<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#4F46E5">
    <title>×¨×©×™××ª ×§× ×™×•×ª ××©×¤×—×ª×™×ª Pro</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class'
        }
    </script>
    
    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, onSnapshot, query, orderBy, setDoc, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyD3pwFMmo4mMjxgzUz5oPynt0D68Yy3Iz0",
            authDomain: "shooping-list-d846b.firebaseapp.com",
            projectId: "shooping-list-d846b",
            storageBucket: "shooping-list-d846b.firebasestorage.app",
            messagingSenderId: "1099114666122",
            appId: "1:1099114666122:web:5c704bf2da52aa3ca63573"
        };
        
        const app = initializeApp(firebaseConfig);
        window.db = getFirestore(app);
        window.firestore = { collection, addDoc, updateDoc, deleteDoc, doc, onSnapshot, query, orderBy, setDoc, getDoc };
    </script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const CATEGORIES = {
            fruits: '×¤×™×¨×•×ª ×•×™×¨×§×•×ª',
            dairy: '×—×œ×‘×™',
            desserts: '××¢×“× ×™ ×—×œ×‘',
            meat: '×‘×©×¨ ×•×“×’×™×',
            deli: '××¢×“× ×™×”',
            bakery: '×œ×—× ×•×××¤×™×',
            cereals: '×“×’× ×™× ×•×§×•×¨× ×¤×œ×§×¡',
            canned: '×©×™××•×¨×™× ×•××–×•×Ÿ ×™×‘×©',
            spices: '×ª×‘×œ×™× ×™× ×•×‘×™×©×•×œ',
            coffee: '×§×¤×” ×•×ª×”',
            drinks: '××©×§××•×ª',
            snacks: '×—×˜×™×¤×™× ×•×××ª×§×™×',
            frozen: '×§×¤×•××™×',
            health: '×“×™××˜×” ×•×—×œ×‘×•×Ÿ',
            hygiene: '×”×™×’×™×™× ×” ×•×¨×—×¦×”',
            cleaning: '× ×™×§×™×•×Ÿ',
            candles: '× ×¨×•×ª ×•×©××Ÿ',
            other: '××—×¨'
        };

        const FAMILY_MEMBERS = [
            { id: 'member1', name: '××‘×', color: 'bg-blue-100 text-blue-800 border-blue-300 dark:bg-blue-900 dark:text-blue-200' },
            { id: 'member2', name: '×××', color: 'bg-pink-100 text-pink-800 border-pink-300 dark:bg-pink-900 dark:text-pink-200' },
            { id: 'member3', name: '×¢××™×ª', color: 'bg-green-100 text-green-800 border-green-300 dark:bg-green-900 dark:text-green-200' },
            { id: 'member4', name: '×¨×•× ×™', color: 'bg-yellow-100 text-yellow-800 border-yellow-300 dark:bg-yellow-900 dark:text-yellow-200' },
            { id: 'member5', name: '× ×•×¢×”', color: 'bg-purple-100 text-purple-800 border-purple-300 dark:bg-purple-900 dark:text-purple-200' },
            { id: 'member6', name: '×××•×¨', color: 'bg-orange-100 text-orange-800 border-orange-300 dark:bg-orange-900 dark:text-orange-200' }
        ];

        const PRODUCTS = [
            // Dairy - ×—×œ×‘×™
            { name: '×—×œ×‘', category: 'dairy', avgPrice: 6 },
            { name: '×œ×‘×Ÿ', category: 'dairy', avgPrice: 5 },
            { name: '×’×‘×™× ×” ×¦×”×•×‘×”', category: 'dairy', avgPrice: 25 },
            { name: '×§×•×˜×’×³', category: 'dairy', avgPrice: 8 },
            { name: '×’×‘×™× ×” ×‘×•×œ×’×¨×™×ª', category: 'dairy', avgPrice: 8 },
            { name: '×¦×¤×ª×™×ª', category: 'dairy', avgPrice: 10 },
            { name: '×’×‘×™× ×ª ×©×× ×ª', category: 'dairy', avgPrice: 12 },
            { name: '×¤×¨××–×Ÿ', category: 'dairy', avgPrice: 20 },
            { name: '××•×¦×¨×œ×”', category: 'dairy', avgPrice: 18 },
            { name: '×‘×™×¦×™×', category: 'dairy', avgPrice: 18 },
            { name: '×—×××”', category: 'dairy', avgPrice: 12 },
            { name: '×©×× ×ª ××ª×•×§×”', category: 'dairy', avgPrice: 8 },
            { name: '×©×× ×ª ×—××•×¦×”', category: 'dairy', avgPrice: 8 },
            { name: '×™×•×’×•×¨×˜', category: 'dairy', avgPrice: 6 },
            { name: '×™×•×’×•×¨×˜ ×™×•×•× ×™', category: 'dairy', avgPrice: 10 },
            { name: '×’×‘×™× ×” ×œ×‘× ×”', category: 'dairy', avgPrice: 9 },
            { name: '×™×•×’×•×¨×˜ ××•×¨×’× ×™', category: 'dairy', avgPrice: 12 },
            { name: '×™×•×’×•×¨×˜ ×œ×™×œ×“×™×', category: 'dairy', avgPrice: 7 },
            { name: '×’×‘×™× ×ª ×¢×–×™×', category: 'dairy', avgPrice: 22 },
            { name: '×’×‘×™× ×ª ×¨×•×§×¤×•×¨', category: 'dairy', avgPrice: 25 },
            { name: '×§×©×§×‘×œ', category: 'dairy', avgPrice: 20 },
            { name: '×’××•×“×”', category: 'dairy', avgPrice: 24 },
            { name: '×—×œ×•××™', category: 'dairy', avgPrice: 18 },
            { name: '×¤×™×œ×“×œ×¤×™×”', category: 'dairy', avgPrice: 15 },
            { name: '×œ××‘× ×”', category: 'dairy', avgPrice: 8 },
            { name: '×’×‘×™× ×ª ×ª×¤×•×—', category: 'dairy', avgPrice: 10 },
            { name: '×—×××” ×‘×¦×œ', category: 'dairy', avgPrice: 10 },
            { name: '×—×××” ×©×•×', category: 'dairy', avgPrice: 10 },
            { name: '××¨×’×¨×™× ×”', category: 'dairy', avgPrice: 8 },
            
            // Fruits & Vegetables - ×¤×™×¨×•×ª ×•×™×¨×§×•×ª
            { name: '×¢×’×‘× ×™×•×ª', category: 'fruits', avgPrice: 8 },
            { name: '××œ×¤×¤×•× ×™×', category: 'fruits', avgPrice: 6 },
            { name: '×‘×¦×œ', category: 'fruits', avgPrice: 4 },
            { name: '×©×•×', category: 'fruits', avgPrice: 10 },
            { name: '×¤×œ×¤×œ ××“×•×', category: 'fruits', avgPrice: 12 },
            { name: '×¤×œ×¤×œ ×™×¨×•×§', category: 'fruits', avgPrice: 10 },
            { name: '×—×¡×”', category: 'fruits', avgPrice: 5 },
            { name: '×›×¨×•×‘', category: 'fruits', avgPrice: 6 },
            { name: '×’×–×¨', category: 'fruits', avgPrice: 5 },
            { name: '×¡×œ×§', category: 'fruits', avgPrice: 6 },
            { name: '×ª×¤×•×—×™ ××“××”', category: 'fruits', avgPrice: 6 },
            { name: '×‘×˜×˜×”', category: 'fruits', avgPrice: 8 },
            { name: '×§×™×©×•×', category: 'fruits', avgPrice: 7 },
            { name: '×—×¦×™×œ', category: 'fruits', avgPrice: 8 },
            { name: '×‘×¨×•×§×•×œ×™', category: 'fruits', avgPrice: 10 },
            { name: '×›×¨×•×‘×™×ª', category: 'fruits', avgPrice: 8 },
            { name: '×ª×¨×“', category: 'fruits', avgPrice: 6 },
            { name: '×©××™×¨', category: 'fruits', avgPrice: 4 },
            { name: '×˜×¨×’×•×Ÿ', category: 'fruits', avgPrice: 3 },
            { name: '×¨××©×”', category: 'fruits', avgPrice: 5 },
            { name: '×¨×™×—×Ÿ', category: 'fruits', avgPrice: 5 },
            { name: '× ×¢× ×¢', category: 'fruits', avgPrice: 3 },
            { name: '×¨×•×§×˜', category: 'fruits', avgPrice: 6 },
            { name: '×¤×˜×¨×•×–×™×œ×™×”', category: 'fruits', avgPrice: 3 },
            { name: '×›×•×¡×‘×¨×”', category: 'fruits', avgPrice: 3 },
            { name: '×¡×œ×¨×™', category: 'fruits', avgPrice: 6 },
            { name: '×©×•××¨', category: 'fruits', avgPrice: 7 },
            { name: '×œ×™××•×Ÿ', category: 'fruits', avgPrice: 8 },
            { name: '×œ×™×™×', category: 'fruits', avgPrice: 10 },
            { name: '×‘× × ×•×ª', category: 'fruits', avgPrice: 8 },
            { name: '×ª×¤×•×—×™×', category: 'fruits', avgPrice: 10 },
            { name: '×ª×¤×•×–×™×', category: 'fruits', avgPrice: 8 },
            { name: '××‘×˜×™×—', category: 'fruits', avgPrice: 15 },
            { name: '××œ×•×Ÿ', category: 'fruits', avgPrice: 12 },
            { name: '×¢× ×‘×™×', category: 'fruits', avgPrice: 18 },
            { name: '××’×¡', category: 'fruits', avgPrice: 12 },
            { name: '×©×–×™×¤×™×', category: 'fruits', avgPrice: 15 },
            { name: '××¤×¨×¡×§×™×', category: 'fruits', avgPrice: 14 },
            { name: '× ×§×˜×¨×™× ×•×ª', category: 'fruits', avgPrice: 14 },
            { name: '×§×œ×× ×˜×™× ×•×ª', category: 'fruits', avgPrice: 10 },
            { name: '×§×™×•×•×™', category: 'fruits', avgPrice: 12 },
            { name: '×¨×™××•× ×™×', category: 'fruits', avgPrice: 15 },
            
            // Bakery - ×œ×—× ×•×××¤×™×
            { name: '×œ×—×', category: 'bakery', avgPrice: 7 },
            { name: '×—×œ×”', category: 'bakery', avgPrice: 10 },
            { name: '×¢×•×’×™×•×ª', category: 'bakery', avgPrice: 12 },
            { name: '×¤×™×ª×•×ª', category: 'bakery', avgPrice: 8 },
            { name: '×œ×—×× ×™×•×ª', category: 'bakery', avgPrice: 10 },
            
            // Meat & Fish - ×‘×©×¨ ×•×“×’×™×
            { name: '×¢×•×£ ×©×œ×', category: 'meat', avgPrice: 35 },
            { name: '×—×–×” ×¢×•×£', category: 'meat', avgPrice: 40 },
            { name: '×›×¨×¢×™×™× ×¢×•×£', category: 'meat', avgPrice: 25 },
            { name: '×›× ×¤×™×™× ×¢×•×£', category: 'meat', avgPrice: 20 },
            { name: '×¢×•×£ ×˜×—×•×Ÿ', category: 'meat', avgPrice: 35 },
            { name: '×‘×©×¨ ×˜×—×•×Ÿ', category: 'meat', avgPrice: 45 },
            { name: '×× ×˜×¨×™×§×•×˜', category: 'meat', avgPrice: 60 },
            { name: '×¤×™×œ×” ×¢×•×£', category: 'meat', avgPrice: 45 },
            { name: '×“×’×™×', category: 'meat', avgPrice: 50 },
            { name: '×©× ×™×¦×œ', category: 'meat', avgPrice: 40 },
            
            // Desserts - ××¢×“× ×™ ×—×œ×‘
            { name: '××™×œ×§×™', category: 'desserts', avgPrice: 8 },
            { name: '×“× ×•× ×”', category: 'desserts', avgPrice: 7 },
            { name: '×™×•×¤×œ×”', category: 'desserts', avgPrice: 6 },
            { name: '×“× ×™××œ×”', category: 'desserts', avgPrice: 7 },
            { name: '××¢×“×Ÿ ×•× ×™×œ', category: 'desserts', avgPrice: 6 },
            { name: '××¢×“×Ÿ ×©×•×§×•×œ×“', category: 'desserts', avgPrice: 6 },
            { name: '××¢×“×Ÿ ×§×¨××œ', category: 'desserts', avgPrice: 7 },
            { name: '××¢×“×Ÿ ×‘×™×¡×§×•×•×™×˜×™×', category: 'desserts', avgPrice: 7 },
            { name: '××¢×“×Ÿ ×œ×•×˜×•×¡', category: 'desserts', avgPrice: 8 },
            { name: '×©×•×§×• ×™×˜×‘×ª×”', category: 'desserts', avgPrice: 8 },
            { name: '×¤×•×“×™× ×’', category: 'desserts', avgPrice: 7 },
            { name: '××¢×“×Ÿ ×™×•×’×•×¨×˜', category: 'desserts', avgPrice: 6 },
            { name: '××¢×“×Ÿ ×ª×•×ª', category: 'desserts', avgPrice: 7 },
            { name: '××¢×“×Ÿ ×‘× × ×”', category: 'desserts', avgPrice: 7 },
            { name: '××•×¡ ×©×•×§×•×œ×“', category: 'desserts', avgPrice: 8 },
            { name: '××•×¡ ×•× ×™×œ', category: 'desserts', avgPrice: 8 },
            
            // Deli - ××¢×“× ×™×”
            { name: '× ×§× ×™×§×™×•×ª', category: 'deli', avgPrice: 18 },
            { name: '×¡×œ××™', category: 'deli', avgPrice: 25 },
            { name: '×¤×¡×˜×¨××”', category: 'deli', avgPrice: 30 },
            { name: '×§×‘× ×•×¡', category: 'deli', avgPrice: 20 },
            { name: '× ×§× ×™×§ ××¢×•×©×Ÿ', category: 'deli', avgPrice: 22 },
            
            // Canned & Dry Goods - ×©×™××•×¨×™× ×•××–×•×Ÿ ×™×‘×©
            { name: '××•×¨×–', category: 'canned', avgPrice: 8 },
            { name: '×¤×¡×˜×”', category: 'canned', avgPrice: 6 },
            { name: '×§×•×¡×§×•×¡', category: 'canned', avgPrice: 7 },
            { name: '×§×˜× ×™×•×ª', category: 'canned', avgPrice: 10 },
            { name: '×¨×•×˜×‘ ×¢×’×‘× ×™×•×ª', category: 'canned', avgPrice: 8 },
            { name: '×˜×•× ×”', category: 'canned', avgPrice: 12 },
            { name: '×ª×™×¨×¡', category: 'canned', avgPrice: 8 },
            { name: '×©××Ÿ ×–×™×ª', category: 'canned', avgPrice: 25 },
            { name: '×©××Ÿ ×§× ×•×œ×”', category: 'canned', avgPrice: 15 },
            { name: '×©××Ÿ ×—×× ×™×•×ª', category: 'canned', avgPrice: 12 },
            { name: '×©××Ÿ ×ª×™×¨×¡', category: 'canned', avgPrice: 14 },
            { name: '×©××Ÿ ×–×™×ª ×›×ª×™×ª ××¢×•×œ×”', category: 'canned', avgPrice: 35 },
            { name: '×©××Ÿ ×–×™×ª ×¤×•××™×™×¡', category: 'canned', avgPrice: 20 },
            { name: '×—×•××¥ ×‘×œ×¡××™', category: 'canned', avgPrice: 18 },
            { name: '×—×•××¥ ×™×™×Ÿ ××“×•×', category: 'canned', avgPrice: 12 },
            { name: '×—×•××¥ ×™×™×Ÿ ×œ×‘×Ÿ', category: 'canned', avgPrice: 12 },
            { name: '×—×•××¥ ×ª×¤×•×—×™×', category: 'canned', avgPrice: 10 },
            { name: '××™×¥ ×œ×™××•×Ÿ', category: 'canned', avgPrice: 8 },
            { name: '×—×•××•×¡ ×˜×—×•×Ÿ', category: 'canned', avgPrice: 10 },
            { name: '×˜×—×™× ×” ×’×•×œ××™×ª', category: 'canned', avgPrice: 15 },
            { name: '×˜×—×™× ×” ××¢×•×¨×‘×ª', category: 'canned', avgPrice: 18 },
            { name: '×××¨×— ×©×•×', category: 'canned', avgPrice: 10 },
            { name: '×–×™×ª×™×', category: 'canned', avgPrice: 12 },
            { name: '××œ×¤×¤×•×Ÿ ×—××•×¥', category: 'canned', avgPrice: 10 },
            { name: '×¤×œ×¤×œ ×—×¨×™×£', category: 'canned', avgPrice: 8 },
            { name: '×¨×™×‘×”', category: 'canned', avgPrice: 12 },
            { name: '×“×‘×©', category: 'canned', avgPrice: 25 },
            { name: '×‘×•×˜× ×™×', category: 'canned', avgPrice: 10 },
            { name: '×©×•××©×•×', category: 'canned', avgPrice: 12 },
            { name: '×¤×¨×’', category: 'canned', avgPrice: 8 },
            { name: '×—×™×˜×”', category: 'canned', avgPrice: 10 },
            { name: '×‘×•×¨×’×•×œ', category: 'canned', avgPrice: 8 },
            { name: '×§×™× ×•××”', category: 'canned', avgPrice: 20 },
            { name: '× ×•×“×œ×¡', category: 'canned', avgPrice: 8 },
            { name: '××˜×¨×™×•×ª ×¡×™× ×™×•×ª', category: 'canned', avgPrice: 10 },
            
            // Cereals - ×“×’× ×™× ×•×§×•×¨× ×¤×œ×§×¡
            { name: '×¤×ª×™×ª×™ ×ª×™×¨×¡', category: 'cereals', avgPrice: 15 },
            { name: '×§×•×¨× ×¤×œ×§×¡', category: 'cereals', avgPrice: 18 },
            { name: '×’×¨× ×•×œ×”', category: 'cereals', avgPrice: 20 },
            { name: '××•×–×œ×™', category: 'cereals', avgPrice: 22 },
            { name: '×©×™×‘×•×œ×ª ×©×•×¢×œ', category: 'cereals', avgPrice: 12 },
            { name: '×¤×¦×¤×•×¦×™ ××•×¨×–', category: 'cereals', avgPrice: 14 },
            { name: '×§×•×•××§×¨', category: 'cereals', avgPrice: 18 },
            { name: '×“×’× ×™ ×‘×•×§×¨', category: 'cereals', avgPrice: 16 },
            { name: '×¤×ª×™×ª×™ ×©×•×§×•×œ×“', category: 'cereals', avgPrice: 16 },
            { name: '×¤×ª×™×ª×™ ×“×‘×©', category: 'cereals', avgPrice: 16 },
            { name: '××™× ×™ ×•×•×™×˜×¡', category: 'cereals', avgPrice: 18 },
            { name: '×¤×¨×•×¡×˜×™×–', category: 'cereals', avgPrice: 17 },
            { name: '×›×¨×™×•×ª ×©×•×§×•×œ×“', category: 'cereals', avgPrice: 15 },
            
            // Spices - ×ª×‘×œ×™× ×™× ×•×‘×™×©×•×œ
            { name: '××œ×—', category: 'spices', avgPrice: 5 },
            { name: '×¡×•×›×¨', category: 'spices', avgPrice: 8 },
            { name: '×¡×•×›×¨ ×—×•×', category: 'spices', avgPrice: 10 },
            { name: '×¡×•×›×¨ ×”××¨×”', category: 'spices', avgPrice: 7 },
            { name: '×¡×•×›×¨ ×’×•×œ×Ÿ', category: 'spices', avgPrice: 9 },
            { name: '×§×•×‘×™×•×ª ×¡×•×›×¨', category: 'spices', avgPrice: 8 },
            { name: '×¤×œ×¤×œ ×©×—×•×¨', category: 'spices', avgPrice: 10 },
            { name: '×¤×¤×¨×™×§×”', category: 'spices', avgPrice: 8 },
            { name: '×›×•×¨×›×•×', category: 'spices', avgPrice: 10 },
            { name: '×›××•×Ÿ', category: 'spices', avgPrice: 12 },
            { name: '×§×™× ××•×Ÿ', category: 'spices', avgPrice: 10 },
            { name: '××‘×§×ª ×©×•×', category: 'spices', avgPrice: 8 },
            { name: '××‘×§×ª ×‘×¦×œ', category: 'spices', avgPrice: 8 },
            { name: '××•×¨×’× ×•', category: 'spices', avgPrice: 10 },
            { name: '×‘×–×™×œ×™×§×•×', category: 'spices', avgPrice: 10 },
            { name: '×–×¢×ª×¨', category: 'spices', avgPrice: 12 },
            { name: '×—×•×•××™×™×’×³', category: 'spices', avgPrice: 15 },
            { name: '×ª×‘×œ×™×Ÿ ×œ×¢×•×£', category: 'spices', avgPrice: 10 },
            { name: '×ª×‘×œ×™×Ÿ ×œ×“×’×™×', category: 'spices', avgPrice: 10 },
            { name: '×§××¨×™', category: 'spices', avgPrice: 12 },
            { name: '×§××— ×œ×‘×Ÿ', category: 'spices', avgPrice: 6 },
            { name: '×§××— ××œ×', category: 'spices', avgPrice: 8 },
            { name: '×©××¨×™×', category: 'spices', avgPrice: 6 },
            { name: '××‘×§×ª ××¤×™×™×”', category: 'spices', avgPrice: 8 },
            { name: '×¡×•×“×” ×œ×©×ª×™×™×”', category: 'spices', avgPrice: 6 },
            { name: '×•× ×™×œ', category: 'spices', avgPrice: 10 },
            { name: '×©×•×§×•×œ×“ ×¦×³×™×¤×¡', category: 'spices', avgPrice: 12 },
            { name: '××’×•×–×™×', category: 'spices', avgPrice: 20 },
            { name: '×©×§×“×™×', category: 'spices', avgPrice: 25 },
            { name: '××’×•×–×™ ××œ×š', category: 'spices', avgPrice: 30 },
            { name: '×§×©×™×•', category: 'spices', avgPrice: 28 },
            { name: '×¦×™××•×§×™×', category: 'spices', avgPrice: 15 },
            { name: '×ª××¨×™×', category: 'spices', avgPrice: 18 },
            { name: '×¢×“×©×™×', category: 'spices', avgPrice: 8 },
            { name: '×—×•××•×¡ ×™×‘×©', category: 'spices', avgPrice: 10 },
            { name: '×¤×•×œ', category: 'spices', avgPrice: 8 },
            { name: '×©×¢×•×¢×™×ª ×œ×‘× ×”', category: 'spices', avgPrice: 10 },
            { name: '×©×¢×•×¢×™×ª ××“×•××”', category: 'spices', avgPrice: 10 },
            { name: '×›×•×¡××ª', category: 'spices', avgPrice: 12 },
            { name: '×‘×•×¨×’×•×œ ×“×§', category: 'spices', avgPrice: 8 },
            
            // Coffee & Tea - ×§×¤×” ×•×ª×”
            { name: '×§×¤×” × ××¡', category: 'coffee', avgPrice: 25 },
            { name: '×§×¤×” ×˜×•×¨×§×™', category: 'coffee', avgPrice: 20 },
            { name: '×§×¤×” × ×¡×¤×¨×¡×•', category: 'coffee', avgPrice: 30 },
            { name: '×§×¤×¡×•×œ×•×ª ×§×¤×”', category: 'coffee', avgPrice: 35 },
            { name: '×§×¤×” ×©×—×•×¨ ×˜×—×•×Ÿ', category: 'coffee', avgPrice: 28 },
            { name: '×§×¤×” × ×˜×•×œ ×§×¤××™×Ÿ', category: 'coffee', avgPrice: 30 },
            { name: '×ª×” ×©×—×•×¨', category: 'coffee', avgPrice: 15 },
            { name: '×ª×” ×™×¨×•×§', category: 'coffee', avgPrice: 18 },
            { name: '×ª×” ×¦××—×™×', category: 'coffee', avgPrice: 16 },
            { name: '×ª×” × ×¢× ×¢', category: 'coffee', avgPrice: 14 },
            { name: '×ª×” ×œ×•××™×–×”', category: 'coffee', avgPrice: 15 },
            { name: '×ª×” ×œ×™×¤×˜×•×Ÿ', category: 'coffee', avgPrice: 16 },
            { name: '×ª×” ×•×™×¡×•×¦×§×™', category: 'coffee', avgPrice: 18 },
            { name: '×§×¤×” ×¢×œ×™×ª', category: 'coffee', avgPrice: 28 },
            { name: '×§×¤×¡×•×œ×•×ª × ×¡×¤×¨×¡×•', category: 'coffee', avgPrice: 40 },
            { name: '×§×¤×¡×•×œ×•×ª ×“×•×œ×¦×³×” ×’×•×¡×˜×•', category: 'coffee', avgPrice: 38 },
            { name: '×§×¤×¡×•×œ×•×ª ×œ× ×“×•×•×¨', category: 'coffee', avgPrice: 35 },
            { name: '×§×¤×¡×•×œ×•×ª ×˜××¡×™××•', category: 'coffee', avgPrice: 36 },
            { name: '×—×œ×‘ ××¨×•×›×–', category: 'coffee', avgPrice: 10 },
            { name: '×¡×•×›×¨ ×œ×§×¤×”', category: 'coffee', avgPrice: 8 },
            { name: '×××ª×™×§ ×¡×•×›×¨×œ×•×–', category: 'coffee', avgPrice: 20 },
            { name: '×××ª×™×§ ×¡×˜×™×‘×™×”', category: 'coffee', avgPrice: 22 },
            
            // Drinks - ××©×§××•×ª
            { name: '××™× ××™× ×¨×œ×™×', category: 'drinks', avgPrice: 5 },
            { name: '×§×•×œ×”', category: 'drinks', avgPrice: 8 },
            { name: '×¡×¤×¨×™×™×˜', category: 'drinks', avgPrice: 8 },
            { name: '××™×¥', category: 'drinks', avgPrice: 10 },
            { name: '×¤×¨×™×’×ª', category: 'drinks', avgPrice: 6 },
            { name: '××™×™×¡ ×§×¤×”', category: 'drinks', avgPrice: 12 },
            { name: '× ×‘×™×¢×•×ª', category: 'drinks', avgPrice: 8 },
            { name: '×ª×¤×•×–×™× ×”', category: 'drinks', avgPrice: 10 },
            { name: '×œ×™××•× ×“×”', category: 'drinks', avgPrice: 8 },
            
            // Snacks - ×—×˜×™×¤×™× ×•×××ª×§×™×
            { name: '×‘××‘×”', category: 'snacks', avgPrice: 8 },
            { name: '×‘×™×¡×œ×™', category: 'snacks', avgPrice: 10 },
            { name: '×“×•×¨×™×˜×•×¡', category: 'snacks', avgPrice: 12 },
            { name: '×˜×•×¨×˜×™×™×”', category: 'snacks', avgPrice: 10 },
            { name: '×¤×•×¤×§×•×¨×Ÿ', category: 'snacks', avgPrice: 8 },
            { name: '×©×•×§×•×œ×“ ×¤×¨×”', category: 'snacks', avgPrice: 12 },
            { name: '×©×•×§×•×œ×“ ××™×œ×§×™', category: 'snacks', avgPrice: 10 },
            { name: '×©×•×§×•×œ×“ ×—×œ×‘', category: 'snacks', avgPrice: 12 },
            { name: '×©×•×§×•×œ×“ ××¨×™×¨', category: 'snacks', avgPrice: 14 },
            { name: '× ×•×˜×œ×”', category: 'snacks', avgPrice: 20 },
            { name: '×××¨×— ×©×•×§×•×œ×“', category: 'snacks', avgPrice: 15 },
            { name: '×—×˜×™×£ ×× ×¨×’×™×”', category: 'snacks', avgPrice: 8 },
            { name: '×‘×™×¡×§×•×•×™×˜×™×', category: 'snacks', avgPrice: 10 },
            { name: '×§×œ×™×§', category: 'snacks', avgPrice: 12 },
            { name: '×ª×¤×•×¦×³×™×¤×¡', category: 'snacks', avgPrice: 10 },
            { name: '×•×•×¤×œ×™×', category: 'snacks', avgPrice: 8 },
            { name: '×•×•×¤×œ×™', category: 'snacks', avgPrice: 8 },
            { name: '×¢×•×’×ª ×“×‘×©', category: 'snacks', avgPrice: 15 },
            { name: '××¨×©××œ×•', category: 'snacks', avgPrice: 10 },
            { name: '×¡×•×›×¨×™×•×ª', category: 'snacks', avgPrice: 6 },
            { name: '××¡×˜×™×§', category: 'snacks', avgPrice: 5 },
            
            // Frozen - ×§×¤×•××™×
            { name: '×’×œ×™×“×”', category: 'frozen', avgPrice: 20 },
            { name: '×™×¨×§×•×ª ×§×¤×•××™×', category: 'frozen', avgPrice: 12 },
            { name: '×©× ×™×¦×œ ×§×¤×•×', category: 'frozen', avgPrice: 35 },
            { name: '×¤×™×¦×” ×§×¤×•××”', category: 'frozen', avgPrice: 25 },
            { name: '×‘×¦×§ ×¢×œ×™× ×§×¤×•×', category: 'frozen', avgPrice: 18 },
            { name: '×‘×¦×§ ×¤×™×œ×• ×§×¤×•×', category: 'frozen', avgPrice: 15 },
            { name: '×‘×¦×§ ×¤×™×¦×” ×§×¤×•×', category: 'frozen', avgPrice: 12 },
            { name: '×‘×¦×§ ×’×³×—× ×•×Ÿ ×§×¤×•×', category: 'frozen', avgPrice: 14 },
            { name: '×‘×¦×§ ××œ×•×•×— ×§×¤×•×', category: 'frozen', avgPrice: 14 },
            { name: '×‘×¦×§ ×¡××‘×•×¡×§ ×§×¤×•×', category: 'frozen', avgPrice: 16 },
            { name: '×‘×¦×§ ×‘×•×¨×§×¡ ×§×¤×•×', category: 'frozen', avgPrice: 16 },
            { name: '×§×•×‘×™×•×ª ×‘×¦×§ ×§×¤×•×', category: 'frozen', avgPrice: 15 },
            { name: '×¤×™×¨×•×ª ×§×¤×•××™×', category: 'frozen', avgPrice: 18 },
            { name: '×ª×•×ª×™× ×§×¤×•××™×', category: 'frozen', avgPrice: 20 },
            
            // Health - ×“×™××˜×” ×•×—×œ×‘×•×Ÿ
            { name: '×™×•×’×•×¨×˜ ×™×•×•× ×™ 0%', category: 'health', avgPrice: 12 },
            { name: '×™×•×’×•×¨×˜ ×—×œ×‘×•×Ÿ', category: 'health', avgPrice: 10 },
            { name: '×§×•×˜×’×³ 5%', category: 'health', avgPrice: 8 },
            { name: '×§×•×˜×’×³ 3%', category: 'health', avgPrice: 8 },
            { name: '×’×‘×™× ×ª ×§×•×˜×’×³ 0%', category: 'health', avgPrice: 9 },
            { name: '×—×œ×‘ ×¡×•×™×”', category: 'health', avgPrice: 10 },
            { name: '×—×œ×‘ ×©×§×“×™×', category: 'health', avgPrice: 12 },
            { name: '×—×œ×‘ ×“×œ ×©×•××Ÿ', category: 'health', avgPrice: 6 },
            { name: '×©×™×™×§ ×—×œ×‘×•×Ÿ', category: 'health', avgPrice: 15 },
            { name: '×¤×¨×•×˜××™×Ÿ ×‘×¨', category: 'health', avgPrice: 8 },
            { name: '××‘×§×ª ×—×œ×‘×•×Ÿ', category: 'health', avgPrice: 120 },
            { name: '×œ×—× ××œ×', category: 'health', avgPrice: 8 },
            { name: '×¤×™×ª×” ××œ××”', category: 'health', avgPrice: 10 },
            { name: '×§×¨×§×¨ ×“×’× ×™×', category: 'health', avgPrice: 12 },
            { name: '×—×˜×™×£ ×—×œ×‘×•×Ÿ', category: 'health', avgPrice: 10 },
            { name: '×˜×•× ×” ×‘××™×', category: 'health', avgPrice: 12 },
            { name: '×—×–×” ×¢×•×£ ××¢×•×©×Ÿ', category: 'health', avgPrice: 30 },
            { name: '×‘×™×• ×™×•×’×•×¨×˜', category: 'health', avgPrice: 8 },
            { name: '×¤×¨×•×‘×™×•×˜×™×§×”', category: 'health', avgPrice: 15 },
            { name: '×—×œ×‘ ×¡×¨×”', category: 'health', avgPrice: 10 },
            
            // Cleaning - × ×™×§×™×•×Ÿ
            { name: '× ×™×¨ ×˜×•××œ×˜', category: 'cleaning', avgPrice: 25 },
            { name: '××’×‘×•×ª × ×™×¨', category: 'cleaning', avgPrice: 20 },
            { name: '×¡×‘×•×Ÿ ×›×œ×™×', category: 'cleaning', avgPrice: 12 },
            { name: '××‘×§×ª ×›×‘×™×¡×”', category: 'cleaning', avgPrice: 35 },
            { name: '××¨×›×š ×›×‘×™×¡×”', category: 'cleaning', avgPrice: 25 },
            { name: '××§×•× ×•××™×§×”', category: 'cleaning', avgPrice: 10 },
            { name: '×¡×™×£', category: 'cleaning', avgPrice: 15 },
            { name: '×× ×§×” ×¨×¦×¤×•×ª', category: 'cleaning', avgPrice: 18 },
            { name: '×× ×§×” ×—×œ×•× ×•×ª', category: 'cleaning', avgPrice: 15 },
            { name: '×× ×§×” ×××‘×˜×™×”', category: 'cleaning', avgPrice: 18 },
            { name: '××‘×§×ª × ×™×§×•×™', category: 'cleaning', avgPrice: 12 },
            { name: '×¡×¤×•×’×™× ×œ××˜×‘×—', category: 'cleaning', avgPrice: 10 },
            { name: '×©×§×™×•×ª ××©×¤×”', category: 'cleaning', avgPrice: 20 },
            { name: '× ×•×–×œ ×›×œ×™×', category: 'cleaning', avgPrice: 12 },
            { name: '×˜×‘×œ×™×•×ª ×œ××“×™×—', category: 'cleaning', avgPrice: 30 },
            { name: '××œ×— ×œ××“×™×—', category: 'cleaning', avgPrice: 15 },
            { name: '× ×•×–×œ ×©×˜×™×¤×” ×œ××“×™×—', category: 'cleaning', avgPrice: 18 },
            { name: '××‘×§×ª ×¡×•×“×”', category: 'cleaning', avgPrice: 8 },
            { name: '×—×•××¥ ×œ× ×™×§×™×•×Ÿ', category: 'cleaning', avgPrice: 10 },
            
            // Hygiene - ×”×™×’×™×™× ×” ×•×¨×—×¦×”
            { name: '×¡×‘×•×Ÿ ×™×“×™×™×', category: 'hygiene', avgPrice: 15 },
            { name: '××’×‘×•× ×™× ×œ×—×™×', category: 'hygiene', avgPrice: 12 },
            { name: '××‘×¨×©×ª ×©×™× ×™×™×', category: 'hygiene', avgPrice: 10 },
            { name: '××©×—×ª ×©×™× ×™×™×', category: 'hygiene', avgPrice: 15 },
            { name: '××™ ×¤×”', category: 'hygiene', avgPrice: 20 },
            { name: '×—×•×˜ ×“× ×˜×œ×™', category: 'hygiene', avgPrice: 12 },
            { name: '×©××¤×•', category: 'hygiene', avgPrice: 20 },
            { name: '××¨×›×š ×©×™×¢×¨', category: 'hygiene', avgPrice: 20 },
            { name: '×©××¤×• ×œ×™×œ×“×™×', category: 'hygiene', avgPrice: 18 },
            { name: '×¡×‘×•×Ÿ ×’×•×£', category: 'hygiene', avgPrice: 15 },
            { name: '×’×³×œ ×¨×—×¦×”', category: 'hygiene', avgPrice: 18 },
            { name: '××¡×›×” ×œ×©×™×¢×¨', category: 'hygiene', avgPrice: 25 },
            { name: '×§×¨× ×’×™×œ×•×—', category: 'hygiene', avgPrice: 20 },
            { name: '×¡×›×™× ×™ ×’×™×œ×•×—', category: 'hygiene', avgPrice: 30 },
            { name: '×“××•×“×•×¨× ×˜', category: 'hygiene', avgPrice: 18 },
            { name: '×§×¨× ×¤× ×™×', category: 'hygiene', avgPrice: 40 },
            { name: '×§×¨× ×™×“×™×™×', category: 'hygiene', avgPrice: 20 },
            { name: '×§×¨× ×’×•×£', category: 'hygiene', avgPrice: 30 },
            { name: '××‘×¨×©×ª ×©×™×¢×¨', category: 'hygiene', avgPrice: 25 },
            { name: '×’×³×œ ×œ×©×™×¢×¨', category: 'hygiene', avgPrice: 20 },
            { name: '×¡×¤×¨×™×™ ×œ×©×™×¢×¨', category: 'hygiene', avgPrice: 25 },
            { name: '×ª×—×‘×•×©×•×ª', category: 'hygiene', avgPrice: 15 },
            { name: '×¤×œ×¡×˜×¨×™×”', category: 'hygiene', avgPrice: 10 },
            { name: '×¦××¨ ×’×¤×Ÿ', category: 'hygiene', avgPrice: 12 },
            { name: '××§×œ×•× ×™ ××•×–× ×™×™×', category: 'hygiene', avgPrice: 8 },
            { name: '×˜××¤×•× ×™×', category: 'hygiene', avgPrice: 20 },
            { name: '××’× ×™ ×ª×—×ª×•×Ÿ', category: 'hygiene', avgPrice: 18 },
            { name: '×ª×—×ª×•× ×™ × ×™×¨', category: 'hygiene', avgPrice: 25 },
            { name: '×ª×—×ª×•× ×™ ×—×“ ×¤×¢××™', category: 'hygiene', avgPrice: 30 },
            
            // Candles - × ×¨×•×ª ×•×©××Ÿ
            { name: '× ×¨×•×ª ×©×‘×ª', category: 'candles', avgPrice: 15 },
            { name: '× ×¨×•×ª ×—× ×•×›×”', category: 'candles', avgPrice: 10 },
            { name: '× ×¨ × ×©××” 24 ×©×¢×•×ª', category: 'candles', avgPrice: 8 },
            { name: '× ×¨ × ×©××” 7 ×™××™×', category: 'candles', avgPrice: 12 },
            { name: '× ×¨ ×”×‘×“×œ×”', category: 'candles', avgPrice: 6 },
            { name: '×©××Ÿ ×œ× ×¨', category: 'candles', avgPrice: 20 },
            { name: '×©××Ÿ ×¤×¨×¤×™×Ÿ', category: 'candles', avgPrice: 18 }
        ];

        function LoginScreen({ onLogin }) {
            const [customName, setCustomName] = useState('');
            const [showCustomInput, setShowCustomInput] = useState(false);
            const [darkMode, setDarkMode] = useState(false);

            useEffect(() => {
                const saved = localStorage.getItem('darkMode');
                if (saved) {
                    setDarkMode(saved === 'true');
                    if (saved === 'true') {
                        document.documentElement.classList.add('dark');
                    }
                }
            }, []);

            const toggleDarkMode = () => {
                const newMode = !darkMode;
                setDarkMode(newMode);
                localStorage.setItem('darkMode', newMode);
                if (newMode) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-indigo-950 flex items-center justify-center p-4">
                    <div className="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-8 max-w-md w-full">
                        <button onClick={toggleDarkMode} className="absolute top-4 left-4 p-2 rounded-lg bg-gray-200 dark:bg-gray-700">
                            {darkMode ? 'â˜€ï¸' : 'ğŸŒ™'}
                        </button>
                        <div className="text-center mb-8">
                            <div className="text-6xl mb-4">ğŸ›’</div>
                            <h1 className="text-3xl font-bold text-gray-800 dark:text-white mb-2">×¨×©×™××ª ×§× ×™×•×ª Pro</h1>
                            <p className="text-gray-600 dark:text-gray-300">×‘×—×¨ ××ª ×”×©× ×©×œ×š</p>
                            <div className="mt-2 px-4 py-2 bg-green-50 dark:bg-green-900/30 border border-green-200 dark:border-green-700 rounded-lg">
                                <p className="text-sm text-green-800 dark:text-green-300">âœ¨ ××¡×•× ×›×¨×Ÿ ×‘×–××Ÿ ×××ª!</p>
                            </div>
                        </div>
                        <div className="space-y-3 mb-6">
                            {FAMILY_MEMBERS.map(member => (
                                <button key={member.id} onClick={() => onLogin(member)}
                                    className={`w-full p-4 rounded-lg border-2 ${member.color} hover:shadow-lg transition-all font-semibold text-lg`}>
                                    {member.name}
                                </button>
                            ))}
                        </div>
                        {showCustomInput ? (
                            <div className="flex gap-2">
                                <input type="text" value={customName} onChange={e => setCustomName(e.target.value)}
                                    placeholder="×”×›× ×¡ ×©×..." className="flex-1 px-4 py-2 border-2 border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg"
                                    onKeyPress={e => e.key === 'Enter' && customName.trim() && onLogin({ id: 'custom_' + Date.now(), name: customName.trim(), color: 'bg-gray-100 text-gray-800 border-gray-300 dark:bg-gray-700 dark:text-gray-200' })} />
                                <button onClick={() => customName.trim() && onLogin({ id: 'custom_' + Date.now(), name: customName.trim(), color: 'bg-gray-100 text-gray-800 border-gray-300' })}
                                    className="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-semibold">
                                    ×›× ×™×¡×”
                                </button>
                            </div>
                        ) : (
                            <button onClick={() => setShowCustomInput(true)}
                                className="w-full p-3 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg text-gray-600 dark:text-gray-300 hover:border-indigo-400">
                                + ×©× ××—×¨
                            </button>
                        )}
                    </div>
                </div>
            );
        }

        function ShoppingList() {
            const [currentUser, setCurrentUser] = useState(null);
            const [items, setItems] = useState([]);
            const [showAddProduct, setShowAddProduct] = useState(false);
            const [selectedCategory, setSelectedCategory] = useState('all');
            const [newProductName, setNewProductName] = useState('');
            const [newProductCategory, setNewProductCategory] = useState('other');
            const [loading, setLoading] = useState(true);
            const [darkMode, setDarkMode] = useState(false);
            const [searchTerm, setSearchTerm] = useState('');
            const [filterBy, setFilterBy] = useState('all'); // all, purchased, unpurchased
            const [sortBy, setSortBy] = useState('date'); // date, name, quantity
            const [showStats, setShowStats] = useState(false);
            const [budget, setBudget] = useState(0);
            const [showBudget, setShowBudget] = useState(false);
            const [notification, setNotification] = useState(null);

            useEffect(() => {
                const savedUser = localStorage.getItem('current-user');
                const savedDark = localStorage.getItem('darkMode');
                const savedBudget = localStorage.getItem('budget');
                
                if (savedUser) setCurrentUser(JSON.parse(savedUser));
                if (savedDark === 'true') {
                    setDarkMode(true);
                    document.documentElement.classList.add('dark');
                }
                if (savedBudget) setBudget(parseFloat(savedBudget));

                if (window.db && window.firestore) {
                    const q = window.firestore.query(
                        window.firestore.collection(window.db, 'shopping-items'),
                        window.firestore.orderBy('createdAt', 'desc')
                    );
                    
                    const unsubscribe = window.firestore.onSnapshot(q, (snapshot) => {
                        const itemsData = [];
                        snapshot.forEach((doc) => {
                            itemsData.push({ id: doc.id, ...doc.data() });
                        });
                        
                        // Check for new items and show notification
                        if (items.length > 0 && itemsData.length > items.length) {
                            const newItem = itemsData[0];
                            if (newItem.addedBy !== currentUser?.name) {
                                showNotification(`${newItem.addedBy} ×”×•×¡×™×£: ${newItem.name}`);
                            }
                        }
                        
                        setItems(itemsData);
                        setLoading(false);
                    });

                    return () => unsubscribe();
                }
            }, []);

            const showNotification = (message) => {
                setNotification(message);
                setTimeout(() => setNotification(null), 3000);
            };

            const handleLogin = user => {
                localStorage.setItem('current-user', JSON.stringify(user));
                setCurrentUser(user);
            };

            const handleLogout = () => {
                localStorage.removeItem('current-user');
                setCurrentUser(null);
            };

            const toggleDarkMode = () => {
                const newMode = !darkMode;
                setDarkMode(newMode);
                localStorage.setItem('darkMode', newMode);
                if (newMode) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            };

            const saveBudget = () => {
                localStorage.setItem('budget', budget);
                setShowBudget(false);
                showNotification('×ª×§×¦×™×‘ × ×©××¨ ×‘×”×¦×œ×—×”!');
            };

            const addProduct = async (product) => {
                const existing = items.find(item => item.name === product.name && !item.purchased);
                if (existing) {
                    await window.firestore.updateDoc(
                        window.firestore.doc(window.db, 'shopping-items', existing.id),
                        { quantity: existing.quantity + 1 }
                    );
                } else {
                    await window.firestore.addDoc(window.firestore.collection(window.db, 'shopping-items'), {
                        name: product.name,
                        category: product.category,
                        quantity: 1,
                        purchased: false,
                        addedBy: currentUser.name,
                        addedByColor: currentUser.color,
                        createdAt: new Date(),
                        price: product.avgPrice || 0
                    });
                }
            };

            const addCustomProduct = async () => {
                if (newProductName.trim()) {
                    await window.firestore.addDoc(window.firestore.collection(window.db, 'shopping-items'), {
                        name: newProductName.trim(),
                        category: newProductCategory,
                        quantity: 1,
                        purchased: false,
                        addedBy: currentUser.name,
                        addedByColor: currentUser.color,
                        createdAt: new Date(),
                        price: 0
                    });
                    setNewProductName('');
                    setShowAddProduct(false);
                }
            };

            const updateQuantity = async (id, newQuantity) => {
                if (newQuantity < 1) {
                    await window.firestore.deleteDoc(window.firestore.doc(window.db, 'shopping-items', id));
                } else {
                    await window.firestore.updateDoc(window.firestore.doc(window.db, 'shopping-items', id), {
                        quantity: newQuantity
                    });
                }
            };

            const togglePurchased = async (id, currentStatus) => {
                await window.firestore.updateDoc(window.firestore.doc(window.db, 'shopping-items', id), {
                    purchased: !currentStatus
                });
            };

            const clearPurchased = async () => {
                if (!confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×›×œ ×”××•×¦×¨×™× ×©× ×§× ×•?')) return;
                const purchasedItems = items.filter(item => item.purchased);
                for (const item of purchasedItems) {
                    await window.firestore.deleteDoc(window.firestore.doc(window.db, 'shopping-items', item.id));
                }
                showNotification('×”××•×¦×¨×™× ×©× ×§× ×• × ××—×§×•!');
            };

            const exportToWhatsApp = () => {
                const unpurchased = items.filter(item => !item.purchased);
                let text = 'ğŸ›’ ×¨×©×™××ª ×§× ×™×•×ª:\n\n';
                Object.entries(CATEGORIES).forEach(([key, label]) => {
                    const categoryItems = unpurchased.filter(item => item.category === key);
                    if (categoryItems.length > 0) {
                        text += `ğŸ“¦ ${label}:\n`;
                        categoryItems.forEach(item => {
                            text += `  âœ“ ${item.name} (${item.quantity})\n`;
                        });
                        text += '\n';
                    }
                });
                const url = `https://wa.me/?text=${encodeURIComponent(text)}`;
                window.open(url, '_blank');
            };

            if (loading && !currentUser) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-indigo-950 flex items-center justify-center">
                        <div className="text-xl text-gray-600 dark:text-gray-300">×˜×•×¢×Ÿ...</div>
                    </div>
                );
            }

            if (!currentUser) return <LoginScreen onLogin={handleLogin} />;

            // Filter and sort items
            let filteredItems = items.filter(item => {
                if (searchTerm && !item.name.includes(searchTerm)) return false;
                if (filterBy === 'purchased' && !item.purchased) return false;
                if (filterBy === 'unpurchased' && item.purchased) return false;
                if (selectedCategory !== 'all' && item.category !== selectedCategory) return false;
                return true;
            });

            if (sortBy === 'name') {
                filteredItems.sort((a, b) => a.name.localeCompare(b.name));
            } else if (sortBy === 'quantity') {
                filteredItems.sort((a, b) => b.quantity - a.quantity);
            }

            const groupedItems = filteredItems.reduce((acc, item) => {
                if (!acc[item.category]) acc[item.category] = [];
                acc[item.category].push(item);
                return acc;
            }, {});

            const totalItems = items.reduce((sum, item) => sum + item.quantity, 0);
            const purchasedItems = items.filter(item => item.purchased).reduce((sum, item) => sum + item.quantity, 0);
            const estimatedTotal = items.reduce((sum, item) => sum + (item.price * item.quantity), 0);

            // Stats
            const topProducts = [...items]
                .sort((a, b) => b.quantity - a.quantity)
                .slice(0, 5);
            
            const categoryStats = Object.entries(CATEGORIES).map(([key, label]) => ({
                category: label,
                count: items.filter(item => item.category === key).length
            })).filter(c => c.count > 0).sort((a, b) => b.count - a.count);

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-indigo-950 p-4">
                    {notification && (
                        <div className="fixed top-4 left-1/2 transform -translate-x-1/2 bg-indigo-600 text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-bounce">
                            {notification}
                        </div>
                    )}
                    
                    <div className="max-w-4xl mx-auto">
                        {/* Header */}
                        <div className="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 mb-6">
                            <div className="flex items-center justify-between mb-4">
                                <div className="flex items-center gap-3">
                                    <span className="text-4xl">ğŸ›’</span>
                                    <div>
                                        <h1 className="text-3xl font-bold text-gray-800 dark:text-white">×¨×©×™××ª ×§× ×™×•×ª Pro</h1>
                                        <div className="flex items-center gap-2 mt-1 flex-wrap">
                                            <span className="text-sm text-gray-600 dark:text-gray-400">××—×•×‘×¨:</span>
                                            <span className={`px-3 py-1 rounded-full text-sm font-semibold border ${currentUser.color}`}>
                                                {currentUser.name}
                                            </span>
                                            <button onClick={handleLogout} className="text-gray-500 hover:text-red-600 text-sm">
                                                ×”×—×œ×£
                                            </button>
                                            <button onClick={toggleDarkMode} className="text-2xl">
                                                {darkMode ? 'â˜€ï¸' : 'ğŸŒ™'}
                                            </button>
                                            <span className="text-xs text-green-600 dark:text-green-400 animate-pulse">â— ××¡×•× ×›×¨×Ÿ</span>
                                        </div>
                                    </div>
                                </div>
                                <button 
                                    onClick={() => document.getElementById('shopping-list-section')?.scrollIntoView({ behavior: 'smooth', block: 'start' })}
                                    className="flex flex-col items-center gap-1 px-4 py-2 bg-indigo-100 dark:bg-indigo-900 hover:bg-indigo-200 dark:hover:bg-indigo-800 rounded-lg transition-all cursor-pointer"
                                >
                                    <div className="text-sm text-gray-600 dark:text-gray-300">×¡×”×´×›</div>
                                    <div className="text-2xl font-bold text-indigo-600 dark:text-indigo-400">{totalItems}</div>
                                    <div className="text-xs text-indigo-600 dark:text-indigo-400">ğŸ‘‡ ×œ×¨×©×™××”</div>
                                </button>
                            </div>

                            {/* Progress Bar */}
                            {totalItems > 0 && (
                                <div className="bg-indigo-50 dark:bg-indigo-900/30 rounded-lg p-4 mb-4">
                                    <div className="flex justify-between items-center mb-2">
                                        <span className="text-sm text-gray-700 dark:text-gray-300">×”×ª×§×“××•×ª</span>
                                        <span className="text-sm font-semibold text-indigo-700 dark:text-indigo-400">{purchasedItems} / {totalItems}</span>
                                    </div>
                                    <div className="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3">
                                        <div className="bg-indigo-600 dark:bg-indigo-500 h-3 rounded-full transition-all" 
                                            style={{ width: `${totalItems > 0 ? (purchasedItems / totalItems) * 100 : 0}%` }} />
                                    </div>
                                </div>
                            )}

                            {/* Budget & Stats */}
                            <div className="grid grid-cols-2 gap-4">
                                <button onClick={() => setShowBudget(!showBudget)} 
                                    className="bg-green-50 dark:bg-green-900/30 p-4 rounded-lg border-2 border-green-200 dark:border-green-700 hover:shadow-md transition-all">
                                    <div className="text-sm text-gray-600 dark:text-gray-400">×ª×§×¦×™×‘ ××©×•×¢×¨</div>
                                    <div className="text-2xl font-bold text-green-600 dark:text-green-400">â‚ª{estimatedTotal.toFixed(0)}</div>
                                    {budget > 0 && (
                                        <div className="text-xs text-gray-500 dark:text-gray-400">××ª×•×š â‚ª{budget}</div>
                                    )}
                                </button>
                                <button onClick={() => setShowStats(!showStats)}
                                    className="bg-purple-50 dark:bg-purple-900/30 p-4 rounded-lg border-2 border-purple-200 dark:border-purple-700 hover:shadow-md transition-all">
                                    <div className="text-sm text-gray-600 dark:text-gray-400">×¡×˜×˜×™×¡×˜×™×§×•×ª</div>
                                    <div className="text-2xl font-bold text-purple-600 dark:text-purple-400">ğŸ“Š</div>
                                </button>
                            </div>

                            {/* Budget Input */}
                            {showBudget && (
                                <div className="mt-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">×”×’×“×¨ ×ª×§×¦×™×‘</label>
                                    <div className="flex gap-2">
                                        <input type="number" value={budget} onChange={e => setBudget(parseFloat(e.target.value) || 0)}
                                            className="flex-1 px-4 py-2 border rounded-lg dark:bg-gray-800 dark:border-gray-600 dark:text-white" placeholder="0" />
                                        <button onClick={saveBudget} className="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                                            ×©××•×¨
                                        </button>
                                    </div>
                                </div>
                            )}

                            {/* Stats */}
                            {showStats && (
                                <div className="mt-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                    <h3 className="font-bold text-lg mb-3 text-gray-800 dark:text-white">×¡×˜×˜×™×¡×˜×™×§×•×ª</h3>
                                    <div className="space-y-3">
                                        <div>
                                            <div className="text-sm text-gray-600 dark:text-gray-400 mb-1">××•×¦×¨×™× ××•×‘×™×œ×™×:</div>
                                            {topProducts.slice(0, 3).map((item, idx) => (
                                                <div key={idx} className="text-sm flex justify-between py-1">
                                                    <span className="text-gray-700 dark:text-gray-300">{idx + 1}. {item.name}</span>
                                                    <span className="font-bold text-indigo-600 dark:text-indigo-400">x{item.quantity}</span>
                                                </div>
                                            ))}
                                        </div>
                                        <div>
                                            <div className="text-sm text-gray-600 dark:text-gray-400 mb-1">×§×˜×’×•×¨×™×•×ª ×¤×•×¤×•×œ×¨×™×•×ª:</div>
                                            {categoryStats.slice(0, 3).map((cat, idx) => (
                                                <div key={idx} className="text-sm flex justify-between py-1">
                                                    <span className="text-gray-700 dark:text-gray-300">{cat.category}</span>
                                                    <span className="font-bold text-purple-600 dark:text-purple-400">{cat.count}</span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Quick Actions */}
                            <div className="mt-4 flex gap-2 flex-wrap">
                                <button onClick={exportToWhatsApp} 
                                    className="flex-1 bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 flex items-center justify-center gap-2">
                                    ğŸ“± ×©×ª×£ ×‘-WhatsApp
                                </button>
                                {purchasedItems > 0 && (
                                    <button onClick={clearPurchased}
                                        className="flex-1 bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600">
                                        ğŸ—‘ï¸ × ×§×” ×©× ×§× ×•
                                    </button>
                                )}
                            </div>
                        </div>

                        {/* Search & Filter */}
                        <div className="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-4 mb-6">
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-3 mb-4">
                                <input type="text" value={searchTerm} onChange={e => setSearchTerm(e.target.value)}
                                    placeholder="ğŸ” ×—×¤×© ××•×¦×¨..." 
                                    className="px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white" />
                                <select value={filterBy} onChange={e => setFilterBy(e.target.value)}
                                    className="px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                    <option value="all">×”×›×œ</option>
                                    <option value="unpurchased">×œ× × ×§× ×•</option>
                                    <option value="purchased">× ×§× ×•</option>
                                </select>
                                <select value={sortBy} onChange={e => setSortBy(e.target.value)}
                                    className="px-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                    <option value="date">××™×•×Ÿ: ×ª××¨×™×š</option>
                                    <option value="name">××™×•×Ÿ: ×©×</option>
                                    <option value="quantity">××™×•×Ÿ: ×›××•×ª</option>
                                </select>
                            </div>
                            
                            <div className="flex gap-2 overflow-x-auto pb-2">
                                <button onClick={() => setSelectedCategory('all')}
                                    className={`px-4 py-2 rounded-lg whitespace-nowrap ${selectedCategory === 'all' ? 'bg-indigo-600 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'}`}>
                                    ×”×›×œ ({items.length})
                                </button>
                                {Object.entries(CATEGORIES).map(([key, label]) => {
                                    const count = items.filter(item => item.category === key).length;
                                    if (count === 0) return null;
                                    return (
                                        <button key={key} onClick={() => setSelectedCategory(key)}
                                            className={`px-4 py-2 rounded-lg whitespace-nowrap ${selectedCategory === key ? 'bg-indigo-600 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'}`}>
                                            {label} ({count})
                                        </button>
                                    );
                                })}
                            </div>
                        </div>

                        {/* Add Products */}
                        <div className="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 mb-6">
                            <h2 className="text-xl font-bold text-gray-800 dark:text-white mb-4">×”×•×¡×¤×ª ××•×¦×¨×™×</h2>
                            <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 mb-4">
                                {PRODUCTS.filter(p => selectedCategory === 'all' || p.category === selectedCategory).slice(0, 12).map((product, idx) => (
                                    <button key={idx} onClick={() => addProduct(product)}
                                        className="bg-gradient-to-br from-indigo-50 to-blue-50 dark:from-indigo-900/30 dark:to-blue-900/30 hover:from-indigo-100 hover:to-blue-100 dark:hover:from-indigo-900/50 dark:hover:to-blue-900/50 p-3 rounded-lg text-gray-800 dark:text-white font-medium text-sm border border-indigo-200 dark:border-indigo-700">
                                        + {product.name}
                                        {product.avgPrice > 0 && <div className="text-xs text-gray-500 dark:text-gray-400">~â‚ª{product.avgPrice}</div>}
                                    </button>
                                ))}
                            </div>
                            {showAddProduct ? (
                                <div className="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg border-2 border-indigo-200 dark:border-indigo-700">
                                    <div className="flex flex-col gap-3">
                                        <input type="text" value={newProductName} onChange={e => setNewProductName(e.target.value)}
                                            placeholder="×©× ×”××•×¦×¨" className="px-4 py-2 border rounded-lg dark:bg-gray-800 dark:border-gray-600 dark:text-white"
                                            onKeyPress={e => e.key === 'Enter' && addCustomProduct()} />
                                        <select value={newProductCategory} onChange={e => setNewProductCategory(e.target.value)}
                                            className="px-4 py-2 border rounded-lg dark:bg-gray-800 dark:border-gray-600 dark:text-white">
                                            {Object.entries(CATEGORIES).map(([key, label]) => <option key={key} value={key}>{label}</option>)}
                                        </select>
                                        <div className="flex gap-2">
                                            <button onClick={addCustomProduct} className="flex-1 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700">×”×•×¡×£</button>
                                            <button onClick={() => { setShowAddProduct(false); setNewProductName(''); }}
                                                className="px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-200 rounded-lg">×‘×™×˜×•×œ</button>
                                        </div>
                                    </div>
                                </div>
                            ) : (
                                <button onClick={() => setShowAddProduct(true)}
                                    className="w-full bg-gradient-to-r from-indigo-600 to-blue-600 text-white px-6 py-3 rounded-lg font-medium hover:from-indigo-700 hover:to-blue-700">
                                    + ×”×•×¡×£ ××•×¦×¨ ××©×œ×š
                                </button>
                            )}
                        </div>

                        {/* Shopping List */}
                        {filteredItems.length > 0 && (
                            <div id="shopping-list-section" className="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-xl font-bold text-gray-800 dark:text-white">
                                        ×”×¨×©×™××” ×©×œ× ×• ({filteredItems.length})
                                    </h2>
                                </div>
                                {Object.entries(groupedItems).map(([category, categoryItems]) => (
                                    <div key={category} className="mb-6">
                                        <h3 className="text-lg font-bold text-indigo-700 dark:text-indigo-400 mb-3 pb-2 border-b-2 border-indigo-200 dark:border-indigo-700">
                                            {CATEGORIES[category]} ({categoryItems.length})
                                        </h3>
                                        {categoryItems.map(item => (
                                            <div key={item.id} className={`flex items-center gap-3 p-3 rounded-lg mb-2 ${item.purchased ? 'bg-green-50 dark:bg-green-900/20 border-2 border-green-200 dark:border-green-700' : 'bg-gray-50 dark:bg-gray-700 border-2 border-gray-200 dark:border-gray-600'}`}>
                                                <button onClick={() => togglePurchased(item.id, item.purchased)}
                                                    className={`w-6 h-6 rounded-full border-2 flex items-center justify-center ${item.purchased ? 'bg-green-500 border-green-500' : 'border-gray-300 dark:border-gray-500'}`}>
                                                    {item.purchased && <span className="text-white text-xs">âœ“</span>}
                                                </button>
                                                <div className="flex-1">
                                                    <span className={`font-medium ${item.purchased ? 'text-gray-500 dark:text-gray-400 line-through' : 'text-gray-800 dark:text-white'}`}>
                                                        {item.name}
                                                    </span>
                                                    {item.price > 0 && (
                                                        <span className="text-xs text-gray-500 dark:text-gray-400 mr-2">
                                                            (â‚ª{(item.price * item.quantity).toFixed(0)})
                                                        </span>
                                                    )}
                                                    {item.addedBy && (
                                                        <span className={`text-xs px-2 py-0.5 rounded-full border inline-block ml-2 ${item.addedByColor}`}>
                                                            {item.addedBy}
                                                        </span>
                                                    )}
                                                </div>
                                                <div className="flex items-center gap-2">
                                                    <button onClick={() => updateQuantity(item.id, item.quantity - 1)}
                                                        className="w-8 h-8 bg-gray-200 dark:bg-gray-600 rounded-lg font-bold hover:bg-gray-300 dark:hover:bg-gray-500">-</button>
                                                    <span className="w-12 text-center font-bold text-indigo-600 dark:text-indigo-400">{item.quantity}</span>
                                                    <button onClick={() => updateQuantity(item.id, item.quantity + 1)}
                                                        className="w-8 h-8 bg-indigo-100 dark:bg-indigo-900 rounded-lg font-bold hover:bg-indigo-200 dark:hover:bg-indigo-800">+</button>
                                                </div>
                                                <button onClick={() => window.firestore.deleteDoc(window.firestore.doc(window.db, 'shopping-items', item.id))}
                                                    className="w-8 h-8 bg-red-100 dark:bg-red-900 rounded-lg text-red-600 dark:text-red-400 hover:bg-red-200 dark:hover:bg-red-800">ğŸ—‘</button>
                                            </div>
                                        ))}
                                    </div>
                                ))}
                            </div>
                        )}

                        {filteredItems.length === 0 && !loading && (
                            <div className="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-12 text-center">
                                <div className="text-6xl mb-4">ğŸ“</div>
                                <p className="text-xl text-gray-600 dark:text-gray-400">×”×¨×©×™××” ×¨×™×§×”</p>
                                <p className="text-sm text-gray-500 dark:text-gray-500 mt-2">×”×ª×—×œ ×œ×”×•×¡×™×£ ××•×¦×¨×™×!</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<ShoppingList />, document.getElementById('root'));
    </script>
</body>
</html>
