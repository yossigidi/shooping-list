<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>ShopSmart - ×¨×©×™××ª ×§× ×™×•×ª ×—×›××”</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/tesseract.js@5.0.4/dist/tesseract.min.js"></script>
    <script>tailwind.config = { darkMode: 'class' }</script>
    <style>
        * { font-family: 'Heebo', sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.2); }
        .dark .glass { background: rgba(30, 41, 59, 0.9); border: 1px solid rgba(255, 255, 255, 0.1); }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%); }
        .dark .gradient-bg { background: linear-gradient(135deg, #1e1b4b 0%, #312e81 50%, #4c1d95 100%); }
        .btn-gradient { background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); }
        .btn-gradient:hover { background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%); transform: translateY(-2px); box-shadow: 0 10px 40px rgba(99, 102, 241, 0.4); }
        .card-hover { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .card-hover:hover { transform: translateY(-4px) scale(1.02); }
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }
        .float { animation: float 3s ease-in-out infinite; }
        @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
        .shimmer { background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent); background-size: 200% 100%; animation: shimmer 2s infinite; }
        .progress-animate { background: linear-gradient(90deg, #6366f1, #8b5cf6, #a855f7, #8b5cf6, #6366f1); background-size: 200% 100%; animation: shimmer 2s linear infinite; }
        .text-gradient { background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        input:focus { outline: none; box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.3); }
        .scrollbar-thin::-webkit-scrollbar { width: 6px; }
        .scrollbar-thin::-webkit-scrollbar-track { background: transparent; }
        .scrollbar-thin::-webkit-scrollbar-thumb { background: rgba(99, 102, 241, 0.3); border-radius: 3px; }
        .scrollbar-thin::-webkit-scrollbar-thumb:hover { background: rgba(99, 102, 241, 0.5); }

        /* Swipe gesture styles - Enhanced */
        .swipe-container { position: relative; overflow: hidden; touch-action: pan-y pinch-zoom; border-radius: 16px; }
        .swipe-background { position: absolute; top: 0; bottom: 0; width: 100%; display: flex; align-items: center; padding: 0 24px; border-radius: 16px; }
        .swipe-bg-right { right: 0; justify-content: flex-start; background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .swipe-bg-left { left: 0; justify-content: flex-end; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
        .swipe-content { position: relative; z-index: 2; background: inherit; transition: transform 0.15s cubic-bezier(0.4, 0, 0.2, 1); }
        .swipe-content.swiping { transition: none; }
        .swipe-indicator { display: flex; flex-direction: column; align-items: center; gap: 4px; }
        .swipe-icon { color: white; font-size: 1.25rem; font-weight: 700; opacity: 0; transform: scale(0.5) translateY(10px); transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1); }
        .swipe-icon.visible { opacity: 1; transform: scale(1) translateY(0); }
        .swipe-icon-emoji { font-size: 1.75rem; }

        /* Modern Product Card */
        .product-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 16px;
            border: 1px solid rgba(0, 0, 0, 0.06);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.06);
            transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .dark .product-card {
            background: rgba(31, 41, 55, 0.95);
            border-color: rgba(255, 255, 255, 0.08);
        }
        .product-card:active { transform: scale(0.98); }
        .product-card.purchased {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.15) 100%);
            border-color: rgba(16, 185, 129, 0.3);
        }
        .dark .product-card.purchased {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.15) 0%, rgba(5, 150, 105, 0.2) 100%);
        }

        /* Micro animations - All under 200ms */
        @keyframes fadeSlideIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeSlideOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-8px); }
        }
        @keyframes expandIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        @keyframes checkBounce {
            0% { transform: scale(0); }
            60% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        @keyframes checkPop {
            0% { transform: scale(1); }
            50% { transform: scale(1.15); }
            100% { transform: scale(1); }
        }
        @keyframes successGlow {
            0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.5); }
            100% { box-shadow: 0 0 0 12px rgba(16, 185, 129, 0); }
        }
        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        @keyframes slideOutLeft {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(-100%); opacity: 0; }
        }
        @keyframes ripple {
            to { transform: scale(2); opacity: 0; }
        }
        .fade-slide-in { animation: fadeSlideIn 0.15s cubic-bezier(0.4, 0, 0.2, 1) forwards; }
        .expand-in { animation: expandIn 0.15s cubic-bezier(0.4, 0, 0.2, 1) forwards; }
        .check-animate { animation: checkBounce 0.2s cubic-bezier(0.4, 0, 0.2, 1) forwards; }
        .check-pop { animation: checkPop 0.15s ease; }
        .success-glow { animation: successGlow 0.4s ease forwards; }
        .slide-out-right { animation: slideOutRight 0.2s ease forwards; }
        .slide-out-left { animation: slideOutLeft 0.2s ease forwards; }

        /* Sticky Add Bar */
        .sticky-add-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(0, 0, 0, 0.08);
            padding: 12px 16px;
            padding-bottom: calc(12px + env(safe-area-inset-bottom, 0px));
            z-index: 40;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.08);
        }
        .dark .sticky-add-bar {
            background: rgba(17, 24, 39, 0.95);
            border-color: rgba(255, 255, 255, 0.08);
        }

        /* Inline edit input */
        .inline-edit-input {
            background: transparent;
            border: none;
            outline: none;
            font-size: inherit;
            font-weight: inherit;
            color: inherit;
            width: 100%;
            padding: 0;
        }
        .inline-edit-input:focus {
            background: rgba(99, 102, 241, 0.1);
            border-radius: 6px;
            padding: 2px 6px;
            margin: -2px -6px;
        }

        /* Quantity stepper */
        .qty-stepper {
            display: flex;
            align-items: center;
            background: rgba(0, 0, 0, 0.04);
            border-radius: 12px;
            overflow: hidden;
        }
        .dark .qty-stepper { background: rgba(255, 255, 255, 0.08); }
        .qty-btn {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1.25rem;
            transition: all 0.1s ease;
        }
        .qty-btn:active { transform: scale(0.9); }
        .qty-value {
            min-width: 40px;
            text-align: center;
            font-weight: 700;
            font-size: 0.95rem;
        }

        /* Bottom spacing for sticky bar */
        .main-content-with-sticky { padding-bottom: 90px; }

        /* Confetti */
        @keyframes particleFly {
            0% { transform: translate(0, 0) scale(1); opacity: 1; }
            100% { transform: translate(var(--tx, 50px), var(--ty, -50px)) scale(0); opacity: 0; }
        }
        .confetti-particle { position: absolute; pointer-events: none; animation: particleFly 0.5s ease-out forwards; }

        /* Voice recognition styles */
        @keyframes voicePulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(168, 85, 247, 0.7); }
            50% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(168, 85, 247, 0); }
        }
        .voice-listening { animation: voicePulse 1.5s ease-in-out infinite; }
        @keyframes soundWave {
            0% { transform: scaleY(0.3); }
            50% { transform: scaleY(1); }
            100% { transform: scaleY(0.3); }
        }
        .sound-wave { display: inline-block; width: 3px; height: 20px; background: currentColor; margin: 0 1px; border-radius: 3px; animation: soundWave 0.5s ease-in-out infinite; }
        .sound-wave:nth-child(2) { animation-delay: 0.1s; }
        .sound-wave:nth-child(3) { animation-delay: 0.2s; }
        .sound-wave:nth-child(4) { animation-delay: 0.3s; }
        .sound-wave:nth-child(5) { animation-delay: 0.4s; }

        /* Accessibility styles */
        .high-contrast { filter: contrast(1.4); }
        .high-contrast * { border-color: #000 !important; }
        .low-contrast { filter: contrast(0.8); }
        .highlight-links a, .highlight-links button { outline: 3px solid #0066cc !important; outline-offset: 2px; }
        .cursor-large-black, .cursor-large-black * { cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 24 24'%3E%3Cpath fill='%23000' d='M4 0l16 12.279-6.78 1.138 4.256 8.676-3.902 1.907-4.256-8.676-5.318 4.676z'/%3E%3C/svg%3E"), auto !important; }
        .cursor-large-white, .cursor-large-white * { cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 24 24'%3E%3Cpath fill='%23fff' stroke='%23000' stroke-width='1' d='M4 0l16 12.279-6.78 1.138 4.256 8.676-3.902 1.907-4.256-8.676-5.318 4.676z'/%3E%3C/svg%3E"), auto !important; }

        /* WCAG 2.4.7 Focus Visible - Enhanced focus indicators */
        *:focus { outline: 3px solid #6366f1 !important; outline-offset: 2px !important; }
        *:focus:not(:focus-visible) { outline: none !important; }
        *:focus-visible { outline: 3px solid #6366f1 !important; outline-offset: 2px !important; box-shadow: 0 0 0 6px rgba(99, 102, 241, 0.3) !important; }
        button:focus-visible, a:focus-visible, input:focus-visible, select:focus-visible, textarea:focus-visible { outline: 3px solid #6366f1 !important; outline-offset: 2px !important; }
        .dark *:focus-visible { outline-color: #818cf8 !important; box-shadow: 0 0 0 6px rgba(129, 140, 248, 0.3) !important; }

        /* Skip link for 2.4.1 Bypass Blocks */
        .skip-link { position: absolute; top: -100px; left: 50%; transform: translateX(-50%); background: #6366f1; color: white; padding: 12px 24px; border-radius: 0 0 8px 8px; z-index: 99999; font-weight: bold; text-decoration: none; transition: top 0.3s; }
        .skip-link:focus { top: 0; }

        /* Screen reader only content */
        .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0; }

        /* 2.5.5 Target Size - Minimum 44x44px touch targets */
        .touch-target { min-width: 44px; min-height: 44px; }

        /* Accessibility button */
        .accessibility-btn {
            position: fixed;
            bottom: 100px;
            left: 16px;
            width: 50px;
            height: 50px;
            background: #0066cc;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 102, 204, 0.4);
            z-index: 9999;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .accessibility-btn:hover { transform: scale(1.05); box-shadow: 0 6px 20px rgba(0, 102, 204, 0.5); }
        .accessibility-btn svg { width: 30px; height: 30px; fill: white; }

        /* Onboarding styles */
        .onboarding-highlight {
            position: relative;
            z-index: 10001;
            box-shadow: 0 0 0 4px #6366f1, 0 0 20px rgba(99, 102, 241, 0.5);
            border-radius: 12px;
        }
    </style>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, onSnapshot, query, orderBy, getDocs, where, serverTimestamp, arrayUnion, arrayRemove, getDoc, setDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import {
            getAuth,
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            signOut,
            onAuthStateChanged,
            updateProfile,
            sendPasswordResetEmail
        } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        const firebaseConfig = {
            apiKey: "AIzaSyD3pwFMmo4mMjxgzUz5oPynt0D68Yy3Iz0",
            authDomain: "shooping-list-d846b.firebaseapp.com",
            projectId: "shooping-list-d846b",
            storageBucket: "shooping-list-d846b.firebasestorage.app",
            messagingSenderId: "1099114666122",
            appId: "1:1099114666122:web:5c704bf2da52aa3ca63573"
        };

        const app = initializeApp(firebaseConfig);
        window.db = getFirestore(app);
        window.auth = getAuth(app);
        window.firestore = { collection, addDoc, updateDoc, deleteDoc, doc, onSnapshot, query, orderBy, getDocs, where, serverTimestamp, arrayUnion, arrayRemove, getDoc, setDoc };
        window.firebaseAuth = {
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            signOut,
            onAuthStateChanged,
            updateProfile,
            sendPasswordResetEmail
        };
    </script>
</head>
<body>
    <!-- WCAG 2.4.1 Skip Link -->
    <a href="#main-content" class="skip-link">×“×œ×’ ×œ×ª×•×›×Ÿ ×”×¨××©×™</a>

    <!-- WCAG 4.1.3 Status Messages - Live Region for announcements -->
    <div id="aria-live-region" aria-live="polite" aria-atomic="true" class="sr-only"></div>
    <div id="aria-live-assertive" aria-live="assertive" aria-atomic="true" class="sr-only"></div>

    <div id="root"></div>
    <script>
        // Global error handler for debugging
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            document.getElementById('root').innerHTML = '<div style="padding:20px;direction:rtl;font-family:Heebo,sans-serif;"><h2 style="color:red;">×©×’×™××”:</h2><pre style="background:#f5f5f5;padding:10px;overflow:auto;font-size:12px;">' + msg + '\nLine: ' + lineNo + '</pre><button onclick="location.reload()" style="padding:10px 20px;margin-top:10px;">× ×¡×” ×©×•×‘</button></div>';
            return false;
        };
    </script>
    <script type="text/babel">
        const { useState, useEffect, createContext, useContext } = React;

        // Auth Context
        const AuthContext = createContext(null);

        function AuthProvider({ children }) {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const unsubscribe = window.firebaseAuth.onAuthStateChanged(window.auth, (user) => {
                    setUser(user);
                    setLoading(false);
                });
                return () => unsubscribe();
            }, []);

            const value = { user, loading };
            return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;
        }

        function useAuth() {
            return useContext(AuthContext);
        }

        // Family Context
        const FamilyContext = createContext(null);

        function FamilyProvider({ children }) {
            const { user } = useAuth();
            const [family, setFamily] = useState(null);
            const [lists, setLists] = useState([]);
            const [currentList, setCurrentList] = useState(null);
            const [loading, setLoading] = useState(true);
            const [activities, setActivities] = useState([]);

            // Generate random 6-character code
            const generateCode = () => {
                const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
                let code = '';
                for (let i = 0; i < 6; i++) {
                    code += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                return code;
            };

            // Find user's family
            useEffect(() => {
                if (!user) {
                    setFamily(null);
                    setLists([]);
                    setCurrentList(null);
                    setLoading(false);
                    return;
                }

                setLoading(true);

                // Query families where user is a member
                const q = window.firestore.query(
                    window.firestore.collection(window.db, 'families')
                );

                const unsubscribe = window.firestore.onSnapshot(q, async (snapshot) => {
                    let userFamily = null;
                    snapshot.forEach((doc) => {
                        const data = doc.data();
                        const isMember = data.members?.some(m => m.userId === user.uid);
                        if (isMember) {
                            userFamily = { id: doc.id, ...data };
                        }
                    });

                    setFamily(userFamily);
                    setLoading(false);
                });

                return () => unsubscribe();
            }, [user]);

            // Load lists when family changes
            useEffect(() => {
                if (!family) {
                    setLists([]);
                    setCurrentList(null);
                    return;
                }

                const q = window.firestore.query(
                    window.firestore.collection(window.db, 'lists'),
                    window.firestore.where('familyId', '==', family.id)
                );

                const unsubscribe = window.firestore.onSnapshot(q, (snapshot) => {
                    const listsData = [];
                    snapshot.forEach((doc) => {
                        listsData.push({ id: doc.id, ...doc.data() });
                    });
                    listsData.sort((a, b) => (b.isDefault ? 1 : 0) - (a.isDefault ? 1 : 0));
                    setLists(listsData);

                    // Set current list to default or first
                    if (!currentList || !listsData.find(l => l.id === currentList.id)) {
                        const defaultList = listsData.find(l => l.isDefault) || listsData[0];
                        setCurrentList(defaultList);
                    }
                });

                return () => unsubscribe();
            }, [family]);

            // Load activities
            useEffect(() => {
                if (!family) {
                    setActivities([]);
                    return;
                }

                const q = window.firestore.query(
                    window.firestore.collection(window.db, 'activity'),
                    window.firestore.where('familyId', '==', family.id)
                );

                const unsubscribe = window.firestore.onSnapshot(q, (snapshot) => {
                    const activitiesData = [];
                    snapshot.forEach((doc) => {
                        activitiesData.push({ id: doc.id, ...doc.data() });
                    });
                    activitiesData.sort((a, b) => {
                        const dateA = a.timestamp?.toDate?.() || new Date(0);
                        const dateB = b.timestamp?.toDate?.() || new Date(0);
                        return dateB - dateA;
                    });
                    setActivities(activitiesData.slice(0, 50));
                });

                return () => unsubscribe();
            }, [family]);

            // Create a new family
            const createFamily = async (familyName) => {
                if (!user) return null;

                const code = generateCode();
                const newFamily = {
                    name: familyName,
                    code: code,
                    adminId: user.uid,
                    members: [{
                        userId: user.uid,
                        email: user.email,
                        displayName: user.displayName || user.email,
                        joinedAt: new Date(),
                        role: 'admin'
                    }],
                    createdAt: new Date()
                };

                const familyRef = await window.firestore.addDoc(
                    window.firestore.collection(window.db, 'families'),
                    newFamily
                );

                // Create default list
                await window.firestore.addDoc(
                    window.firestore.collection(window.db, 'lists'),
                    {
                        familyId: familyRef.id,
                        name: '×¨×©×™××ª ×§× ×™×•×ª',
                        icon: 'ğŸ›’',
                        createdBy: user.uid,
                        createdAt: new Date(),
                        isDefault: true
                    }
                );

                // Log activity
                await logActivity('member_joined', { memberName: user.displayName || user.email }, familyRef.id);

                return { id: familyRef.id, ...newFamily };
            };

            // Join existing family
            const joinFamily = async (code) => {
                if (!user) return { success: false, error: '×œ× ××—×•×‘×¨' };

                const q = window.firestore.query(
                    window.firestore.collection(window.db, 'families'),
                    window.firestore.where('code', '==', code.toUpperCase())
                );

                const snapshot = await window.firestore.getDocs(q);

                if (snapshot.empty) {
                    return { success: false, error: '×§×•×“ ×œ× × ××¦×' };
                }

                const familyDoc = snapshot.docs[0];
                const familyData = familyDoc.data();

                // Check if already a member
                if (familyData.members?.some(m => m.userId === user.uid)) {
                    return { success: false, error: '×›×‘×¨ ×—×‘×¨ ×‘××©×¤×—×” ×–×•' };
                }

                // Add user to family
                const newMember = {
                    userId: user.uid,
                    email: user.email,
                    displayName: user.displayName || user.email,
                    joinedAt: new Date(),
                    role: 'member'
                };

                await window.firestore.updateDoc(
                    window.firestore.doc(window.db, 'families', familyDoc.id),
                    { members: window.firestore.arrayUnion(newMember) }
                );

                // Log activity
                await logActivity('member_joined', { memberName: user.displayName || user.email }, familyDoc.id);

                return { success: true };
            };

            // Leave family
            const leaveFamily = async () => {
                if (!family || !user) return;

                const memberToRemove = family.members.find(m => m.userId === user.uid);
                if (!memberToRemove) return;

                // If admin and only member, delete family
                if (family.adminId === user.uid && family.members.length === 1) {
                    // Delete all lists
                    const listsSnapshot = await window.firestore.getDocs(
                        window.firestore.query(
                            window.firestore.collection(window.db, 'lists'),
                            window.firestore.where('familyId', '==', family.id)
                        )
                    );
                    for (const doc of listsSnapshot.docs) {
                        await window.firestore.deleteDoc(doc.ref);
                    }
                    // Delete family
                    await window.firestore.deleteDoc(
                        window.firestore.doc(window.db, 'families', family.id)
                    );
                } else {
                    // Remove member
                    await window.firestore.updateDoc(
                        window.firestore.doc(window.db, 'families', family.id),
                        { members: window.firestore.arrayRemove(memberToRemove) }
                    );
                }
            };

            // Remove member (admin only)
            const removeMember = async (memberUserId) => {
                if (!family || family.adminId !== user.uid) return;
                if (memberUserId === user.uid) return; // Can't remove self

                const memberToRemove = family.members.find(m => m.userId === memberUserId);
                if (!memberToRemove) return;

                await window.firestore.updateDoc(
                    window.firestore.doc(window.db, 'families', family.id),
                    { members: window.firestore.arrayRemove(memberToRemove) }
                );
            };

            // Create new list
            const createList = async (name, icon = 'ğŸ“') => {
                if (!family) return;

                await window.firestore.addDoc(
                    window.firestore.collection(window.db, 'lists'),
                    {
                        familyId: family.id,
                        name: name,
                        icon: icon,
                        createdBy: user.uid,
                        createdAt: new Date(),
                        isDefault: false
                    }
                );

                await logActivity('list_created', { listName: name });
            };

            // Delete list
            const deleteList = async (listId) => {
                if (!family) return;
                const list = lists.find(l => l.id === listId);
                if (!list || list.isDefault) return; // Can't delete default list

                await window.firestore.deleteDoc(
                    window.firestore.doc(window.db, 'lists', listId)
                );
            };

            // Log activity
            const logActivity = async (type, details = {}, overrideFamilyId = null) => {
                if (!user) return;
                const fid = overrideFamilyId || family?.id;
                if (!fid) return;

                await window.firestore.addDoc(
                    window.firestore.collection(window.db, 'activity'),
                    {
                        familyId: fid,
                        listId: currentList?.id || null,
                        type: type,
                        userId: user.uid,
                        userName: user.displayName || user.email,
                        timestamp: new Date(),
                        ...details
                    }
                );
            };

            const value = {
                family,
                lists,
                currentList,
                setCurrentList,
                activities,
                loading,
                createFamily,
                joinFamily,
                leaveFamily,
                removeMember,
                createList,
                deleteList,
                logActivity,
                isAdmin: family?.adminId === user?.uid
            };

            return <FamilyContext.Provider value={value}>{children}</FamilyContext.Provider>;
        }

        function useFamily() {
            return useContext(FamilyContext);
        }

        // No Family Screen
        function NoFamilyScreen() {
            const [mode, setMode] = useState('choose'); // choose, create, join
            const [familyName, setFamilyName] = useState('');
            const [joinCode, setJoinCode] = useState('');
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);
            const [createdCode, setCreatedCode] = useState('');
            const { createFamily, joinFamily } = useFamily();
            const { user } = useAuth();
            const [darkMode, setDarkMode] = useState(false);

            useEffect(() => {
                const savedDark = localStorage.getItem('darkMode') === 'true';
                if (savedDark) {
                    setDarkMode(true);
                    document.documentElement.classList.add('dark');
                }
            }, []);

            const handleCreate = async (e) => {
                e.preventDefault();
                if (!familyName.trim()) {
                    setError('× × ×œ×”×–×™×Ÿ ×©× ×œ××©×¤×—×”');
                    return;
                }
                setLoading(true);
                setError('');
                try {
                    const newFamily = await createFamily(familyName.trim());
                    setCreatedCode(newFamily.code);
                    setMode('created');
                } catch (err) {
                    setError('×©×’×™××” ×‘×™×¦×™×¨×ª ××©×¤×—×”');
                } finally {
                    setLoading(false);
                }
            };

            const handleJoin = async (e) => {
                e.preventDefault();
                if (!joinCode.trim() || joinCode.trim().length !== 6) {
                    setError('× × ×œ×”×–×™×Ÿ ×§×•×“ ×‘×Ÿ 6 ×ª×•×•×™×');
                    return;
                }
                setLoading(true);
                setError('');
                try {
                    const result = await joinFamily(joinCode.trim());
                    if (!result.success) {
                        setError(result.error);
                    }
                } catch (err) {
                    setError('×©×’×™××” ×‘×”×¦×˜×¨×¤×•×ª');
                } finally {
                    setLoading(false);
                }
            };

            const handleLogout = async () => {
                await window.firebaseAuth.signOut(window.auth);
            };

            const toggleDarkMode = () => {
                const newMode = !darkMode;
                setDarkMode(newMode);
                localStorage.setItem('darkMode', String(newMode));
                document.documentElement.classList.toggle('dark');
            };

            return (
                <div className="min-h-screen gradient-bg flex items-center justify-center p-4">
                    <div className="glass rounded-3xl shadow-2xl p-8 max-w-md w-full relative overflow-hidden">
                        <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500"></div>

                        <button onClick={toggleDarkMode} className="absolute top-6 left-6 p-2.5 rounded-xl bg-white/50 dark:bg-gray-700/50 text-2xl hover:scale-110 transition-all">
                            {darkMode ? 'â˜€ï¸' : 'ğŸŒ™'}
                        </button>

                        <button onClick={handleLogout} className="absolute top-6 right-6 p-2.5 rounded-xl bg-red-100 dark:bg-red-900/50 text-sm text-red-600 dark:text-red-400 hover:scale-105 transition-all">
                            ×”×ª× ×ª×§
                        </button>

                        <div className="text-center mb-8 pt-8">
                            <div className="text-7xl mb-4 float">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</div>
                            <h1 className="text-2xl font-bold text-gradient mb-2">×‘×¨×•×š ×”×‘×, {user?.displayName || '××©×ª××©'}!</h1>
                            <p className="text-gray-500 dark:text-gray-400 text-sm">×¦×•×¨ ××©×¤×—×” ×—×“×©×” ××• ×”×¦×˜×¨×£ ×œ××©×¤×—×” ×§×™×™××ª</p>
                        </div>

                        {mode === 'choose' && (
                            <div className="space-y-4">
                                <button onClick={() => setMode('create')} className="w-full btn-gradient text-white py-4 rounded-xl font-semibold hover:shadow-lg transition-all flex items-center justify-center gap-3">
                                    <span className="text-2xl">ğŸ </span>
                                    ×¦×•×¨ ××©×¤×—×” ×—×“×©×”
                                </button>
                                <button onClick={() => setMode('join')} className="w-full glass border-2 border-indigo-300 dark:border-indigo-600 py-4 rounded-xl font-semibold hover:bg-indigo-50 dark:hover:bg-indigo-900/30 transition-all flex items-center justify-center gap-3 text-gray-700 dark:text-gray-200">
                                    <span className="text-2xl">ğŸ”—</span>
                                    ×”×¦×˜×¨×£ ×œ××©×¤×—×” ×§×™×™××ª
                                </button>
                            </div>
                        )}

                        {mode === 'create' && (
                            <form onSubmit={handleCreate} className="space-y-4">
                                <h2 className="text-xl font-bold text-center text-gray-800 dark:text-white mb-4">×™×¦×™×¨×ª ××©×¤×—×”</h2>

                                {error && (
                                    <div className="bg-red-100 dark:bg-red-900/30 border-2 border-red-300 dark:border-red-700 text-red-700 dark:text-red-300 px-4 py-3 rounded-lg text-sm">
                                        {error}
                                    </div>
                                )}

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">×©× ×”××©×¤×—×”</label>
                                    <input
                                        type="text"
                                        value={familyName}
                                        onChange={e => setFamilyName(e.target.value)}
                                        placeholder="×œ×“×•×’××”: ××©×¤×—×ª ×›×”×Ÿ"
                                        className="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl dark:bg-gray-700 dark:text-white focus:border-indigo-500"
                                        required
                                    />
                                </div>

                                <button type="submit" disabled={loading} className="w-full btn-gradient text-white py-3 rounded-xl font-semibold disabled:opacity-50">
                                    {loading ? '×™×•×¦×¨...' : '×¦×•×¨ ××©×¤×—×”'}
                                </button>

                                <button type="button" onClick={() => { setMode('choose'); setError(''); }} className="w-full text-indigo-600 dark:text-indigo-400 text-sm hover:underline">
                                    ×—×–×•×¨
                                </button>
                            </form>
                        )}

                        {mode === 'join' && (
                            <form onSubmit={handleJoin} className="space-y-4">
                                <h2 className="text-xl font-bold text-center text-gray-800 dark:text-white mb-4">×”×¦×˜×¨×¤×•×ª ×œ××©×¤×—×”</h2>

                                {error && (
                                    <div className="bg-red-100 dark:bg-red-900/30 border-2 border-red-300 dark:border-red-700 text-red-700 dark:text-red-300 px-4 py-3 rounded-lg text-sm">
                                        {error}
                                    </div>
                                )}

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">×§×•×“ ××©×¤×—×”</label>
                                    <input
                                        type="text"
                                        value={joinCode}
                                        onChange={e => setJoinCode(e.target.value.toUpperCase())}
                                        placeholder="ABC123"
                                        maxLength={6}
                                        className="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl dark:bg-gray-700 dark:text-white focus:border-indigo-500 text-center text-2xl tracking-widest font-mono"
                                        dir="ltr"
                                        required
                                    />
                                    <p className="text-xs text-gray-500 dark:text-gray-400 mt-1 text-center">×§×‘×œ ××ª ×”×§×•×“ ××× ×”×œ ×”××©×¤×—×”</p>
                                </div>

                                <button type="submit" disabled={loading} className="w-full btn-gradient text-white py-3 rounded-xl font-semibold disabled:opacity-50">
                                    {loading ? '××¦×˜×¨×£...' : '×”×¦×˜×¨×£'}
                                </button>

                                <button type="button" onClick={() => { setMode('choose'); setError(''); }} className="w-full text-indigo-600 dark:text-indigo-400 text-sm hover:underline">
                                    ×—×–×•×¨
                                </button>
                            </form>
                        )}

                        {mode === 'created' && (
                            <div className="text-center space-y-4">
                                <div className="text-6xl mb-4">ğŸ‰</div>
                                <h2 className="text-xl font-bold text-gradient">×”××©×¤×—×” × ×•×¦×¨×”!</h2>
                                <p className="text-gray-600 dark:text-gray-400">×©×ª×£ ××ª ×”×§×•×“ ×”×–×” ×¢× ×‘× ×™ ×”××©×¤×—×”:</p>
                                <div className="bg-indigo-100 dark:bg-indigo-900/50 px-6 py-4 rounded-xl">
                                    <div className="text-3xl font-mono font-bold text-indigo-600 dark:text-indigo-400 tracking-widest">{createdCode}</div>
                                </div>
                                <button
                                    onClick={() => navigator.clipboard.writeText(createdCode)}
                                    className="text-indigo-600 dark:text-indigo-400 text-sm hover:underline flex items-center justify-center gap-2 mx-auto"
                                >
                                    ğŸ“‹ ×”×¢×ª×§ ×§×•×“
                                </button>
                                <p className="text-xs text-gray-500 dark:text-gray-400">×”×“×£ ×™×ª×¨×¢× ×Ÿ ××•×˜×•××˜×™×ª...</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // Family Settings Modal
        function FamilySettingsModal({ onClose }) {
            const { family, leaveFamily, removeMember, isAdmin } = useFamily();
            const { user } = useAuth();
            const [showLeaveConfirm, setShowLeaveConfirm] = useState(false);
            const [copied, setCopied] = useState(false);

            const copyCode = () => {
                navigator.clipboard.writeText(family.code);
                setCopied(true);
                setTimeout(() => setCopied(false), 2000);
            };

            const handleLeave = async () => {
                await leaveFamily();
                onClose();
            };

            return (
                <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                    <div className="glass rounded-3xl p-8 max-w-md w-full shadow-2xl max-h-[90vh] overflow-y-auto">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold flex items-center gap-3">
                                <span className="text-3xl">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</span>
                                <span className="text-gradient">{family.name}</span>
                            </h2>
                            <button onClick={onClose} className="w-10 h-10 flex items-center justify-center glass rounded-full text-gray-500 hover:text-red-500 text-2xl hover:scale-110 hover:rotate-90 transition-all">Ã—</button>
                        </div>

                        {/* Share Code */}
                        <div className="glass rounded-xl p-4 mb-6">
                            <h3 className="font-bold text-gray-700 dark:text-gray-300 mb-2">×§×•×“ ×”×–×× ×”</h3>
                            <div className="flex items-center gap-3">
                                <div className="flex-1 bg-indigo-100 dark:bg-indigo-900/50 px-4 py-3 rounded-lg text-center">
                                    <span className="text-2xl font-mono font-bold text-indigo-600 dark:text-indigo-400 tracking-widest">{family.code}</span>
                                </div>
                                <button onClick={copyCode} className="btn-gradient text-white px-4 py-3 rounded-lg hover:scale-105 transition-all">
                                    {copied ? 'âœ“' : 'ğŸ“‹'}
                                </button>
                            </div>
                            <p className="text-xs text-gray-500 dark:text-gray-400 mt-2 text-center">×©×ª×£ ××ª ×”×§×•×“ ×¢× ×‘× ×™ ××©×¤×—×” ×œ×”×¦×˜×¨×¤×•×ª</p>
                        </div>

                        {/* Members List */}
                        <div className="mb-6">
                            <h3 className="font-bold text-gray-700 dark:text-gray-300 mb-3">×—×‘×¨×™ ×”××©×¤×—×” ({family.members?.length})</h3>
                            <div className="space-y-2">
                                {family.members?.map((member, idx) => (
                                    <div key={idx} className="glass rounded-lg p-3 flex items-center justify-between">
                                        <div className="flex items-center gap-3">
                                            <div className="w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center text-white font-bold">
                                                {member.displayName?.charAt(0)?.toUpperCase() || '?'}
                                            </div>
                                            <div>
                                                <div className="font-medium dark:text-white">{member.displayName}</div>
                                                <div className="text-xs text-gray-500 dark:text-gray-400">{member.role === 'admin' ? 'ğŸ‘‘ ×× ×”×œ' : '×—×‘×¨'}</div>
                                            </div>
                                        </div>
                                        {isAdmin && member.userId !== user.uid && (
                                            <button
                                                onClick={() => removeMember(member.userId)}
                                                className="text-red-500 hover:bg-red-100 dark:hover:bg-red-900/30 p-2 rounded-lg transition-colors"
                                                title="×”×¡×¨ ×—×‘×¨"
                                            >
                                                ğŸ—‘
                                            </button>
                                        )}
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Leave Family */}
                        {!showLeaveConfirm ? (
                            <button
                                onClick={() => setShowLeaveConfirm(true)}
                                className="w-full bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 py-3 rounded-xl font-semibold hover:bg-red-200 dark:hover:bg-red-900/50 transition-colors"
                            >
                                {isAdmin && family.members?.length === 1 ? 'ğŸ—‘ ××—×§ ××©×¤×—×”' : 'ğŸšª ×¢×–×•×‘ ××©×¤×—×”'}
                            </button>
                        ) : (
                            <div className="glass rounded-xl p-4 border-2 border-red-300 dark:border-red-700">
                                <p className="text-center text-red-600 dark:text-red-400 mb-4 font-medium">
                                    {isAdmin && family.members?.length === 1
                                        ? '×”××©×¤×—×” ×ª×™××—×§ ×œ×¦××™×ª×•×ª. ×œ×”××©×™×š?'
                                        : '×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ×¢×–×•×‘?'}
                                </p>
                                <div className="flex gap-2">
                                    <button onClick={handleLeave} className="flex-1 bg-red-500 text-white py-2 rounded-lg font-semibold hover:bg-red-600">
                                        ×›×Ÿ, {isAdmin && family.members?.length === 1 ? '××—×§' : '×¢×–×•×‘'}
                                    </button>
                                    <button onClick={() => setShowLeaveConfirm(false)} className="flex-1 glass py-2 rounded-lg font-semibold">
                                        ×‘×™×˜×•×œ
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // Create List Modal
        function CreateListModal({ onClose }) {
            const { createList } = useFamily();
            const [name, setName] = useState('');
            const [icon, setIcon] = useState('ğŸ“');
            const [loading, setLoading] = useState(false);

            const icons = ['ğŸ“', 'ğŸ›’', 'ğŸ‰', 'ğŸ ', 'ğŸ’Š', 'ğŸ¾', 'ğŸ‘¶', 'ğŸ½ï¸', 'ğŸ§¹', 'âœˆï¸'];

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!name.trim()) return;
                setLoading(true);
                await createList(name.trim(), icon);
                onClose();
            };

            return (
                <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                    <div className="glass rounded-3xl p-8 max-w-sm w-full shadow-2xl">
                        <div className="text-5xl text-center mb-4">ğŸ“‹</div>
                        <h2 className="text-xl font-bold text-center text-gradient mb-6">×¨×©×™××” ×—×“×©×”</h2>

                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">×©× ×”×¨×©×™××”</label>
                                <input
                                    type="text"
                                    value={name}
                                    onChange={e => setName(e.target.value)}
                                    placeholder="×œ×“×•×’××”: ×§× ×™×•×ª ×œ×©×‘×ª"
                                    className="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl dark:bg-gray-700 dark:text-white focus:border-indigo-500"
                                    autoFocus
                                    required
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">××™×™×§×•×Ÿ</label>
                                <div className="flex flex-wrap gap-2">
                                    {icons.map(i => (
                                        <button
                                            key={i}
                                            type="button"
                                            onClick={() => setIcon(i)}
                                            className={`text-2xl p-2 rounded-lg transition-all ${icon === i ? 'bg-indigo-100 dark:bg-indigo-900/50 scale-110' : 'hover:bg-gray-100 dark:hover:bg-gray-700'}`}
                                        >
                                            {i}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            <div className="flex gap-3 pt-2">
                                <button type="submit" disabled={loading} className="flex-1 btn-gradient text-white py-3 rounded-xl font-semibold disabled:opacity-50">
                                    {loading ? '×™×•×¦×¨...' : '×¦×•×¨ ×¨×©×™××”'}
                                </button>
                                <button type="button" onClick={onClose} className="px-6 py-3 glass border-2 border-gray-300 dark:border-gray-600 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-700">
                                    ×‘×™×˜×•×œ
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        // Item Note Modal
        function ItemNoteModal({ item, onClose, onSave }) {
            const [note, setNote] = useState(item.note || '');
            const [loading, setLoading] = useState(false);

            const handleSave = async () => {
                setLoading(true);
                await onSave(note);
                onClose();
            };

            return (
                <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                    <div className="glass rounded-3xl p-8 max-w-sm w-full shadow-2xl">
                        <div className="text-5xl text-center mb-4">ğŸ“</div>
                        <h2 className="text-xl font-bold text-center text-gradient mb-2">×”×¢×¨×” ×œ××•×¦×¨</h2>
                        <p className="text-center text-gray-500 dark:text-gray-400 mb-4">{item.name}</p>

                        <textarea
                            value={note}
                            onChange={e => setNote(e.target.value)}
                            placeholder="×œ×“×•×’××”: ××•×ª×’ ××¡×, ××”××“×£ ×”×¢×œ×™×•×Ÿ..."
                            className="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl dark:bg-gray-700 dark:text-white focus:border-indigo-500 resize-none h-24 mb-4"
                            autoFocus
                        />

                        <div className="flex gap-3">
                            <button onClick={handleSave} disabled={loading} className="flex-1 btn-gradient text-white py-3 rounded-xl font-semibold disabled:opacity-50">
                                {loading ? '×©×•××¨...' : '×©××•×¨'}
                            </button>
                            <button onClick={onClose} className="px-6 py-3 glass border-2 border-gray-300 dark:border-gray-600 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-700">
                                ×‘×™×˜×•×œ
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // Error message helper
        function getErrorMessage(errorCode) {
            const messages = {
                'auth/email-already-in-use': '×›×ª×•×‘×ª ×”××™××™×™×œ ×›×‘×¨ ×‘×©×™××•×©',
                'auth/invalid-email': '×›×ª×•×‘×ª ××™××™×™×œ ×œ× ×ª×§×™× ×”',
                'auth/operation-not-allowed': '×¤×¢×•×œ×” ×œ× ××•×¨×©×™×ª',
                'auth/weak-password': '×”×¡×™×¡××” ×—×œ×©×” ××“×™ (×œ×¤×—×•×ª 6 ×ª×•×•×™×)',
                'auth/user-disabled': '×”××©×ª××© ×”×•×©×‘×ª',
                'auth/user-not-found': '××©×ª××© ×œ× × ××¦×',
                'auth/wrong-password': '×¡×™×¡××” ×©×’×•×™×”',
                'auth/too-many-requests': '×™×•×ª×¨ ××“×™ × ×™×¡×™×•× ×•×ª, × ×¡×” ×©×•×‘ ×××•×—×¨ ×™×•×ª×¨',
                'auth/invalid-credential': '×¤×¨×˜×™ ×”×ª×—×‘×¨×•×ª ×©×’×•×™×™×',
                'auth/missing-password': '× × ×œ×”×–×™×Ÿ ×¡×™×¡××”'
            };
            return messages[errorCode] || '××™×¨×¢×” ×©×’×™××”, × ×¡×” ×©×•×‘';
        }

        // Sign Up Form
        function SignUpForm({ onSwitchToLogin }) {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [confirmPassword, setConfirmPassword] = useState('');
            const [displayName, setDisplayName] = useState('');
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);

            const handleSignUp = async (e) => {
                e.preventDefault();
                setError('');

                if (!displayName.trim()) {
                    return setError('× × ×œ×”×–×™×Ÿ ×©× ×ª×¦×•×’×”');
                }
                if (password !== confirmPassword) {
                    return setError('×”×¡×™×¡×××•×ª ××™× ×Ÿ ×ª×•×××•×ª');
                }
                if (password.length < 6) {
                    return setError('×”×¡×™×¡××” ×—×™×™×‘×ª ×œ×”×™×•×ª ×œ×¤×—×•×ª 6 ×ª×•×•×™×');
                }

                try {
                    setLoading(true);
                    const userCredential = await window.firebaseAuth.createUserWithEmailAndPassword(
                        window.auth, email, password
                    );
                    await window.firebaseAuth.updateProfile(userCredential.user, {
                        displayName: displayName.trim()
                    });
                } catch (err) {
                    setError(getErrorMessage(err.code));
                } finally {
                    setLoading(false);
                }
            };

            return (
                <form onSubmit={handleSignUp} className="space-y-4">
                    <h2 className="text-2xl font-bold text-gray-800 dark:text-white text-center mb-6">×”×¨×©××”</h2>

                    {error && (
                        <div className="bg-red-100 dark:bg-red-900/30 border-2 border-red-300 dark:border-red-700 text-red-700 dark:text-red-300 px-4 py-3 rounded-lg text-sm">
                            {error}
                        </div>
                    )}

                    <div>
                        <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">×©× ×ª×¦×•×’×”</label>
                        <input
                            type="text"
                            value={displayName}
                            onChange={e => setDisplayName(e.target.value)}
                            placeholder="×”×©× ×©×™×•×¦×’ ×‘××¤×œ×™×§×¦×™×”"
                            className="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white focus:border-indigo-500 dark:focus:border-indigo-400 transition-colors"
                            required
                        />
                    </div>

                    <div>
                        <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">××™××™×™×œ</label>
                        <input
                            type="email"
                            value={email}
                            onChange={e => setEmail(e.target.value)}
                            placeholder="example@email.com"
                            className="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white focus:border-indigo-500 dark:focus:border-indigo-400 transition-colors"
                            dir="ltr"
                            required
                        />
                    </div>

                    <div>
                        <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">×¡×™×¡××”</label>
                        <input
                            type="password"
                            value={password}
                            onChange={e => setPassword(e.target.value)}
                            placeholder="×œ×¤×—×•×ª 6 ×ª×•×•×™×"
                            className="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white focus:border-indigo-500 dark:focus:border-indigo-400 transition-colors"
                            dir="ltr"
                            required
                        />
                    </div>

                    <div>
                        <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">××™××•×ª ×¡×™×¡××”</label>
                        <input
                            type="password"
                            value={confirmPassword}
                            onChange={e => setConfirmPassword(e.target.value)}
                            placeholder="×”×–×Ÿ ×©×•×‘ ××ª ×”×¡×™×¡××”"
                            className="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white focus:border-indigo-500 dark:focus:border-indigo-400 transition-colors"
                            dir="ltr"
                            required
                        />
                    </div>

                    <button
                        type="submit"
                        disabled={loading}
                        className="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-indigo-700 hover:to-purple-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                        {loading ? '× ×¨×©×...' : '×”×¨×©××”'}
                    </button>

                    <p className="text-center text-gray-600 dark:text-gray-400 text-sm">
                        ×›×‘×¨ ×™×© ×œ×š ×—×©×‘×•×Ÿ?{' '}
                        <button type="button" onClick={onSwitchToLogin} className="text-indigo-600 dark:text-indigo-400 font-semibold hover:underline">
                            ×”×ª×—×‘×¨×•×ª
                        </button>
                    </p>
                </form>
            );
        }

        // Login Form
        function LoginForm({ onSwitchToSignUp, onSwitchToReset }) {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);

            const handleLogin = async (e) => {
                e.preventDefault();
                setError('');

                try {
                    setLoading(true);
                    await window.firebaseAuth.signInWithEmailAndPassword(window.auth, email, password);
                } catch (err) {
                    setError(getErrorMessage(err.code));
                } finally {
                    setLoading(false);
                }
            };

            return (
                <form onSubmit={handleLogin} className="space-y-4">
                    <h2 className="text-2xl font-bold text-gray-800 dark:text-white text-center mb-6">×”×ª×—×‘×¨×•×ª</h2>

                    {error && (
                        <div className="bg-red-100 dark:bg-red-900/30 border-2 border-red-300 dark:border-red-700 text-red-700 dark:text-red-300 px-4 py-3 rounded-lg text-sm">
                            {error}
                        </div>
                    )}

                    <div>
                        <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">××™××™×™×œ</label>
                        <input
                            type="email"
                            value={email}
                            onChange={e => setEmail(e.target.value)}
                            placeholder="example@email.com"
                            className="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white focus:border-indigo-500 dark:focus:border-indigo-400 transition-colors"
                            dir="ltr"
                            required
                        />
                    </div>

                    <div>
                        <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">×¡×™×¡××”</label>
                        <input
                            type="password"
                            value={password}
                            onChange={e => setPassword(e.target.value)}
                            placeholder="×”×¡×™×¡××” ×©×œ×š"
                            className="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white focus:border-indigo-500 dark:focus:border-indigo-400 transition-colors"
                            dir="ltr"
                            required
                        />
                    </div>

                    <button
                        type="submit"
                        disabled={loading}
                        className="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-indigo-700 hover:to-purple-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                        {loading ? '××ª×—×‘×¨...' : '×”×ª×—×‘×¨×•×ª'}
                    </button>

                    <button
                        type="button"
                        onClick={onSwitchToReset}
                        className="w-full text-indigo-600 dark:text-indigo-400 text-sm hover:underline"
                    >
                        ×©×›×—×ª×™ ×¡×™×¡××”
                    </button>

                    <p className="text-center text-gray-600 dark:text-gray-400 text-sm">
                        ××™×Ÿ ×œ×š ×—×©×‘×•×Ÿ?{' '}
                        <button type="button" onClick={onSwitchToSignUp} className="text-indigo-600 dark:text-indigo-400 font-semibold hover:underline">
                            ×”×¨×©××”
                        </button>
                    </p>
                </form>
            );
        }

        // Password Reset Form
        function PasswordResetForm({ onSwitchToLogin }) {
            const [email, setEmail] = useState('');
            const [error, setError] = useState('');
            const [success, setSuccess] = useState(false);
            const [loading, setLoading] = useState(false);

            const handleReset = async (e) => {
                e.preventDefault();
                setError('');

                try {
                    setLoading(true);
                    await window.firebaseAuth.sendPasswordResetEmail(window.auth, email);
                    setSuccess(true);
                } catch (err) {
                    setError(getErrorMessage(err.code));
                } finally {
                    setLoading(false);
                }
            };

            if (success) {
                return (
                    <div className="text-center space-y-4">
                        <div className="text-6xl">ğŸ“§</div>
                        <h2 className="text-2xl font-bold text-gray-800 dark:text-white">× ×©×œ×—!</h2>
                        <p className="text-gray-600 dark:text-gray-400">
                            ×§×™×©×•×¨ ×œ××™×¤×•×¡ ×¡×™×¡××” × ×©×œ×— ×œ-<br/>
                            <span className="font-semibold" dir="ltr">{email}</span>
                        </p>
                        <p className="text-sm text-gray-500 dark:text-gray-500">×‘×“×•×§ ×’× ×‘×ª×™×§×™×™×ª ×”×¡×¤××</p>
                        <button
                            onClick={onSwitchToLogin}
                            className="text-indigo-600 dark:text-indigo-400 font-semibold hover:underline"
                        >
                            ×—×–×•×¨ ×œ×”×ª×—×‘×¨×•×ª
                        </button>
                    </div>
                );
            }

            return (
                <form onSubmit={handleReset} className="space-y-4">
                    <h2 className="text-2xl font-bold text-gray-800 dark:text-white text-center mb-2">××™×¤×•×¡ ×¡×™×¡××”</h2>
                    <p className="text-center text-gray-600 dark:text-gray-400 text-sm mb-6">
                        ×”×–×Ÿ ××ª ×›×ª×•×‘×ª ×”××™××™×™×œ ×©×œ×š ×•× ×©×œ×— ×œ×š ×§×™×©×•×¨ ×œ××™×¤×•×¡
                    </p>

                    {error && (
                        <div className="bg-red-100 dark:bg-red-900/30 border-2 border-red-300 dark:border-red-700 text-red-700 dark:text-red-300 px-4 py-3 rounded-lg text-sm">
                            {error}
                        </div>
                    )}

                    <div>
                        <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">××™××™×™×œ</label>
                        <input
                            type="email"
                            value={email}
                            onChange={e => setEmail(e.target.value)}
                            placeholder="example@email.com"
                            className="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white focus:border-indigo-500 dark:focus:border-indigo-400 transition-colors"
                            dir="ltr"
                            required
                        />
                    </div>

                    <button
                        type="submit"
                        disabled={loading}
                        className="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-indigo-700 hover:to-purple-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                        {loading ? '×©×•×œ×—...' : '×©×œ×— ×§×™×©×•×¨ ××™×¤×•×¡'}
                    </button>

                    <button
                        type="button"
                        onClick={onSwitchToLogin}
                        className="w-full text-indigo-600 dark:text-indigo-400 text-sm hover:underline"
                    >
                        ×—×–×•×¨ ×œ×”×ª×—×‘×¨×•×ª
                    </button>
                </form>
            );
        }

        // Auth Screen Container
        function AuthScreen() {
            const [mode, setMode] = useState('login');
            const [darkMode, setDarkMode] = useState(false);

            useEffect(() => {
                const savedDark = localStorage.getItem('darkMode') === 'true';
                if (savedDark) {
                    setDarkMode(true);
                    document.documentElement.classList.add('dark');
                }
            }, []);

            const toggleDarkMode = () => {
                const newMode = !darkMode;
                setDarkMode(newMode);
                localStorage.setItem('darkMode', String(newMode));
                document.documentElement.classList.toggle('dark');
            };

            return (
                <div className="min-h-screen gradient-bg flex items-center justify-center p-4">
                    <div className="glass rounded-3xl shadow-2xl p-8 max-w-md w-full relative overflow-hidden">
                        <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500"></div>
                        <button
                            onClick={toggleDarkMode}
                            className="absolute top-6 left-6 p-2.5 rounded-xl bg-white/50 dark:bg-gray-700/50 text-2xl hover:scale-110 transition-all duration-300 shadow-lg"
                        >
                            {darkMode ? 'â˜€ï¸' : 'ğŸŒ™'}
                        </button>

                        <div className="text-center mb-8 pt-4">
                            <div className="text-7xl mb-4 float">ğŸ›’</div>
                            <h1 className="text-3xl font-bold text-gradient mb-2">ShopSmart</h1>
                            <p className="text-gray-500 dark:text-gray-400 text-sm">×¨×©×™××ª ×”×§× ×™×•×ª ×”×—×›××” ×©×œ×š</p>
                        </div>

                        {mode === 'login' && (
                            <LoginForm
                                onSwitchToSignUp={() => setMode('signup')}
                                onSwitchToReset={() => setMode('reset')}
                            />
                        )}
                        {mode === 'signup' && (
                            <SignUpForm onSwitchToLogin={() => setMode('login')} />
                        )}
                        {mode === 'reset' && (
                            <PasswordResetForm onSwitchToLogin={() => setMode('login')} />
                        )}
                    </div>
                </div>
            );
        }

        const CATEGORIES = {
            fruits: { name: '×¤×™×¨×•×ª ×•×™×¨×§×•×ª', icon: 'ğŸ', unit: '×§"×’', unitOptions: ['×§"×’', '×™×—\'', '×’×¨×'] },
            dairy: { name: '×—×œ×‘×™', icon: 'ğŸ§€', unit: '×™×—\'', unitOptions: ['×™×—\'', '×’×¨×', '×"×œ', '×œ×™×˜×¨'] },
            desserts: { name: '××¢×“× ×™ ×—×œ×‘', icon: 'ğŸ¨', unit: '×™×—\'', unitOptions: ['×™×—\'', '×’×¨×'] },
            meat: { name: '×‘×©×¨ ×•×“×’×™×', icon: 'ğŸ¥©', unit: '×§"×’', unitOptions: ['×§"×’', '×’×¨×', '×™×—\''] },
            deli: { name: '××¢×“× ×™×”', icon: 'ğŸ¥ª', unit: '×’×¨×', unitOptions: ['×’×¨×', '×§"×’', '×™×—\''] },
            bakery: { name: '×œ×—× ×•×××¤×™×', icon: 'ğŸ¥', unit: '×™×—\'', unitOptions: ['×™×—\''] },
            spreads: { name: '×××¨×—×™×', icon: 'ğŸ¯', unit: '×™×—\'', unitOptions: ['×™×—\'', '×’×¨×'] },
            baking: { name: '××•×¦×¨×™ ××¤×™×”', icon: 'ğŸ§', unit: '×™×—\'', unitOptions: ['×™×—\'', '×’×¨×', '×§"×’'] },
            cereals: { name: '×“×’× ×™× ×•×§×•×¨× ×¤×œ×§×¡', icon: 'ğŸŒ¾', unit: '×™×—\'', unitOptions: ['×™×—\'', '×’×¨×'] },
            canned: { name: '×©×™××•×¨×™× ×•××–×•×Ÿ ×™×‘×©', icon: 'ğŸ¥«', unit: '×™×—\'', unitOptions: ['×™×—\'', '×’×¨×'] },
            spices: { name: '×ª×‘×œ×™× ×™× ×•×‘×™×©×•×œ', icon: 'ğŸŒ¿', unit: '×’×¨×', unitOptions: ['×’×¨×', '×™×—\''] },
            coffee: { name: '×§×¤×” ×•×ª×”', icon: 'â˜•', unit: '×™×—\'', unitOptions: ['×™×—\'', '×’×¨×'] },
            drinks: { name: '××©×§××•×ª ×§×œ×™×', icon: 'ğŸ§ƒ', unit: '×™×—\'', unitOptions: ['×™×—\'', '×œ×™×˜×¨', '×"×œ'] },
            wine: { name: '×™×™×Ÿ ×•××œ×›×•×”×•×œ', icon: 'ğŸ·', unit: '×™×—\'', unitOptions: ['×™×—\'', '×"×œ'] },
            snacks: { name: '×—×˜×™×¤×™× ×•×××ª×§×™×', icon: 'ğŸ«', unit: '×™×—\'', unitOptions: ['×™×—\'', '×’×¨×'] },
            frozen: { name: '×§×¤×•××™×', icon: 'â„ï¸', unit: '×™×—\'', unitOptions: ['×™×—\'', '×§"×’', '×’×¨×'] },
            health: { name: '×“×™××˜×” ×•×—×œ×‘×•×Ÿ', icon: 'ğŸ¥—', unit: '×™×—\'', unitOptions: ['×™×—\'', '×’×¨×'] },
            hygiene: { name: '×”×™×’×™×™× ×” ×•×¨×—×¦×”', icon: 'ğŸ›', unit: '×™×—\'', unitOptions: ['×™×—\''] },
            cleaning: { name: '× ×™×§×™×•×Ÿ', icon: 'âœ¨', unit: '×™×—\'', unitOptions: ['×™×—\'', '×œ×™×˜×¨'] },
            candles: { name: '× ×¨×•×ª ×•×©××Ÿ', icon: 'ğŸ•¯ï¸', unit: '×™×—\'', unitOptions: ['×™×—\'', '×œ×™×˜×¨'] },
            baby: { name: '×ª×™× ×•×§×•×ª ×•×™×œ×“×™×', icon: 'ğŸ¼', unit: '×™×—\'', unitOptions: ['×™×—\''] },
            pets: { name: '×—×™×•×ª ××—××“', icon: 'ğŸ•', unit: '×™×—\'', unitOptions: ['×™×—\'', '×§"×’'] }
        };

        // Israeli holidays for calendar reminders (2025-2026 dates)
        const ISRAELI_HOLIDAYS = [
            { name: '×¤×•×¨×™×', icon: 'ğŸ­', date: '14.03.2025', dateObj: new Date('2025-03-14'), reminder: '×–××Ÿ ×œ×§× ×•×ª ××©×œ×•×—×™ ×× ×•×ª ×•××•×–× ×™ ×”××Ÿ', type: 'jewish' },
            { name: '×¤×¡×—', icon: 'ğŸ·', date: '13-19.04.2025', dateObj: new Date('2025-04-13'), reminder: '×–××Ÿ ×œ×§× ×•×ª ××¦×•×ª, ×™×™×Ÿ, ×—×¨×•×¡×ª ×•××¦×¨×›×™× ×œ×—×’', type: 'jewish' },
            { name: '×™×•× ×”×–×™×›×¨×•×Ÿ', icon: 'ğŸ•¯ï¸', date: '30.04.2025', dateObj: new Date('2025-04-30'), reminder: '×™×•× ×–×™×›×¨×•×Ÿ ×œ×—×œ×œ×™ ×¦×”"×œ', type: 'national' },
            { name: '×™×•× ×”×¢×¦×××•×ª', icon: 'ğŸ‡®ğŸ‡±', date: '01.05.2025', dateObj: new Date('2025-05-01'), reminder: '×–××Ÿ ×œ×§× ×•×ª ×‘×©×¨, × ×§× ×™×§×™×•×ª ×•×¦×™×•×“ ×œ×× ×’×œ!', type: 'national' },
            { name: '×œ"×’ ×‘×¢×•××¨', icon: 'ğŸ”¥', date: '16.05.2025', dateObj: new Date('2025-05-16'), reminder: '×–××Ÿ ×œ×§× ×•×ª ×‘×©×¨ ×•× ×§× ×™×§×™×•×ª ×œ××“×•×¨×”', type: 'jewish' },
            { name: '×™×•× ×™×¨×•×©×œ×™×', icon: 'ğŸ›ï¸', date: '02.06.2025', dateObj: new Date('2025-06-02'), reminder: '×™×•× ×™×¨×•×©×œ×™×', type: 'national' },
            { name: '×©×‘×•×¢×•×ª', icon: 'ğŸ§€', date: '02-03.06.2025', dateObj: new Date('2025-06-02'), reminder: '×–××Ÿ ×œ×§× ×•×ª ××•×¦×¨×™ ×—×œ×‘ ×•×¢×•×’×•×ª ×’×‘×™× ×”', type: 'jewish' },
            { name: '×¨××© ×”×©× ×”', icon: 'ğŸ', date: '23-24.09.2025', dateObj: new Date('2025-09-23'), reminder: '×–××Ÿ ×œ×§× ×•×ª ×“×‘×©, ×ª×¤×•×—×™×, ×¨×™××•× ×™× ×•×“×’×™×', type: 'jewish' },
            { name: '×™×•× ×›×™×¤×•×¨', icon: 'ğŸ•¯ï¸', date: '02.10.2025', dateObj: new Date('2025-10-02'), reminder: '×–××Ÿ ×œ×”×›×™×Ÿ ××•×›×œ ×œ×¤× ×™ ×•××—×¨×™ ×”×¦×•×', type: 'jewish' },
            { name: '×¡×•×›×•×ª', icon: 'ğŸŒ¿', date: '07-13.10.2025', dateObj: new Date('2025-10-07'), reminder: '×–××Ÿ ×œ×§× ×•×ª ××¨×‘×¢×ª ×”××™× ×™× ×•××•×›×œ ×œ×—×’', type: 'jewish' },
            { name: '×©××—×ª ×ª×•×¨×”', icon: 'ğŸ“œ', date: '15.10.2025', dateObj: new Date('2025-10-15'), reminder: '×–××Ÿ ×œ×”×›×™×Ÿ ×›×™×‘×•×“ ×•×××ª×§×™×', type: 'jewish' },
            { name: '×—× ×•×›×”', icon: 'ğŸ•', date: '15-22.12.2025', dateObj: new Date('2025-12-15'), reminder: '×–××Ÿ ×œ×§× ×•×ª ×©××Ÿ, × ×¨×•×ª, ×¡×•×¤×’× ×™×•×ª ×•×œ×‘×™×‘×•×ª', type: 'jewish' },
            { name: '×¡×™×œ×‘×¡×˜×¨', icon: 'ğŸ¥‚', date: '31.12.2025', dateObj: new Date('2025-12-31'), reminder: '××¡×™×‘×ª ×¡×•×£ ×©× ×” - ×–××Ÿ ×œ×§× ×•×ª ×—×˜×™×¤×™× ×•×©×ª×™×™×”', type: 'civil' },
            { name: '×¨××© ×”×©× ×” ×”××–×¨×—×™×ª', icon: 'ğŸ‰', date: '01.01.2026', dateObj: new Date('2026-01-01'), reminder: '×©× ×” ××–×¨×—×™×ª ×—×“×©×”!', type: 'civil' },
            { name: '×˜"×• ×‘×©×‘×˜', icon: 'ğŸŒ³', date: '04.02.2026', dateObj: new Date('2026-02-04'), reminder: '×–××Ÿ ×œ×§× ×•×ª ×¤×™×¨×•×ª ×™×‘×©×™× ×•×¤×™×¨×•×ª ×”××¨×¥', type: 'jewish' },
            { name: '×¤×•×¨×™×', icon: 'ğŸ­', date: '03.03.2026', dateObj: new Date('2026-03-03'), reminder: '×–××Ÿ ×œ×§× ×•×ª ××©×œ×•×—×™ ×× ×•×ª ×•××•×–× ×™ ×”××Ÿ', type: 'jewish' },
            { name: '×¤×¡×—', icon: 'ğŸ·', date: '02-08.04.2026', dateObj: new Date('2026-04-02'), reminder: '×–××Ÿ ×œ×§× ×•×ª ××¦×•×ª, ×™×™×Ÿ, ×—×¨×•×¡×ª ×•××¦×¨×›×™× ×œ×—×’', type: 'jewish' }
        ];

        const PRODUCTS = {
            dairy: ['×—×œ×‘', '×—×œ×‘ 3%', '×—×œ×‘ 1%', '×—×œ×‘ ×“×œ ×©×•××Ÿ', '×—×œ×‘ ×¡×•×™×”', '×—×œ×‘ ×©×§×“×™×', '×—×œ×‘ ×§×•×§×•×¡', '×—×œ×‘ ×©×™×‘×•×œ×ª ×©×•×¢×œ', '×œ×‘×Ÿ', '×œ×‘×Ÿ ×¢×–', '×’×‘×™× ×” ×¦×”×•×‘×” ×¢××§', '×’×‘×™× ×” ×¦×”×•×‘×” ×’×œ×‘×•×¢', '×’×‘×™× ×” ×¦×”×•×‘×” 9%', '×’×‘×™× ×” ×¦×”×•×‘×” 22%', '×§×•×˜×’×³', '×§×•×˜×’×³ 5%', '×§×•×˜×’×³ 3%', '×§×•×˜×’×³ 0%', '×’×‘×™× ×” ×‘×•×œ×’×¨×™×ª', '×¦×¤×ª×™×ª', '×’×‘×™× ×ª ×©×× ×ª', '×¤×¨××–×Ÿ', '××•×¦×¨×œ×”', '××•×¦×¨×œ×” ×˜×¨×™×™×”', '×‘×™×¦×™×', '×‘×™×¦×™× L', '×‘×™×¦×™× XL', '×‘×™×¦×™× ××•×¨×’× ×™×•×ª', '×‘×™×¦×™× ×—×•×¤×©×™×•×ª', '×—×××”', '×—×××” ××œ×•×—×”', '×©×× ×ª ××ª×•×§×”', '×©×× ×ª ×—××•×¦×”', '×©×× ×ª ×œ×§×¦×¤×ª', '×™×•×’×•×¨×˜', '×™×•×’×•×¨×˜ ×™×•×•× ×™', '×™×•×’×•×¨×˜ ×™×•×•× ×™ 0%', '×™×•×’×•×¨×˜ ×ª× ×•×‘×”', '×™×•×’×•×¨×˜ ×©×˜×¨××•×¡', '×™×•×’×•×¨×˜ ××§×˜×™×‘×™×”', '×’×‘×™× ×” ×œ×‘× ×”', '×’×‘×™× ×” ×œ×‘× ×” 5%', '×’×‘×™× ×” ×œ×‘× ×” 9%', '×™×•×’×•×¨×˜ ××•×¨×’× ×™', '×™×•×’×•×¨×˜ ×œ×™×œ×“×™×', '×’×‘×™× ×ª ×¢×–×™×', '×’×‘×™× ×ª ×¨×•×§×¤×•×¨', '×§×©×§×‘×œ', '×’××•×“×”', '××× ×˜×œ', '×‘×¨×™', '×§×××‘×¨', '×—×œ×•××™', '×¤×™×œ×“×œ×¤×™×”', '×œ××‘× ×”', '×¨×™×§×•×˜×”', '××¡×§×¨×¤×•× ×”', '×’×‘×™× ×ª ×ª×¤×•×—', '×××¨×— ×’×‘×™× ×”', '×’×‘×™× ×” ××•×ª×›×ª', '×—×××” ×‘×¦×œ', '×—×××” ×©×•×', '××¨×’×¨×™× ×”', '×˜×•×¤×•', '×˜×•×¤×• ××•×§×©×”'],

            fruits: ['×¢×’×‘× ×™×•×ª', '×¢×’×‘× ×™×•×ª ×©×¨×™', '×¢×’×‘× ×™×•×ª ×¢× ×‘×™×', '×¢×’×‘× ×™×•×ª ××’×™', '××œ×¤×¤×•× ×™×', '××œ×¤×¤×•×Ÿ ×‘×™×™×‘×™', '××œ×¤×¤×•×Ÿ ×—××•×¥', '×‘×¦×œ', '×‘×¦×œ ×¡×’×•×œ', '×‘×¦×œ ×™×¨×•×§', '×©×•×', '×¨××© ×©×•×', '×©×•× ×§×œ×•×£', '×¤×œ×¤×œ ××“×•×', '×¤×œ×¤×œ ×™×¨×•×§', '×¤×œ×¤×œ ×¦×”×•×‘', '×¤×œ×¤×œ ×›×ª×•×', '×¤×œ×¤×œ ×—×¨×™×£', '×—×¡×”', '×—×¡×” ××™×™×¡×‘×¨×’', '×—×¡×” ×¨×•××™×ª', '×›×¨×•×‘', '×›×¨×•×‘ ×¡×’×•×œ', '×›×¨×•×‘ ×¡×™× ×™', '×’×–×¨', '×’×–×¨ ×‘×™×™×‘×™', '×¡×œ×§', '×¡×œ×§ ××‘×•×©×œ', '×ª×¤×•×—×™ ××“××”', '×ª×¤×•×´× ××“×•×', '×ª×¤×•×´× ×œ×‘×Ÿ', '×‘×˜×˜×”', '×‘×˜×˜×” ×›×ª×•××”', '×§×™×©×•×', '×§×™×©×•× ×™×¨×•×§', '×—×¦×™×œ', '×‘×¨×•×§×•×œ×™', '×›×¨×•×‘×™×ª', '×ª×¨×“', '×ª×¨×“ ×‘×™×™×‘×™', '×©××™×¨', '×˜×¨×’×•×Ÿ', '×¨××©××“', '×¨×™×—×Ÿ', '× ×¢× ×¢', '×¨×•×§×˜', '×¤×˜×¨×•×–×™×œ×™×”', '×›×•×¡×‘×¨×”', '×¡×œ×¨×™', '×©×•××¨', '×§×•×œ×•×¨×‘×™', '××¨×˜×™×©×•×§', '××¡×¤×¨×’×•×¡', '×¤×˜×¨×™×•×ª', '×¤×˜×¨×™×•×ª ×©××¤×™× ×™×•×Ÿ', '×¤×˜×¨×™×•×ª ×¤×•×¨×˜×•×‘×œ×•', '×œ×™××•×Ÿ', '×œ×™×™×', '×‘× × ×•×ª', '×ª×¤×•×—×™×', '×ª×¤×•×—×™× ×™×¨×•×§×™×', '×ª×¤×•×—×™× ××“×•××™×', '×ª×¤×•×–×™×', '××©×›×•×œ×™×ª', '××©×›×•×œ×™×ª ××“×•××”', '×¤×•××œ×”', '××‘×˜×™×—', '××œ×•×Ÿ', '××œ×•×Ÿ ×’×œ×™×”', '×¢× ×‘×™×', '×¢× ×‘×™× ×™×¨×•×§×™×', '×¢× ×‘×™× ×©×—×•×¨×™×', '××’×¡', '×©×–×™×¤×™×', '××¤×¨×¡×§×™×', '× ×§×˜×¨×™× ×•×ª', '×§×œ×× ×˜×™× ×•×ª', '×§×™×•×•×™', '×¨×™××•× ×™×', '×× ×’×•', '×× × ×¡', '××‘×•×§×“×•', '×ª×•×ª×™×', '×¤×˜×œ', '××•×›×× ×™×•×ª', '×“×•×‘×“×‘× ×™×', '××©××©', '×ª×× ×™×', '×¤×¡×™×¤×œ×•×¨×”', '×¤×¤××™×”', '×§×¨××‘×•×œ×”', '×œ×™×¦\'×™', '×“×¨×§×•×Ÿ ×¤×¨×™', '×§×•×§×•×¡'],

            bakery: ['×œ×—×', '×œ×—× ××œ×', '×œ×—× ×©×™×¤×•×Ÿ', '×œ×—× ×›×•×¡××™×Ÿ', '×œ×—× ×“×’× ×™×', '×œ×—× ×¤×¨×•×¡', '×œ×—× ××—×™×“', '×œ×—× ×œ×œ× ×’×œ×•×˜×Ÿ', '×—×œ×”', '×—×œ×” ××œ××”', '×—×œ×” ××ª×•×§×”', '×¢×•×’×™×•×ª', '×¢×•×’×™×•×ª ×©×•×§×•×œ×“ ×¦\'×™×¤×¡', '×¢×•×’×™×•×ª ×—×××”', '×¤×™×ª×•×ª', '×¤×™×ª×•×ª ××œ××•×ª', '×¤×™×ª×•×ª ××™× ×™', '×œ×—×× ×™×•×ª', '×œ×—×× ×™×•×ª ×”××‘×•×¨×’×¨', '×œ×—×× ×™×•×ª × ×§× ×™×§×™×”', '×‘×’×˜', '×¦\'×‘×˜×”', '×¤×•×§×¦\'×”', '×¨×•×œ×“×”', '×œ×—× ×©×•××©×•×', '×œ×—× ×¤×©×•×˜', '××¦×•×ª', '××¦×•×ª ××œ××•×ª', '×§×¨×§×¨×™×', '×œ×—× ×§×œ', '×˜×•×¨×˜×™×™×”', '×œ××¤×”', '× ××Ÿ', '×§×¨×•××¡×•×Ÿ', '×§×¨×•××¡×•×Ÿ ×©×•×§×•×œ×“', '×‘×¨×™×•×©', '×¡×•×¤×’× ×™×•×ª', '×“×•× ××˜×¡', '×××¤×™× ×¡', '×¢×•×’×ª ×©××¨×™×', '×©×˜×¨×•×“×œ', '×¨×•×’×œ×š', '×‘×•×¨×§×¡', '×‘×•×¨×§×¡ ×’×‘×™× ×”', '×‘×•×¨×§×¡ ×ª×¤×•×´×', '×‘×•×¨×§×¡ ×¤×˜×¨×™×•×ª'],

            spreads: ['× ×•×˜×œ×”', '× ×•×˜×œ×” 400 ×’×¨×', '× ×•×˜×œ×” 750 ×’×¨×', '×××¨×— ×©×•×§×•×œ×“', '×××¨×— ×©×•×§×•×œ×“ ×”×©×—×¨ ×”×¢×•×œ×”', '×××¨×— ×©×•×§×•×œ×“ ×¢×œ×™×ª', '×××¨×— ××’×•×–×™×', '×××¨×— ×œ×•×˜×•×¡', '×—×××ª ×‘×•×˜× ×™×', '×—×××ª ×‘×•×˜× ×™× ×—×œ×§×”', '×—×××ª ×‘×•×˜× ×™× ×§×¨×× ×¦\'×™', '×—×××ª ×‘×•×˜× ×™× ×¡×§×™×¤×™', '×—×××ª ×©×§×“×™×', '×—×××ª ×§×©×™×•', '×—×××ª ××’×•×–×™ ×œ×•×–', '×˜×—×™× ×”', '×˜×—×™× ×” ×’×•×œ××™×ª', '×˜×—×™× ×” ××œ ××¨×–', '×˜×—×™× ×” ×”×‘××‘×', '×—×œ×•×•×”', '×—×œ×•×•×” ×¤×¨×•×¡×”', '×—×œ×•×•×” ×©×•×§×•×œ×“', '×—×œ×•×•×” ×¤×™×¡×˜×•×§', '×¨×™×‘×”', '×¨×™×‘×” ×ª×•×ª', '×¨×™×‘×” ××©××©', '×¨×™×‘×” ×“×•×‘×“×‘×Ÿ', '×¨×™×‘×” ×ª×¤×•×–', '×¨×™×‘×” ×¤×˜×œ', '×¨×™×‘×” ×œ×œ× ×¡×•×›×¨', '××¨××œ×“×”', '×“×‘×©', '×“×‘×© ×˜×”×•×¨', '×“×‘×© ×¤×¨×—×™×', '×“×‘×© ××•×¨×’× ×™', '×¡×™×œ××Ÿ', '×¡×™×œ××Ÿ ×˜×”×•×¨', '×××¨×— ×©×•×', '×××¨×— ×–×™×ª×™×', '×××¨×— ×¢×’×‘× ×™×•×ª ××™×•×‘×©×•×ª', '×××¨×— ××¨×˜×™×©×•×§', '×¤×¡×˜×•', '×¤×¡×˜×• ×™×¨×•×§', '×¤×¡×˜×• ××“×•×', '×××¨×— ×˜×•× ×”', '×××¨×— ×—×¦×™×œ', '×—×•××•×¡ ×××¨×—'],

            baking: ['×§××—', '×§××— ×œ×‘×Ÿ', '×§××— ××œ×', '×§××— ×ª×™×¨×¡', '×§××— ×›×•×¡××™×Ÿ', '×§××— ×©×§×“×™×', '×§××— ×§×•×§×•×¡', '×§××— ×œ×œ× ×’×œ×•×˜×Ÿ', '×§××— ×ª×•×¤×—', '×§×•×¨× ×¤×œ×•×¨', '×¢××™×œ×Ÿ', '×¢××™×œ×Ÿ ×ª×™×¨×¡', '×¡×•×›×¨', '×¡×•×›×¨ ×œ×‘×Ÿ', '×¡×•×›×¨ ×—×•×', '×¡×•×›×¨ ×“××¨×¨×”', '×¡×•×›×¨ ×•× ×™×œ', '×¡×•×›×¨ ××‘×§×”', '×¡×•×›×¨×ª', '×¡×˜×™×‘×™×”', '×©××¨×™×', '×©××¨×™× ×™×‘×©×™×', '×©××¨×™× ×˜×¨×™×™×', '××‘×§×ª ××¤×™×™×”', '×¡×•×“×” ×œ×©×ª×™×™×”', '×•× ×™×œ', '×ª××¦×™×ª ×•× ×™×œ', '××§×œ×•×ª ×•× ×™×œ', '×©×•×§×•×œ×“ ×¦\'×™×¤×¡', '×©×•×§×•×œ×“ ×¦\'×™×¤×¡ ××¨×™×¨', '×©×•×§×•×œ×“ ×¦\'×™×¤×¡ ×œ×‘×Ÿ', '×©×•×§×•×œ×“ ××¨×™×¨ ×œ××¤×™×™×”', '×©×•×§×•×œ×“ ×—×œ×‘ ×œ××¤×™×™×”', '×©×•×§×•×œ×“ ×œ×‘×Ÿ ×œ××¤×™×™×”', '×§×§××•', '××‘×§×ª ×§×§××•', '×§×•×§×•×¡ ××’×•×¨×“', '×§×•×§×•×¡ ×˜×—×•×Ÿ', '×©×§×“×™×', '×©×§×“×™× ×˜×—×•× ×™×', '×©×§×“×™× ×¤×¨×•×¡×™×', '×©×§×“×™× ×©×œ××™×', '××’×•×–×™ ××œ×š', '××’×•×–×™ ××œ×š ×˜×—×•× ×™×', '×¤×§××Ÿ', '×¤×§××Ÿ ×˜×—×•×Ÿ', '×§×©×™×•', '×¤×™×¡×˜×•×§', '××’×•×–×™ ×œ×•×–', '×¦×™××•×§×™×', '×—××•×¦×™×•×ª', '×ª××¨×™×', '×ª××¨×™× ××’\'×”×•×œ', '×¤×¨×’', '×©×•××©×•×', '××¨×¦×™×¤×Ÿ', '×¤×•× ×“× ×˜', '×‘×¦×§ ×¡×•×›×¨', '×¦×‘×¢×™ ×××›×œ', '×¡×•×›×¨×™×•×ª ×œ×§×™×©×•×˜', '×’×œ×™×˜×¨ ×œ××¤×™×™×”', '×¤×™×¨×•×¨×™ ×œ×—×', '×¤×™×¨×•×¨×™ ×‘×™×¡×§×•×•×™×˜'],

            meat: ['×¢×•×£ ×©×œ× ×˜×¨×™', '×¢×•×£ ×©×œ× ×§×¤×•×', '×—×–×” ×¢×•×£ ×˜×¨×™', '×—×–×” ×¢×•×£ ×§×¤×•×', '×—×–×” ×¢×•×£ ×œ×œ× ×¢×•×¨ ×˜×¨×™', '×—×–×” ×¢×•×£ ×œ×œ× ×¢×•×¨ ×§×¤×•×', '×—×–×” ×¢×•×£ ×¤×¨×•×¡ ×˜×¨×™', '×›×¨×¢×™×™× ×¢×•×£ ×˜×¨×™×•×ª', '×›×¨×¢×™×™× ×¢×•×£ ×§×¤×•××•×ª', '×©×•×§×™×™× ×¢×•×£ ×˜×¨×™×™×', '×©×•×§×™×™× ×¢×•×£ ×§×¤×•××™×', '×›× ×¤×™×™× ×¢×•×£ ×˜×¨×™×•×ª', '×›× ×¤×™×™× ×¢×•×£ ×§×¤×•××•×ª', '×¢×•×£ ×˜×—×•×Ÿ ×˜×¨×™', '×¢×•×£ ×˜×—×•×Ÿ ×§×¤×•×', '×›×‘×“ ×¢×•×£ ×˜×¨×™', '×›×‘×“ ×¢×•×£ ×§×¤×•×', '×œ×‘×‘×•×ª ×¢×•×£', '×¤×¨×’×™×ª ×˜×¨×™×™×”', '×¤×¨×’×™×ª ×§×¤×•××”', '×—×–×” ×”×•×“×• ×˜×¨×™', '×—×–×” ×”×•×“×• ×§×¤×•×', '×”×•×“×• ×˜×—×•×Ÿ ×˜×¨×™', '×”×•×“×• ×˜×—×•×Ÿ ×§×¤×•×', '×‘×©×¨ ×˜×—×•×Ÿ ×˜×¨×™', '×‘×©×¨ ×˜×—×•×Ÿ ×§×¤×•×', '×‘×©×¨ ×˜×—×•×Ÿ ×¨×–×” ×˜×¨×™', '×× ×˜×¨×™×§×•×˜ ×˜×¨×™', '×× ×˜×¨×™×§×•×˜ ×§×¤×•×', '×¡×™× ×˜×” ×˜×¨×™×™×”', '×¡×™× ×˜×” ×§×¤×•××”', '×¤×™×œ×” ×‘×§×¨ ×˜×¨×™', '×¤×™×œ×” ×‘×§×¨ ×§×¤×•×', '×¦×œ×¢×•×ª ×‘×§×¨ ×˜×¨×™×•×ª', '×¦×œ×¢×•×ª ×‘×§×¨ ×§×¤×•××•×ª', '×©×¤×•× ×“×¨×” ×˜×¨×™×™×”', '×©×¤×•× ×“×¨×” ×§×¤×•××”', '××¡××“×• ×˜×¨×™', '××¡××“×• ×§×¤×•×', '×’×•×œ×© ×˜×¨×™', '×’×•×œ×© ×§×¤×•×', '×‘×©×¨ ×œ×©×•×•××¨××” ×˜×¨×™', '×‘×©×¨ ×œ×©×•×•××¨××” ×§×¤×•×', '×˜×œ×” ×˜×¨×™', '×˜×œ×” ×§×¤×•×', '×›×‘×© ×˜×¨×™', '×›×‘×© ×§×¤×•×', '×©× ×™×¦×œ ×¢×•×£ ×˜×¨×™', '×©× ×™×¦×œ ×¢×•×£ ×§×¤×•×', '×©× ×™×¦×œ ×”×•×“×• ×˜×¨×™', '×©× ×™×¦×œ ×”×•×“×• ×§×¤×•×', '×§×‘×‘ ×˜×¨×™', '×§×‘×‘ ×§×¤×•×', '×”××‘×•×¨×’×¨ ×˜×¨×™', '×”××‘×•×¨×’×¨ ×§×¤×•×', '×”××‘×•×¨×’×¨ ×‘×™×ª×™', '× ×§× ×™×§×™×•×ª ×¢×•×£', '× ×§× ×™×§×™×•×ª ×‘×§×¨', '×¡×œ××•×Ÿ ×˜×¨×™', '×¡×œ××•×Ÿ ×§×¤×•×', '×¡×œ××•×Ÿ ××¢×•×©×Ÿ', '×¤×™×œ×” ×¡×œ××•×Ÿ ×˜×¨×™', '×¤×™×œ×” ×¡×œ××•×Ÿ ×§×¤×•×', '×¤×™×œ×” ××× ×•×Ÿ ×˜×¨×™', '×¤×™×œ×” ××× ×•×Ÿ ×§×¤×•×', '×¤×™×œ×” ×‘×•×¨×™ ×˜×¨×™', '×¤×™×œ×” ×‘×•×¨×™ ×§×¤×•×', '×¤×™×œ×” ×“× ×™×¡ ×˜×¨×™', '×¤×™×œ×” ×“× ×™×¡ ×§×¤×•×', '×˜×•× ×” ×˜×¨×™×™×”', '×“×’ ×©×œ× ×˜×¨×™', '×“×’ ×©×œ× ×§×¤×•×', '× ×¡×™×›×™ ×™×', '×©×¨×™××¤×¡ ×§×¤×•×', '×§×œ×××¨×™ ×§×¤×•×', '××•×œ×™×', '×¡×¨×“×™× ×™×', '×“×’ ××¢×•×©×Ÿ', '×‘×©×¨ ××¢×•×‘×“'],

            desserts: ['××™×œ×§×™', '××™×œ×§×™ ××§×•×¨×™', '××™×œ×§×™ ××•×¨××•', '×“× ×•× ×”', '×“× ×•× ×” ×©×•×§×•×œ×“', '×™×•×¤×œ×”', '×“× ×™××œ×”', '×“× ×™××œ×” ×§×¨××œ', '××¢×“×Ÿ ×•× ×™×œ', '××¢×“×Ÿ ×©×•×§×•×œ×“', '××¢×“×Ÿ ×§×¨××œ', '××¢×“×Ÿ ×‘×™×¡×§×•×•×™×˜×™×', '××¢×“×Ÿ ×œ×•×˜×•×¡', '×©×•×§×• ×™×˜×‘×ª×”', '×©×•×§×• ×ª× ×•×‘×”', '×¤×•×“×™× ×’', '×¤×•×“×™× ×’ ×©×•×§×•×œ×“', '×¤×•×“×™× ×’ ×•× ×™×œ', '××¢×“×Ÿ ×™×•×’×•×¨×˜', '××¢×“×Ÿ ×ª×•×ª', '××¢×“×Ÿ ×‘× × ×”', '××•×¡ ×©×•×§×•×œ×“', '××•×¡ ×•× ×™×œ', '×¤×¨×™ ×’×“', '×“×Ÿ ×‘×¨××•×Ÿ', '×˜×™×¨××™×¡×•', '×§×¨× ×‘×¨×•×œ×”', '×¤× ×§×•×˜×”', '××•×¨×– ×—×œ×‘', '×¡×”×¨×•×Ÿ', '×’×•', '××•× ×˜×”', '×§×™× ×“×¨ ×‘×•×× ×•', '×§×™× ×“×¨ ××™×œ×§', '×§×™× ×“×¨ ×”×¤×ª×¢×”'],

            deli: ['× ×§× ×™×§×™×•×ª', '× ×§× ×™×§×™×•×ª ×‘×¨×’×–', '× ×§× ×™×§×™×•×ª ×¦×œ×™×™×”', '× ×§× ×™×§ ×¤×¨× ×§×¤×•×¨×˜×¨', '×¡×œ××™', '×¡×œ××™ ×”×•× ×’×¨×™', '×¤×¡×˜×¨××”', '×¤×¡×˜×¨××” ×”×•×“×•', '×§×‘× ×•×¡', '× ×§× ×™×§ ××¢×•×©×Ÿ', '×—×–×” ×”×•×“×• ××¢×•×©×Ÿ', '×—×–×” ×”×•×“×• ×¤×¨×•×¡', '×¨×•×¡×˜×‘×™×£', '×§×•×¨× ×‘×™×£', '×©×™×¤×•×“×™×', '×©×™×¤×•×“×™ ×¢×•×£', '×©×™×¤×•×“×™ ×”×•×“×•', '×§×¦×™×¦×•×ª', '×§×¦×™×¦×•×ª ×¢×•×£', '×§×¦×™×¦×•×ª ×‘×§×¨', '×œ×‘×™×‘×•×ª', '×¤×œ××¤×œ ××•×›×Ÿ', '×—×•××•×¡ ××•×›×Ÿ', '×˜×—×™× ×” ××•×›× ×”', '×¡×œ×˜×™× ××•×›× ×™×', '×¡×œ×˜ ×—×¦×™×œ×™×', '×¡×œ×˜ ××˜×‘×•×—×”', '×¡×œ×˜ ×˜×•×¨×§×™'],

            canned: ['××•×¨×–', '××•×¨×– ×‘×¡××˜×™', '××•×¨×– ×™×¡××™×Ÿ', '××•×¨×– ××œ×', '××•×¨×– ×¡×•×©×™', '××•×¨×– ×¤×¨×¡×™', '×¤×¡×˜×”', '×¤×¡×˜×” ×¤× ×”', '×¤×¡×˜×” ×¡×¤×’×˜×™', '×¤×¡×˜×” ×¤×¨×¤×œ×”', '×¤×¡×˜×” ×¤×•×–×™×œ×™', '×¤×¡×˜×” ×œ×–× ×™×”', '×¤×¡×˜×” ××œ××”', '×§×•×¡×§×•×¡', '×§×•×¡×§×•×¡ ××œ×', '×§×•×¡×§×•×¡ ×¤×ª×™×ª×™×', '×§×˜× ×™×•×ª', '×¨×•×˜×‘ ×¢×’×‘× ×™×•×ª', '×¨×•×˜×‘ ×¤×¡×˜×”', '×¨×¡×§ ×¢×’×‘× ×™×•×ª', '×˜×•× ×”', '×˜×•× ×” ×‘××™×', '×˜×•× ×” ×‘×©××Ÿ', '×˜×•× ×” ×‘×¨×•×˜×‘', '×ª×™×¨×¡', '×ª×™×¨×¡ ××ª×•×§', '×’×¨×’×™×¨×™ ×ª×™×¨×¡', '×©××Ÿ ×–×™×ª', '×©××Ÿ ×–×™×ª ×›×ª×™×ª', '×©××Ÿ ×§× ×•×œ×”', '×©××Ÿ ×—×× ×™×•×ª', '×©××Ÿ ×ª×™×¨×¡', '×©××Ÿ ×©×•××©×•×', '×©××Ÿ ××’×•×–×™×', '×—×•××¥ ×‘×œ×¡××™', '×—×•××¥ ×™×™×Ÿ', '×—×•××¥ ×ª×¤×•×—×™×', '×—×•××¥ ×œ×‘×Ÿ', '××™×¥ ×œ×™××•×Ÿ', '×—×•××•×¡', '×—×•××•×¡ ×˜×—×•×Ÿ', '×–×™×ª×™×', '×–×™×ª×™× ×©×—×•×¨×™×', '×–×™×ª×™× ×™×¨×•×§×™×', '×–×™×ª×™× ×§×œ××˜×”', '××œ×¤×¤×•×Ÿ ×—××•×¥', '×¤×œ×¤×œ ×—×¨×™×£', '×¤×¤×¨×™×§×” ×§×œ×•×™×”', '×‘×•×˜× ×™×', '×—×™×˜×”', '×‘×•×¨×’×•×œ', '×§×™× ×•××”', '×¤×¨×™×§×”', '× ×•×“×œ×¡', '××˜×¨×™×•×ª', '×¤×•×œ', '×’×¨×’×™×¨×™ ×—×•××•×¡', '×¢×“×©×™×', '×¢×“×©×™× ×›×ª×•××•×ª', '×¢×“×©×™× ×™×¨×•×§×•×ª', '×©×¢×•×¢×™×ª ×œ×‘× ×”', '×©×¢×•×¢×™×ª ××“×•××”', '×©×¢×•×¢×™×ª ×©×—×•×¨×”', '××¤×•× ×”', '×¡×•×™×”', '×××©'],

            cereals: ['×§×•×¨× ×¤×œ×§×¡', '×§×•×¨× ×¤×œ×§×¡ ×§×œ××¡×™', '×§×•×¨× ×¤×œ×§×¡ ×“×‘×©', '×§×•×¨× ×¤×œ×§×¡ ×©×•×§×•×œ×“', '×§×•×¨× ×¤×œ×§×¡ ×›×¨×™×•×ª', '×§×•×¨× ×¤×œ×§×¡ ×¤×™×¨×•×ª', '×˜×œ××” ×›×¨×™×•×ª', '×˜×¨×™×§×¡', '×¤×ª×™×ª×™ ×ª×™×¨×¡', '×’×¨× ×•×œ×”', '×’×¨× ×•×œ×” ×©×•×§×•×œ×“', '×’×¨× ×•×œ×” ×¤×™×¨×•×ª', '×’×¨× ×•×œ×” ××’×•×–×™×', '××•×–×œ×™', '×©×™×‘×•×œ×ª ×©×•×¢×œ', '×©×™×‘×•×œ×ª ×©×•×¢×œ ××”×™×¨×”', '×¤×¦×¤×•×¦×™ ××•×¨×–', '×§×•×•××§×¨', '×“×’× ×™ ×‘×•×§×¨', '×“×’× ×™× ××œ××™×', '××™× ×™ ×•×•×™×˜×¡', '×¤×¨×•×¡×˜×™×–', '×¦\'×¨×™×•×¡', '×¡×¤×™×™×©×œ K', '× ×¡×˜×œ×” ×¤×™×˜× ×¡', '×¡× ××§ ×‘×¨', '×—×˜×™×£ ×“×’× ×™×', '×—×˜×™×£ ×’×¨× ×•×œ×”'],

            spices: ['××œ×—', '××œ×— ×™×', '××œ×— ×©×•×œ×—×Ÿ', '××œ×— ×’×¡', '×¤×œ×¤×œ ×©×—×•×¨', '×¤×œ×¤×œ ×’×¨×•×¡', '×¤×¤×¨×™×§×”', '×¤×¤×¨×™×§×” ××ª×•×§×”', '×¤×¤×¨×™×§×” ×—×¨×™×¤×”', '×¤×¤×¨×™×§×” ××¢×•×©× ×ª', '×›×•×¨×›×•×', '×›××•×Ÿ', '×§×™× ××•×Ÿ', '×§×™× ××•×Ÿ ×˜×—×•×Ÿ', '××§×œ×•×ª ×§×™× ××•×Ÿ', '××‘×§×ª ×©×•×', '××‘×§×ª ×‘×¦×œ', '××•×¨×’× ×•', '×‘×–×™×œ×™×§×•×', '×–×¢×ª×¨', '×¡×•××§', '×—×•×•××™×™×’×³', '×ª×‘×œ×™×Ÿ ×œ×¢×•×£', '×ª×‘×œ×™×Ÿ ×œ×“×’×™×', '×ª×‘×œ×™×Ÿ ×œ×‘×©×¨', '×ª×‘×œ×™×Ÿ ×’×¨×™×œ', '×§××¨×™', '×’×¨× ××¡××œ×”', '×¦×™×™×œ×™', '×§×™××Ÿ', '×–× ×’×‘×™×œ', '××’×•×– ××•×¡×§×˜', '×¦×™×¤×•×¨×Ÿ', '×›×•×¡×‘×¨×” ×˜×—×•× ×”', '×§×¨×“××•×Ÿ', '×¢×œ×™ ×“×¤× ×”', '×¨×•×–××¨×™×Ÿ', '×˜×™××™×Ÿ', '×¤×¤×¨×™×§×” ×× ×˜×”', '×”×œ', '×›×•×›×‘ ×× ×™×¡', '×©×•××¨', '×¢×™×¨×™×ª', '××¨×•×•×”'],

            coffee: ['×§×¤×” × ××¡', '×§×¤×” ×¢×œ×™×ª', '×§×¤×” ×’\'×§×•×‘×¡', '×§×¤×” × ×¡×§×¤×”', '×§×¤×” ×˜×•×¨×§×™', '×§×¤×” ×©×—×•×¨', '×§×¤×” × ×¡×¤×¨×¡×•', '×§×¤×” × ×˜×•×œ ×§×¤××™×Ÿ', '×§×¤×¡×•×œ×•×ª × ×¡×¤×¨×¡×•', '×§×¤×¡×•×œ×•×ª ×“×•×œ×¦\'×”', '×§×¤×¡×•×œ×•×ª ×œ×•×•××¦×”', '×§×¤×¡×•×œ×•×ª ×˜××¡×™××•', '×§×¤×¡×•×œ×•×ª ×œ× ×“×•×•×¨', '×§×¤×” ×§×œ×•×™ ×˜×—×•×Ÿ', '×§×¤×” ××¡×¤×¨×¡×•', '×ª×” ×©×—×•×¨', '×ª×” ×™×¨×•×§', '×ª×” ×™×¨×•×§ ×™×¡××™×Ÿ', '×ª×” ×¦××—×™×', '×ª×” × ×¢× ×¢', '×ª×” ×œ×•××™×–×”', '×ª×” ×œ×™×¤×˜×•×Ÿ', '×ª×” ×•×™×¡×•×¦×§×™', '×ª×” ×¤×•×§×™××•×Ÿ', '×ª×” ×§××•××™×œ', '×ª×” ××¨×•×•×”', '×ª×” ×’\'×™× ×’\'×¨', '×ª×” ×œ×™××•×Ÿ', '×ª×” ××¨×œ ×’×¨×™×™', '×ª×” ×× ×’×œ×™', '×—×œ×‘ ××¨×•×›×–', '×§×¤×” ××•×›×Ÿ', '××™×™×¡ ×§×¤×”', '×§×¤×•×¦\'×™× ×• ××•×›×Ÿ', '×§×§××• ×©×•×§×•', '××‘×§×ª ×§×§××•'],

            drinks: ['××™× ××™× ×¨×œ×™×', '××™× ×‘×˜×¢××™×', '××™ ×¢×“×Ÿ', '× ×‘×™×¢×•×ª', '××™ × ×¢×', '×§×•×œ×”', '×§×•×œ×” 1.5 ×œ×™×˜×¨', '×§×•×œ×” 1 ×œ×™×˜×¨', '×§×•×œ×” 2 ×œ×™×˜×¨', '×§×•×œ×” ×¤×—×™×ª', '×©×™×©×™×™×ª ×§×•×œ×”', '×©×™×©×™×™×ª ×§×•×œ×” ×¤×—×™×•×ª', '×§×•×œ×” ×–×™×¨×•', '×§×•×œ×” ×–×™×¨×• 1.5 ×œ×™×˜×¨', '×§×•×œ×” ×–×™×¨×• 1 ×œ×™×˜×¨', '×§×•×œ×” ×–×™×¨×• ×¤×—×™×ª', '×©×™×©×™×™×ª ×§×•×œ×” ×–×™×¨×•', '×§×•×œ×” ×“×™××˜', '×§×•×œ×” ×“×™××˜ 1.5 ×œ×™×˜×¨', '×¤×¤×¡×™', '×¤×¤×¡×™ 1.5 ×œ×™×˜×¨', '×¤×¤×¡×™ ×¤×—×™×ª', '×©×™×©×™×™×ª ×¤×¤×¡×™', '×¤×¤×¡×™ ××§×¡', '×¤×¤×¡×™ ××§×¡ 1.5 ×œ×™×˜×¨', '×¡×¤×¨×™×™×˜', '×¡×¤×¨×™×™×˜ 1.5 ×œ×™×˜×¨', '×¡×¤×¨×™×™×˜ ×¤×—×™×ª', '×©×™×©×™×™×ª ×¡×¤×¨×™×™×˜', '×¡×¤×¨×™×™×˜ ×–×™×¨×•', '×¤×× ×˜×”', '×¤×× ×˜×” 1.5 ×œ×™×˜×¨', '×¤×× ×˜×” ×¤×—×™×ª', '×©×™×©×™×™×ª ×¤×× ×˜×”', '×©×•×•×¤×¡', '×©×•×•×¤×¡ 1.5 ×œ×™×˜×¨', '×¡×•×“×”', '×¡×•×“×” ×¤×—×™×ª', '×˜×•× ×™×§', '×˜×•× ×™×§ ×¤×—×™×ª', '××™×¥ ×ª×¤×•×–×™×', '××™×¥ ×ª×¤×•×–×™× ×¡×—×•×˜', '××™×¥ ×ª×¤×•×–×™× 1 ×œ×™×˜×¨', '××™×¥ ×ª×¤×•×—×™×', '××™×¥ ×¢× ×‘×™×', '××™×¥ ×’×–×¨', '××™×¥ ×¨×™××•× ×™×', '××™×¥ ×¤×¨×™×’×ª', '××™×¥ ×¡×¤×¨×™× ×’', '× ×§×˜×¨', '×ª×¤×•×–×™× ×”', '×œ×™××•× ×“×”', '×œ×™××•× ×¢× ×¢', 'XL ×× ×¨×’×™×”', 'XL ×¤×—×™×ª', '×¨×“ ×‘×•×œ', '×¨×“ ×‘×•×œ ×¤×—×™×ª', '××•× ×¡×˜×¨', '××•× ×¡×˜×¨ ×¤×—×™×ª', '××©×§×” ×¡×¤×•×¨×˜', '××©×§×” ×× ×¨×’×™×”', '××©×§×” ××™×–×•×˜×•× ×™', '×§×•××‘×•×¦\'×”', '××™ ×§×•×§×•×¡', '×—×œ×‘ ×©×•×§×•×œ×“', '×—×œ×‘ ×ª×•×ª', '×—×œ×‘ ×‘× × ×”'],

            wine: ['×™×™×Ÿ ××“×•×', '×™×™×Ÿ ×œ×‘×Ÿ', '×™×™×Ÿ ×¨×•×–×”', '×™×™×Ÿ ××‘×¢×‘×¢', '×™×™×Ÿ ×™×‘×©', '×™×™×Ÿ ×—×¦×™ ×™×‘×©', '×™×™×Ÿ ××ª×•×§', '×™×™×Ÿ ×§×™×“×•×©', '×™×™×Ÿ ×œ×¤×¡×—', '×™×™×Ÿ ×‘×¨×§×Ÿ', '×™×™×Ÿ ×™×§×‘ ×’×•×œ×Ÿ', '×™×™×Ÿ ×›×¨××œ', '×™×™×Ÿ ×˜×¤×¨×‘×¨×’', '×™×™×Ÿ ×’×œ× ×¡', '×™×™×Ÿ ×¤×¡×’×•×ª', '×™×™×Ÿ ×¨××ª × ×’×‘', '×™×™×Ÿ ××¨×–×”', '×™×™×Ÿ ×™×ª×™×¨', '×©××¤× ×™×”', '×¤×¨×•×¡×§×•', '×§××•×•×”', '××¡×ª×™', '×‘×™×¨×”', '×‘×™×¨×” ×’×•×œ×“×¡×˜××¨', '×‘×™×¨×” ××›×‘×™', '×‘×™×¨×” ×§×¨×œ×¡×‘×¨×’', '×‘×™×¨×” ×”×™×™× ×™×§×Ÿ', '×‘×™×¨×” ×§×•×¨×•× ×”', '×‘×™×¨×” ×¡×˜×œ×”', '×‘×™×¨×” ×˜×•×‘×•×¨×’', '×‘×™×¨×” ××œ×›×¡× ×“×¨', '×‘×™×¨×” ×‘×–×œ×ª', '×‘×™×¨×” ××œ×›×”', '×‘×™×¨×” ×œ×œ× ××œ×›×•×”×•×œ', '×¡×™×™×“×¨', '×¡×™×™×“×¨ ×ª×¤×•×—×™×', '×¢×¨×§', '×¢×¨×§ ××œ×™×ª', '×•×•×“×§×”', '×•×•×“×§×” ××‘×¡×•×œ×•×˜', '×•×•×“×§×” ×¡××™×¨× ×•×£', '×•×•×“×§×” ×’×¨×™×™ ×’×•×¡', '×•×•×™×¡×§×™', '×•×•×™×¡×§×™ ×’\'×•× ×™ ×•×•×§×¨', '×•×•×™×¡×§×™ ×’\'×§ ×“× ×™××œ×¡', '×•×•×™×¡×§×™ ×’\'×™×™××¡×•×Ÿ', '×¨×•×', '×¨×•× ×‘×§×¨×“×™', '×’\'×™×Ÿ', '×’\'×™×Ÿ ×’×•×¨×“×•× ×¡', '×˜×§×™×œ×”', '×§×•× ×™××§', '×‘×¨×× ×“×™', '×œ×™×§×¨', '×œ×™×§×¨ ×§×¤×”', '×œ×™×§×¨ ×©×•×§×•×œ×“', '×œ×™×§×¨ ×¤×™×¨×•×ª', '×××¨×˜×•', '×‘×™×™×œ×™×¡', '×§××¤×¨×™', '××¤×¨×•×œ', '×¡× ×’×¨×™×”'],

            snacks: ['×‘××‘×”', '×‘××‘×” ××“×•××™×', '×‘××‘×” × ×•×’×˜', '×‘×™×¡×œ×™', '×‘×™×¡×œ×™ ×’×¨×™×œ', '×‘×™×¡×œ×™ ×‘×¦×œ', '×‘×™×¡×œ×™ ×¤×™×¦×”', '×“×•×¨×™×˜×•×¡', '×“×•×¨×™×˜×•×¡ ×¦\'×™×œ×™', '×˜×•×¨×˜×™×™×” ×¦\'×™×¤×¡', '×ª×¤×•×¦\'×™×¤×¡', '×¤×¨×™× ×’×œ×¡', '×¤×¨×™× ×’×œ×¡ ×—××•×¥', '×¤×•×¤×§×•×¨×Ÿ', '×¤×•×¤×§×•×¨×Ÿ ××™×§×¨×•', '×¤×•×¤×§×•×¨×Ÿ ×§×¨××œ', '×©×•×§×•×œ×“', '×©×•×§×•×œ×“ ×¤×¨×”', '×©×•×§×•×œ×“ ××™×œ×§×”', '×©×•×§×•×œ×“ ×—×œ×‘', '×©×•×§×•×œ×“ ××¨×™×¨', '×©×•×§×•×œ×“ ×œ×‘×Ÿ', '×©×•×§×•×œ×“ ×¢× ××’×•×–×™×', '×§×™× ×“×¨', '×¡× ×™×§×¨×¡', '×××¨×¡', '×˜×•×•×™×§×¡', '×§×™×˜×§×˜', '×‘×™×¡×§×•×•×™×˜×™×', '×¢×•×’×™×•×ª ××•×¨××•', '×¢×•×’×™×•×ª ×œ×•×˜×•×¡', '×•×•×¤×œ×™×', '×•×•×¤×œ ×‘×œ×’×™', '×§×¦×¤×ª', '××¨×©××œ×•', '×¡×•×›×¨×™×•×ª', '×¡×•×›×¨×™×•×ª ×’×•××™', '×“×•×‘×•× ×™×', '××¡×˜×™×§', '×× ×˜×•×¡', '×˜×™×§ ×˜×§', '×¢×•×’×ª ×©×•×§×•×œ×“', '×¢×•×’×ª ×’×‘×™× ×”', '×¨×•×œ×“×”', '×§×¨××‘×•', '×¤×¡×§ ×–××Ÿ', '×§×œ×™×§', '×˜×¢××™'],

            frozen: ['×’×œ×™×“×”', '×’×œ×™×“×” ×•× ×™×œ', '×’×œ×™×“×” ×©×•×§×•×œ×“', '×’×œ×™×“×” ×ª×•×ª', '×’×œ×™×“×” ×¤×™×¡×˜×•×§', '×’×œ×™×“×” ×§×¨××œ', '×’×œ×™×“×ª ×¤×¨×•×•×”', '×’×œ×™×“×” ×‘×Ÿ ×× ×“ ×’\'×¨×™', '××¨×˜×™×§', '××’× ×•×', '×§×•×¨× ×˜×•', '×©×œ×’×•×Ÿ', '×¤×™×¨×•×ª ×§×¤×•××™×', '×ª×•×ª×™× ×§×¤×•××™×', '×¤×˜×œ ×§×¤×•×', '××•×›×× ×™×•×ª ×§×¤×•××•×ª', '×× ×’×• ×§×¤×•×', '×™×¨×§×•×ª ×§×¤×•××™×', '×™×¨×§×•×ª ××•×§×¤×¦×™×', '××¤×•× ×” ×§×¤×•××”', '×ª×™×¨×¡ ×§×¤×•×', '×©×¢×•×¢×™×ª ×™×¨×•×§×” ×§×¤×•××”', '×‘×¨×•×§×•×œ×™ ×§×¤×•×', '×ª×¨×“ ×§×¤×•×', '×©× ×™×¦×œ ×§×¤×•×', '× ××’×˜×¡ ×§×¤×•××™×', '×§×¦×™×¦×•×ª ×§×¤×•××•×ª', '×”××‘×•×¨×’×¨ ×§×¤×•×', '×¤×™×¦×” ×§×¤×•××”', '×¤×™×¦×” ××©×¤×—×ª×™×ª', '×œ×–× ×™×” ×§×¤×•××”', '×‘×¦×§ ×¢×œ×™×', '×‘×¦×§ ×¤×™×œ×•', '×‘×¦×§ ×¤×™×¦×”', '×‘×¦×§ ×××¤×™×', '×‘×¦×§ ×’\'×—× ×•×Ÿ', '×‘×¦×§ ××œ×•×•×—', '×‘×¦×§ ×¡××‘×•×¡×§', '×‘×¦×§ ×‘×•×¨×§×¡', '×‘×œ×™× ×¦\'×¡', '×§×¨×¤', '×•×•×¤×œ ×§×¤×•×'],

            health: ['×™×•×’×•×¨×˜ ×™×•×•× ×™ 0%', '×™×•×’×•×¨×˜ ×—×œ×‘×•×Ÿ', '×™×•×’×•×¨×˜ ×¤×¨×•×‘×™×•×˜×™', '×§×•×˜×’\' 0%', '×§×•×˜×’\' 3%', '×’×‘×™× ×” ×œ×‘× ×” 0%', '×—×œ×‘ ×¡×•×™×”', '×—×œ×‘ ×©×§×“×™×', '×—×œ×‘ ×§×•×§×•×¡', '×—×œ×‘ ××•×¨×–', '×—×œ×‘ ×©×™×‘×•×œ×ª ×©×•×¢×œ', '×—×œ×‘ ×“×œ ×œ×§×˜×•×–', '××©×§×” ×—×œ×‘×•×Ÿ', '×©×™×™×§ ×—×œ×‘×•×Ÿ', '××‘×§×ª ×—×œ×‘×•×Ÿ', '×¤×¨×•×˜××™×Ÿ ×‘×¨', '×—×˜×™×£ ×—×œ×‘×•×Ÿ', '×—×˜×™×£ ×× ×¨×’×™×”', '×œ×—× ××œ×', '×œ×—× ×œ×œ× ×’×œ×•×˜×Ÿ', '×¤×™×ª×” ××œ××”', '×§×¨×§×¨ ×“×’× ×™×', '×§×¨×§×¨ ××•×¨×–', '×˜×•× ×” ×‘××™×', '×¡×œ×˜ ×˜×•× ×”', '×—×–×” ×¢×•×£ ××¢×•×©×Ÿ', '×’×¨× ×•×œ×” ×‘×¨×™××•×ª', '×©×™×‘×•×œ×ª ×©×•×¢×œ', '×–×¨×¢×™ ×¦\'×™×”', '×–×¨×¢×™ ×¤×©×ª×Ÿ', '×§×™× ×•××”', '××’×•×–×™× ×˜×‘×¢×™×™×', '×©×§×“×™× ×˜×‘×¢×™×™×', '×¤×™×¨×•×ª ×™×‘×©×™× ×œ×œ× ×¡×•×›×¨', '×—××•×¦×™×•×ª', '×’×•×’\'×™ ×‘×¨×™', '×¡×¤×™×¨×•×œ×™× ×”', '×•×™×˜××™× ×™×', '××•××’×” 3', '×¤×¨×•×‘×™×•×˜×™×§×”'],

            cleaning: ['× ×™×™×¨ ×˜×•××œ×˜', '× ×™×™×¨ ×˜×•××œ×˜ ×ª×œ×ª ×©×›×‘×ª×™', '××’×‘×•×ª × ×™×™×¨', '××’×‘×•×ª × ×™×™×¨ ×œ×™×“×™×™×', '×××—×˜×•×ª × ×™×™×¨', '×¡×‘×•×Ÿ ×›×œ×™×', '×¡×‘×•×Ÿ ×›×œ×™× ×¤×™×™×¨×™', '× ×•×–×œ ×›×œ×™×', '××‘×§×ª ×›×‘×™×¡×”', '××‘×§×ª ×›×‘×™×¡×” ××¨×™××œ', '×’\'×œ ×›×‘×™×¡×”', '×’\'×œ ×›×‘×™×¡×” ××¨×•×›×–', '×§×¤×¡×•×œ×•×ª ×›×‘×™×¡×”', '××¨×›×š ×›×‘×™×¡×”', '××‘×©× ×›×‘×™×¡×”', '××§×•× ×•××™×§×”', '××§×•× ×•××™×§×” ×’\'×œ', '×××™×¥ ×›×‘×™×¡×”', '×× ×§×” ×¨×¦×¤×•×ª', '×× ×§×” ×¨×¦×¤×•×ª ×¡× ×•', '×× ×§×” ×—×œ×•× ×•×ª', '×× ×§×” ×××‘×˜×™×”', '×× ×§×” ×©×™×¨×•×ª×™×', '×× ×§×” ×›×™×¨×™×™×', '×× ×§×” ×ª× ×•×¨', '×× ×§×” ×©×•×× ×™×', '××‘×§×ª × ×™×§×•×™', '×¡×™×£', '××¨ ××•×¡×§×œ', '×¡×¤×•×’×™×', '×¡×¤×•×’×™ ×¤×œ×“×”', '××˜×œ×™×•×ª ×¨×¦×¤×”', '××˜×œ×™×•×ª × ×™×§×•×™', '×©×§×™×•×ª ××©×¤×”', '×©×§×™×•×ª ××©×¤×” ×’×“×•×œ×•×ª', '×©×§×™×•×ª ××©×¤×” ×¨×™×—× ×™×•×ª', '×©×§×™×•×ª ×–×™×¤×œ×•×§', '×©×§×™×•×ª ×›×¨×™×›×™×', '×©×§×™×•×ª ×§×¤×•××™×', '× ×™×™×¨ ××¤×™×™×”', '× ×™×™×¨ ××œ×•××™× ×™×•×', '× ×™×™×œ×•×Ÿ × ×¦××“', '×˜×‘×œ×™×•×ª ×œ××“×™×—', '××œ×— ×œ××“×™×—', '× ×•×–×œ ××‘×¨×™×§ ×œ××“×™×—', '×× ×§×” ××“×™×—', '××˜×”×¨ ××•×•×™×¨', '×’×¨×™×™× ×™ ××©×¤×”'],

            hygiene: ['×¡×‘×•×Ÿ ×™×“×™×™×', '×¡×‘×•×Ÿ ×™×“×™×™× × ×•×–×œ×™', '×¡×‘×•×Ÿ ××•×¦×§', '××’×‘×•× ×™× ×œ×—×™×', '××’×‘×•× ×™× ×× ×˜×™×‘×§×˜×¨×™××œ×™×™×', '×’\'×œ ××œ×›×•×”×•×œ', '××‘×¨×©×ª ×©×™× ×™×™×', '××‘×¨×©×ª ×©×™× ×™×™× ×—×©××œ×™×ª', '×¨××©×™× ×œ××‘×¨×©×ª', '××©×—×ª ×©×™× ×™×™×', '××©×—×ª ×©×™× ×™×™× ×§×•×œ×’×™×™×˜', '××©×—×ª ×©×™× ×™×™× ×¡× ×¡×•×“×™×™×Ÿ', '××™ ×¤×”', '××™ ×¤×” ×œ×™×¡×˜×¨×™×Ÿ', '×—×•×˜ ×“× ×˜×œ×™', '×§×™×¡××™ ×©×™× ×™×™×', '×©××¤×•', '×©××¤×• ×”×“ ×× ×“ ×©×•×œ×“×¨×¡', '×©××¤×• ×¤× ×˜×Ÿ', '×©××¤×• ×œ×©×™×¢×¨ ×™×‘×©', '×©××¤×• ×œ×©×™×¢×¨ ×©××Ÿ', '×©××¤×• × ×’×“ ×§×©×§×©×™×', '××¨×›×š ×©×™×¢×¨', '××¡×›×” ×œ×©×™×¢×¨', '×¡×¨×•× ×œ×©×™×¢×¨', '×¡×¤×¨×™×™ ×œ×©×™×¢×¨', '×’\'×œ ×œ×©×™×¢×¨', '×§×¦×£ ×œ×©×™×¢×¨', '×©××¤×• ×œ×™×œ×“×™×', '×¡×‘×•×Ÿ ×’×•×£', '×’\'×œ ×¨×—×¦×”', '×’\'×œ ×¨×—×¦×” × ×™×•×•××”', '×§×¨× ×’×™×œ×•×—', '×’\'×œ ×’×™×œ×•×—', '×¡×›×™× ×™ ×’×™×œ×•×—', '×¡×›×™× ×™ ×’×™×œ×•×— ×’\'×™×œ×˜', '×“××•×“×•×¨× ×˜', '×“××•×“×•×¨× ×˜ ×¨×•×œ ××•×Ÿ', '×“××•×“×•×¨× ×˜ ×¡×¤×¨×™×™', '×× ×˜×™×¤×¨×¡×¤×™×¨× ×˜', '×§×¨× ×¤× ×™×', '×§×¨× ×œ×—×•×ª', '×§×¨× ×™×“×™×™×', '×§×¨× ×’×•×£', '×§×¨× ×¨×’×œ×™×™×', '×©××Ÿ ×’×•×£', '×œ×•×¡×™×•×Ÿ ×’×•×£', '×ª×—×‘×•×©×•×ª', '×¤×œ×¡×˜×¨×™×”', '×¦××¨ ×’×¤×Ÿ', '××§×œ×•× ×™ ××•×–× ×™×™×', '×˜××¤×•× ×™×', '××’× ×™ ×ª×—×ª×•×Ÿ', '×ª×—×‘×•×©×•×ª ×™×•×', '×ª×—×‘×•×©×•×ª ×œ×™×œ×”', '×§×¨× ×”×’× ×”', '×§×¨× ×©×™×–×•×£', '××¤×˜×¨ ×¡××Ÿ', '××¡×™×¨ ××™×¤×•×¨', '××’×‘×•× ×™× ×œ×”×¡×¨×ª ××™×¤×•×¨', '×ª×¡×¤×•×¨×ª ×—×“ ×¤×¢××™×ª'],

            candles: ['× ×¨×•×ª ×©×‘×ª', '× ×¨×•×ª ×©×‘×ª ×œ×‘× ×™×', '× ×¨×•×ª ×©×‘×ª ×¦×‘×¢×•× ×™×™×', '× ×¨×•×ª ×—× ×•×›×”', '× ×¨×•×ª ×—× ×•×›×” ×¦×‘×¢×•× ×™×™×', '× ×¨ × ×©××” 24 ×©×¢×•×ª', '× ×¨ × ×©××” 48 ×©×¢×•×ª', '× ×¨ × ×©××” 7 ×™××™×', '× ×¨ ×”×‘×“×œ×”', '× ×¨×•×ª ×™×•× ×”×•×œ×“×ª', '× ×¨×•×ª ×¨×™×—× ×™×™×', '× ×¨×•×ª ×“×§×•×¨×˜×™×‘×™×™×', '×©××Ÿ ×œ× ×¨', '×©××Ÿ ×¤×¨×¤×™×Ÿ', '×©××Ÿ ×–×™×ª ×œ× ×¨', '×¤×ª×™×œ×•×ª', '×’×¤×¨×•×¨×™×', '××¦×™×ª×™×'],

            baby: ['×—×™×ª×•×œ×™×', '×—×™×ª×•×œ×™× ×¤××¤×¨×¡', '×—×™×ª×•×œ×™× ×”××’×™×¡', '×—×™×ª×•×œ×™× ××™×“×” 1', '×—×™×ª×•×œ×™× ××™×“×” 2', '×—×™×ª×•×œ×™× ××™×“×” 3', '×—×™×ª×•×œ×™× ××™×“×” 4', '×—×™×ª×•×œ×™× ××™×“×” 5', '××›× ×¡×•× ×™ ×—×™×ª×•×œ', '×—×™×ª×•×œ×™ ×œ×™×œ×”', '××’×‘×•× ×™× ×œ×ª×™× ×•×§×•×ª', '××’×‘×•× ×™× ×¤××¤×¨×¡', '××’×‘×•× ×™× ×¨×’×™×©×™×', '×©××¤×• ×œ×ª×™× ×•×§×•×ª', '×¡×‘×•×Ÿ ×œ×ª×™× ×•×§×•×ª', '××œ ×¡×‘×•×Ÿ ×œ×ª×™× ×•×§×•×ª', '×§×¨× ×”×—×ª×œ×”', '×§×¨× ×¤×•×©', '×§×¨× ×“×¡×™×˜×™×Ÿ', '××©×—×ª ×”×—×ª×œ×”', '××‘×§×ª ×ª×™× ×•×§×•×ª', '×©××Ÿ ×ª×™× ×•×§×•×ª', '×§×¨× ×¤× ×™× ×œ×ª×™× ×•×§', '××‘×§×ª ×—×œ×‘', '××‘×§×ª ×—×œ×‘ ×¡×™××™×œ××§', '××‘×§×ª ×—×œ×‘ ××˜×¨× ×”', '××–×•×Ÿ ×œ×ª×™× ×•×§×•×ª', '××—×™×ª ×¤×™×¨×•×ª', '××—×™×ª ×™×¨×§×•×ª', '×“×™×™×¡×” ×œ×ª×™× ×•×§×•×ª', '×‘×™×¡×œ×™ ×œ×ª×™× ×•×§×•×ª', '×—×˜×™×£ ×ª×™× ×•×§×•×ª', '××™×¥ ×œ×ª×™× ×•×§×•×ª', '××•×¦×¦×™×', '××•×¦×¥ ××•×•× ×˜', '×‘×§×‘×•×§ ×ª×™× ×•×§', '×‘×§×‘×•×§ ××•×•× ×˜', '×¤×˜××•×ª', '××‘×¨×©×ª ×©×™× ×™×™× ×œ×ª×™× ×•×§', '××©×—×ª ×©×™× ×™×™× ×œ×ª×™× ×•×§', '×©××¤×• ×™×œ×“×™×', '×¡×‘×•×Ÿ ×™×œ×“×™×'],

            pets: ['××–×•×Ÿ ×œ×›×œ×‘×™×', '××–×•×Ÿ ×™×‘×© ×œ×›×œ×‘×™×', '××–×•×Ÿ ×¨×˜×•×‘ ×œ×›×œ×‘×™×', '××–×•×Ÿ ×œ×›×œ×‘×™× ×‘×•×’×¨×™×', '××–×•×Ÿ ×œ×’×•×¨×™×', '××–×•×Ÿ ×œ×—×ª×•×œ×™×', '××–×•×Ÿ ×™×‘×© ×œ×—×ª×•×œ×™×', '××–×•×Ÿ ×¨×˜×•×‘ ×œ×—×ª×•×œ×™×', '××–×•×Ÿ ×œ×—×ª×•×œ×™× ×‘×•×’×¨×™×', '××–×•×Ÿ ×œ×’×•×¨×™ ×—×ª×•×œ×™×', '×—×•×œ ×œ×—×ª×•×œ×™×', '×—×•×œ ××ª×’×‘×©', '×—×•×œ ×¡×™×œ×™×§×”', '×—×˜×™×¤×™× ×œ×›×œ×‘×™×', '×—×˜×™×¤×™× ×œ×—×ª×•×œ×™×', '×¢×¦××•×ª ×œ×›×¢×™×¡×”', '×“× ×˜×¡×˜×™×§×¡', '×¦×¢×¦×•×¢×™× ×œ×›×œ×‘×™×', '×¦×¢×¦×•×¢×™× ×œ×—×ª×•×œ×™×', '××™×˜×” ×œ×›×œ×‘', '××™×˜×” ×œ×—×ª×•×œ', '×§×¢×¨×ª ××•×›×œ', '×§×¢×¨×ª ××™×', '×¨×¦×•×¢×” ×œ×›×œ×‘', '×§×•×œ×¨', '××¡×¨×§ ×œ×›×œ×‘', '×©××¤×• ×œ×›×œ×‘×™×', '×©×§×™×•×ª ×§×§×™', '××©×˜×— ××™××•×Ÿ', '××–×•×Ÿ ×œ×“×’×™×', '××–×•×Ÿ ×œ×¦×™×¤×•×¨×™×', '××–×•×Ÿ ×œ××•×’×¨×™×']
        };

        // Confetti burst effect component
        function ConfettiBurst({ x, y, onComplete }) {
            const [particles, setParticles] = useState([]);

            useEffect(() => {
                const colors = ['#10b981', '#34d399', '#6ee7b7', '#fbbf24', '#f472b6', '#818cf8'];
                const newParticles = [];
                for (let i = 0; i < 12; i++) {
                    const angle = (i / 12) * 360;
                    const velocity = 60 + Math.random() * 40;
                    const size = 4 + Math.random() * 4;
                    newParticles.push({
                        id: i,
                        color: colors[Math.floor(Math.random() * colors.length)],
                        angle,
                        velocity,
                        size,
                        x: Math.cos(angle * Math.PI / 180) * velocity,
                        y: Math.sin(angle * Math.PI / 180) * velocity
                    });
                }
                setParticles(newParticles);
                const timer = setTimeout(() => onComplete?.(), 600);
                return () => clearTimeout(timer);
            }, []);

            return (
                <div style={{ position: 'absolute', left: x, top: y, pointerEvents: 'none', zIndex: 50 }}>
                    {particles.map(p => (
                        <div
                            key={p.id}
                            className="confetti-particle"
                            style={{
                                width: p.size,
                                height: p.size,
                                borderRadius: '50%',
                                backgroundColor: p.color,
                                '--tx': `${p.x}px`,
                                '--ty': `${p.y}px`,
                                animation: `particleFly 0.6s ease-out forwards`
                            }}
                        />
                    ))}
                </div>
            );
        }

        // Swipeable Item Component
        function SwipeableItem({ children, onSwipeRight, onSwipeLeft, className, purchased }) {
            const [touchStart, setTouchStart] = useState(null);
            const [touchDelta, setTouchDelta] = useState(0);
            const [isSwiping, setIsSwiping] = useState(false);
            const [completing, setCompleting] = useState(null); // 'right' or 'left'
            const THRESHOLD = 80;

            const handleTouchStart = (e) => {
                setTouchStart(e.touches[0].clientX);
                setIsSwiping(true);
            };

            const handleTouchMove = (e) => {
                if (touchStart === null) return;
                const delta = e.touches[0].clientX - touchStart;
                // RTL: negative delta = swiping right visually, positive = swiping left
                setTouchDelta(delta);
            };

            const handleTouchEnd = () => {
                if (Math.abs(touchDelta) > THRESHOLD) {
                    // RTL adjustment: negative delta means swiping toward the left side of screen (which is "right" in RTL)
                    if (touchDelta < -THRESHOLD) {
                        // Swiped left on screen = "right" action in RTL = bought
                        setCompleting('right');
                        setTimeout(() => {
                            onSwipeRight?.();
                            setCompleting(null);
                            setTouchDelta(0);
                        }, 300);
                    } else if (touchDelta > THRESHOLD) {
                        // Swiped right on screen = "left" action in RTL = postpone
                        setCompleting('left');
                        setTimeout(() => {
                            onSwipeLeft?.();
                            setCompleting(null);
                            setTouchDelta(0);
                        }, 300);
                    }
                } else {
                    setTouchDelta(0);
                }
                setTouchStart(null);
                setIsSwiping(false);
            };

            const showRightIndicator = touchDelta < -30;
            const showLeftIndicator = touchDelta > 30;
            const rightProgress = Math.min(Math.abs(Math.min(touchDelta, 0)) / THRESHOLD, 1);
            const leftProgress = Math.min(Math.max(touchDelta, 0) / THRESHOLD, 1);

            return (
                <div className={`swipe-container ${className || ''}`}>
                    {/* Right swipe background (bought - green) */}
                    <div
                        className="swipe-bg-right swipe-background"
                        style={{ opacity: rightProgress }}
                    >
                        <div className="swipe-indicator">
                            <span className={`swipe-icon swipe-icon-emoji ${showRightIndicator ? 'visible' : ''}`} style={{ transform: `scale(${0.5 + rightProgress * 0.5})` }}>
                                âœ“
                            </span>
                            <span className={`swipe-icon text-sm ${showRightIndicator ? 'visible' : ''}`}>
                                × ×§× ×”
                            </span>
                        </div>
                    </div>
                    {/* Left swipe background (postpone - orange) */}
                    <div
                        className="swipe-bg-left swipe-background"
                        style={{ opacity: leftProgress }}
                    >
                        <div className="swipe-indicator">
                            <span className={`swipe-icon swipe-icon-emoji ${showLeftIndicator ? 'visible' : ''}`} style={{ transform: `scale(${0.5 + leftProgress * 0.5})` }}>
                                â­
                            </span>
                            <span className={`swipe-icon text-sm ${showLeftIndicator ? 'visible' : ''}`}>
                                ××—×´×›
                            </span>
                        </div>
                    </div>
                    {/* Content */}
                    <div
                        className={`swipe-content ${isSwiping ? 'swiping' : ''} ${completing === 'right' ? 'slide-out-right' : ''} ${completing === 'left' ? 'slide-out-left' : ''}`}
                        style={{ transform: completing ? undefined : `translateX(${touchDelta}px)` }}
                        onTouchStart={handleTouchStart}
                        onTouchMove={handleTouchMove}
                        onTouchEnd={handleTouchEnd}
                    >
                        {children}
                    </div>
                </div>
            );
        }

        function ShoppingList() {
            const { user } = useAuth();
            const { family, lists, currentList, setCurrentList, logActivity } = useFamily();
            const [items, setItems] = useState([]);
            const [selectedCategory, setSelectedCategory] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [loading, setLoading] = useState(true);
            const [darkMode, setDarkMode] = useState(false);
            const [showFinishShopping, setShowFinishShopping] = useState(false);
            const [showHistory, setShowHistory] = useState(false);
            const [totalAmount, setTotalAmount] = useState('');
            const [receiptPhoto, setReceiptPhoto] = useState(null);
            const [uploadingReceipt, setUploadingReceipt] = useState(false);
            const receiptInputRef = React.useRef(null);
            const [history, setHistory] = useState([]);
            const [showDeleteConfirm, setShowDeleteConfirm] = useState(null);
            const [showFamilySettings, setShowFamilySettings] = useState(false);
            const [showCreateList, setShowCreateList] = useState(false);
            const [editingNote, setEditingNote] = useState(null);
            const [editingItemId, setEditingItemId] = useState(null);
            const [editingItemName, setEditingItemName] = useState('');
            const [confetti, setConfetti] = useState(null);
            const [animatingItems, setAnimatingItems] = useState(new Set());
            const addBarInputRef = React.useRef(null);
            // Chat & Photo states
            const [showChat, setShowChat] = useState(false);
            const [chatMessages, setChatMessages] = useState([]);
            const [chatInput, setChatInput] = useState('');
            const [showCamera, setShowCamera] = useState(false);
            const [capturedPhoto, setCapturedPhoto] = useState(null);
            const [notificationsEnabled, setNotificationsEnabled] = useState(false);
            const lastMessageIdRef = React.useRef(null);
            const videoRef = React.useRef(null);
            const canvasRef = React.useRef(null);
            // Recipe states
            const [showRecipes, setShowRecipes] = useState(false);
            const [recipes, setRecipes] = useState([]);
            const [showAddRecipe, setShowAddRecipe] = useState(false);
            const [newRecipeName, setNewRecipeName] = useState('');
            const [newRecipeIngredients, setNewRecipeIngredients] = useState('');
            const [addingRecipeItems, setAddingRecipeItems] = useState(null);
            // Recipe scanning states
            const [showRecipeScan, setShowRecipeScan] = useState(false);
            const [scanningRecipe, setScanningRecipe] = useState(false);
            const [scanProgress, setScanProgress] = useState(0);
            const [scannedText, setScannedText] = useState('');
            const [scannedIngredients, setScannedIngredients] = useState([]);
            const [scannedRecipeName, setScannedRecipeName] = useState('');
            const recipeVideoRef = React.useRef(null);
            const recipeCanvasRef = React.useRef(null);
            const recipeScanActiveRef = React.useRef(false);
            // Forgotten items tracking
            const [forgottenStats, setForgottenStats] = useState({});
            const [showForgottenStats, setShowForgottenStats] = useState(false);
            const [shoppingStreak, setShoppingStreak] = useState(0);
            const [achievements, setAchievements] = useState([]);
            // Regular items & Calendar
            const [regularItems, setRegularItems] = useState([]);
            const [showRegulars, setShowRegulars] = useState(false);
            const [showCalendar, setShowCalendar] = useState(false);
            const [upcomingHolidays, setUpcomingHolidays] = useState([]);
            // Quantity selector
            const [showQuantitySelector, setShowQuantitySelector] = useState(false);
            const [selectedProduct, setSelectedProduct] = useState(null);
            const [selectedQuantity, setSelectedQuantity] = useState(1);
            const [selectedUnit, setSelectedUnit] = useState('×™×—\'');
            const [selectedNote, setSelectedNote] = useState('');
            // Calendar view
            const [calendarMonth, setCalendarMonth] = useState(new Date());
            const [selectedHoliday, setSelectedHoliday] = useState(null);
            const [reminderDays, setReminderDays] = useState(7);
            // Voice recognition states
            const [isListening, setIsListening] = useState(false);
            const [voiceSupported, setVoiceSupported] = useState(false);
            const [voiceLang, setVoiceLang] = useState(localStorage.getItem('voiceLang') || 'he-IL');
            // Shopping mode - keeps screen awake
            const [shoppingMode, setShoppingMode] = useState(false);
            const [wakeLock, setWakeLock] = useState(null);
            // Out of stock tracking
            const [outOfStockItems, setOutOfStockItems] = useState([]);
            // Saved lists for quick reuse
            const [savedLists, setSavedLists] = useState([]);
            const [showSavedLists, setShowSavedLists] = useState(false);
            const [showImportWhatsApp, setShowImportWhatsApp] = useState(false);
            const [whatsAppText, setWhatsAppText] = useState('');
            // Real-time editing indicator
            const [activeEditors, setActiveEditors] = useState([]);
            // Holiday recommendations
            const [showHolidayRecommendations, setShowHolidayRecommendations] = useState(false);
            // Price comparison scanner
            const [showPriceScanner, setShowPriceScanner] = useState(false);
            const [scanningPrice, setScanningPrice] = useState(false);
            const [scannedProductName, setScannedProductName] = useState('');
            const [priceCompareResults, setPriceCompareResults] = useState(null);
            const priceVideoRef = React.useRef(null);
            const priceCanvasRef = React.useRef(null);
            // AI Assistant
            const [showAIAssistant, setShowAIAssistant] = useState(false);
            const [aiSuggestions, setAiSuggestions] = useState([]);
            const [aiThinking, setAiThinking] = useState(false);
            // Onboarding & Help
            const [showOnboarding, setShowOnboarding] = useState(false);
            const [onboardingStep, setOnboardingStep] = useState(0);
            const [showHelp, setShowHelp] = useState(false);
            const [showFeedback, setShowFeedback] = useState(false);
            const [feedbackText, setFeedbackText] = useState('');
            const [feedbackType, setFeedbackType] = useState('bug');
            const [feedbackSending, setFeedbackSending] = useState(false);
            const [feedbackSent, setFeedbackSent] = useState(false);
            // Accessibility
            const [showAccessibility, setShowAccessibility] = useState(false);
            const [accessibilitySettings, setAccessibilitySettings] = useState({
                fontSize: 'normal',
                contrast: 'normal',
                highlightLinks: false,
                cursorSize: 'normal'
            });

            // English to Hebrew grocery translations
            const ENGLISH_TO_HEBREW = {
                // Dairy
                'milk': '×—×œ×‘', 'eggs': '×‘×™×¦×™×', 'egg': '×‘×™×¦×™×', 'cheese': '×’×‘×™× ×”', 'butter': '×—×××”',
                'yogurt': '×™×•×’×•×¨×˜', 'cream': '×©×× ×ª', 'cottage': '×§×•×˜×’\'', 'cream cheese': '×’×‘×™× ×ª ×©×× ×ª',
                'sour cream': '×©×× ×ª ×—××•×¦×”', 'whipped cream': '×§×¦×¤×ª',
                // Bread & Bakery
                'bread': '×œ×—×', 'pita': '×¤×™×ª×”', 'challah': '×—×œ×”', 'bagel': '×‘×™×™×’×œ', 'croissant': '×§×¨×•××¡×•×Ÿ',
                'toast': '×œ×—× ×˜×•×¡×˜', 'rolls': '×œ×—×× ×™×•×ª', 'baguette': '×‘××’×˜',
                // Fruits
                'apple': '×ª×¤×•×—', 'apples': '×ª×¤×•×—×™×', 'banana': '×‘× × ×”', 'bananas': '×‘× × ×•×ª',
                'orange': '×ª×¤×•×–', 'oranges': '×ª×¤×•×–×™×', 'lemon': '×œ×™××•×Ÿ', 'lemons': '×œ×™××•× ×™×',
                'grapes': '×¢× ×‘×™×', 'strawberry': '×ª×•×ª', 'strawberries': '×ª×•×ª×™×',
                'watermelon': '××‘×˜×™×—', 'melon': '××œ×•×Ÿ', 'mango': '×× ×’×•', 'peach': '××¤×¨×¡×§',
                'pear': '××’×¡', 'plum': '×©×–×™×£', 'cherry': '×“×•×‘×“×‘×Ÿ', 'cherries': '×“×•×‘×“×‘× ×™×',
                'avocado': '××‘×•×§×“×•', 'pomegranate': '×¨×™××•×Ÿ', 'kiwi': '×§×™×•×•×™', 'pineapple': '×× × ×¡',
                // Vegetables
                'tomato': '×¢×’×‘× ×™×”', 'tomatoes': '×¢×’×‘× ×™×•×ª', 'cucumber': '××œ×¤×¤×•×Ÿ', 'cucumbers': '××œ×¤×¤×•× ×™×',
                'onion': '×‘×¦×œ', 'onions': '×‘×¦×œ', 'garlic': '×©×•×', 'potato': '×ª×¤×•×— ××“××”', 'potatoes': '×ª×¤×•×—×™ ××“××”',
                'carrot': '×’×–×¨', 'carrots': '×’×–×¨', 'pepper': '×¤×œ×¤×œ', 'peppers': '×¤×œ×¤×œ×™×',
                'lettuce': '×—×¡×”', 'cabbage': '×›×¨×•×‘', 'broccoli': '×‘×¨×•×§×•×œ×™', 'cauliflower': '×›×¨×•×‘×™×ª',
                'spinach': '×ª×¨×“', 'celery': '×¡×œ×¨×™', 'corn': '×ª×™×¨×¡', 'mushroom': '×¤×˜×¨×™×•×ª', 'mushrooms': '×¤×˜×¨×™×•×ª',
                'zucchini': '×§×™×©×•×', 'eggplant': '×—×¦×™×œ', 'beet': '×¡×œ×§', 'radish': '×¦× ×•×Ÿ',
                // Meat & Fish
                'chicken': '×¢×•×£', 'beef': '×‘×§×¨', 'meat': '×‘×©×¨', 'fish': '×“×’', 'salmon': '×¡×œ××•×Ÿ',
                'tuna': '×˜×•× ×”', 'turkey': '×”×•×“×•', 'schnitzel': '×©× ×™×¦×œ', 'steak': '×¡×˜×™×™×§',
                'ground beef': '×‘×©×¨ ×˜×—×•×Ÿ', 'sausage': '× ×§× ×™×§', 'hot dog': '× ×§× ×™×§×™×™×”',
                // Pantry
                'rice': '××•×¨×–', 'pasta': '×¤×¡×˜×”', 'noodles': '××˜×¨×™×•×ª', 'flour': '×§××—',
                'sugar': '×¡×•×›×¨', 'salt': '××œ×—', 'oil': '×©××Ÿ', 'olive oil': '×©××Ÿ ×–×™×ª',
                'vinegar': '×—×•××¥', 'sauce': '×¨×•×˜×‘', 'ketchup': '×§×˜×©×•×¤', 'mayonnaise': '××™×•× ×–',
                'mustard': '×—×¨×“×œ', 'honey': '×“×‘×©', 'jam': '×¨×™×‘×”', 'peanut butter': '×—×××ª ×‘×•×˜× ×™×',
                'coffee': '×§×¤×”', 'tea': '×ª×”', 'juice': '××™×¥', 'water': '××™×', 'soda': '×¡×•×“×”',
                'cereal': '×“×’× ×™ ×‘×•×§×¨', 'oatmeal': '×©×™×‘×•×œ×ª ×©×•×¢×œ', 'crackers': '×§×¨×§×¨×™×',
                'chips': '×¦\'×™×¤×¡', 'cookies': '×¢×•×’×™×•×ª', 'chocolate': '×©×•×§×•×œ×“', 'candy': '×××ª×§×™×',
                'nuts': '××’×•×–×™×', 'almonds': '×©×§×“×™×', 'walnuts': '××’×•×–×™ ××œ×š',
                // Frozen
                'ice cream': '×’×œ×™×“×”', 'frozen vegetables': '×™×¨×§×•×ª ×§×¤×•××™×', 'pizza': '×¤×™×¦×”',
                // Cleaning
                'soap': '×¡×‘×•×Ÿ', 'shampoo': '×©××¤×•', 'toilet paper': '× ×™×™×¨ ×˜×•××œ×˜',
                'tissues': '×˜×™×©×•', 'detergent': '××‘×§×ª ×›×‘×™×¡×”', 'dish soap': '×¡×‘×•×Ÿ ×›×œ×™×',
                'trash bags': '×©×§×™×•×ª ××©×¤×”', 'paper towels': '××’×‘×•×ª × ×™×™×¨',
                // Baby
                'diapers': '×—×™×ª×•×œ×™×', 'baby food': '××–×•×Ÿ ×œ×ª×™× ×•×§×•×ª', 'formula': '×ª×¨×›×•×‘×ª ××–×•×Ÿ',
                'wipes': '××’×‘×•× ×™×',
                // Other common
                'hummus': '×—×•××•×¡', 'tahini': '×˜×—×™× ×”', 'falafel': '×¤×œ××¤×œ', 'shawarma': '×©×•×•××¨××”'
            };
            const [voiceTranscript, setVoiceTranscript] = useState('');
            const recognitionRef = React.useRef(null);

            // Voice status for debugging
            const [voiceStatus, setVoiceStatus] = useState('');
            const voiceTimeoutRef = React.useRef(null);

            // Check voice support and setup recognition
            useEffect(() => {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                if (SpeechRecognition) {
                    setVoiceSupported(true);
                } else {
                    setVoiceStatus('×”×“×¤×“×¤×Ÿ ×œ× ×ª×•××š ×‘×–×™×”×•×™ ×§×•×œ');
                }
            }, []);

            // Create recognition when starting to listen
            const createRecognition = () => {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                if (!SpeechRecognition) return null;

                const recognition = new SpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = true;
                recognition.maxAlternatives = 3; // More alternatives for better Hebrew recognition

                // Check if iOS Safari - Hebrew support is limited
                const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
                const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);

                if (isIOS && isSafari && voiceLang === 'he-IL') {
                    // iOS Safari has limited Hebrew support, try a workaround
                    recognition.lang = 'he'; // Try shorter code
                } else {
                    recognition.lang = voiceLang;
                }

                recognition.onstart = () => {
                    const isIOSSafari = isIOS && isSafari;
                    if (isIOSSafari && voiceLang === 'he-IL') {
                        setVoiceStatus('×××–×™×Ÿ... (×‘-iPhone × ×¡×” ×œ×“×‘×¨ ×‘×× ×’×œ×™×ª)');
                    } else {
                        setVoiceStatus(voiceLang === 'en-US' ? 'Listening... speak now' : '×××–×™×Ÿ... ×“×‘×¨ ×¢×›×©×™×•');
                    }
                };

                recognition.onaudiostart = () => {
                    setVoiceStatus(voiceLang === 'en-US' ? 'Hearing audio...' : '×§×•×œ×˜ ×©××¢...');
                };

                recognition.onspeechstart = () => {
                    setVoiceStatus(voiceLang === 'en-US' ? 'Detecting speech...' : '××–×”×” ×“×™×‘×•×¨...');
                };

                recognition.onresult = (event) => {
                    // Clear timeout since we got a result
                    if (voiceTimeoutRef.current) {
                        clearTimeout(voiceTimeoutRef.current);
                    }

                    const transcript = Array.from(event.results)
                        .map(result => result[0].transcript)
                        .join('');
                    setVoiceTranscript(transcript);
                    setVoiceStatus(voiceLang === 'en-US' ? 'Got it!' : '×§×™×‘×œ×ª×™!');

                    // If final result, process it
                    if (event.results[0].isFinal) {
                        processVoiceCommand(transcript, voiceLang);
                        setIsListening(false);
                    }
                };

                recognition.onend = () => {
                    if (voiceTimeoutRef.current) {
                        clearTimeout(voiceTimeoutRef.current);
                    }
                    setIsListening(false);
                    if (!voiceTranscript) {
                        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
                        const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
                        if (isIOS && isSafari && voiceLang === 'he-IL') {
                            setVoiceStatus('×¢×‘×¨×™×ª ×œ× × ×ª××›×ª ×‘××™×™×¤×•×Ÿ. × ×¡×” ×‘×× ×’×œ×™×ª ××• ×”×§×œ×“ ×™×“× ×™×ª ğŸ‡ºğŸ‡¸');
                        } else {
                            setVoiceStatus(voiceLang === 'en-US' ? 'No speech detected. Try again.' : '×œ× ×–×•×”×” ×“×™×‘×•×¨. × ×¡×” ×©×•×‘.');
                        }
                    }
                };

                recognition.onerror = (event) => {
                    console.error('Voice recognition error:', event.error);
                    if (voiceTimeoutRef.current) {
                        clearTimeout(voiceTimeoutRef.current);
                    }
                    setIsListening(false);

                    switch(event.error) {
                        case 'not-allowed':
                            setVoiceStatus('× × ×œ××¤×©×¨ ×’×™×©×” ×œ××™×§×¨×•×¤×•×Ÿ ×‘×”×’×“×¨×•×ª ×”×“×¤×“×¤×Ÿ');
                            alert('× × ×œ××¤×©×¨ ×’×™×©×” ×œ××™×§×¨×•×¤×•×Ÿ. ×œ×—×¥ ×¢×œ ×¡××œ ×”×× ×¢×•×œ ×‘×©×•×¨×ª ×”×›×ª×•×‘×ª ×•××¤×©×¨ ××™×§×¨×•×¤×•×Ÿ.');
                            break;
                        case 'no-speech':
                            setVoiceStatus(voiceLang === 'en-US' ? 'No speech detected. Tap mic to try again.' : '×œ× × ×©××¢ ×“×™×‘×•×¨. ×œ×—×¥ ×©×•×‘ ×¢×œ ×”××™×§×¨×•×¤×•×Ÿ.');
                            break;
                        case 'audio-capture':
                            setVoiceStatus('×œ× × ××¦× ××™×§×¨×•×¤×•×Ÿ. ×‘×“×•×§ ××ª ×”×—×™×‘×•×¨.');
                            break;
                        case 'network':
                            setVoiceStatus('×‘×¢×™×™×ª ×¨×©×ª. ×‘×“×•×§ ××ª ×”×—×™×‘×•×¨ ×œ××™× ×˜×¨× ×˜.');
                            break;
                        case 'aborted':
                            setVoiceStatus(voiceLang === 'en-US' ? 'Cancelled' : '×‘×•×˜×œ');
                            break;
                        default:
                            setVoiceStatus(`×©×’×™××”: ${event.error}`);
                    }
                };

                return recognition;
            };

            // Toggle voice language
            const toggleVoiceLang = () => {
                const newLang = voiceLang === 'he-IL' ? 'en-US' : 'he-IL';
                setVoiceLang(newLang);
                localStorage.setItem('voiceLang', newLang);
            };

            // Shopping Mode - Keep screen awake
            const toggleShoppingMode = async () => {
                if (shoppingMode) {
                    // Turn off shopping mode
                    if (wakeLock) {
                        await wakeLock.release();
                        setWakeLock(null);
                    }
                    setShoppingMode(false);
                } else {
                    // Turn on shopping mode
                    try {
                        if ('wakeLock' in navigator) {
                            const lock = await navigator.wakeLock.request('screen');
                            setWakeLock(lock);
                            lock.addEventListener('release', () => {
                                setShoppingMode(false);
                                setWakeLock(null);
                            });
                        }
                        setShoppingMode(true);
                    } catch (err) {
                        console.log('Wake Lock not supported or failed:', err);
                        setShoppingMode(true); // Still enable mode visually
                    }
                }
            };

            // Mark item as out of stock
            const markOutOfStock = async (item) => {
                try {
                    await window.firestore.updateDoc(
                        window.firestore.doc(window.db, 'shopping-items', item.id),
                        { outOfStock: true, outOfStockAt: new Date(), outOfStockBy: user.displayName || user.email }
                    );
                    // Save to out of stock list for future reference
                    const newOutOfStock = [...outOfStockItems, { name: item.name, date: new Date() }];
                    setOutOfStockItems(newOutOfStock);
                    localStorage.setItem(`outOfStock_${family.id}`, JSON.stringify(newOutOfStock));
                } catch (err) {
                    console.error('Error marking out of stock:', err);
                }
            };

            // Save current list for reuse
            const saveListForReuse = () => {
                const currentItems = items.filter(i => !i.purchased).map(i => ({ name: i.name, category: i.category, quantity: i.quantity, unit: i.unit }));
                if (currentItems.length === 0) return;

                const listName = `×¨×©×™××” ${new Date().toLocaleDateString('he-IL')}`;
                const newList = { id: Date.now(), name: listName, items: currentItems, createdAt: new Date() };
                const updated = [newList, ...savedLists.slice(0, 9)]; // Keep max 10
                setSavedLists(updated);
                localStorage.setItem(`savedLists_${family.id}`, JSON.stringify(updated));
            };

            // Load saved list to cart
            const loadSavedList = async (savedList) => {
                for (const item of savedList.items) {
                    await addProduct(item.name, item.category);
                }
                setShowSavedLists(false);
            };

            // Import from WhatsApp text
            const importFromWhatsApp = async () => {
                if (!whatsAppText.trim()) return;

                // Parse WhatsApp text - split by newlines, commas, or bullet points
                const lines = whatsAppText
                    .split(/[\n,â€¢\-\*]/)
                    .map(line => line.trim())
                    .filter(line => line.length > 0 && line.length < 50);

                let addedCount = 0;
                for (const line of lines) {
                    // Try to extract quantity if present (e.g., "2 ×—×œ×‘" or "×—×œ×‘ x3" or "2 ×§"×’ ×‘×©×¨")
                    let qty = 1;
                    let productName = line;

                    // Match patterns like "2 ×—×œ×‘", "×—×œ×‘ x3", "2 ×§"×’ ×‘×©×¨"
                    const qtyMatch = line.match(/^([\d.]+)\s*(.+)$/) || line.match(/^(.+?)\s*[xXÃ—]\s*([\d.]+)$/);
                    if (qtyMatch) {
                        qty = parseFloat(qtyMatch[1]) || parseFloat(qtyMatch[2]) || 1;
                        productName = (qtyMatch[2] || qtyMatch[1]).trim();
                        // Remove unit from product name if it starts with a unit
                        productName = productName.replace(/^(×§"×’|×§×’|×’×¨×|×œ×™×˜×¨|×"×œ|×™×—'|×™×—×™×“×•×ª?)\s*/i, '').trim();
                    }

                    if (!productName) continue;

                    // Detect category and get appropriate unit
                    const category = detectCategory(productName);
                    const unit = CATEGORIES[category]?.unit || '×™×—\'';

                    // Check if already exists
                    const existing = items.find(item => item.name === productName && !item.purchased);
                    if (existing) {
                        // Update quantity
                        let newQty;
                        if (typeof existing.quantity === 'string') {
                            const numMatch = existing.quantity.match(/^([\d.]+)/);
                            const existingNum = numMatch ? parseFloat(numMatch[1]) : 1;
                            newQty = `${existingNum + qty} ${unit}`;
                        } else {
                            newQty = `${(existing.quantity || 0) + qty} ${unit}`;
                        }
                        await window.firestore.updateDoc(
                            window.firestore.doc(window.db, 'shopping-items', existing.id),
                            { quantity: newQty, unit: unit, updatedAt: new Date() }
                        );
                    } else {
                        // Add new item with correct unit
                        await window.firestore.addDoc(window.firestore.collection(window.db, 'shopping-items'), {
                            name: productName,
                            category: category,
                            quantity: `${qty} ${unit}`,
                            unit: unit,
                            purchased: false,
                            familyId: family.id,
                            listId: currentList.id,
                            addedBy: user.displayName || user.email,
                            addedByUid: user.uid,
                            note: '',
                            createdAt: new Date()
                        });
                    }
                    addedCount++;
                }

                setWhatsAppText('');
                setShowImportWhatsApp(false);
            };

            // Price comparison scanner functions
            const startPriceScanner = async () => {
                setShowPriceScanner(true);
                setScannedProductName('');
                setPriceCompareResults(null);
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({
                        video: { facingMode: 'environment', width: { ideal: 1280 }, height: { ideal: 720 } }
                    });
                    if (priceVideoRef.current) {
                        priceVideoRef.current.srcObject = stream;
                    }
                } catch (err) {
                    console.error('Camera error:', err);
                    alert('×œ× × ×™×ª×Ÿ ×œ×’×©×ª ×œ××¦×œ××”');
                    setShowPriceScanner(false);
                }
            };

            const stopPriceScanner = () => {
                if (priceVideoRef.current?.srcObject) {
                    const tracks = priceVideoRef.current.srcObject.getTracks();
                    tracks.forEach(track => {
                        track.stop();
                        track.enabled = false;
                    });
                    priceVideoRef.current.srcObject = null;
                }
                setShowPriceScanner(false);
                setScanningPrice(false);
            };

            // Get product suggestions for price search
            const getPriceSearchSuggestions = (searchText) => {
                if (!searchText || searchText.length < 2) return [];
                const text = searchText.toLowerCase();
                const suggestions = [];
                for (const [cat, products] of Object.entries(PRODUCTS)) {
                    for (const product of products) {
                        if (product.includes(searchText) || product.toLowerCase().includes(text)) {
                            suggestions.push(product);
                            if (suggestions.length >= 8) return suggestions;
                        }
                    }
                }
                return suggestions;
            };

            // Translate English product name to Hebrew
            const translateProductToHebrew = (text) => {
                if (!text) return text;
                const lower = text.toLowerCase().trim();

                // Check direct translation
                if (ENGLISH_TO_HEBREW[lower]) {
                    return ENGLISH_TO_HEBREW[lower];
                }

                // Check if any word matches
                const words = lower.split(/\s+/);
                for (const word of words) {
                    if (ENGLISH_TO_HEBREW[word]) {
                        return ENGLISH_TO_HEBREW[word];
                    }
                }

                // Check partial matches
                for (const [eng, heb] of Object.entries(ENGLISH_TO_HEBREW)) {
                    if (lower.includes(eng) || eng.includes(lower)) {
                        return heb;
                    }
                }

                return text; // Return original if no translation found
            };

            // Check if text is English (contains mostly English letters)
            const isEnglishText = (text) => {
                const englishChars = (text.match(/[a-zA-Z]/g) || []).length;
                const hebrewChars = (text.match(/[\u0590-\u05FF]/g) || []).length;
                return englishChars > hebrewChars;
            };

            const captureAndScanPrice = async () => {
                if (!priceVideoRef.current || !priceCanvasRef.current) return;

                setScanningPrice(true);
                const video = priceVideoRef.current;
                const canvas = priceCanvasRef.current;
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                const ctx = canvas.getContext('2d');

                // Enhance image for better OCR
                ctx.drawImage(video, 0, 0);
                // Increase contrast
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imageData.data;
                for (let i = 0; i < data.length; i += 4) {
                    // Convert to grayscale and increase contrast
                    const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
                    const contrast = 1.5;
                    const newVal = Math.min(255, Math.max(0, ((avg - 128) * contrast) + 128));
                    data[i] = data[i + 1] = data[i + 2] = newVal > 128 ? 255 : 0; // Binarize
                }
                ctx.putImageData(imageData, 0, 0);

                try {
                    // Try Hebrew first
                    const result = await Tesseract.recognize(canvas, 'heb', {
                        logger: m => console.log(m)
                    });

                    let text = result.data.text.trim();

                    // If no Hebrew found, try English and translate
                    if (!text || text.length < 2) {
                        const engResult = await Tesseract.recognize(canvas, 'eng', {
                            logger: m => console.log(m)
                        });
                        text = engResult.data.text.trim();
                    }

                    // Extract meaningful words
                    const words = text.match(/[\u0590-\u05FFa-zA-Z]{2,}/g) || [];
                    const cleanWords = words.filter(w => w.length >= 2 && !['×©×œ', '××ª', '××•', '×’×', '×¢×', 'the', 'and', 'or'].includes(w.toLowerCase()));

                    if (cleanWords.length > 0) {
                        let productName = cleanWords.slice(0, 3).join(' ');

                        // If English, translate to Hebrew
                        if (isEnglishText(productName)) {
                            productName = translateProductToHebrew(productName);
                        }

                        // Try to find matching product in our database
                        const suggestions = getPriceSearchSuggestions(productName);
                        if (suggestions.length > 0) {
                            setScannedProductName(suggestions[0]);
                        } else {
                            setScannedProductName(productName);
                        }
                    } else {
                        setScannedProductName('');
                    }
                } catch (err) {
                    console.error('OCR Error:', err);
                } finally {
                    setScanningPrice(false);

                    // Stop camera after scan - more robust cleanup
                    if (priceVideoRef.current?.srcObject) {
                        const tracks = priceVideoRef.current.srcObject.getTracks();
                        tracks.forEach(track => {
                            track.stop();
                            track.enabled = false;
                        });
                        priceVideoRef.current.srcObject = null;
                    }
                }
            };

            const searchPriceComparison = (productName) => {
                if (!productName) return;

                const encodedName = encodeURIComponent(productName);

                // Israeli supermarket search URLs
                const sites = [
                    { name: '×©×•×¤×¨×¡×œ', url: `https://www.shufersal.co.il/online/he/search?text=${encodedName}`, color: 'bg-red-500' },
                    { name: '×¨××™ ×œ×•×™', url: `https://www.rami-levy.co.il/he/online/search?q=${encodedName}`, color: 'bg-blue-500' },
                    { name: '×•×™×§×˜×•×¨×™', url: `https://www.victoryonline.co.il/search?q=${encodedName}`, color: 'bg-orange-500' },
                    { name: '×™×™× ×•×ª ×‘×™×ª×Ÿ', url: `https://www.ybitan.co.il/search?q=${encodedName}`, color: 'bg-purple-500' },
                    { name: '××—×¡× ×™ ×”×©×•×§', url: `https://mahsane-hashuk.co.il/?s=${encodedName}`, color: 'bg-green-500' },
                    { name: '××•×©×¨ ×¢×“', url: `https://www.osheread.co.il/catalogsearch/result/?q=${encodedName}`, color: 'bg-yellow-500' }
                ];

                setPriceCompareResults(sites);
            };

            const openPriceLink = (url) => {
                window.open(url, '_blank');
            };

            // Get holiday recommendations
            const getHolidayRecommendations = () => {
                const now = new Date();
                const upcoming = ISRAELI_HOLIDAYS.filter(h => {
                    const daysUntil = Math.ceil((h.dateObj - now) / (1000 * 60 * 60 * 24));
                    return daysUntil > 0 && daysUntil <= 14;
                });

                const recommendations = {
                    '×¤×•×¨×™×': ['××•×–× ×™ ×”××Ÿ', '×©×•×§×•×œ×“', '×××ª×§×™×', '××©×§××•×ª', '×¤×™×¨×•×ª ×™×‘×©×™×', '××’×•×–×™×'],
                    '×¤×¡×—': ['××¦×•×ª', '×™×™×Ÿ', '×—×¨×•×¡×ª', '×—×¡×”', '×‘×™×¦×™×', '×‘×©×¨', '×ª×¤×•×—×™ ××“××”', '×‘×¦×œ'],
                    '×™×•× ×”×¢×¦×××•×ª': ['×‘×©×¨ ×˜×—×•×Ÿ', '× ×§× ×™×§×™×•×ª', '×”××‘×•×¨×’×¨', '×¤×—×', '×œ×—×× ×™×•×ª', '×¡×œ×˜×™×', '××©×§××•×ª ×§×œ×™×'],
                    '×œ"×’ ×‘×¢×•××¨': ['× ×§× ×™×§×™×•×ª', '×‘×©×¨', '×¤×—×', '×ª×™×¨×¡', '×œ×—×× ×™×•×ª', '×§×˜×©×•×¤', '×—×¨×“×œ'],
                    '×©×‘×•×¢×•×ª': ['×’×‘×™× ×•×ª', '×©×× ×ª', '×—×œ×‘', '×‘×™×¦×™×', '×¤×™×¨×•×ª', '×¢×•×’×ª ×’×‘×™× ×”'],
                    '×¨××© ×”×©× ×”': ['×ª×¤×•×—×™×', '×“×‘×©', '×¨×™××•× ×™×', '×“×’×™×', '×‘×©×¨', '×™×™×Ÿ', '×—×œ×”'],
                    '×¡×•×›×•×ª': ['×¤×™×¨×•×ª', '×™×¨×§×•×ª', '×‘×©×¨', '×¢×•×£', '×™×™×Ÿ'],
                    '×—× ×•×›×”': ['×©××Ÿ', '×ª×¤×•×—×™ ××“××”', '×‘×¦×œ', '×‘×™×¦×™×', '×§××—', '×¡×•×¤×’× ×™×•×ª', '×©×•×§×•×œ×“ ××˜×‘×¢×•×ª']
                };

                return upcoming.map(holiday => ({
                    ...holiday,
                    products: recommendations[holiday.name] || []
                })).filter(h => h.products.length > 0);
            };

            // AI Assistant - Smart Shopping Suggestions
            const generateAISuggestions = () => {
                setAiThinking(true);
                setAiSuggestions([]);

                // Simulate AI thinking delay
                setTimeout(() => {
                    const suggestions = [];
                    const currentItems = items.map(i => i.name.toLowerCase());
                    const currentCategories = [...new Set(items.map(i => i.category))];

                    // 1. Suggest complementary items based on what's in cart
                    const complementaryRules = {
                        '×¤×¡×˜×”': ['×¨×•×˜×‘ ×¢×’×‘× ×™×•×ª', '×’×‘×™× ×” ×¦×”×•×‘×”', '×©××Ÿ ×–×™×ª'],
                        '×‘×©×¨ ×˜×—×•×Ÿ': ['×‘×¦×œ', '×©×•×', '×‘×™×¦×™×', '×¤×™×¨×•×¨×™ ×œ×—×'],
                        '×—×–×” ×¢×•×£': ['×œ×™××•×Ÿ', '×©×•×', '×©××Ÿ ×–×™×ª', '×ª×‘×œ×™× ×™×'],
                        '×œ×—×': ['×—×××”', '×¨×™×‘×”', '×’×‘×™× ×” ×¦×”×•×‘×”'],
                        '×‘×™×¦×™×': ['×—×œ×‘', '×’×‘×™× ×” ×¦×”×•×‘×”', '×™×¨×§×•×ª'],
                        '×¡×œ×˜': ['×©××Ÿ ×–×™×ª', '×œ×™××•×Ÿ', '×¢×’×‘× ×™×•×ª', '××œ×¤×¤×•× ×™×'],
                        '××•×¨×–': ['×¨×•×˜×‘ ×¡×•×™×”', '×™×¨×§×•×ª ××•×§×¤×¦×™×', '×¢×•×£'],
                        '×§×¤×”': ['×—×œ×‘', '×¡×•×›×¨', '×¢×•×’×™×•×ª'],
                        '×ª×”': ['×“×‘×©', '×œ×™××•×Ÿ', '×¢×•×’×™×•×ª'],
                        '×©× ×™×¦×œ': ['×ª×¤×•×—×™ ××“××”', '×¡×œ×˜', '×œ×™××•×Ÿ'],
                        '×”××‘×•×¨×’×¨': ['×œ×—×× ×™×•×ª', '×§×˜×©×•×¤', '×—×¨×“×œ', '×—×¡×”', '×¢×’×‘× ×™×•×ª'],
                        '×¤×™×¦×”': ['×’×‘×™× ×” ×¦×”×•×‘×”', '×¨×•×˜×‘ ×¢×’×‘× ×™×•×ª', '×–×™×ª×™×', '×¤×˜×¨×™×•×ª']
                    };

                    items.forEach(item => {
                        const itemLower = item.name.toLowerCase();
                        Object.keys(complementaryRules).forEach(key => {
                            if (itemLower.includes(key)) {
                                complementaryRules[key].forEach(suggestion => {
                                    if (!currentItems.some(ci => ci.includes(suggestion.toLowerCase())) &&
                                        !suggestions.some(s => s.name === suggestion)) {
                                        suggestions.push({
                                            type: 'complementary',
                                            name: suggestion,
                                            reason: `××©×œ×™× ×œ${item.name}`,
                                            icon: 'ğŸ§©'
                                        });
                                    }
                                });
                            }
                        });
                    });

                    // 2. Suggest basics if missing
                    const basicItems = ['×—×œ×‘', '×œ×—×', '×‘×™×¦×™×', '×—×××”', '×’×‘×™× ×” ×¦×”×•×‘×”'];
                    basicItems.forEach(basic => {
                        if (!currentItems.some(ci => ci.includes(basic.toLowerCase()))) {
                            if (Math.random() > 0.5) { // Don't suggest all basics
                                suggestions.push({
                                    type: 'basic',
                                    name: basic,
                                    reason: '××•×¦×¨ ×‘×¡×™×¡×™ ×©×›×“××™ ×©×™×”×™×” ×‘×‘×™×ª',
                                    icon: 'ğŸ '
                                });
                            }
                        }
                    });

                    // 3. Suggest based on day of week
                    const dayOfWeek = new Date().getDay();
                    if (dayOfWeek === 4 || dayOfWeek === 5) { // Thursday or Friday - Shabbat prep
                        const shabbatItems = ['×—×œ×”', '×™×™×Ÿ', '× ×¨×•×ª ×©×‘×ª', '×¢×•×£', '×ª×¤×•×—×™ ××“××”'];
                        shabbatItems.forEach(item => {
                            if (!currentItems.some(ci => ci.includes(item.toLowerCase()))) {
                                suggestions.push({
                                    type: 'shabbat',
                                    name: item,
                                    reason: '×œ×§×¨××ª ×©×‘×ª',
                                    icon: 'ğŸ•¯ï¸'
                                });
                            }
                        });
                    }

                    // 4. Suggest based on weather/season (simple logic)
                    const month = new Date().getMonth();
                    if (month >= 5 && month <= 8) { // Summer
                        const summerItems = ['××™×', '××‘×˜×™×—', '×’×œ×™×“×”', '××™×¥'];
                        summerItems.forEach(item => {
                            if (!currentItems.some(ci => ci.includes(item.toLowerCase())) && Math.random() > 0.6) {
                                suggestions.push({
                                    type: 'seasonal',
                                    name: item,
                                    reason: '××ª××™× ×œ×§×™×¥',
                                    icon: 'â˜€ï¸'
                                });
                            }
                        });
                    } else if (month >= 11 || month <= 2) { // Winter
                        const winterItems = ['××¨×§', '×ª×”', '×“×‘×©', '×©×•×§×•'];
                        winterItems.forEach(item => {
                            if (!currentItems.some(ci => ci.includes(item.toLowerCase())) && Math.random() > 0.6) {
                                suggestions.push({
                                    type: 'seasonal',
                                    name: item,
                                    reason: '××ª××™× ×œ×—×•×¨×£',
                                    icon: 'â„ï¸'
                                });
                            }
                        });
                    }

                    // 5. Recipe suggestion based on items
                    if (currentItems.some(ci => ci.includes('×¤×¡×˜×”')) &&
                        currentItems.some(ci => ci.includes('×¨×•×˜×‘') || ci.includes('×¢×’×‘× ×™'))) {
                        suggestions.unshift({
                            type: 'recipe',
                            name: 'ğŸ ××¤×©×¨ ×œ×”×›×™×Ÿ ×¤×¡×˜×” ×‘×¨×•×˜×‘ ×¢×’×‘× ×™×•×ª!',
                            reason: '×›×œ ×”××¨×›×™×‘×™× ×‘×¨×©×™××”',
                            icon: 'ğŸ‘¨â€ğŸ³',
                            isRecipe: true
                        });
                    }

                    if (currentItems.some(ci => ci.includes('×‘×™×¦')) &&
                        currentItems.some(ci => ci.includes('×’×‘×™× '))) {
                        suggestions.unshift({
                            type: 'recipe',
                            name: 'ğŸ³ ××¤×©×¨ ×œ×”×›×™×Ÿ ×—×‘×™×ª×” ×¢× ×’×‘×™× ×”!',
                            reason: '×›×œ ×”××¨×›×™×‘×™× ×‘×¨×©×™××”',
                            icon: 'ğŸ‘¨â€ğŸ³',
                            isRecipe: true
                        });
                    }

                    // Limit suggestions
                    setAiSuggestions(suggestions.slice(0, 8));
                    setAiThinking(false);
                }, 1500);
            };

            // Add AI suggestion to cart
            const addAISuggestion = async (suggestion) => {
                if (suggestion.isRecipe) return;
                await addProduct(suggestion.name);
                setAiSuggestions(prev => prev.filter(s => s.name !== suggestion.name));
            };

            // Load saved data on mount
            React.useEffect(() => {
                const savedListsData = localStorage.getItem(`savedLists_${family?.id}`);
                if (savedListsData) setSavedLists(JSON.parse(savedListsData));

                const outOfStockData = localStorage.getItem(`outOfStock_${family?.id}`);
                if (outOfStockData) setOutOfStockItems(JSON.parse(outOfStockData));
            }, [family?.id]);

            // Update presence for real-time editing
            React.useEffect(() => {
                if (!family?.id || !user) return;

                const presenceRef = window.firestore.doc(window.db, 'families', family.id, 'presence', user.uid);

                const updatePresence = () => {
                    window.firestore.setDoc(presenceRef, {
                        name: user.displayName || user.email,
                        lastSeen: new Date(),
                        isActive: true
                    }, { merge: true });
                };

                updatePresence();
                const interval = setInterval(updatePresence, 30000);

                // Listen to other editors
                const unsubscribe = window.firestore.onSnapshot(
                    window.firestore.collection(window.db, 'families', family.id, 'presence'),
                    (snapshot) => {
                        const editors = [];
                        const now = new Date();
                        snapshot.forEach(doc => {
                            const data = doc.data();
                            if (doc.id !== user.uid && data.lastSeen) {
                                const lastSeen = data.lastSeen.toDate ? data.lastSeen.toDate() : new Date(data.lastSeen);
                                if ((now - lastSeen) < 60000) { // Active in last minute
                                    editors.push(data.name);
                                }
                            }
                        });
                        setActiveEditors(editors);
                    }
                );

                return () => {
                    clearInterval(interval);
                    unsubscribe();
                    window.firestore.updateDoc(presenceRef, { isActive: false });
                };
            }, [family?.id, user]);

            // Translate English to Hebrew
            const translateToHebrew = (text) => {
                const lowerText = text.toLowerCase().trim();
                // Direct match
                if (ENGLISH_TO_HEBREW[lowerText]) {
                    return ENGLISH_TO_HEBREW[lowerText];
                }
                // Try without 's' for plurals
                if (lowerText.endsWith('s') && ENGLISH_TO_HEBREW[lowerText.slice(0, -1)]) {
                    return ENGLISH_TO_HEBREW[lowerText.slice(0, -1)];
                }
                // Try partial match
                for (const [eng, heb] of Object.entries(ENGLISH_TO_HEBREW)) {
                    if (lowerText.includes(eng) || eng.includes(lowerText)) {
                        return heb;
                    }
                }
                return text; // Return original if no translation found
            };

            useEffect(() => {
                const savedDark = localStorage.getItem('darkMode') === 'true';
                if (savedDark) {
                    setDarkMode(true);
                    document.documentElement.classList.add('dark');
                }
            }, []);

            // Check for first-time visit and show onboarding
            useEffect(() => {
                const hasSeenOnboarding = localStorage.getItem('hasSeenOnboarding');
                if (!hasSeenOnboarding) {
                    setTimeout(() => setShowOnboarding(true), 1000);
                }
                // Load saved accessibility settings
                const savedAccessibility = localStorage.getItem('accessibilitySettings');
                if (savedAccessibility) {
                    const settings = JSON.parse(savedAccessibility);
                    setAccessibilitySettings(settings);
                    applyAccessibilitySettings(settings);
                }
            }, []);

            // Apply accessibility settings to document
            const applyAccessibilitySettings = (settings) => {
                const root = document.documentElement;
                // Font size
                root.style.fontSize = settings.fontSize === 'large' ? '120%' : settings.fontSize === 'small' ? '85%' : '100%';
                // Contrast
                if (settings.contrast === 'high') {
                    root.classList.add('high-contrast');
                    root.classList.remove('low-contrast');
                } else if (settings.contrast === 'low') {
                    root.classList.add('low-contrast');
                    root.classList.remove('high-contrast');
                } else {
                    root.classList.remove('high-contrast', 'low-contrast');
                }
                // Highlight links
                if (settings.highlightLinks) {
                    root.classList.add('highlight-links');
                } else {
                    root.classList.remove('highlight-links');
                }
                // Cursor size
                if (settings.cursorSize === 'large-black') {
                    root.classList.add('cursor-large-black');
                    root.classList.remove('cursor-large-white');
                } else if (settings.cursorSize === 'large-white') {
                    root.classList.add('cursor-large-white');
                    root.classList.remove('cursor-large-black');
                } else {
                    root.classList.remove('cursor-large-black', 'cursor-large-white');
                }
            };

            const updateAccessibility = (key, value) => {
                const newSettings = { ...accessibilitySettings, [key]: value };
                setAccessibilitySettings(newSettings);
                localStorage.setItem('accessibilitySettings', JSON.stringify(newSettings));
                applyAccessibilitySettings(newSettings);
            };

            const resetAccessibility = () => {
                const defaultSettings = { fontSize: 'normal', contrast: 'normal', highlightLinks: false, cursorSize: 'normal' };
                setAccessibilitySettings(defaultSettings);
                localStorage.setItem('accessibilitySettings', JSON.stringify(defaultSettings));
                applyAccessibilitySettings(defaultSettings);
            };

            const completeOnboarding = () => {
                localStorage.setItem('hasSeenOnboarding', 'true');
                setShowOnboarding(false);
            };

            const sendFeedback = async () => {
                if (!feedbackText.trim()) return;
                setFeedbackSending(true);
                try {
                    // Send feedback using EmailJS or similar service (hidden from user)
                    const templateParams = {
                        type: feedbackType,
                        message: feedbackText,
                        user_email: user?.email || '×œ× ××—×•×‘×¨',
                        user_name: user?.displayName || '×× ×•× ×™××™'
                    };
                    // Using a simple mailto link as fallback (opens email client)
                    const subject = encodeURIComponent(`[ShopSmart] ${feedbackType === 'bug' ? '×“×™×•×•×— ×¢×œ ×‘×¢×™×”' : feedbackType === 'feature' ? '×‘×§×©×ª ×¤×™×¦\'×¨' : '××©×•×‘ ×›×œ×œ×™'}`);
                    const body = encodeURIComponent(`×¡×•×’: ${feedbackType}\n\n×”×•×“×¢×”:\n${feedbackText}\n\n---\n××©×ª××©: ${user?.displayName || '×× ×•× ×™××™'}\n××™××™×™×œ: ${user?.email || '×œ× ×–××™×Ÿ'}`);
                    window.open(`mailto:yosigidi1979@gmail.com?subject=${subject}&body=${body}`, '_blank');
                    setFeedbackSent(true);
                    setFeedbackText('');
                    setTimeout(() => {
                        setShowFeedback(false);
                        setFeedbackSent(false);
                    }, 2000);
                } catch (error) {
                    console.error('Error sending feedback:', error);
                }
                setFeedbackSending(false);
            };

            useEffect(() => {
                if (!family || !currentList) {
                    setItems([]);
                    setLoading(false);
                    return;
                }

                const q = window.firestore.query(
                    window.firestore.collection(window.db, 'shopping-items'),
                    window.firestore.where('familyId', '==', family.id),
                    window.firestore.where('listId', '==', currentList.id)
                );

                const unsubscribe = window.firestore.onSnapshot(
                    q,
                    (snapshot) => {
                        const itemsData = [];
                        snapshot.forEach((doc) => {
                            itemsData.push({ id: doc.id, ...doc.data() });
                        });
                        // Sort client-side (newest first)
                        itemsData.sort((a, b) => {
                            const dateA = a.createdAt?.toDate?.() || new Date(0);
                            const dateB = b.createdAt?.toDate?.() || new Date(0);
                            return dateB - dateA;
                        });
                        setItems(itemsData);
                        setLoading(false);
                    },
                    (error) => {
                        console.error('×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™×:', error);
                        setLoading(false);
                    }
                );

                loadHistory();
                return () => unsubscribe();
            }, [family, currentList]);

            const loadHistory = async () => {
                if (!family) return;
                try {
                    const historyQuery = window.firestore.query(
                        window.firestore.collection(window.db, 'shopping-history'),
                        window.firestore.where('familyId', '==', family.id)
                    );
                    const snapshot = await window.firestore.getDocs(historyQuery);
                    const historyData = [];
                    snapshot.forEach(doc => {
                        historyData.push({ id: doc.id, ...doc.data() });
                    });
                    // Sort client-side (newest first)
                    historyData.sort((a, b) => {
                        const dateA = a.completedAt?.toDate?.() || new Date(0);
                        const dateB = b.completedAt?.toDate?.() || new Date(0);
                        return dateB - dateA;
                    });
                    setHistory(historyData);
                } catch (error) {
                    console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ×”×™×¡×˜×•×¨×™×”:', error);
                }
            };

            // Request notification permission
            useEffect(() => {
                const requestNotificationPermission = async () => {
                    if ('Notification' in window) {
                        if (Notification.permission === 'granted') {
                            setNotificationsEnabled(true);
                        } else if (Notification.permission !== 'denied') {
                            const permission = await Notification.requestPermission();
                            setNotificationsEnabled(permission === 'granted');
                        }
                    }
                };
                requestNotificationPermission();
            }, []);

            // Show chat notification
            const showChatNotification = (message) => {
                if (!notificationsEnabled || !('Notification' in window)) return;
                if (Notification.permission !== 'granted') return;

                // Don't show if chat is open and visible
                if (showChat && document.visibilityState === 'visible') return;

                const title = `ğŸ’¬ ${message.senderName || '×”×•×“×¢×” ×—×“×©×”'}`;
                const body = message.photoUrl ? 'ğŸ“· ×©×œ×—/×” ×ª××•× ×”' : message.text || '×”×•×“×¢×” ×—×“×©×”';

                try {
                    const notification = new Notification(title, {
                        body: body,
                        icon: 'ğŸ›’',
                        badge: 'ğŸ›’',
                        tag: 'chat-message',
                        renotify: true,
                        vibrate: [200, 100, 200]
                    });

                    notification.onclick = () => {
                        window.focus();
                        setShowChat(true);
                        notification.close();
                    };

                    // Auto close after 5 seconds
                    setTimeout(() => notification.close(), 5000);
                } catch (error) {
                    console.error('Notification error:', error);
                }
            };

            // Mark messages as read when chat is opened
            const markMessagesAsRead = async () => {
                if (!family || !user || !showChat) return;

                const unreadMessages = chatMessages.filter(msg =>
                    msg.senderUid !== user.uid &&
                    (!msg.readBy || !msg.readBy.includes(user.uid))
                );

                for (const msg of unreadMessages) {
                    try {
                        await window.firestore.updateDoc(
                            window.firestore.doc(window.db, 'family-chat', msg.id),
                            { readBy: window.firestore.arrayUnion(user.uid) }
                        );
                    } catch (e) {
                        console.error('Error marking message as read:', e);
                    }
                }
            };

            // Mark messages as read when chat opens
            useEffect(() => {
                if (showChat && chatMessages.length > 0) {
                    markMessagesAsRead();
                }
            }, [showChat, chatMessages.length]);

            // Load chat messages
            useEffect(() => {
                if (!family) {
                    setChatMessages([]);
                    return;
                }

                const q = window.firestore.query(
                    window.firestore.collection(window.db, 'family-chat'),
                    window.firestore.where('familyId', '==', family.id)
                );

                const unsubscribe = window.firestore.onSnapshot(q, (snapshot) => {
                    const messages = [];
                    snapshot.forEach((doc) => {
                        messages.push({ id: doc.id, ...doc.data() });
                    });
                    messages.sort((a, b) => {
                        const dateA = a.createdAt?.toDate?.() || new Date(0);
                        const dateB = b.createdAt?.toDate?.() || new Date(0);
                        return dateA - dateB;
                    });

                    // Check for new messages from other users and send notification
                    if (messages.length > 0 && user) {
                        const latestMessage = messages[messages.length - 1];
                        if (latestMessage.id !== lastMessageIdRef.current &&
                            latestMessage.senderUid !== user.uid &&
                            lastMessageIdRef.current !== null) {
                            // New message from someone else
                            showChatNotification(latestMessage);
                        }
                        lastMessageIdRef.current = latestMessage.id;
                    }

                    setChatMessages(messages);
                });

                return () => unsubscribe();
            }, [family, user]);

            // Load recipes
            useEffect(() => {
                if (!family) {
                    setRecipes([]);
                    return;
                }

                const q = window.firestore.query(
                    window.firestore.collection(window.db, 'recipes'),
                    window.firestore.where('familyId', '==', family.id)
                );

                const unsubscribe = window.firestore.onSnapshot(q, (snapshot) => {
                    const recipesData = [];
                    snapshot.forEach((doc) => {
                        recipesData.push({ id: doc.id, ...doc.data() });
                    });
                    recipesData.sort((a, b) => {
                        const dateA = a.createdAt?.toDate?.() || new Date(0);
                        const dateB = b.createdAt?.toDate?.() || new Date(0);
                        return dateB - dateA;
                    });
                    setRecipes(recipesData);
                });

                return () => unsubscribe();
            }, [family]);

            // Load forgotten stats
            useEffect(() => {
                if (!family) {
                    setForgottenStats({});
                    setShoppingStreak(0);
                    setAchievements([]);
                    return;
                }

                const monthKey = new Date().toISOString().slice(0, 7);
                const docRef = window.firestore.doc(window.db, 'forgotten-stats', `${family.id}_${monthKey}`);

                const unsubscribe = window.firestore.onSnapshot(docRef, (doc) => {
                    if (doc.exists()) {
                        setForgottenStats(doc.data().items || {});
                    } else {
                        setForgottenStats({});
                    }
                });

                // Load streak data
                loadShoppingStreak();

                return () => unsubscribe();
            }, [family]);

            // Recalculate achievements when stats change
            useEffect(() => {
                const newAchievements = [];

                // Only show achievements if we have some shopping history
                const essentials = ['×—×œ×‘', '×œ×—×', '×‘×™×¦×™×', '×’×‘×™× ×”', '×¢×’×‘× ×™×•×ª', '××œ×¤×¤×•× ×™×'];

                // Check for items with zero forgets this month (only show top 3)
                let perfectCount = 0;
                essentials.forEach(item => {
                    if ((!forgottenStats[item] || forgottenStats[item] === 0) && perfectCount < 3) {
                        newAchievements.push({
                            name: `${item} Master`,
                            emoji: 'ğŸ†',
                            description: `0 ×¤×¢××™× ×©×›×—×ª ${item} ×”×—×•×“×©`
                        });
                        perfectCount++;
                    }
                });

                // Perfect week achievement
                if (shoppingStreak >= 7) {
                    newAchievements.push({
                        name: '×©×‘×•×¢ ××•×©×œ×',
                        emoji: 'â­',
                        description: `${shoppingStreak} ×§× ×™×•×ª ×‘×¨×¦×£ ×‘×œ×™ ×œ×©×›×•×—!`
                    });
                } else if (shoppingStreak >= 3) {
                    newAchievements.push({
                        name: '×¢×œ ×”×“×¨×š ×”× ×›×•× ×”',
                        emoji: 'ğŸŒŸ',
                        description: `${shoppingStreak} ×§× ×™×•×ª ×‘×¨×¦×£!`
                    });
                }

                // Memory champion
                if (Object.keys(forgottenStats).length === 0 || Object.values(forgottenStats).every(v => v === 0)) {
                    newAchievements.push({
                        name: '××œ×•×£ ×”×–×™×›×¨×•×Ÿ',
                        emoji: 'ğŸ§ ',
                        description: '×œ× ×©×›×—×ª ×›×œ×•× ×”×—×•×“×©!'
                    });
                }

                setAchievements(newAchievements);
            }, [forgottenStats, shoppingStreak]);

            // Load regular items (items that appear frequently in shopping history)
            useEffect(() => {
                if (!family || history.length === 0) {
                    setRegularItems([]);
                    return;
                }

                // Count item frequency across all shopping history
                const itemCounts = {};
                history.forEach(record => {
                    record.items?.forEach(item => {
                        const name = item.name?.toLowerCase?.() || '';
                        if (name) {
                            itemCounts[name] = (itemCounts[name] || 0) + 1;
                        }
                    });
                });

                // Get items that appear in at least 3 shopping trips or 30% of trips
                const minCount = Math.max(3, Math.floor(history.length * 0.3));
                const regulars = Object.entries(itemCounts)
                    .filter(([_, count]) => count >= minCount)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 20)
                    .map(([name, count]) => ({ name, count }));

                setRegularItems(regulars);
            }, [family, history]);

            // Calculate upcoming holidays (within next 14 days)
            useEffect(() => {
                // This is a simplified version - in production you'd use a proper Hebrew calendar library
                const checkUpcomingHolidays = () => {
                    const today = new Date();
                    const twoWeeksFromNow = new Date(today.getTime() + 14 * 24 * 60 * 60 * 1000);

                    // For demo purposes, we'll show random holiday reminders occasionally
                    // In production, you'd integrate with a Hebrew calendar API
                    const savedReminders = JSON.parse(localStorage.getItem('holidayReminders') || '[]');
                    const lastCheck = localStorage.getItem('lastHolidayCheck');
                    const now = Date.now();

                    // Check once per day
                    if (!lastCheck || now - parseInt(lastCheck) > 24 * 60 * 60 * 1000) {
                        localStorage.setItem('lastHolidayCheck', now.toString());
                        // In a real implementation, calculate actual Hebrew dates here
                    }

                    setUpcomingHolidays(savedReminders);
                };

                checkUpcomingHolidays();
            }, []);

            // Add regular items to cart
            const addRegularItems = async () => {
                const currentItemNames = items.map(i => i.name.toLowerCase());
                const itemsToAdd = regularItems.filter(r => !currentItemNames.includes(r.name.toLowerCase()));

                for (const item of itemsToAdd) {
                    // Find category for the item
                    let category = 'other';
                    for (const [cat, products] of Object.entries(PRODUCTS)) {
                        if (products.some(p => p.toLowerCase() === item.name.toLowerCase())) {
                            category = cat;
                            break;
                        }
                    }

                    const unit = CATEGORIES[category]?.unit || '×™×—\'';

                    await window.firestore.addDoc(window.firestore.collection(window.db, 'shopping-items'), {
                        name: item.name.charAt(0).toUpperCase() + item.name.slice(1),
                        category,
                        quantity: `1 ${unit}`,
                        unit,
                        purchased: false,
                        addedBy: user.displayName || user.email,
                        addedByUid: user.uid,
                        createdAt: new Date(),
                        updatedAt: new Date(),
                        familyId: family.id,
                        listId: currentList.id,
                        isRegular: true
                    });
                }

                if (itemsToAdd.length > 0) {
                    alert(`× ×•×¡×¤×• ${itemsToAdd.length} ××•×¦×¨×™× ×§×‘×•×¢×™× ×œ×¨×©×™××”! ğŸ‰`);
                } else {
                    alert('×›×œ ×”××•×¦×¨×™× ×”×§×‘×•×¢×™× ×›×‘×¨ × ××¦××™× ×‘×¨×©×™××”');
                }

                setShowRegulars(false);
            };

            // Load shopping streak
            const loadShoppingStreak = async () => {
                if (!family) return;

                try {
                    const streakRef = window.firestore.doc(window.db, 'shopping-streaks', family.id);
                    const streakDoc = await window.firestore.getDoc(streakRef);

                    if (streakDoc.exists()) {
                        const data = streakDoc.data();
                        const lastDate = data.lastShoppingDate?.toDate?.() || new Date(0);
                        const daysSinceLast = Math.floor((new Date() - lastDate) / (1000 * 60 * 60 * 24));

                        // Reset streak if more than 2 days passed
                        if (daysSinceLast > 2) {
                            setShoppingStreak(0);
                        } else {
                            setShoppingStreak(data.streak || 0);
                        }
                    }
                } catch (error) {
                    console.error('Error loading streak:', error);
                }
            };

            // Update streak on successful shopping
            const updateShoppingStreak = async (hadForgottenItems) => {
                if (!family) return;

                try {
                    const streakRef = window.firestore.doc(window.db, 'shopping-streaks', family.id);
                    const streakDoc = await window.firestore.getDoc(streakRef);

                    let newStreak = 1;
                    if (streakDoc.exists() && !hadForgottenItems) {
                        const data = streakDoc.data();
                        const lastDate = data.lastShoppingDate?.toDate?.() || new Date(0);
                        const daysSinceLast = Math.floor((new Date() - lastDate) / (1000 * 60 * 60 * 24));

                        if (daysSinceLast <= 2) {
                            newStreak = (data.streak || 0) + 1;
                        }
                    } else if (hadForgottenItems) {
                        newStreak = 0;
                    }

                    await window.firestore.setDoc(streakRef, {
                        familyId: family.id,
                        streak: newStreak,
                        lastShoppingDate: new Date(),
                        updatedAt: new Date()
                    });

                    setShoppingStreak(newStreak);
                } catch (error) {
                    console.error('Error updating streak:', error);
                }
            };

            // Get playful message for forgotten count
            const getForgottenMessage = (count) => {
                if (count === 0) return { emoji: 'ğŸ‘Œ', text: '××•×©×œ×!' };
                if (count === 1) return { emoji: 'ğŸ˜…', text: '×§×¨×” ×¤×¢× ××—×ª' };
                if (count === 2) return { emoji: 'ğŸ™ˆ', text: '××•×¤×¡, ×©×•×‘?' };
                if (count === 3) return { emoji: 'ğŸ˜¬', text: '×©×œ×•×© ×¤×¢××™×...' };
                if (count >= 4) return { emoji: 'ğŸ¤¦', text: '×‘×•××• × ×©×™× ×ª×–×›×•×¨×ª!' };
                return { emoji: 'ğŸ“Š', text: `${count} ×¤×¢××™×` };
            };

            // Recipe scanning functions
            const startRecipeScan = () => {
                setScanningRecipe(false);
                setScanProgress(0);
                setScannedText('');
                setScannedIngredients([]);
                setScannedRecipeName('××ª×›×•×Ÿ ×¡×¨×•×§');
                recipeScanActiveRef.current = true;
                setShowRecipeScan(true);

                // Wait for modal to render, then start camera
                setTimeout(async () => {
                    if (!recipeScanActiveRef.current) return;

                    try {
                        const stream = await navigator.mediaDevices.getUserMedia({
                            video: { facingMode: 'environment', width: { ideal: 1920 }, height: { ideal: 1080 } }
                        });
                        // Another small delay to ensure video element is fully mounted
                        setTimeout(() => {
                            if (recipeVideoRef.current && recipeScanActiveRef.current) {
                                recipeVideoRef.current.srcObject = stream;
                            } else {
                                // Stop stream if modal was closed
                                stream.getTracks().forEach(track => track.stop());
                            }
                        }, 200);
                    } catch (error) {
                        console.error('Camera error:', error);
                        alert('×œ× × ×™×ª×Ÿ ×œ×’×©×ª ×œ××¦×œ××”');
                        recipeScanActiveRef.current = false;
                        setShowRecipeScan(false);
                    }
                }, 300);
            };

            const captureAndScanRecipe = async () => {
                if (!recipeVideoRef.current || !recipeCanvasRef.current) return;

                const video = recipeVideoRef.current;
                const canvas = recipeCanvasRef.current;

                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(video, 0, 0);

                // Stop camera - more robust cleanup
                if (video.srcObject) {
                    const tracks = video.srcObject.getTracks();
                    tracks.forEach(track => {
                        track.stop();
                        track.enabled = false;
                    });
                    video.srcObject = null;
                }

                setScanningRecipe(true);
                setScanProgress(5);

                try {
                    if (typeof Tesseract === 'undefined') {
                        throw new Error('OCR library not loaded');
                    }

                    const imageData = canvas.toDataURL('image/jpeg', 0.95);

                    const result = await Tesseract.recognize(
                        imageData,
                        'heb+eng',
                        {
                            logger: info => {
                                if (info.status === 'recognizing text') {
                                    setScanProgress(Math.round(info.progress * 90) + 5);
                                }
                            }
                        }
                    );

                    setScanProgress(95);
                    const text = result.data.text;
                    setScannedText(text);

                    const parsedIngredients = parseIngredientsFromText(text);
                    setScannedIngredients(parsedIngredients);
                    setScanProgress(100);

                } catch (error) {
                    console.error('OCR error:', error);
                    alert('×©×’×™××” ×‘×–×™×”×•×™ ×˜×§×¡×˜: ' + error.message);
                } finally {
                    setScanningRecipe(false);
                }
            };

            const parseIngredientsFromText = (text) => {
                const lines = text.split('\n').map(line => line.trim()).filter(line => line.length > 1);
                const ingredients = [];
                const skipWords = ['×”×•×¨××•×ª', '×”×›× ×”', '××•×¤×Ÿ', '×©×œ×‘', 'step', 'instructions', 'method'];

                for (const line of lines) {
                    if (skipWords.some(word => line.toLowerCase().includes(word))) continue;
                    if (/^\d+\.$/.test(line)) continue;

                    const match = line.match(/^(\d+\.?\d*)?\s*(.+)$/);
                    if (match) {
                        const quantity = parseInt(match[1]) || 1;
                        let name = (match[2] || match[1] || '').trim();

                        if (name && name.length > 1 && name.length < 40) {
                            // Try to match with known products
                            for (const [cat, products] of Object.entries(PRODUCTS)) {
                                const found = products.find(p => p.includes(name) || name.includes(p));
                                if (found) { name = found; break; }
                            }

                            ingredients.push({ name, quantity, original: line, selected: true });
                        }
                    }
                }
                return ingredients;
            };

            const cancelRecipeScan = () => {
                recipeScanActiveRef.current = false;
                if (recipeVideoRef.current && recipeVideoRef.current.srcObject) {
                    const tracks = recipeVideoRef.current.srcObject.getTracks();
                    tracks.forEach(track => {
                        track.stop();
                        track.enabled = false;
                    });
                    recipeVideoRef.current.srcObject = null;
                }
                setShowRecipeScan(false);
                setScannedIngredients([]);
            };

            const toggleScannedIngredient = (index) => {
                setScannedIngredients(prev => prev.map((ing, i) => i === index ? { ...ing, selected: !ing.selected } : ing));
            };

            const addScannedToCart = async () => {
                const selected = scannedIngredients.filter(ing => ing.selected);
                if (selected.length === 0) { alert('× × ×œ×‘×—×•×¨ ×œ×¤×—×•×ª ××¨×›×™×‘ ××—×“'); return; }

                setScanningRecipe(true);
                try {
                    for (const ingredient of selected) {
                        let category = 'other';
                        for (const [cat, products] of Object.entries(PRODUCTS)) {
                            if (products.some(p => p.includes(ingredient.name) || ingredient.name.includes(p))) {
                                category = cat; break;
                            }
                        }

                        await window.firestore.addDoc(window.firestore.collection(window.db, 'shopping-items'), {
                            name: ingredient.name,
                            category: category,
                            quantity: ingredient.quantity,
                            purchased: false,
                            familyId: family.id,
                            listId: currentList.id,
                            addedBy: user.displayName || user.email,
                            addedByUid: user.uid,
                            note: 'ğŸ“· × ×¡×¨×§ ×××ª×›×•×Ÿ',
                            createdAt: new Date()
                        });
                    }

                    await logActivity('scanned_recipe_added', { count: selected.length });
                    recipeScanActiveRef.current = false;
                    setShowRecipeScan(false);
                    setShowRecipes(false);
                    setScannedIngredients([]);
                } catch (error) {
                    console.error('Error adding items:', error);
                    alert('×©×’×™××” ×‘×”×•×¡×¤×ª ×”××¨×›×™×‘×™×');
                } finally {
                    setScanningRecipe(false);
                }
            };

            // Save new recipe
            const saveRecipe = async () => {
                if (!newRecipeName.trim() || !newRecipeIngredients.trim()) {
                    alert('× × ×œ××œ× ×©× ××ª×›×•×Ÿ ×•×¨×©×™××ª ××¨×›×™×‘×™×');
                    return;
                }

                // Parse ingredients - split by newlines or commas
                const ingredients = newRecipeIngredients
                    .split(/[\n,]/)
                    .map(i => i.trim())
                    .filter(i => i.length > 0)
                    .map(i => {
                        // Try to parse quantity and item name
                        // Patterns like: "2 ×›×•×¡×•×ª ×§××—", "×§××— 2 ×›×•×¡×•×ª", "×—×œ×‘", "3 ×‘×™×¦×™×"
                        const match = i.match(/^(\d+\.?\d*)\s*(.+)$/) || i.match(/^(.+?)\s+(\d+\.?\d*).*$/);
                        if (match) {
                            const num = parseFloat(match[1]) || parseFloat(match[2]);
                            const name = match[2] || match[1];
                            if (!isNaN(num)) {
                                return { name: name.replace(/^\d+\.?\d*\s*/, '').trim(), quantity: Math.ceil(num) || 1 };
                            }
                        }
                        return { name: i, quantity: 1 };
                    });

                try {
                    await window.firestore.addDoc(window.firestore.collection(window.db, 'recipes'), {
                        name: newRecipeName.trim(),
                        ingredients: ingredients,
                        rawIngredients: newRecipeIngredients.trim(),
                        familyId: family.id,
                        createdBy: user.displayName || user.email,
                        createdByUid: user.uid,
                        createdAt: window.firestore.serverTimestamp()
                    });
                    setNewRecipeName('');
                    setNewRecipeIngredients('');
                    setShowAddRecipe(false);
                    await logActivity('recipe_added', { recipeName: newRecipeName.trim() });
                } catch (error) {
                    console.error('×©×’×™××” ×‘×©××™×¨×ª ××ª×›×•×Ÿ:', error);
                    alert('×©×’×™××” ×‘×©××™×¨×ª ×”××ª×›×•×Ÿ');
                }
            };

            // Delete recipe
            const deleteRecipe = async (recipeId, recipeName) => {
                if (!confirm(`×œ××—×•×§ ××ª ×”××ª×›×•×Ÿ "${recipeName}"?`)) return;
                try {
                    await window.firestore.deleteDoc(window.firestore.doc(window.db, 'recipes', recipeId));
                } catch (error) {
                    console.error('×©×’×™××” ×‘××—×™×§×ª ××ª×›×•×Ÿ:', error);
                }
            };

            // Add all recipe ingredients to shopping list
            const addRecipeToCart = async (recipe) => {
                setAddingRecipeItems(recipe.id);
                try {
                    for (const ingredient of recipe.ingredients) {
                        // Check if item already exists in current list
                        const existing = items.find(item =>
                            item.name.includes(ingredient.name) || ingredient.name.includes(item.name)
                        );

                        if (existing && !existing.purchased) {
                            // Update quantity
                            await window.firestore.updateDoc(
                                window.firestore.doc(window.db, 'shopping-items', existing.id),
                                {
                                    quantity: existing.quantity + ingredient.quantity,
                                    updatedAt: new Date(),
                                    updatedBy: user.displayName || user.email
                                }
                            );
                        } else {
                            // Find matching category from products
                            let category = 'other';
                            for (const [cat, products] of Object.entries(PRODUCTS)) {
                                if (products.some(p => p.includes(ingredient.name) || ingredient.name.includes(p))) {
                                    category = cat;
                                    break;
                                }
                            }

                            // Add new item
                            await window.firestore.addDoc(window.firestore.collection(window.db, 'shopping-items'), {
                                name: ingredient.name,
                                category: category,
                                quantity: ingredient.quantity,
                                purchased: false,
                                familyId: family.id,
                                listId: currentList.id,
                                addedBy: user.displayName || user.email,
                                addedByUid: user.uid,
                                note: `××ª×›×•×Ÿ: ${recipe.name}`,
                                createdAt: new Date()
                            });
                        }
                    }
                    await logActivity('recipe_added_to_cart', { recipeName: recipe.name, itemCount: recipe.ingredients.length });
                    setShowRecipes(false);
                } catch (error) {
                    console.error('×©×’×™××” ×‘×”×•×¡×¤×ª ××¨×›×™×‘×™ ××ª×›×•×Ÿ:', error);
                    alert('×©×’×™××” ×‘×”×•×¡×¤×ª ×”××¨×›×™×‘×™×');
                } finally {
                    setAddingRecipeItems(null);
                }
            };

            // Voice recognition functions
            const startListening = () => {
                if (isListening) return;

                // Stop any existing recognition
                if (recognitionRef.current) {
                    try { recognitionRef.current.abort(); } catch(e) {}
                }

                // Clear previous timeout
                if (voiceTimeoutRef.current) {
                    clearTimeout(voiceTimeoutRef.current);
                }

                setVoiceTranscript('');
                setVoiceStatus(voiceLang === 'en-US' ? 'Starting...' : '××ª×—×™×œ...');
                setIsListening(true);

                // Create fresh recognition instance
                const recognition = createRecognition();
                if (!recognition) {
                    setIsListening(false);
                    setVoiceStatus('×”×“×¤×“×¤×Ÿ ×œ× ×ª×•××š ×‘×–×™×”×•×™ ×§×•×œ');
                    return;
                }

                recognitionRef.current = recognition;

                try {
                    recognition.start();

                    // Auto-stop after 10 seconds if no result
                    voiceTimeoutRef.current = setTimeout(() => {
                        if (isListening) {
                            setVoiceStatus(voiceLang === 'en-US' ? 'Timeout - try again' : '×–××Ÿ ×”×”××–× ×” × ×’××¨ - × ×¡×” ×©×•×‘');
                            try { recognition.stop(); } catch(e) {}
                            setIsListening(false);
                        }
                    }, 10000);

                } catch (e) {
                    console.error('Failed to start recognition:', e);
                    setIsListening(false);
                    setVoiceStatus('×©×’×™××” ×‘×”×¤×¢×œ×ª ×–×™×”×•×™ ×§×•×œ: ' + e.message);
                }
            };

            const stopListening = () => {
                if (voiceTimeoutRef.current) {
                    clearTimeout(voiceTimeoutRef.current);
                }
                if (recognitionRef.current) {
                    try {
                        recognitionRef.current.stop();
                    } catch(e) {}
                }
                setIsListening(false);
                setVoiceStatus(voiceLang === 'en-US' ? 'Stopped' : '×”×•×¤×¡×§');
            };

            const processVoiceCommand = async (transcript, lang = 'he-IL') => {
                const text = transcript.trim().toLowerCase();
                if (!text) return;

                const isEnglish = lang === 'en-US';
                let itemPatterns;

                if (isEnglish) {
                    // Parse English - remove common phrases and split by "and", commas
                    itemPatterns = text
                        .replace(/add|buy|get|i need|i want|we need|please|some|the|a |an /gi, '')
                        .split(/\s*(?:,|and|&)\s*/)
                        .map(item => item.trim())
                        .filter(item => item.length > 1)
                        .map(item => translateToHebrew(item)); // Translate each item
                } else {
                    // Parse Hebrew - remove common phrases and split by "×•" (and), commas
                    itemPatterns = text
                        .replace(/×ª×•×¡×™×£|×”×•×¡×£|×¦×¨×™×š|×¦×¨×™×›×”|×§× ×”|×§× ×™|×ª×§× ×”|×ª×§× ×™|×× ×™ ×¨×•×¦×”|×× ×™ ×¦×¨×™×š|×× ×™ ×¦×¨×™×›×”/g, '')
                        .split(/\s*(?:,|×•(?:×’×)?|×•×’×)\s*/)
                        .map(item => item.trim())
                        .filter(item => item.length > 1);
                }

                if (itemPatterns.length === 0) {
                    // Try as single item
                    let singleItem;
                    if (isEnglish) {
                        singleItem = translateToHebrew(text.replace(/add|buy|get|i need|i want|we need|please|some|the|a |an /gi, '').trim());
                    } else {
                        singleItem = text.replace(/×ª×•×¡×™×£|×”×•×¡×£|×¦×¨×™×š|×¦×¨×™×›×”|×§× ×”|×§× ×™|×ª×§× ×”|×ª×§× ×™|×× ×™ ×¨×•×¦×”|×× ×™ ×¦×¨×™×š|×× ×™ ×¦×¨×™×›×”/g, '').trim();
                    }
                    if (singleItem.length > 1) {
                        itemPatterns.push(singleItem);
                    }
                }

                let addedCount = 0;
                for (const itemText of itemPatterns) {
                    // Try to find matching product in database
                    let matchedProduct = null;
                    let matchedCategory = 'other';

                    for (const [cat, products] of Object.entries(PRODUCTS)) {
                        const found = products.find(p =>
                            p.includes(itemText) || itemText.includes(p) ||
                            p.split(' ').some(word => itemText.includes(word) && word.length > 2)
                        );
                        if (found) {
                            matchedProduct = found;
                            matchedCategory = cat;
                            break;
                        }
                    }

                    const productName = matchedProduct || itemText;

                    // Check if already in list
                    const existing = items.find(item =>
                        item.name === productName ||
                        item.name.includes(itemText) ||
                        itemText.includes(item.name)
                    );

                    try {
                        if (existing && !existing.purchased) {
                            await window.firestore.updateDoc(
                                window.firestore.doc(window.db, 'shopping-items', existing.id),
                                { quantity: existing.quantity + 1, updatedAt: new Date() }
                            );
                        } else {
                            await window.firestore.addDoc(window.firestore.collection(window.db, 'shopping-items'), {
                                name: productName,
                                category: matchedCategory,
                                quantity: 1,
                                purchased: false,
                                familyId: family.id,
                                listId: currentList.id,
                                addedBy: user.displayName || user.email,
                                addedByUid: user.uid,
                                note: 'ğŸ¤ × ×•×¡×£ ×‘×§×•×œ',
                                createdAt: new Date()
                            });
                        }
                        addedCount++;
                    } catch (error) {
                        console.error('Error adding voice item:', error);
                    }
                }

                if (addedCount > 0) {
                    await logActivity('voice_items_added', { count: addedCount, transcript: transcript });
                    // Visual/audio feedback
                    if (navigator.vibrate) navigator.vibrate(100);
                }

                setVoiceTranscript('');
            };

            // Send chat message
            const sendChatMessage = async (text, photoUrl = null) => {
                if (!text.trim() && !photoUrl) return;
                try {
                    await window.firestore.addDoc(window.firestore.collection(window.db, 'family-chat'), {
                        text: text.trim(),
                        photoUrl: photoUrl,
                        senderName: user.displayName || user.email,
                        senderUid: user.uid,
                        familyId: family.id,
                        createdAt: window.firestore.serverTimestamp()
                    });
                    setChatInput('');
                    setCapturedPhoto(null);
                } catch (error) {
                    console.error('×©×’×™××” ×‘×©×œ×™×—×ª ×”×•×“×¢×”:', error);
                }
            };

            // Camera functions
            const startCamera = async () => {
                setShowCamera(true);
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({
                        video: { facingMode: 'environment' }
                    });
                    if (videoRef.current) {
                        videoRef.current.srcObject = stream;
                    }
                } catch (error) {
                    console.error('×©×’×™××” ×‘×¤×ª×™×—×ª ××¦×œ××”:', error);
                    alert('×œ× × ×™×ª×Ÿ ×œ×’×©×ª ×œ××¦×œ××”');
                    setShowCamera(false);
                }
            };

            const capturePhoto = () => {
                if (videoRef.current && canvasRef.current) {
                    const canvas = canvasRef.current;
                    const video = videoRef.current;
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(video, 0, 0);
                    const photoData = canvas.toDataURL('image/jpeg', 0.8);
                    setCapturedPhoto(photoData);
                    stopCamera();
                }
            };

            const stopCamera = () => {
                if (videoRef.current && videoRef.current.srcObject) {
                    const tracks = videoRef.current.srcObject.getTracks();
                    tracks.forEach(track => {
                        track.stop();
                        track.enabled = false;
                    });
                    videoRef.current.srcObject = null;
                }
                setShowCamera(false);
            };

            // Handle receipt photo capture
            const handleReceiptCapture = async (e) => {
                const file = e.target.files?.[0];
                if (!file) return;

                setUploadingReceipt(true);
                try {
                    // Compress and convert to base64
                    const reader = new FileReader();
                    reader.onload = async (event) => {
                        const img = new Image();
                        img.onload = () => {
                            // Create canvas for compression
                            const canvas = document.createElement('canvas');
                            const maxSize = 800;
                            let width = img.width;
                            let height = img.height;

                            // Scale down if too large
                            if (width > height && width > maxSize) {
                                height = (height * maxSize) / width;
                                width = maxSize;
                            } else if (height > maxSize) {
                                width = (width * maxSize) / height;
                                height = maxSize;
                            }

                            canvas.width = width;
                            canvas.height = height;
                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(img, 0, 0, width, height);

                            // Get compressed base64
                            const compressedData = canvas.toDataURL('image/jpeg', 0.7);
                            setReceiptPhoto(compressedData);
                            setUploadingReceipt(false);
                        };
                        img.src = event.target.result;
                    };
                    reader.readAsDataURL(file);
                } catch (error) {
                    console.error('Error processing receipt:', error);
                    setUploadingReceipt(false);
                    alert('×©×’×™××” ×‘×¢×™×‘×•×“ ×”×ª××•× ×”');
                }

                // Clear the input
                e.target.value = '';
            };

            // Enhanced toggle purchased with animation
            const togglePurchasedWithAnimation = async (id, currentStatus, event) => {
                if (!currentStatus) {
                    // Adding to purchased - show confetti!
                    const rect = event?.currentTarget?.getBoundingClientRect();
                    if (rect) {
                        setConfetti({ x: rect.left + rect.width / 2, y: rect.top + rect.height / 2 });
                        setTimeout(() => setConfetti(null), 600);
                    }
                    setAnimatingItems(prev => new Set([...prev, id]));
                    setTimeout(() => {
                        setAnimatingItems(prev => {
                            const newSet = new Set(prev);
                            newSet.delete(id);
                            return newSet;
                        });
                    }, 400);
                }
                await togglePurchased(id, currentStatus);
            };

            const handleLogout = async () => {
                try {
                    await window.firebaseAuth.signOut(window.auth);
                } catch (error) {
                    console.error('×©×’×™××” ×‘×”×ª× ×ª×§×•×ª:', error);
                }
            };

            const toggleDarkMode = () => {
                const newMode = !darkMode;
                setDarkMode(newMode);
                localStorage.setItem('darkMode', String(newMode));
                document.documentElement.classList.toggle('dark');
            };

            // Calendar helper functions
            const getCalendarDays = (date) => {
                const year = date.getFullYear();
                const month = date.getMonth();
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const daysInMonth = lastDay.getDate();
                const startingDay = firstDay.getDay();

                const days = [];
                // Add empty cells for days before the first day of the month
                for (let i = 0; i < startingDay; i++) {
                    days.push(null);
                }
                // Add days of the month
                for (let i = 1; i <= daysInMonth; i++) {
                    days.push(new Date(year, month, i));
                }
                return days;
            };

            const getHolidayForDate = (date) => {
                if (!date) return null;
                return ISRAELI_HOLIDAYS.find(h => {
                    const hDate = h.dateObj;
                    return hDate.getDate() === date.getDate() &&
                           hDate.getMonth() === date.getMonth() &&
                           hDate.getFullYear() === date.getFullYear();
                });
            };

            const formatDateForGoogle = (date) => {
                return date.toISOString().replace(/-|:|\.\d+/g, '').slice(0, 8);
            };

            const addToGoogleCalendar = (holiday, daysBefore = 7) => {
                const reminderDate = new Date(holiday.dateObj);
                reminderDate.setDate(reminderDate.getDate() - daysBefore);

                const endDate = new Date(reminderDate);
                endDate.setDate(endDate.getDate() + 1);

                const title = encodeURIComponent(`ğŸ›’ ×§× ×™×•×ª ×œ×¤× ×™ ${holiday.name}`);
                const details = encodeURIComponent(`${holiday.reminder}\n\n×ª×–×›×•×¨×ª ×××¤×œ×™×§×¦×™×™×ª ShopSmart`);
                const startStr = formatDateForGoogle(reminderDate);
                const endStr = formatDateForGoogle(endDate);

                const url = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${title}&dates=${startStr}/${endStr}&details=${details}`;
                window.open(url, '_blank');
            };

            const downloadICSFile = (holiday, daysBefore = 7) => {
                const reminderDate = new Date(holiday.dateObj);
                reminderDate.setDate(reminderDate.getDate() - daysBefore);

                const formatICSDate = (d) => d.toISOString().replace(/-|:|\.\d+/g, '').slice(0, 8);

                const endDate = new Date(reminderDate);
                endDate.setDate(endDate.getDate() + 1);

                const icsContent = `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//ShopSmart//Shopping Reminder//HE
BEGIN:VEVENT
DTSTART;VALUE=DATE:${formatICSDate(reminderDate)}
DTEND;VALUE=DATE:${formatICSDate(endDate)}
SUMMARY:ğŸ›’ ×§× ×™×•×ª ×œ×¤× ×™ ${holiday.name}
DESCRIPTION:${holiday.reminder}\\n\\n×ª×–×›×•×¨×ª ×××¤×œ×™×§×¦×™×™×ª ShopSmart
END:VEVENT
END:VCALENDAR`;

                const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `shopping-reminder-${holiday.name}.ics`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            };

            const HEBREW_MONTHS = ['×™× ×•××¨', '×¤×‘×¨×•××¨', '××¨×¥', '××¤×¨×™×œ', '×××™', '×™×•× ×™', '×™×•×œ×™', '××•×’×•×¡×˜', '×¡×¤×˜××‘×¨', '××•×§×˜×•×‘×¨', '× ×•×‘××‘×¨', '×“×¦××‘×¨'];
            const HEBREW_DAYS = ['××³', '×‘×³', '×’×³', '×“×³', '×”×³', '×•×³', '×©×³'];

            // Smart category detection with partial matching
            const detectCategory = (productName) => {
                const name = productName.trim().toLowerCase();

                // First try exact match
                for (const [cat, products] of Object.entries(PRODUCTS)) {
                    if (products.some(p => p === productName || p.toLowerCase() === name)) {
                        return cat;
                    }
                }

                // Then try partial match - product name contains or is contained in known product
                for (const [cat, products] of Object.entries(PRODUCTS)) {
                    if (products.some(p => p.includes(productName) || productName.includes(p) ||
                        p.toLowerCase().includes(name) || name.includes(p.toLowerCase()))) {
                        return cat;
                    }
                }

                // Keyword-based detection for common items
                const keywords = {
                    fruits: ['×ª×¤×•×—', '×‘× × ', '×¢×’×‘× ×™', '××œ×¤×¤×•×Ÿ', '×’×–×¨', '×‘×¦×œ', '×©×•×', '×¤×œ×¤×œ', '×—×¡', '×™×¨×§', '×¤×¨×™', '×œ×™××•×Ÿ', '×ª×¤×•×–', '×¢× ×‘', '××‘×•×§×“×•', '×ª×•×ª', '××‘×˜×™×—', '××œ×•×Ÿ', '×ª×¤×•"×', '×ª×¤×•×', '×‘×˜×˜×”', '×§×™×©×•×', '×—×¦×™×œ', '×‘×¨×•×§×•×œ×™', '×›×¨×•×‘', '×¡×œ×§', '×¤×˜×¨×™×•×ª'],
                    meat: ['×‘×©×¨', '×¢×•×£', '×—×–×”', '×©× ×™×¦×œ', '×›×¨×¢×™×™×', '×›× ×¤×™×™×', '×¡×œ××•×Ÿ', '×“×’', '×˜×•× ×”', '×¤×™×œ×”', '×§×¦×™×¦', '×”××‘×•×¨×’×¨', '× ×§× ×™×§', '×× ×˜×¨×™×§×•×˜', '×¦×œ×¢×•×ª', '×˜×—×•×Ÿ', '×›×‘×“', '×”×•×“×•'],
                    dairy: ['×—×œ×‘', '×’×‘×™× ', '×™×•×’×•×¨×˜', '×‘×™×¦', '×§×•×˜×’', '×©×× ×ª', '×—×××”', '×œ×‘×Ÿ', '××•×¦×¨×œ×”', '×¦×¤×ª×™×ª'],
                    bakery: ['×œ×—×', '×—×œ×”', '×¤×™×ª×”', '×œ×—×× ×™', '×‘×’×˜', '×¢×•×’×™', '×§×¨×•××¡×•×Ÿ', '×××¤×”', '×‘×•×¨×§×¡'],
                    drinks: ['××™×', '×§×•×œ×”', '×¤×¤×¡×™', '××™×¥', '×¡×•×“×”', '×¡×¤×¨×™×™×˜', '×¤×× ×˜×”', '××©×§×”'],
                    wine: ['×™×™×Ÿ', '×‘×™×¨×”', '×•×•×“×§×”', '×•×•×™×¡×§×™', '×¢×¨×§', '×©××¤× ×™×”', '××œ×›×•×”×•×œ'],
                    cleaning: ['× ×™×™×¨ ×˜×•××œ×˜', '××§×•× ×•××™×§×”', '×¡×‘×•×Ÿ ×›×œ×™×', '××‘×§×ª ×›×‘×™×¡×”', '×× ×§×”', '×©×§×™×•×ª ××©×¤×”', '×¡×¤×•×’', '××˜×œ×™×ª'],
                    spices: ['××œ×—', '×¤×œ×¤×œ', '×¤×¤×¨×™×§×”', '×›×•×¨×›×•×', '×§×™× ××•×Ÿ', '××•×¨×’× ×•', '×‘×–×™×œ×™×§×•×', '×ª×‘×œ×™×Ÿ', '×¡×•×›×¨', '×§××—'],
                    canned: ['××•×¨×–', '×¤×¡×˜×”', '×©×™××•×¨', '×˜×•× ×”', '×ª×™×¨×¡', '×–×™×ª', '×¨×¡×§', '×©××Ÿ', '×—×•××•×¡', '×˜×—×™× ×”', '×¨×™×‘×”', '×“×‘×©'],
                    snacks: ['×‘××‘×”', '×‘×™×¡×œ×™', '×©×•×§×•×œ×“', '×—×˜×™×£', '×¢×•×’×™×•×ª', '×××ª×§', '×¦\'×™×¤×¡', '×¤×•×¤×§×•×¨×Ÿ'],
                    frozen: ['×’×œ×™×“×”', '×§×¤×•×', '×©×œ×’×•×Ÿ', '××¨×˜×™×§', '×‘×¦×§'],
                    hygiene: ['×©××¤×•', '×¡×‘×•×Ÿ', '××©×—×ª ×©×™× ×™×™×', '×“××•×“×•×¨× ×˜', '××‘×¨×©×ª', '××’×‘×•×Ÿ', '×§×¨×'],
                    coffee: ['×§×¤×”', '×ª×”', '× ×¡', '×§×¤×¡×•×œ'],
                    baby: ['×—×™×ª×•×œ', '×ª×™× ×•×§', '×¤××¤×¨×¡'],
                    pets: ['×›×œ×‘', '×—×ª×•×œ', '××–×•×Ÿ ×œ×—×™×•×ª']
                };

                for (const [cat, words] of Object.entries(keywords)) {
                    if (words.some(word => name.includes(word) || productName.includes(word))) {
                        return cat;
                    }
                }

                return 'canned'; // Default fallback to general groceries
            };

            // Check if product is a cheese that should be in grams
            const isCheeseInGrams = (productName) => {
                const cheeseKeywords = [
                    '×’×‘×™× ×” ×¦×”×•×‘×”', '×¦×”×•×‘×”', '×©×× ×ª', '×‘×•×œ×’×¨×™×ª', '×¤×¨××–×Ÿ', '×¦×¤×ª×™×ª',
                    '×§×©×§×‘×œ', '×¨×•×§×¤×•×¨', '×’××•×“×”', '×‘×¨×™', '××× ×˜×œ', '×—×œ×•××™', '×’×‘×™× ×ª ×©×× ×ª',
                    '××•×¦×¨×œ×”', '×§×××‘×¨', '×¢××§', '×’×œ×‘×•×¢', '×¤×™×œ×“×œ×¤×™×”', '×œ××‘× ×”', '×¨×™×§×•×˜×”',
                    '××¡×§×¨×¤×•× ×”', '×’×‘×™× ×ª ×¢×–×™×', '×’×‘×™× ×” ×œ×‘× ×”'
                ];
                const nameLower = productName.toLowerCase();
                return cheeseKeywords.some(cheese => nameLower.includes(cheese));
            };

            // Open quantity selector before adding product
            const addProduct = (product) => {
                const category = selectedCategory || detectCategory(product);
                let unit = CATEGORIES[category]?.unit || '×™×—\'';
                const unitOptions = CATEGORIES[category]?.unitOptions || ['×™×—\''];

                // Override unit for cheese products to grams
                if (category === 'dairy' && isCheeseInGrams(product)) {
                    unit = '×’×¨×';
                }

                setSelectedProduct({ name: product, category, unitOptions });
                setSelectedQuantity(1); // Always start at 1, user can adjust
                setSelectedUnit(unit);
                setShowQuantitySelector(true);
            };

            // Actually add product with selected quantity
            const addProductWithQuantity = async () => {
                if (!selectedProduct) return;

                try {
                    const { name: product, category } = selectedProduct;
                    const existing = items.find(item => item.name === product && !item.purchased);

                    if (existing) {
                        // Add to existing quantity
                        let newQty;
                        if (typeof existing.quantity === 'string') {
                            const numMatch = existing.quantity.match(/^([\d.]+)/);
                            if (numMatch) {
                                const num = parseFloat(numMatch[1]) + selectedQuantity;
                                newQty = `${num} ${selectedUnit}`;
                            } else {
                                newQty = `${selectedQuantity + 1} ${selectedUnit}`;
                            }
                        } else {
                            newQty = `${(existing.quantity || 0) + selectedQuantity} ${selectedUnit}`;
                        }

                        const updateData = {
                                quantity: newQty,
                                unit: selectedUnit,
                                updatedAt: new Date(),
                                updatedBy: user.displayName || user.email
                            };
                        if (selectedNote) {
                            updateData.note = existing.note ? `${existing.note}, ${selectedNote}` : selectedNote;
                        }
                        await window.firestore.updateDoc(
                            window.firestore.doc(window.db, 'shopping-items', existing.id),
                            updateData
                        );
                        await logActivity('quantity_changed', { itemName: product });
                    } else {
                        await window.firestore.addDoc(window.firestore.collection(window.db, 'shopping-items'), {
                            name: product,
                            category: category,
                            quantity: `${selectedQuantity} ${selectedUnit}`,
                            unit: selectedUnit,
                            purchased: false,
                            familyId: family.id,
                            listId: currentList.id,
                            addedBy: user.displayName || user.email,
                            addedByUid: user.uid,
                            note: selectedNote || '',
                            createdAt: new Date()
                        });
                        await logActivity('item_added', { itemName: product });
                    }

                    setSearchTerm('');
                    setShowQuantitySelector(false);
                    setSelectedNote('');
                    setSelectedProduct(null);
                } catch (error) {
                    console.error('×©×’×™××” ×‘×”×•×¡×¤×ª ××•×¦×¨:', error);
                    alert('×©×’×™××” ×‘×”×•×¡×¤×ª ×”××•×¦×¨. × ×¡×” ×©×•×‘.');
                }
            };

            const togglePurchased = async (id, currentStatus) => {
                try {
                    const item = items.find(i => i.id === id);

                    // Conflict detection: Check if item was already marked by someone else
                    const docRef = window.firestore.doc(window.db, 'shopping-items', id);
                    const freshDoc = await window.firestore.getDoc(docRef);

                    if (freshDoc.exists()) {
                        const freshData = freshDoc.data();

                        // If someone else already marked it as purchased
                        if (!currentStatus && freshData.purchased && freshData.purchasedBy !== (user.displayName || user.email)) {
                            // Auto-unified: item already purchased by someone else
                            console.log(`Smart conflict resolved: ${item?.name} already marked by ${freshData.purchasedBy}`);
                            return; // No need to update, already done
                        }
                    }

                    await window.firestore.updateDoc(docRef, {
                        purchased: !currentStatus,
                        purchasedBy: !currentStatus ? (user.displayName || user.email) : null,
                        purchasedByUid: !currentStatus ? user.uid : null,
                        purchasedAt: !currentStatus ? new Date() : null
                    });

                    if (!currentStatus && item) {
                        await logActivity('item_purchased', { itemName: item.name });
                    }
                } catch (error) {
                    console.error('×©×’×™××” ×‘×¢×“×›×•×Ÿ ××•×¦×¨:', error);
                }
            };

            const updateQuantity = async (id, newQuantity) => {
                try {
                    if (newQuantity < 1) {
                        setShowDeleteConfirm(id);
                    } else {
                        const item = items.find(i => i.id === id);
                        await window.firestore.updateDoc(window.firestore.doc(window.db, 'shopping-items', id), {
                            quantity: newQuantity,
                            updatedAt: new Date(),
                            updatedBy: user.displayName || user.email
                        });
                        if (item) {
                            await logActivity('quantity_changed', { itemName: item.name });
                        }
                    }
                } catch (error) {
                    console.error('×©×’×™××” ×‘×¢×“×›×•×Ÿ ×›××•×ª:', error);
                }
            };

            // Inline edit item name
            const startEditingItem = (item) => {
                setEditingItemId(item.id);
                setEditingItemName(item.name);
            };

            const saveItemName = async () => {
                if (!editingItemId || !editingItemName.trim()) {
                    setEditingItemId(null);
                    return;
                }
                try {
                    await window.firestore.updateDoc(window.firestore.doc(window.db, 'shopping-items', editingItemId), {
                        name: editingItemName.trim(),
                        updatedAt: new Date(),
                        updatedBy: user.displayName || user.email
                    });
                } catch (error) {
                    console.error('×©×’×™××” ×‘×¢×“×›×•×Ÿ ×©×:', error);
                }
                setEditingItemId(null);
            };

            const deleteItem = async (id) => {
                try {
                    const item = items.find(i => i.id === id);
                    await window.firestore.deleteDoc(window.firestore.doc(window.db, 'shopping-items', id));
                    setShowDeleteConfirm(null);
                    if (item) {
                        await logActivity('item_deleted', { itemName: item.name });
                        // Track as forgotten if wasn't purchased
                        if (!item.purchased) {
                            await trackForgottenItem(item.name);
                        }
                    }
                } catch (error) {
                    console.error('×©×’×™××” ×‘××—×™×§×ª ××•×¦×¨:', error);
                }
            };

            // Postpone item - moves it to the end of the list
            const postponeItem = async (id) => {
                try {
                    const item = items.find(i => i.id === id);
                    await window.firestore.updateDoc(window.firestore.doc(window.db, 'shopping-items', id), {
                        postponedAt: new Date(),
                        postponedBy: user.displayName || user.email
                    });
                    if (item) {
                        await logActivity('item_postponed', { itemName: item.name });
                        // Track as forgotten
                        if (!item.purchased) {
                            await trackForgottenItem(item.name);
                        }
                    }
                } catch (error) {
                    console.error('×©×’×™××” ×‘×“×—×™×™×ª ××•×¦×¨:', error);
                }
            };

            // Track forgotten items
            const trackForgottenItem = async (itemName) => {
                try {
                    const monthKey = new Date().toISOString().slice(0, 7); // YYYY-MM
                    const docRef = window.firestore.doc(window.db, 'forgotten-stats', `${family.id}_${monthKey}`);
                    const docSnap = await window.firestore.getDoc(docRef);

                    if (docSnap.exists()) {
                        const data = docSnap.data();
                        const items = data.items || {};
                        items[itemName] = (items[itemName] || 0) + 1;
                        await window.firestore.updateDoc(docRef, { items, updatedAt: new Date() });
                    } else {
                        await window.firestore.setDoc(docRef, {
                            familyId: family.id,
                            month: monthKey,
                            items: { [itemName]: 1 },
                            createdAt: new Date(),
                            updatedAt: new Date()
                        });
                    }
                } catch (error) {
                    console.error('Error tracking forgotten item:', error);
                }
            };

            const updateItemNote = async (itemId, note) => {
                try {
                    const item = items.find(i => i.id === itemId);
                    await window.firestore.updateDoc(window.firestore.doc(window.db, 'shopping-items', itemId), {
                        note: note,
                        updatedAt: new Date(),
                        updatedBy: user.displayName || user.email
                    });
                    if (item && note) {
                        await logActivity('note_added', { itemName: item.name });
                    }
                } catch (error) {
                    console.error('×©×’×™××” ×‘×¢×“×›×•×Ÿ ×”×¢×¨×”:', error);
                }
            };

            const finishShopping = async () => {
                if (!totalAmount || parseFloat(totalAmount) <= 0) {
                    alert('× × ×œ×”×–×™×Ÿ ×¡×›×•× ×ª×§×™×Ÿ');
                    return;
                }

                const purchasedItems = items.filter(item => item.purchased);
                const unpurchasedItems = items.filter(item => !item.purchased);

                if (purchasedItems.length === 0) {
                    alert('×œ× × ×‘×—×¨×• ××•×¦×¨×™× ×©× ×§× ×•');
                    return;
                }

                try {
                    // Track forgotten items (unpurchased items left behind)
                    const hadForgottenItems = unpurchasedItems.length > 0;
                    for (const item of unpurchasedItems) {
                        await trackForgottenItem(item.name);
                    }

                    await window.firestore.addDoc(window.firestore.collection(window.db, 'shopping-history'), {
                        items: purchasedItems,
                        totalAmount: parseFloat(totalAmount),
                        completedAt: new Date(),
                        completedBy: user.displayName || user.email,
                        completedByUid: user.uid,
                        familyId: family.id,
                        listId: currentList.id,
                        forgottenCount: unpurchasedItems.length,
                        receiptPhoto: receiptPhoto || null
                    });

                    for (const item of purchasedItems) {
                        await window.firestore.deleteDoc(window.firestore.doc(window.db, 'shopping-items', item.id));
                    }

                    // Update shopping streak
                    await updateShoppingStreak(hadForgottenItems);

                    setShowFinishShopping(false);
                    setTotalAmount('');
                    setReceiptPhoto(null);
                    loadHistory();

                    // Show achievement celebration if perfect shopping
                    if (!hadForgottenItems) {
                        setTimeout(() => {
                            alert('ğŸ‰ ×§× ×™×™×” ××•×©×œ××ª! ×œ× ×©×›×—×ª ×›×œ×•×!');
                        }, 500);
                    }
                } catch (error) {
                    console.error('×©×’×™××” ×‘×¡×™×•× ×§× ×™×™×”:', error);
                    alert('×©×’×™××” ×‘×©××™×¨×ª ×”×§× ×™×™×”. × ×¡×” ×©×•×‘.');
                }
            };

            const exportToWhatsApp = () => {
                const unpurchased = items.filter(item => !item.purchased);
                let text = 'ğŸ›’ ×¨×©×™××ª ×§× ×™×•×ª:\n\n';
                Object.entries(CATEGORIES).forEach(([key, cat]) => {
                    const categoryItems = unpurchased.filter(item => item.category === key);
                    if (categoryItems.length > 0) {
                        text += `${cat.icon} ${cat.name}:\n`;
                        categoryItems.forEach(item => {
                            text += `  âœ“ ${item.name} (${item.quantity})\n`;
                        });
                        text += '\n';
                    }
                });
                window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
            };

            if (loading) {
                return (
                    <div className="min-h-screen gradient-bg flex items-center justify-center">
                        <div className="text-center">
                            <div className="text-6xl mb-4 float">ğŸ›’</div>
                            <div className="text-xl text-white font-medium">×˜×•×¢×Ÿ...</div>
                            <div className="mt-4 w-32 h-1 bg-white/20 rounded-full overflow-hidden mx-auto">
                                <div className="h-full w-1/2 progress-animate rounded-full"></div>
                            </div>
                        </div>
                    </div>
                );
            }

            const filteredItems = items;
            const groupedItems = filteredItems.reduce((acc, item) => {
                if (!acc[item.category]) acc[item.category] = [];
                acc[item.category].push(item);
                return acc;
            }, {});

            const totalItems = items.reduce((sum, item) => sum + item.quantity, 0);
            const purchasedCount = items.filter(item => item.purchased).reduce((sum, item) => sum + item.quantity, 0);

            // WCAG 4.1.3 - Announce status messages to screen readers
            const announceToScreenReader = (message, priority = 'polite') => {
                const region = document.getElementById(priority === 'assertive' ? 'aria-live-assertive' : 'aria-live-region');
                if (region) {
                    region.textContent = '';
                    setTimeout(() => { region.textContent = message; }, 100);
                }
            };

            return (
                <div className="min-h-screen gradient-bg p-4 pb-20" role="application" aria-label="ShopSmart - ×¨×©×™××ª ×§× ×™×•×ª">
                    {/* Main content landmark for skip link */}
                    <main id="main-content" role="main" aria-label="×ª×•×›×Ÿ ×¨××©×™">

                    {showDeleteConfirm && (
                        <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                            <div className="glass rounded-3xl p-8 max-w-sm w-full shadow-2xl">
                                <div className="text-5xl text-center mb-4">ğŸ—‘ï¸</div>
                                <h2 className="text-xl font-bold text-center text-gradient mb-2">××—×™×§×ª ××•×¦×¨</h2>
                                <p className="text-gray-600 dark:text-gray-300 mb-6 text-center">×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××•×¦×¨ ×–×”?</p>
                                <div className="flex gap-3">
                                    <button onClick={() => deleteItem(showDeleteConfirm)}
                                        className="flex-1 bg-gradient-to-r from-red-500 to-pink-500 text-white px-6 py-3 rounded-xl hover:shadow-lg hover:scale-105 font-semibold transition-all">
                                        ××—×§
                                    </button>
                                    <button onClick={() => setShowDeleteConfirm(null)}
                                        className="flex-1 px-6 py-3 glass border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-700 hover:scale-105 transition-all">
                                        ×‘×™×˜×•×œ
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Import from WhatsApp Modal */}
                    {showImportWhatsApp && (
                        <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                            <div className="glass rounded-3xl p-6 max-w-md w-full shadow-2xl">
                                <div className="text-4xl text-center mb-3">ğŸ“±</div>
                                <h2 className="text-xl font-bold text-center text-gradient mb-2">×™×‘×•× ××•×•×˜×¡××¤</h2>
                                <p className="text-gray-500 dark:text-gray-400 text-sm text-center mb-4">×”×¢×ª×§ ×¨×©×™××ª ×§× ×™×•×ª ××•×•×˜×¡××¤ ×•×”×“×‘×§ ×›××Ÿ</p>
                                <textarea
                                    value={whatsAppText}
                                    onChange={e => setWhatsAppText(e.target.value)}
                                    placeholder="×—×œ×‘&#10;×‘×™×¦×™× x2&#10;3 ×œ×—×&#10;×’×‘×™× ×”, ×—×××”"
                                    className="w-full px-4 py-3 border-2 border-gray-200 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800 dark:text-white min-h-[150px] mb-4 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-100 transition-all text-sm"
                                    dir="rtl"
                                />
                                <div className="text-xs text-gray-400 dark:text-gray-500 mb-4">
                                    × ×ª××š: ×©×•×¨×•×ª × ×¤×¨×“×•×ª, ×¤×¡×™×§×™×, ××¡×¤×¨×™× (2 ×—×œ×‘ ××• ×—×œ×‘ x2)
                                </div>
                                <div className="flex gap-3">
                                    <button
                                        onClick={importFromWhatsApp}
                                        className="flex-1 btn-gradient text-white py-3 rounded-xl font-semibold hover:shadow-lg transition-all"
                                    >
                                        ×™×‘× ×œ×¨×©×™××”
                                    </button>
                                    <button
                                        onClick={() => { setShowImportWhatsApp(false); setWhatsAppText(''); }}
                                        className="px-6 py-3 rounded-xl bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 font-medium hover:bg-gray-200 dark:hover:bg-gray-600 transition-all"
                                    >
                                        ×‘×™×˜×•×œ
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Saved Lists Modal */}
                    {showSavedLists && (
                        <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                            <div className="glass rounded-3xl p-6 max-w-md w-full shadow-2xl max-h-[80vh] overflow-y-auto">
                                <div className="text-4xl text-center mb-3">ğŸ“‹</div>
                                <h2 className="text-xl font-bold text-center text-gradient mb-4">×¨×©×™××•×ª ×©××•×¨×•×ª</h2>
                                {savedLists.length === 0 ? (
                                    <div className="text-center py-8">
                                        <div className="text-5xl mb-3">ğŸ“</div>
                                        <p className="text-gray-500 dark:text-gray-400">××™×Ÿ ×¨×©×™××•×ª ×©××•×¨×•×ª</p>
                                        <p className="text-xs text-gray-400 dark:text-gray-500 mt-1">×œ×—×¥ ×¢×œ "×©××•×¨ ×¨×©×™××”" ×œ×©××™×¨×ª ×”×¨×©×™××” ×”× ×•×›×—×™×ª</p>
                                    </div>
                                ) : (
                                    <div className="space-y-3 mb-4">
                                        {savedLists.map(list => (
                                            <div
                                                key={list.id}
                                                className="bg-white dark:bg-gray-800 p-4 rounded-xl border border-gray-100 dark:border-gray-700"
                                            >
                                                <div className="flex items-center justify-between mb-2">
                                                    <span className="font-semibold text-gray-800 dark:text-white">{list.name}</span>
                                                    <span className="text-xs text-gray-400">{list.items.length} ×¤×¨×™×˜×™×</span>
                                                </div>
                                                <div className="text-xs text-gray-500 dark:text-gray-400 mb-3 truncate">
                                                    {list.items.slice(0, 5).map(i => i.name).join(', ')}
                                                    {list.items.length > 5 && '...'}
                                                </div>
                                                <button
                                                    onClick={() => loadSavedList(list)}
                                                    className="w-full py-2 bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 rounded-lg font-medium hover:bg-indigo-100 dark:hover:bg-indigo-900/50 transition-all text-sm"
                                                >
                                                    ×˜×¢×Ÿ ×œ×¢×’×œ×”
                                                </button>
                                            </div>
                                        ))}
                                    </div>
                                )}
                                <button
                                    onClick={() => setShowSavedLists(false)}
                                    className="w-full py-3 rounded-xl bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 font-medium hover:bg-gray-200 dark:hover:bg-gray-600 transition-all"
                                >
                                    ×¡×’×•×¨
                                </button>
                            </div>
                        </div>
                    )}

                    {/* AI Assistant Modal */}
                    {showAIAssistant && (
                        <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                            <div className="glass rounded-3xl p-6 max-w-lg w-full shadow-2xl max-h-[85vh] overflow-y-auto">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold flex items-center gap-3 text-gradient">
                                        <span className="text-3xl">ğŸ¤–</span>
                                        ×¢×•×–×¨ ×§× ×™×•×ª ×—×›×
                                    </h2>
                                    <button onClick={() => setShowAIAssistant(false)} className="w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center hover:bg-gray-200 dark:hover:bg-gray-600 transition-all">âœ•</button>
                                </div>

                                {aiThinking ? (
                                    <div className="text-center py-12">
                                        <div className="text-6xl mb-4 animate-bounce">ğŸ¤”</div>
                                        <p className="text-lg text-gray-600 dark:text-gray-300 font-medium">AI ×—×•×©×‘...</p>
                                        <p className="text-sm text-gray-400 dark:text-gray-500 mt-2">×× ×ª×— ××ª ×”×¨×©×™××” ×•××›×™×Ÿ ×”×¦×¢×•×ª</p>
                                        <div className="mt-4 flex justify-center gap-1">
                                            <div className="w-2 h-2 bg-violet-500 rounded-full animate-bounce" style={{animationDelay: '0ms'}}></div>
                                            <div className="w-2 h-2 bg-violet-500 rounded-full animate-bounce" style={{animationDelay: '150ms'}}></div>
                                            <div className="w-2 h-2 bg-violet-500 rounded-full animate-bounce" style={{animationDelay: '300ms'}}></div>
                                        </div>
                                    </div>
                                ) : aiSuggestions.length === 0 ? (
                                    <div className="text-center py-12">
                                        <div className="text-6xl mb-4">ğŸ‰</div>
                                        <p className="text-lg text-gray-600 dark:text-gray-300 font-medium">×”×¨×©×™××” ×©×œ×š × ×¨××™×ª ××•×©×œ××ª!</p>
                                        <p className="text-sm text-gray-400 dark:text-gray-500 mt-2">××™×Ÿ ×œ×™ ×”×¦×¢×•×ª × ×•×¡×¤×•×ª ×›×¨×’×¢</p>
                                        <button
                                            onClick={generateAISuggestions}
                                            className="mt-6 px-6 py-3 bg-violet-100 dark:bg-violet-900/50 text-violet-700 dark:text-violet-300 rounded-xl font-medium hover:bg-violet-200 transition-all"
                                        >
                                            ğŸ”„ × ×¡×” ×©×•×‘
                                        </button>
                                    </div>
                                ) : (
                                    <div className="space-y-3">
                                        <p className="text-sm text-gray-500 dark:text-gray-400 mb-4">
                                            ×‘×”×ª×‘×¡×¡ ×¢×œ ×”×¨×©×™××” ×©×œ×š, ×”× ×” ×›××” ×”×¦×¢×•×ª:
                                        </p>
                                        {aiSuggestions.map((suggestion, idx) => (
                                            <div
                                                key={idx}
                                                className={`p-4 rounded-xl border-2 transition-all ${
                                                    suggestion.isRecipe
                                                        ? 'bg-gradient-to-r from-amber-50 to-orange-50 dark:from-amber-900/20 dark:to-orange-900/20 border-amber-300 dark:border-amber-700'
                                                        : 'bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-violet-400 dark:hover:border-violet-500'
                                                }`}
                                            >
                                                <div className="flex items-center justify-between">
                                                    <div className="flex items-center gap-3">
                                                        <span className="text-2xl">{suggestion.icon}</span>
                                                        <div>
                                                            <p className="font-bold text-gray-800 dark:text-white">{suggestion.name}</p>
                                                            <p className="text-xs text-gray-500 dark:text-gray-400">{suggestion.reason}</p>
                                                        </div>
                                                    </div>
                                                    {!suggestion.isRecipe && (
                                                        <button
                                                            onClick={() => addAISuggestion(suggestion)}
                                                            className="px-4 py-2 bg-violet-500 text-white rounded-xl text-sm font-medium hover:bg-violet-600 transition-all"
                                                        >
                                                            â• ×”×•×¡×£
                                                        </button>
                                                    )}
                                                </div>
                                            </div>
                                        ))}

                                        <div className="flex gap-3 mt-6">
                                            <button
                                                onClick={generateAISuggestions}
                                                className="flex-1 py-3 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 rounded-xl font-medium hover:bg-gray-200 dark:hover:bg-gray-600 transition-all"
                                            >
                                                ğŸ”„ ×”×¦×¢×•×ª ×—×“×©×•×ª
                                            </button>
                                            <button
                                                onClick={() => setShowAIAssistant(false)}
                                                className="flex-1 py-3 btn-gradient text-white rounded-xl font-medium"
                                            >
                                                âœ“ ×¡×™×™××ª×™
                                            </button>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}

                    {/* Price Comparison Scanner Modal */}
                    {showPriceScanner && (
                        <div className="fixed inset-0 bg-black/95 flex flex-col z-50">
                            {/* Header */}
                            <div className="p-4 flex items-center justify-between">
                                <button onClick={stopPriceScanner} className="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center text-white text-xl hover:bg-white/20 transition-all">âœ•</button>
                                <h2 className="text-white font-bold text-lg">ğŸ” ×”×©×•×•××ª ××—×™×¨×™×</h2>
                                <div className="w-10"></div>
                            </div>

                            <div className="flex-1 p-4 overflow-y-auto">
                                {/* Search Input - Primary */}
                                <div className="mb-4">
                                    <label className="text-white text-sm mb-2 block">×”×§×œ×“ ×©× ××•×¦×¨ ×œ×—×™×¤×•×©:</label>
                                    <div className="flex gap-2">
                                        <input
                                            type="text"
                                            value={scannedProductName}
                                            onChange={e => { setScannedProductName(e.target.value); setPriceCompareResults(null); }}
                                            placeholder="×œ×“×•×’××”: ×—×œ×‘ ×ª× ×•×‘×”, ×§×•×˜×’×³, ×‘××‘×”..."
                                            className="flex-1 px-4 py-3 rounded-xl bg-white text-gray-800 border-2 border-transparent focus:border-cyan-400 transition-all text-lg"
                                            autoFocus
                                        />
                                        <button
                                            onClick={() => searchPriceComparison(scannedProductName)}
                                            disabled={!scannedProductName}
                                            className="px-5 py-3 bg-cyan-500 text-white rounded-xl font-bold disabled:opacity-50 hover:bg-cyan-600 transition-all"
                                        >
                                            ğŸ”
                                        </button>
                                    </div>
                                </div>

                                {/* Autocomplete Suggestions */}
                                {scannedProductName && !priceCompareResults && getPriceSearchSuggestions(scannedProductName).length > 0 && (
                                    <div className="mb-4 bg-white/10 rounded-xl p-2">
                                        <div className="text-gray-400 text-xs mb-2 px-2">×”×¦×¢×•×ª:</div>
                                        <div className="flex flex-wrap gap-2">
                                            {getPriceSearchSuggestions(scannedProductName).map((suggestion, idx) => (
                                                <button
                                                    key={idx}
                                                    onClick={() => { setScannedProductName(suggestion); searchPriceComparison(suggestion); }}
                                                    className="px-3 py-2 bg-white/20 text-white rounded-lg text-sm hover:bg-cyan-500 transition-all"
                                                >
                                                    {suggestion}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {/* Quick Popular Products */}
                                {!scannedProductName && !priceCompareResults && (
                                    <div className="mb-4">
                                        <div className="text-gray-400 text-sm mb-2">××•×¦×¨×™× ×¤×•×¤×•×œ×¨×™×™×:</div>
                                        <div className="flex flex-wrap gap-2">
                                            {['×—×œ×‘', '×‘×™×¦×™×', '×œ×—×', '×’×‘×™× ×” ×¦×”×•×‘×”', '×©×•×§×•×œ×“', '×§×•×œ×”', '×‘××‘×”', '×©××Ÿ ×–×™×ª'].map((product, idx) => (
                                                <button
                                                    key={idx}
                                                    onClick={() => { setScannedProductName(product); searchPriceComparison(product); }}
                                                    className="px-3 py-2 bg-white/10 text-white rounded-lg text-sm hover:bg-white/20 transition-all"
                                                >
                                                    {product}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {/* Camera Scan - Secondary Option */}
                                {!priceCompareResults && (
                                    <div className="mb-4 p-4 bg-white/10 rounded-xl border border-white/20">
                                        <div className="text-white text-sm mb-3 text-center font-medium">××• ×¦×œ× ××ª ×©× ×”××•×¦×¨:</div>
                                        <div className="relative aspect-video bg-black rounded-xl overflow-hidden mb-4">
                                            <video ref={priceVideoRef} autoPlay playsInline className="w-full h-full object-cover" />
                                            <canvas ref={priceCanvasRef} className="hidden" />
                                            {scanningPrice && (
                                                <div className="absolute inset-0 bg-black/70 flex items-center justify-center">
                                                    <div className="text-center">
                                                        <div className="text-3xl mb-2 animate-spin">â³</div>
                                                        <div className="text-white text-sm">×× ×ª×— ×ª××•× ×”...</div>
                                                    </div>
                                                </div>
                                            )}
                                            {/* Big Capture Button Overlay */}
                                            {!scanningPrice && (
                                                <button
                                                    onClick={captureAndScanPrice}
                                                    className="absolute bottom-4 left-1/2 transform -translate-x-1/2 w-16 h-16 rounded-full bg-white border-4 border-cyan-400 shadow-lg flex items-center justify-center hover:scale-110 transition-all"
                                                >
                                                    <div className="w-12 h-12 rounded-full bg-gradient-to-r from-cyan-500 to-blue-500 flex items-center justify-center">
                                                        <span className="text-2xl">ğŸ“¸</span>
                                                    </div>
                                                </button>
                                            )}
                                        </div>
                                        <button
                                            onClick={captureAndScanPrice}
                                            disabled={scanningPrice}
                                            className="w-full py-4 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-xl font-bold text-lg shadow-lg disabled:opacity-50 hover:shadow-xl hover:scale-[1.02] transition-all"
                                        >
                                            {scanningPrice ? 'â³ ×× ×ª×—...' : 'ğŸ“¸ ×œ×—×¥ ×œ×¦×™×œ×•× ×•×–×™×”×•×™'}
                                        </button>
                                        <p className="text-gray-400 text-xs text-center mt-2">* ×›×•×•×Ÿ ××ª ×”××¦×œ××” ×œ×©× ×”××•×¦×¨ ×•×œ×—×¥ ×¢×œ ×”×›×¤×ª×•×¨</p>
                                    </div>
                                )}

                                {/* Supermarket Links - Results */}
                                {priceCompareResults && (
                                    <div className="space-y-3">
                                        <div className="flex items-center justify-between mb-2">
                                            <h3 className="text-white font-bold">×ª×•×¦××•×ª ×¢×‘×•×¨: {scannedProductName}</h3>
                                            <button
                                                onClick={() => { setPriceCompareResults(null); }}
                                                className="text-cyan-400 text-sm hover:underline"
                                            >
                                                ×—×™×¤×•×© ×—×“×©
                                            </button>
                                        </div>
                                        {priceCompareResults.map((site, idx) => (
                                            <button
                                                key={idx}
                                                onClick={() => openPriceLink(site.url)}
                                                className={`w-full p-4 ${site.color} text-white rounded-xl font-bold text-lg flex items-center justify-between hover:opacity-90 hover:scale-[1.02] transition-all`}
                                            >
                                                <span>{site.name}</span>
                                                <span>ğŸ”—</span>
                                            </button>
                                        ))}
                                        <button
                                            onClick={() => {
                                                priceCompareResults.forEach(site => window.open(site.url, '_blank'));
                                            }}
                                            className="w-full p-4 bg-gradient-to-r from-indigo-500 to-purple-500 text-white rounded-xl font-bold text-lg mt-2 hover:opacity-90 transition-all"
                                        >
                                            ğŸš€ ×¤×ª×— ×”×›×œ ×‘×•-×–×× ×™×ª
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}

                    {showFinishShopping && (
                        <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                            <div className="glass rounded-3xl p-8 max-w-md w-full shadow-2xl max-h-[90vh] overflow-y-auto">
                                <div className="text-5xl text-center mb-4">âœ…</div>
                                <h2 className="text-2xl font-bold text-center text-gradient mb-2">×¡×™×•× ×§× ×™×™×”</h2>
                                <p className="text-gray-600 dark:text-gray-300 mb-6 text-center">× ×§× ×• <span className="font-bold text-indigo-600">{purchasedCount}</span> ×¤×¨×™×˜×™×</p>
                                <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">××” ×”×™×” ×”×¡×›×•× ×”×›×•×œ×œ? â‚ª</label>
                                <input
                                    type="number"
                                    value={totalAmount}
                                    onChange={e => setTotalAmount(e.target.value)}
                                    placeholder="0"
                                    className="w-full px-5 py-4 border-2 border-indigo-200 dark:border-indigo-600 rounded-xl bg-white/50 dark:bg-gray-700/50 dark:text-white text-xl mb-4 focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition-all"
                                    autoFocus
                                />

                                {/* Receipt Photo Section */}
                                <div className="mb-6">
                                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">×¦×œ× ×§×‘×œ×” (××•×¤×¦×™×•× ×œ×™)</label>
                                    <input
                                        type="file"
                                        accept="image/*"
                                        capture="environment"
                                        ref={receiptInputRef}
                                        onChange={handleReceiptCapture}
                                        className="hidden"
                                    />
                                    {!receiptPhoto ? (
                                        <button
                                            onClick={() => receiptInputRef.current?.click()}
                                            disabled={uploadingReceipt}
                                            className="w-full p-4 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl hover:border-indigo-400 dark:hover:border-indigo-500 transition-colors flex flex-col items-center gap-2 text-gray-500 dark:text-gray-400 hover:text-indigo-500"
                                        >
                                            {uploadingReceipt ? (
                                                <>
                                                    <div className="animate-spin text-2xl">â³</div>
                                                    <span className="text-sm">××¢×œ×”...</span>
                                                </>
                                            ) : (
                                                <>
                                                    <span className="text-3xl">ğŸ§¾</span>
                                                    <span className="text-sm">×œ×—×¥ ×œ×¦×™×œ×•× ×§×‘×œ×”</span>
                                                </>
                                            )}
                                        </button>
                                    ) : (
                                        <div className="relative">
                                            <img
                                                src={receiptPhoto}
                                                alt="×§×‘×œ×”"
                                                className="w-full h-32 object-cover rounded-xl border-2 border-green-300"
                                            />
                                            <button
                                                onClick={() => setReceiptPhoto(null)}
                                                className="absolute top-2 left-2 w-8 h-8 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600 transition-colors shadow-lg"
                                            >
                                                âœ•
                                            </button>
                                            <div className="absolute bottom-2 right-2 bg-green-500 text-white px-2 py-1 rounded-lg text-xs flex items-center gap-1">
                                                <span>âœ“</span> ×§×‘×œ×” ×¦×•×¨×¤×”
                                            </div>
                                        </div>
                                    )}
                                </div>

                                <div className="flex gap-3">
                                    <button onClick={finishShopping}
                                        disabled={uploadingReceipt}
                                        className="flex-1 bg-gradient-to-r from-green-500 to-emerald-500 text-white px-6 py-3 rounded-xl hover:shadow-lg hover:scale-105 font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                                        âœ“ ×¡×™×™× ×•×©××•×¨
                                    </button>
                                    <button onClick={() => { setShowFinishShopping(false); setTotalAmount(''); setReceiptPhoto(null); }}
                                        className="px-6 py-3 glass border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-700 hover:scale-105 transition-all">
                                        ×‘×™×˜×•×œ
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {showHistory && (
                        <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 overflow-y-auto">
                            <div className="glass rounded-3xl p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl scrollbar-thin">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold flex items-center gap-3">
                                        <span className="text-3xl">ğŸ“Š</span>
                                        <span className="text-gradient">×”×™×¡×˜×•×¨×™×™×ª ×§× ×™×•×ª</span>
                                    </h2>
                                    <button onClick={() => setShowHistory(false)}
                                        className="w-10 h-10 flex items-center justify-center glass rounded-full text-gray-500 hover:text-red-500 dark:hover:text-red-400 text-2xl hover:scale-110 hover:rotate-90 transition-all">Ã—</button>
                                </div>
                                {history.length === 0 ? (
                                    <div className="text-center py-12">
                                        <div className="text-7xl mb-4 float">ğŸ“­</div>
                                        <p className="text-xl text-gradient font-bold mb-2">××™×Ÿ ×”×™×¡×˜×•×¨×™×” ×¢×“×™×™×Ÿ</p>
                                        <p className="text-gray-500 dark:text-gray-400">×¡×™×™××• ×§× ×™×™×” ×¨××©×•× ×” ×œ×¨××•×ª ×¡×˜×˜×™×¡×˜×™×§×”</p>
                                    </div>
                                ) : (
                                    <div className="space-y-4">
                                        {history.map((record) => (
                                            <div key={record.id} className="glass rounded-xl p-5 card-hover border border-gray-200/50 dark:border-gray-600/50">
                                                <div className="flex justify-between items-start mb-3">
                                                    <div>
                                                        <div className="text-sm text-gray-600 dark:text-gray-400 font-semibold flex items-center gap-2">
                                                            <span className="text-lg">ğŸ“…</span>
                                                            {record.completedAt?.toDate?.()?.toLocaleDateString('he-IL', {
                                                                year: 'numeric',
                                                                month: 'long',
                                                                day: 'numeric',
                                                                weekday: 'long'
                                                            }) || '×ª××¨×™×š ×œ× ×™×“×•×¢'}
                                                        </div>
                                                        <div className="text-xs text-gray-500 dark:text-gray-500 mt-1">ğŸ‘¤ {record.completedBy}</div>
                                                    </div>
                                                    <div className="text-2xl font-bold bg-gradient-to-r from-green-500 to-emerald-500 bg-clip-text text-transparent">
                                                        â‚ª{record.totalAmount.toFixed(2)}
                                                    </div>
                                                </div>
                                                <div className="text-sm text-gray-700 dark:text-gray-300 bg-indigo-50/50 dark:bg-indigo-900/20 rounded-lg p-3">
                                                    ğŸ›’ {record.items.length} ×¤×¨×™×˜×™× â€¢ ×××•×¦×¢: â‚ª{(record.totalAmount / record.items.length).toFixed(2)} ×œ×¤×¨×™×˜
                                                </div>
                                                {record.receiptPhoto && (
                                                    <div className="mt-3">
                                                        <button
                                                            onClick={() => window.open(record.receiptPhoto, '_blank')}
                                                            className="flex items-center gap-2 text-sm text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300 transition-colors"
                                                        >
                                                            <span>ğŸ§¾</span>
                                                            <span>×¦×¤×” ×‘×§×‘×œ×”</span>
                                                        </button>
                                                    </div>
                                                )}
                                            </div>
                                        ))}
                                        <div className="glass rounded-xl p-5 border-2 border-indigo-200/50 dark:border-indigo-700/50">
                                            <h3 className="font-bold text-gradient mb-4 flex items-center gap-2">
                                                <span className="text-xl">ğŸ“ˆ</span>
                                                ×¡×˜×˜×™×¡×˜×™×§×” ×›×œ×œ×™×ª
                                            </h3>
                                            <div className="space-y-3">
                                                <div className="flex justify-between text-gray-700 dark:text-gray-300 bg-gray-50/50 dark:bg-gray-800/50 p-3 rounded-lg">
                                                    <span>×¡×”"×› ×§× ×™×•×ª:</span>
                                                    <span className="font-bold text-lg">{history.length}</span>
                                                </div>
                                                <div className="flex justify-between text-gray-700 dark:text-gray-300 bg-green-50/50 dark:bg-green-900/20 p-3 rounded-lg">
                                                    <span>×¡×”"×› ×”×•×¦××•×ª:</span>
                                                    <span className="font-bold text-lg text-green-600 dark:text-green-400">
                                                        â‚ª{history.reduce((sum, h) => sum + h.totalAmount, 0).toFixed(2)}
                                                    </span>
                                                </div>
                                                <div className="flex justify-between text-gray-700 dark:text-gray-300 bg-blue-50/50 dark:bg-blue-900/20 p-3 rounded-lg">
                                                    <span>×××•×¦×¢ ×œ×§× ×™×™×”:</span>
                                                    <span className="font-bold text-lg text-blue-600 dark:text-blue-400">
                                                        â‚ª{(history.reduce((sum, h) => sum + h.totalAmount, 0) / history.length).toFixed(2)}
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}

                    {/* Forgotten Stats Modal */}
                    {showForgottenStats && (
                        <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 overflow-y-auto">
                            <div className="glass rounded-3xl p-8 max-w-lg w-full max-h-[90vh] overflow-y-auto shadow-2xl scrollbar-thin">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold flex items-center gap-3">
                                        <span className="text-3xl">ğŸ§ </span>
                                        <span className="text-gradient">××” ×©×›×—×ª×™?</span>
                                    </h2>
                                    <button onClick={() => setShowForgottenStats(false)}
                                        className="w-10 h-10 flex items-center justify-center glass rounded-full text-gray-500 hover:text-red-500 dark:hover:text-red-400 text-2xl hover:scale-110 hover:rotate-90 transition-all">Ã—</button>
                                </div>

                                {/* Shopping Streak */}
                                <div className="bg-gradient-to-r from-orange-100 to-amber-100 dark:from-orange-900/30 dark:to-amber-900/30 rounded-2xl p-4 mb-6 border border-orange-200 dark:border-orange-800">
                                    <div className="flex items-center justify-between">
                                        <div>
                                            <div className="text-lg font-bold text-orange-800 dark:text-orange-200">ğŸ”¥ ×¨×¦×£ ×§× ×™×•×ª</div>
                                            <div className="text-sm text-orange-600 dark:text-orange-400">×§× ×™×•×ª ×‘×œ×™ ×œ×©×›×•×— ×“×‘×¨×™×</div>
                                        </div>
                                        <div className="text-4xl font-bold text-orange-600 dark:text-orange-400">
                                            {shoppingStreak}
                                        </div>
                                    </div>
                                    {shoppingStreak >= 3 && (
                                        <div className="mt-2 text-sm text-orange-700 dark:text-orange-300 animate-pulse">
                                            â­ ××“×”×™×! {shoppingStreak} ×§× ×™×•×ª ×‘×¨×¦×£!
                                        </div>
                                    )}
                                </div>

                                {/* Achievements */}
                                {achievements.length > 0 && (
                                    <div className="mb-6">
                                        <h3 className="font-bold text-gray-800 dark:text-gray-200 mb-3 flex items-center gap-2">
                                            <span>ğŸ†</span> ×”×™×©×’×™× ×”×—×•×“×©
                                        </h3>
                                        <div className="grid grid-cols-2 gap-2">
                                            {achievements.map((achievement, idx) => (
                                                <div key={idx} className="bg-gradient-to-br from-yellow-50 to-amber-100 dark:from-yellow-900/20 dark:to-amber-900/20 rounded-xl p-3 border border-yellow-200 dark:border-yellow-800 hover:scale-105 transition-transform">
                                                    <div className="text-2xl mb-1">{achievement.emoji}</div>
                                                    <div className="text-sm font-bold text-amber-800 dark:text-amber-200">{achievement.name}</div>
                                                    <div className="text-xs text-amber-600 dark:text-amber-400">{achievement.description}</div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {/* Monthly Stats */}
                                <div className="mb-4">
                                    <h3 className="font-bold text-gray-800 dark:text-gray-200 mb-3 flex items-center gap-2">
                                        <span>ğŸ“…</span> ×¡×˜×˜×™×¡×˜×™×§×” ×—×•×“×©×™×ª - {new Date().toLocaleDateString('he-IL', { month: 'long', year: 'numeric' })}
                                    </h3>

                                    {Object.keys(forgottenStats).length === 0 ? (
                                        <div className="text-center py-8 bg-green-50 dark:bg-green-900/20 rounded-2xl">
                                            <div className="text-5xl mb-3">ğŸ‰</div>
                                            <p className="text-lg font-bold text-green-700 dark:text-green-300">××•×©×œ×!</p>
                                            <p className="text-sm text-green-600 dark:text-green-400">×œ× ×©×›×—×ª ×›×œ×•× ×”×—×•×“×©</p>
                                        </div>
                                    ) : (
                                        <div className="space-y-2">
                                            {Object.entries(forgottenStats)
                                                .sort(([,a], [,b]) => b - a)
                                                .map(([item, count]) => {
                                                    const msg = getForgottenMessage(count);
                                                    return (
                                                        <div key={item} className="flex items-center justify-between bg-gray-50 dark:bg-gray-800/50 rounded-xl p-3 hover:bg-gray-100 dark:hover:bg-gray-700/50 transition-colors">
                                                            <div className="flex items-center gap-3">
                                                                <span className="text-2xl">{msg.emoji}</span>
                                                                <span className="font-medium text-gray-800 dark:text-gray-200">{item}</span>
                                                            </div>
                                                            <div className="text-left">
                                                                <div className="font-bold text-gray-700 dark:text-gray-300">{count} ×¤×¢××™×</div>
                                                                <div className="text-xs text-gray-500">{msg.text}</div>
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                        </div>
                                    )}
                                </div>

                                {/* Tips Section */}
                                {Object.keys(forgottenStats).length > 0 && (
                                    <div className="bg-blue-50 dark:bg-blue-900/20 rounded-xl p-4 border border-blue-200 dark:border-blue-800">
                                        <div className="flex items-start gap-2">
                                            <span className="text-xl">ğŸ’¡</span>
                                            <div>
                                                <div className="font-bold text-blue-800 dark:text-blue-200 text-sm">×˜×™×¤!</div>
                                                <div className="text-xs text-blue-600 dark:text-blue-400">
                                                    ×”×•×¡×£ ××ª ×”×¤×¨×™×˜×™× ×©× ×©×›×—×™× ×œ×¢×ª×™× ×§×¨×•×‘×•×ª ×œ×¨×©×™××” ×§×‘×•×¢×”, ××• ×”×’×“×¨ ×ª×–×›×•×¨×ª ×‘×˜×œ×¤×•×Ÿ
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}

                    {showFamilySettings && <FamilySettingsModal onClose={() => setShowFamilySettings(false)} />}
                    {showCreateList && <CreateListModal onClose={() => setShowCreateList(false)} />}
                    {editingNote && <ItemNoteModal item={editingNote} onClose={() => setEditingNote(null)} onSave={(note) => updateItemNote(editingNote.id, note)} />}

                    {/* Regular Items Modal */}
                    {showRegulars && (
                        <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 overflow-y-auto">
                            <div className="glass rounded-3xl p-8 max-w-lg w-full max-h-[90vh] overflow-y-auto shadow-2xl scrollbar-thin">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold flex items-center gap-3">
                                        <span className="text-3xl">â­</span>
                                        <span className="text-gradient">×”××•×¦×¨×™× ×”×§×‘×•×¢×™× ×©×œ×™</span>
                                    </h2>
                                    <button onClick={() => setShowRegulars(false)}
                                        className="w-10 h-10 flex items-center justify-center glass rounded-full text-gray-500 hover:text-red-500 dark:hover:text-red-400 text-2xl hover:scale-110 hover:rotate-90 transition-all">Ã—</button>
                                </div>

                                <p className="text-gray-600 dark:text-gray-400 mb-4 text-sm">
                                    ××•×¦×¨×™× ×©××ª×” ×§×•× ×” ×œ×¢×ª×™× ×§×¨×•×‘×•×ª, ×œ×¤×™ ×”×”×™×¡×˜×•×¨×™×” ×©×œ×š:
                                </p>

                                {regularItems.length === 0 ? (
                                    <div className="text-center py-8">
                                        <div className="text-5xl mb-3">ğŸ“Š</div>
                                        <p className="text-gray-500 dark:text-gray-400">××™×Ÿ ××¡×¤×™×§ ×”×™×¡×˜×•×¨×™×™×ª ×§× ×™×•×ª</p>
                                        <p className="text-sm text-gray-400 dark:text-gray-500 mt-1">×¡×™×™× ×¢×•×“ ×›××” ×§× ×™×•×ª ×›×“×™ ×œ×–×”×•×ª ××•×¦×¨×™× ×§×‘×•×¢×™×</p>
                                    </div>
                                ) : (
                                    <>
                                        <div className="space-y-2 mb-6">
                                            {regularItems.map((item, idx) => (
                                                <div key={idx} className="flex items-center justify-between bg-gray-50 dark:bg-gray-800/50 rounded-xl p-3 hover:bg-gray-100 dark:hover:bg-gray-700/50 transition-colors">
                                                    <div className="flex items-center gap-3">
                                                        <span className="text-xl">ğŸ”„</span>
                                                        <span className="font-medium text-gray-800 dark:text-gray-200 capitalize">{item.name}</span>
                                                    </div>
                                                    <div className="text-sm text-gray-500 dark:text-gray-400">
                                                        × ×§× ×” {item.count} ×¤×¢××™×
                                                    </div>
                                                </div>
                                            ))}
                                        </div>

                                        <button
                                            onClick={addRegularItems}
                                            className="w-full bg-gradient-to-r from-amber-500 to-orange-500 text-white px-6 py-4 rounded-xl hover:from-amber-600 hover:to-orange-600 transition-all font-bold text-lg shadow-lg hover:shadow-xl hover:scale-[1.02]"
                                        >
                                            â• ×”×•×¡×£ ××ª ×›×•×œ× ×œ×¨×©×™××”
                                        </button>
                                    </>
                                )}
                            </div>
                        </div>
                    )}

                    {/* Calendar & Holidays Modal */}
                    {showCalendar && (
                        <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 overflow-y-auto">
                            <div className="glass rounded-3xl p-6 max-w-md w-full max-h-[95vh] overflow-y-auto shadow-2xl scrollbar-thin">
                                {/* Header */}
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-xl font-bold flex items-center gap-2">
                                        <span className="text-2xl">ğŸ“…</span>
                                        <span className="text-gradient">×œ×•×— ×©× ×” ×•×—×’×™×</span>
                                    </h2>
                                    <button onClick={() => { setShowCalendar(false); setSelectedHoliday(null); }}
                                        className="w-10 h-10 flex items-center justify-center glass rounded-full text-gray-500 hover:text-red-500 dark:hover:text-red-400 text-2xl hover:scale-110 hover:rotate-90 transition-all">Ã—</button>
                                </div>

                                {/* Month Navigation */}
                                <div className="flex items-center justify-between mb-4 bg-gradient-to-r from-indigo-500 to-purple-500 text-white rounded-xl p-3">
                                    <button
                                        onClick={() => setCalendarMonth(new Date(calendarMonth.getFullYear(), calendarMonth.getMonth() + 1))}
                                        className="w-10 h-10 rounded-full bg-white/20 hover:bg-white/30 flex items-center justify-center text-xl transition-all"
                                    >
                                        â€¹
                                    </button>
                                    <div className="text-center">
                                        <div className="text-lg font-bold">{HEBREW_MONTHS[calendarMonth.getMonth()]}</div>
                                        <div className="text-sm opacity-80">{calendarMonth.getFullYear()}</div>
                                    </div>
                                    <button
                                        onClick={() => setCalendarMonth(new Date(calendarMonth.getFullYear(), calendarMonth.getMonth() - 1))}
                                        className="w-10 h-10 rounded-full bg-white/20 hover:bg-white/30 flex items-center justify-center text-xl transition-all"
                                    >
                                        â€º
                                    </button>
                                </div>

                                {/* Days Header */}
                                <div className="grid grid-cols-7 gap-1 mb-2">
                                    {HEBREW_DAYS.map((day, i) => (
                                        <div key={i} className={`text-center text-xs font-bold py-2 ${i === 6 ? 'text-blue-600 dark:text-blue-400' : 'text-gray-600 dark:text-gray-400'}`}>
                                            {day}
                                        </div>
                                    ))}
                                </div>

                                {/* Calendar Grid */}
                                <div className="grid grid-cols-7 gap-1 mb-4">
                                    {getCalendarDays(calendarMonth).map((day, idx) => {
                                        const holiday = getHolidayForDate(day);
                                        const isToday = day && day.toDateString() === new Date().toDateString();
                                        const isSaturday = day && day.getDay() === 6;

                                        return (
                                            <div
                                                key={idx}
                                                onClick={() => holiday && setSelectedHoliday(holiday)}
                                                className={`
                                                    aspect-square rounded-lg flex flex-col items-center justify-center text-sm relative
                                                    ${!day ? '' : 'cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700'}
                                                    ${isToday ? 'ring-2 ring-indigo-500 bg-indigo-50 dark:bg-indigo-900/30' : ''}
                                                    ${isSaturday ? 'text-blue-600 dark:text-blue-400' : 'text-gray-700 dark:text-gray-300'}
                                                    ${holiday ? 'bg-gradient-to-br from-amber-100 to-orange-100 dark:from-amber-900/30 dark:to-orange-900/30 font-bold' : ''}
                                                `}
                                            >
                                                {day && (
                                                    <>
                                                        <span className={`${holiday ? 'text-amber-700 dark:text-amber-300' : ''}`}>{day.getDate()}</span>
                                                        {holiday && (
                                                            <span className="text-xs absolute -bottom-0.5">{holiday.icon}</span>
                                                        )}
                                                    </>
                                                )}
                                            </div>
                                        );
                                    })}
                                </div>

                                {/* Selected Holiday Details */}
                                {selectedHoliday ? (
                                    <div className="bg-gradient-to-r from-amber-50 to-orange-50 dark:from-amber-900/20 dark:to-orange-900/20 rounded-xl p-4 border-2 border-amber-300 dark:border-amber-700 mb-4">
                                        <div className="flex items-center gap-3 mb-3">
                                            <span className="text-3xl">{selectedHoliday.icon}</span>
                                            <div>
                                                <h3 className="font-bold text-lg text-gray-800 dark:text-white">{selectedHoliday.name}</h3>
                                                <p className="text-sm text-amber-700 dark:text-amber-300">{selectedHoliday.date}</p>
                                            </div>
                                        </div>
                                        <p className="text-sm text-gray-600 dark:text-gray-400 mb-4">{selectedHoliday.reminder}</p>

                                        {/* Reminder Days Selector */}
                                        <div className="mb-4">
                                            <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">×ª×–×›×•×¨×ª ×œ×§× ×™×•×ª ×œ×¤× ×™:</label>
                                            <div className="flex gap-2 flex-wrap">
                                                {[3, 5, 7, 10, 14].map(days => (
                                                    <button
                                                        key={days}
                                                        onClick={() => setReminderDays(days)}
                                                        className={`px-3 py-1 rounded-full text-sm transition-all ${
                                                            reminderDays === days
                                                                ? 'bg-indigo-500 text-white'
                                                                : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200'
                                                        }`}
                                                    >
                                                        {days} ×™××™×
                                                    </button>
                                                ))}
                                            </div>
                                        </div>

                                        {/* Add to Calendar Buttons */}
                                        <div className="space-y-2">
                                            <button
                                                onClick={() => addToGoogleCalendar(selectedHoliday, reminderDays)}
                                                className="w-full flex items-center justify-center gap-2 bg-white dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-600 text-gray-800 dark:text-white px-4 py-3 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-700 transition-all font-medium"
                                            >
                                                <svg className="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
                                                    <path d="M12 0C5.372 0 0 5.372 0 12s5.372 12 12 12 12-5.372 12-12S18.628 0 12 0zm6.369 8.648l-1.816 1.244c-.216.148-.504.087-.641-.138l-.858-1.416c-.137-.226-.451-.297-.698-.158l-1.674.938c-.247.139-.547.048-.669-.203l-.795-1.628c-.122-.25-.413-.365-.65-.255l-1.66.77c-.236.11-.512-.018-.616-.284l-.703-1.78c-.103-.267-.391-.401-.642-.3l-1.692.682c-.25.1-.528-.048-.618-.331L6.37 4.107c-.09-.282-.373-.44-.631-.353L4 4.42v14.16c0 .552.448 1 1 1h14c.552 0 1-.448 1-1V8.42l-1.631.228z"/>
                                                </svg>
                                                ×”×•×¡×£ ×œ-Google Calendar
                                            </button>
                                            <button
                                                onClick={() => downloadICSFile(selectedHoliday, reminderDays)}
                                                className="w-full flex items-center justify-center gap-2 bg-gradient-to-r from-indigo-500 to-purple-500 text-white px-4 py-3 rounded-xl hover:from-indigo-600 hover:to-purple-600 transition-all font-medium"
                                            >
                                                ğŸ“¥ ×”×•×¨×“ ×œ×™×•××Ÿ (iPhone/××—×©×‘)
                                            </button>
                                        </div>
                                    </div>
                                ) : (
                                    /* Upcoming Holidays List */
                                    <div className="space-y-2">
                                        <h3 className="font-bold text-gray-800 dark:text-white text-sm mb-2">ğŸ‰ ×—×’×™× ×§×¨×•×‘×™×:</h3>
                                        {ISRAELI_HOLIDAYS
                                            .filter(h => h.dateObj >= new Date())
                                            .sort((a, b) => a.dateObj - b.dateObj)
                                            .slice(0, 4)
                                            .map((holiday, idx) => {
                                                const daysUntil = Math.ceil((holiday.dateObj - new Date()) / (1000 * 60 * 60 * 24));
                                                return (
                                                    <button
                                                        key={idx}
                                                        onClick={() => {
                                                            setSelectedHoliday(holiday);
                                                            setCalendarMonth(new Date(holiday.dateObj));
                                                        }}
                                                        className="w-full flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800/50 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-700 transition-all text-right"
                                                    >
                                                        <span className="text-xl">{holiday.icon}</span>
                                                        <div className="flex-1">
                                                            <div className="font-medium text-gray-800 dark:text-white">{holiday.name}</div>
                                                            <div className="text-xs text-gray-500">{holiday.date}</div>
                                                        </div>
                                                        <span className={`text-xs px-2 py-1 rounded-full ${
                                                            daysUntil <= 7 ? 'bg-red-100 text-red-700 dark:bg-red-900/50 dark:text-red-300' :
                                                            daysUntil <= 30 ? 'bg-amber-100 text-amber-700 dark:bg-amber-900/50 dark:text-amber-300' :
                                                            'bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400'
                                                        }`}>
                                                            {daysUntil} ×™××™×
                                                        </span>
                                                    </button>
                                                );
                                            })}
                                    </div>
                                )}

                                {/* Legend */}
                                <div className="mt-4 p-3 bg-gray-50 dark:bg-gray-800/50 rounded-xl">
                                    <div className="text-xs text-gray-500 dark:text-gray-400 flex flex-wrap gap-3">
                                        <span className="flex items-center gap-1">
                                            <span className="w-3 h-3 rounded bg-amber-200 dark:bg-amber-700"></span> ×—×’
                                        </span>
                                        <span className="flex items-center gap-1">
                                            <span className="w-3 h-3 rounded ring-2 ring-indigo-500"></span> ×”×™×•×
                                        </span>
                                        <span className="flex items-center gap-1">
                                            <span className="text-blue-600">×©×³</span> ×©×‘×ª
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Quantity Selector Modal */}
                    {showQuantitySelector && selectedProduct && (
                        <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                            <div className="glass rounded-3xl p-6 max-w-sm w-full shadow-2xl">
                                <div className="text-center mb-6">
                                    <div className="text-4xl mb-2">{CATEGORIES[selectedProduct.category]?.icon || 'ğŸ›’'}</div>
                                    <h2 className="text-xl font-bold text-gray-800 dark:text-white">{selectedProduct.name}</h2>
                                    <p className="text-sm text-gray-500 dark:text-gray-400">{CATEGORIES[selectedProduct.category]?.name}</p>
                                </div>

                                {/* Quantity Selector */}
                                <div className="mb-6">
                                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 text-center">×›××•×ª</label>
                                    <div className="flex items-center justify-center gap-4">
                                        <button
                                            onClick={() => setSelectedQuantity(Math.max(0.5, selectedQuantity - (selectedUnit === '×’×¨×' ? 100 : selectedUnit === '×§"×’' ? 0.5 : 1)))}
                                            className="w-14 h-14 bg-gray-100 dark:bg-gray-700 rounded-2xl text-2xl font-bold hover:bg-gray-200 dark:hover:bg-gray-600 transition-all hover:scale-110"
                                        >
                                            -
                                        </button>
                                        <div className="text-center min-w-[80px]">
                                            <input
                                                type="number"
                                                value={selectedQuantity}
                                                onChange={(e) => setSelectedQuantity(Math.max(0.1, parseFloat(e.target.value) || 1))}
                                                onFocus={(e) => e.target.select()}
                                                className="w-20 text-center text-3xl font-bold bg-transparent border-none outline-none text-gradient"
                                                step={selectedUnit === '×’×¨×' ? 100 : selectedUnit === '×§"×’' ? 0.5 : 1}
                                            />
                                        </div>
                                        <button
                                            onClick={() => setSelectedQuantity(selectedQuantity + (selectedUnit === '×’×¨×' ? 100 : selectedUnit === '×§"×’' ? 0.5 : 1))}
                                            className="w-14 h-14 btn-gradient text-white rounded-2xl text-2xl font-bold hover:scale-110 transition-all"
                                        >
                                            +
                                        </button>
                                    </div>
                                </div>

                                {/* Unit Selector */}
                                <div className="mb-6">
                                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 text-center">×™×—×™×“×ª ××™×“×”</label>
                                    <div className="flex justify-center gap-2 flex-wrap">
                                        {selectedProduct.unitOptions?.map((unit) => (
                                            <button
                                                key={unit}
                                                onClick={() => {
                                                    setSelectedUnit(unit);
                                                    // Reset quantity when changing units
                                                    if (unit === '×’×¨×') setSelectedQuantity(100);
                                                    else if (unit === '×§"×’') setSelectedQuantity(1);
                                                    else setSelectedQuantity(1);
                                                }}
                                                className={`px-4 py-2 rounded-xl font-medium transition-all ${
                                                    selectedUnit === unit
                                                        ? 'btn-gradient text-white shadow-lg'
                                                        : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'
                                                }`}
                                            >
                                                {unit}
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                {/* Note Input */}
                                <div className="mb-4">
                                    <label className="block text-sm font-medium text-gray-600 dark:text-gray-400 mb-2">ğŸ“ ×”×•×¡×£ ×”×¢×¨×” (××•×¤×¦×™×•× ×œ×™):</label>
                                    <input
                                        type="text"
                                        value={selectedNote}
                                        onChange={(e) => setSelectedNote(e.target.value)}
                                        placeholder="×œ×“×•×’××”: ×˜×¨×™, ×œ×œ× ×’×œ×•×˜×Ÿ, ××•×¨×’× ×™..."
                                        className="w-full px-4 py-3 rounded-xl border-2 border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-700 dark:text-white focus:border-indigo-400 transition-all"
                                    />
                                </div>

                                {/* Preview */}
                                <div className="bg-indigo-50 dark:bg-indigo-900/30 rounded-xl p-3 mb-6 text-center">
                                    <span className="text-lg font-bold text-indigo-700 dark:text-indigo-300">
                                        {selectedProduct.name} - {selectedQuantity} {selectedUnit}
                                        {selectedNote && <span className="block text-sm mt-1">ğŸ“ {selectedNote}</span>}
                                    </span>
                                </div>

                                {/* Buttons */}
                                <div className="flex gap-3">
                                    <button
                                        onClick={addProductWithQuantity}
                                        className="flex-1 btn-gradient text-white px-6 py-4 rounded-xl font-bold text-lg shadow-lg hover:shadow-xl hover:scale-[1.02] transition-all"
                                    >
                                        â• ×”×•×¡×£ ×œ×¨×©×™××”
                                    </button>
                                    <button
                                        onClick={() => { setShowQuantitySelector(false); setSelectedProduct(null); setSelectedNote(''); }}
                                        className="px-6 py-4 glass border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-700 transition-all"
                                    >
                                        ×‘×™×˜×•×œ
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Confetti Effect */}
                    {confetti && <ConfettiBurst x={confetti.x} y={confetti.y} onComplete={() => setConfetti(null)} />}

                    {/* Family Chat Modal */}
                    {showChat && (
                        <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                            <div className="bg-white dark:bg-gray-900 rounded-3xl w-full max-w-lg h-[85vh] max-h-[650px] shadow-2xl flex flex-col overflow-hidden">
                                {/* Chat Header - Modern Design */}
                                <div className="p-4 flex items-center justify-between bg-white dark:bg-gray-800 border-b border-gray-100 dark:border-gray-700">
                                    <div className="flex items-center gap-3">
                                        <div className="w-12 h-12 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white text-xl shadow-lg">
                                            ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦
                                        </div>
                                        <div>
                                            <h2 className="font-bold text-gray-800 dark:text-white">{family?.name}</h2>
                                            <p className="text-xs text-gray-500 dark:text-gray-400">
                                                {activeEditors.length > 0 ? `${activeEditors[0]} ××§×œ×™×“/×”...` : '×¦\'××˜ ××©×¤×—×ª×™'}
                                            </p>
                                        </div>
                                    </div>
                                    <div className="flex items-center gap-2">
                                        <button
                                            onClick={async () => {
                                                if ('Notification' in window) {
                                                    if (Notification.permission === 'granted') {
                                                        setNotificationsEnabled(!notificationsEnabled);
                                                    } else if (Notification.permission !== 'denied') {
                                                        const permission = await Notification.requestPermission();
                                                        setNotificationsEnabled(permission === 'granted');
                                                    } else {
                                                        alert('×”×ª×¨××•×ª ×—×¡×•××•×ª. ×× × ××¤×©×¨ ×”×ª×¨××•×ª ×‘×”×’×“×¨×•×ª ×”×“×¤×“×¤×Ÿ.');
                                                    }
                                                }
                                            }}
                                            className={`w-10 h-10 rounded-xl flex items-center justify-center transition-all ${notificationsEnabled ? 'bg-green-100 dark:bg-green-900/50 text-green-600' : 'bg-gray-100 dark:bg-gray-700 text-gray-500'}`}
                                            title={notificationsEnabled ? '×”×ª×¨××•×ª ×¤×¢×™×œ×•×ª' : '×”×¤×¢×œ ×”×ª×¨××•×ª'}
                                        >
                                            {notificationsEnabled ? 'ğŸ””' : 'ğŸ”•'}
                                        </button>
                                        <button onClick={() => setShowChat(false)} className="w-10 h-10 rounded-xl bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-gray-500 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                            <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
                                                <path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" />
                                            </svg>
                                        </button>
                                    </div>
                                </div>

                                {/* Chat Messages - Modern Bubbles */}
                                <div className="flex-1 overflow-y-auto p-4 space-y-4 bg-gradient-to-b from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 scrollbar-thin">
                                    {chatMessages.length === 0 ? (
                                        <div className="text-center py-16">
                                            <div className="w-20 h-20 rounded-full bg-indigo-100 dark:bg-indigo-900/50 flex items-center justify-center mx-auto mb-4">
                                                <span className="text-4xl">ğŸ’¬</span>
                                            </div>
                                            <p className="text-gray-600 dark:text-gray-300 font-medium">××™×Ÿ ×”×•×“×¢×•×ª ×¢×“×™×™×Ÿ</p>
                                            <p className="text-sm text-gray-400 dark:text-gray-500 mt-1">×©×œ×—×• ×”×•×“×¢×” ×¨××©×•× ×” ×œ××©×¤×—×”!</p>
                                        </div>
                                    ) : (
                                        chatMessages.map(msg => {
                                            const isMe = msg.senderUid === user.uid;
                                            return (
                                                <div key={msg.id} className={`flex ${isMe ? 'justify-start' : 'justify-end'} items-end gap-2`}>
                                                    {isMe && (
                                                        <div className="w-8 h-8 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white text-xs font-bold flex-shrink-0">
                                                            {(msg.senderName || '?')[0]}
                                                        </div>
                                                    )}
                                                    <div className={`max-w-[75%] ${isMe ? 'order-2' : ''}`}>
                                                        {!isMe && <p className="text-xs text-gray-500 dark:text-gray-400 mb-1 mr-2 font-medium">{msg.senderName}</p>}
                                                        <div className={`rounded-2xl p-3 shadow-sm ${
                                                            isMe
                                                                ? 'bg-indigo-500 text-white rounded-bl-md'
                                                                : 'bg-white dark:bg-gray-700 text-gray-800 dark:text-white rounded-br-md border border-gray-100 dark:border-gray-600'
                                                        }`}>
                                                            {msg.photoUrl && (
                                                                <img src={msg.photoUrl} alt="×ª××•× ×”" className="rounded-xl mb-2 max-w-full cursor-pointer hover:opacity-90 shadow-sm" onClick={() => window.open(msg.photoUrl, '_blank')} />
                                                            )}
                                                            {msg.text && <p className="text-sm leading-relaxed">{msg.text}</p>}
                                                            <div className={`flex items-center gap-1 mt-1.5 ${isMe ? 'justify-start' : 'justify-end'}`}>
                                                                <p className={`text-xs ${isMe ? 'text-indigo-200' : 'text-gray-400'}`}>
                                                                    {msg.createdAt?.toDate?.().toLocaleTimeString('he-IL', { hour: '2-digit', minute: '2-digit' }) || ''}
                                                                </p>
                                                                {isMe && (
                                                                    <span className={`text-xs ${msg.readBy && msg.readBy.some(uid => uid !== msg.senderUid) ? 'text-cyan-300' : 'text-indigo-300'}`}>
                                                                        {msg.readBy && msg.readBy.some(uid => uid !== msg.senderUid) ? 'âœ“âœ“' : 'âœ“'}
                                                                    </span>
                                                                )}
                                                            </div>
                                                        </div>
                                                    </div>
                                                    {!isMe && (
                                                        <div className="w-8 h-8 rounded-full bg-gradient-to-br from-emerald-500 to-teal-600 flex items-center justify-center text-white text-xs font-bold flex-shrink-0">
                                                            {(msg.senderName || '?')[0]}
                                                        </div>
                                                    )}
                                                </div>
                                            );
                                        })
                                    )}
                                </div>

                                {/* Photo Preview - Improved */}
                                {capturedPhoto && (
                                    <div className="px-4 py-3 bg-white dark:bg-gray-800 border-t border-gray-100 dark:border-gray-700">
                                        <div className="relative inline-block">
                                            <img src={capturedPhoto} alt="×ª×¦×•×’×” ××§×“×™××”" className="h-24 rounded-xl shadow-md" />
                                            <button onClick={() => setCapturedPhoto(null)} className="absolute -top-2 -right-2 w-7 h-7 bg-red-500 text-white rounded-full text-sm flex items-center justify-center shadow-lg hover:bg-red-600 transition-colors">âœ•</button>
                                        </div>
                                    </div>
                                )}

                                {/* Chat Input - Modern Design */}
                                <div className="p-4 bg-white dark:bg-gray-800 border-t border-gray-100 dark:border-gray-700">
                                    <div className="flex items-center gap-3">
                                        <button onClick={startCamera} className="w-11 h-11 rounded-xl bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-all" title="×¦×œ× ×ª××•× ×”">
                                            <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
                                                <path strokeLinecap="round" strokeLinejoin="round" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                                                <path strokeLinecap="round" strokeLinejoin="round" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                                            </svg>
                                        </button>
                                        <input
                                            type="text"
                                            value={chatInput}
                                            onChange={e => setChatInput(e.target.value)}
                                            onKeyPress={e => e.key === 'Enter' && sendChatMessage(chatInput, capturedPhoto)}
                                            placeholder="×”×§×œ×“ ×”×•×“×¢×”..."
                                            className="flex-1 px-4 py-3 border border-gray-200 dark:border-gray-600 rounded-xl bg-gray-50 dark:bg-gray-700 dark:text-white focus:border-indigo-400 focus:ring-2 focus:ring-indigo-100 dark:focus:ring-indigo-900/50 transition-all text-sm"
                                        />
                                        <button
                                            onClick={() => sendChatMessage(chatInput, capturedPhoto)}
                                            className="w-11 h-11 bg-indigo-500 hover:bg-indigo-600 rounded-xl flex items-center justify-center text-white transition-all shadow-md hover:shadow-lg"
                                        >
                                            <svg className="w-5 h-5 rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
                                                <path strokeLinecap="round" strokeLinejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Recipes Modal */}
                    {showRecipes && (
                        <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                            <div className="glass rounded-3xl w-full max-w-2xl max-h-[85vh] shadow-2xl flex flex-col overflow-hidden">
                                {/* Header */}
                                <div className="p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between bg-gradient-to-r from-orange-500 to-amber-500 text-white rounded-t-3xl">
                                    <div className="flex items-center gap-3">
                                        <span className="text-2xl">ğŸ³</span>
                                        <div>
                                            <h2 className="font-bold text-lg">××ª×›×•× ×™×</h2>
                                            <p className="text-xs opacity-80">×”×•×¡×£ ××¨×›×™×‘×™× ×œ×¢×’×œ×” ×‘×œ×—×™×¦×”</p>
                                        </div>
                                    </div>
                                    <div className="flex items-center gap-2">
                                        <button onClick={startRecipeScan} className="px-3 py-1.5 bg-white/20 rounded-lg hover:bg-white/30 transition-colors text-sm font-medium">ğŸ“· ×¡×¨×•×§</button>
                                        <button onClick={() => setShowAddRecipe(true)} className="px-3 py-1.5 bg-white/20 rounded-lg hover:bg-white/30 transition-colors text-sm font-medium">+ ×™×“× ×™</button>
                                        <button onClick={() => setShowRecipes(false)} className="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center hover:bg-white/30 transition-colors">âœ•</button>
                                    </div>
                                </div>

                                {/* Add Recipe Form */}
                                {showAddRecipe && (
                                    <div className="p-4 bg-orange-50 dark:bg-orange-900/20 border-b border-orange-200 dark:border-orange-800">
                                        <div className="mb-3">
                                            <input
                                                type="text"
                                                value={newRecipeName}
                                                onChange={e => setNewRecipeName(e.target.value)}
                                                placeholder="×©× ×”××ª×›×•×Ÿ (×œ××©×œ: ×¢×•×’×ª ×©×•×§×•×œ×“)"
                                                className="w-full px-4 py-3 border-2 border-orange-200 dark:border-orange-700 rounded-xl bg-white dark:bg-gray-800 dark:text-white focus:border-orange-400 transition-all"
                                            />
                                        </div>
                                        <div className="mb-3">
                                            <textarea
                                                value={newRecipeIngredients}
                                                onChange={e => setNewRecipeIngredients(e.target.value)}
                                                placeholder="×¨×©×™××ª ××¨×›×™×‘×™× (×›×œ ××¨×›×™×‘ ×‘×©×•×¨×” ×—×“×©×”)&#10;×œ×“×•×’××”:&#10;2 ×›×•×¡×•×ª ×§××—&#10;3 ×‘×™×¦×™×&#10;×›×•×¡ ×¡×•×›×¨&#10;×—×œ×‘"
                                                rows={5}
                                                className="w-full px-4 py-3 border-2 border-orange-200 dark:border-orange-700 rounded-xl bg-white dark:bg-gray-800 dark:text-white focus:border-orange-400 transition-all resize-none"
                                            />
                                        </div>
                                        <div className="flex gap-2">
                                            <button onClick={saveRecipe} className="flex-1 bg-gradient-to-r from-orange-500 to-amber-500 text-white px-4 py-2 rounded-xl hover:shadow-lg transition-all font-medium">
                                                ğŸ’¾ ×©××•×¨ ××ª×›×•×Ÿ
                                            </button>
                                            <button onClick={() => { setShowAddRecipe(false); setNewRecipeName(''); setNewRecipeIngredients(''); }} className="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 rounded-xl hover:bg-gray-300 dark:hover:bg-gray-600 transition-all">
                                                ×‘×™×˜×•×œ
                                            </button>
                                        </div>
                                    </div>
                                )}

                                {/* Recipes List */}
                                <div className="flex-1 overflow-y-auto p-4 space-y-3 scrollbar-thin">
                                    {recipes.length === 0 ? (
                                        <div className="text-center py-12">
                                            <div className="text-6xl mb-4">ğŸ³</div>
                                            <p className="text-gray-500 dark:text-gray-400 text-lg">××™×Ÿ ××ª×›×•× ×™× ×©××•×¨×™×</p>
                                            <p className="text-sm text-gray-400 dark:text-gray-500 mt-2">×”×•×¡×£ ××ª×›×•×Ÿ ×•×ª×•×›×œ ×œ×”×•×¡×™×£ ××ª ×›×œ ×”××¨×›×™×‘×™× ×‘×œ×—×™×¦×” ××—×ª!</p>
                                            <button onClick={() => setShowAddRecipe(true)} className="mt-4 bg-gradient-to-r from-orange-500 to-amber-500 text-white px-6 py-2 rounded-xl hover:shadow-lg transition-all font-medium">
                                                + ×”×•×¡×£ ××ª×›×•×Ÿ ×¨××©×•×Ÿ
                                            </button>
                                        </div>
                                    ) : (
                                        recipes.map(recipe => (
                                            <div key={recipe.id} className="bg-white dark:bg-gray-800 rounded-2xl p-4 border-2 border-orange-100 dark:border-orange-900/50 hover:border-orange-300 dark:hover:border-orange-700 transition-all">
                                                <div className="flex items-start justify-between mb-3">
                                                    <div>
                                                        <h3 className="font-bold text-lg text-gray-800 dark:text-white flex items-center gap-2">
                                                            ğŸ½ï¸ {recipe.name}
                                                        </h3>
                                                        <p className="text-xs text-gray-400 dark:text-gray-500 mt-1">
                                                            {recipe.ingredients?.length || 0} ××¨×›×™×‘×™× â€¢ × ×•×¡×£ ×¢×´×™ {recipe.createdBy}
                                                        </p>
                                                    </div>
                                                    <button onClick={() => deleteRecipe(recipe.id, recipe.name)} className="text-gray-400 hover:text-red-500 transition-colors p-1">ğŸ—‘ï¸</button>
                                                </div>
                                                <div className="flex flex-wrap gap-1.5 mb-3">
                                                    {recipe.ingredients?.slice(0, 8).map((ing, idx) => (
                                                        <span key={idx} className="text-xs bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300 px-2 py-1 rounded-full">
                                                            {ing.quantity > 1 ? `${ing.quantity}Ã— ` : ''}{ing.name}
                                                        </span>
                                                    ))}
                                                    {recipe.ingredients?.length > 8 && (
                                                        <span className="text-xs bg-gray-100 dark:bg-gray-700 text-gray-500 px-2 py-1 rounded-full">
                                                            +{recipe.ingredients.length - 8} ×¢×•×“
                                                        </span>
                                                    )}
                                                </div>
                                                <button
                                                    onClick={() => addRecipeToCart(recipe)}
                                                    disabled={addingRecipeItems === recipe.id}
                                                    className={`w-full py-3 rounded-xl font-bold transition-all ${addingRecipeItems === recipe.id ? 'bg-gray-300 dark:bg-gray-600 text-gray-500 cursor-wait' : 'bg-gradient-to-r from-green-500 to-emerald-500 text-white hover:shadow-lg hover:scale-[1.02]'}`}
                                                >
                                                    {addingRecipeItems === recipe.id ? (
                                                        <span className="flex items-center justify-center gap-2">
                                                            <span className="animate-spin">â³</span> ××•×¡×™×£ ××¨×›×™×‘×™×...
                                                        </span>
                                                    ) : (
                                                        <span>ğŸ›’ ×”×•×¡×£ ×”×›×œ ×œ×¢×’×œ×”</span>
                                                    )}
                                                </button>
                                            </div>
                                        ))
                                    )}
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Recipe Scan Modal */}
                    {showRecipeScan && (
                        <div className="fixed inset-0 bg-black z-[60]">
                            {/* Header - fixed at top */}
                            <div className="fixed top-0 left-0 right-0 flex items-center justify-between p-4 bg-gradient-to-r from-orange-500 to-amber-500 z-[70]">
                                <button onClick={cancelRecipeScan} className="text-white px-4 py-2 font-bold text-lg">×‘×™×˜×•×œ</button>
                                <h2 className="text-white font-bold text-lg">ğŸ“· ×¡×¨×™×§×ª ××ª×›×•×Ÿ</h2>
                                <div className="w-20"></div>
                            </div>

                            {scannedIngredients.length === 0 ? (
                                <>
                                    {/* Video area - full screen behind buttons */}
                                    <div className="fixed inset-0 bg-black pt-16 pb-52">
                                        <video ref={recipeVideoRef} autoPlay playsInline muted className="w-full h-full object-cover" />
                                        {scanningRecipe && (
                                            <div className="absolute inset-0 bg-black/80 flex flex-col items-center justify-center">
                                                <div className="text-5xl mb-4 animate-pulse">ğŸ”</div>
                                                <p className="text-white text-lg mb-4">××–×”×” ××¨×›×™×‘×™×...</p>
                                                <div className="w-64 h-3 bg-white/20 rounded-full overflow-hidden">
                                                    <div className="h-full bg-gradient-to-r from-orange-500 to-amber-500 rounded-full transition-all" style={{ width: `${scanProgress}%` }} />
                                                </div>
                                                <p className="text-white/70 text-sm mt-2">{scanProgress}%</p>
                                            </div>
                                        )}
                                    </div>
                                    {/* Buttons area - fixed at bottom with high z-index */}
                                    <div className="fixed bottom-0 left-0 right-0 bg-black/95 p-4 flex flex-col items-center gap-2 z-[70]" style={{ paddingBottom: 'calc(1rem + env(safe-area-inset-bottom, 8px))' }}>
                                        <p className="text-white text-sm text-center">ğŸ‘† ×›×•×•×Ÿ ××ª ×”××¦×œ××” ××œ ×¨×©×™××ª ×”××¨×›×™×‘×™×</p>
                                        <button onClick={captureAndScanRecipe} disabled={scanningRecipe}
                                            className="w-18 h-18 rounded-full bg-white border-4 border-orange-400 shadow-2xl flex items-center justify-center disabled:opacity-50">
                                            <div className="w-14 h-14 rounded-full bg-gradient-to-r from-orange-500 to-amber-500 flex items-center justify-center text-white text-xl">
                                                {scanningRecipe ? 'â³' : 'ğŸ“·'}
                                            </div>
                                        </button>
                                        <button onClick={captureAndScanRecipe} disabled={scanningRecipe}
                                            className="w-full py-3 bg-gradient-to-r from-orange-500 to-amber-500 text-white rounded-xl font-bold text-lg shadow-lg disabled:opacity-50">
                                            {scanningRecipe ? 'â³ ××–×”×” ××¨×›×™×‘×™×...' : 'ğŸ“¸ ×œ×—×¥ ×œ×¦×™×œ×•×'}
                                        </button>
                                    </div>
                                </>
                            ) : (
                                <>
                                    {/* Results list area */}
                                    <div className="fixed top-16 left-0 right-0 bottom-36 bg-white dark:bg-gray-900 overflow-y-auto p-4">
                                        <div className="mb-4">
                                            <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">××¨×›×™×‘×™× ×©×–×•×”×• ({scannedIngredients.filter(i => i.selected).length}/{scannedIngredients.length})</label>
                                            <div className="space-y-2">
                                                {scannedIngredients.map((ing, idx) => (
                                                    <div key={idx} onClick={() => toggleScannedIngredient(idx)}
                                                        className={`p-3 rounded-xl border-2 cursor-pointer transition-all ${ing.selected ? 'border-orange-400 bg-orange-50 dark:bg-orange-900/30' : 'border-gray-200 dark:border-gray-700 opacity-50'}`}>
                                                        <div className="flex items-center gap-3">
                                                            <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center ${ing.selected ? 'border-orange-500 bg-orange-500' : 'border-gray-300'}`}>
                                                                {ing.selected && <span className="text-white text-sm">âœ“</span>}
                                                            </div>
                                                            <div className="flex-1">
                                                                <p className="font-medium text-gray-800 dark:text-white">{ing.name}</p>
                                                                {ing.quantity > 1 && <p className="text-xs text-gray-500">×›××•×ª: {ing.quantity}</p>}
                                                            </div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                    {/* Results buttons - fixed at bottom */}
                                    <div className="fixed bottom-0 left-0 right-0 p-4 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700 space-y-2 z-[70]" style={{ paddingBottom: 'calc(1rem + env(safe-area-inset-bottom, 8px))' }}>
                                        <button onClick={addScannedToCart} disabled={scanningRecipe || scannedIngredients.filter(i => i.selected).length === 0}
                                            className="w-full py-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-xl font-bold disabled:opacity-50">
                                            {scanningRecipe ? 'â³ ××•×¡×™×£...' : 'ğŸ›’ ×”×•×¡×£ ×œ×¢×’×œ×”'}
                                        </button>
                                        <button onClick={() => { setScannedIngredients([]); startRecipeScan(); }}
                                            className="w-full py-3 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 rounded-xl">
                                            ğŸ“· ×¦×œ× ×©×•×‘
                                        </button>
                                    </div>
                                </>
                            )}
                            <canvas ref={recipeCanvasRef} className="hidden" />
                        </div>
                    )}

                    {/* Camera Modal */}
                    {showCamera && (
                        <div className="fixed inset-0 bg-black z-[60] flex flex-col">
                            <div className="flex items-center justify-between p-4 bg-black/50">
                                <button onClick={stopCamera} className="text-white text-lg px-4 py-2">×‘×™×˜×•×œ</button>
                                <h2 className="text-white font-bold">×¦×œ× ××•×¦×¨</h2>
                                <div className="w-16"></div>
                            </div>
                            <div className="flex-1 flex items-center justify-center bg-black">
                                <video ref={videoRef} autoPlay playsInline className="max-w-full max-h-full" />
                            </div>
                            <div className="p-6 bg-black/50 flex justify-center" style={{ paddingBottom: 'calc(1.5rem + env(safe-area-inset-bottom, 1.5rem))' }}>
                                <button onClick={capturePhoto} className="w-20 h-20 rounded-full bg-white border-4 border-gray-300 hover:scale-105 transition-transform flex items-center justify-center">
                                    <div className="w-16 h-16 rounded-full bg-white border-2 border-gray-400"></div>
                                </button>
                            </div>
                            <canvas ref={canvasRef} className="hidden" />
                        </div>
                    )}

                    <div className="max-w-4xl mx-auto">
                        <div className="glass rounded-3xl shadow-xl p-6 mb-6 relative overflow-hidden">
                            <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500"></div>
                            <div className="flex items-center justify-between mb-4">
                                <div className="flex items-center gap-4">
                                    <div className="w-14 h-14 rounded-2xl btn-gradient flex items-center justify-center shadow-lg">
                                        <span className="text-3xl">ğŸ›’</span>
                                    </div>
                                    <div>
                                        <h1 className="text-2xl font-bold text-gradient">ShopSmart</h1>
                                        <div className="flex items-center gap-2 mt-1 flex-wrap">
                                            <button onClick={() => setShowFamilySettings(true)} className="px-3 py-1 rounded-full text-sm font-medium bg-gradient-to-r from-indigo-100 to-purple-100 text-indigo-700 dark:from-indigo-900/50 dark:to-purple-900/50 dark:text-indigo-300 hover:scale-105 transition-transform cursor-pointer">
                                                ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ {family?.name}
                                            </button>
                                            <span className="px-2 py-1 rounded-full text-xs bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300">
                                                ğŸ‘¤ {user.displayName || user.email}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div className="flex items-center gap-2">
                                    <button
                                        onClick={toggleShoppingMode}
                                        className={`w-10 h-10 rounded-xl flex items-center justify-center text-lg hover:scale-110 transition-all touch-target ${
                                            shoppingMode
                                                ? 'bg-green-500 text-white shadow-lg shadow-green-200 dark:shadow-green-900/50 animate-pulse'
                                                : 'bg-green-100 dark:bg-green-900/50 text-green-600 dark:text-green-400'
                                        }`}
                                        title={shoppingMode ? '××¦×‘ ×§× ×™×•×ª ×¤×¢×™×œ - ×”××¡×š ×œ× ×™×›×‘×”' : '×”×¤×¢×œ ××¦×‘ ×§× ×™×•×ª'}
                                        aria-label={shoppingMode ? '×›×‘×” ××¦×‘ ×§× ×™×•×ª - ×”××¡×š ×œ× ×™×›×‘×”' : '×”×¤×¢×œ ××¦×‘ ×§× ×™×•×ª'}
                                        aria-pressed={shoppingMode}
                                    >
                                        <span aria-hidden="true">{shoppingMode ? 'ğŸ›’' : 'ğŸ“±'}</span>
                                    </button>
                                    <button
                                        onClick={() => setShowChat(true)}
                                        className="w-10 h-10 rounded-xl bg-blue-100 dark:bg-blue-900/50 flex items-center justify-center text-lg hover:scale-110 transition-transform relative touch-target"
                                        title="×¦'××˜ ××©×¤×—×ª×™"
                                        aria-label={chatMessages.some(msg => msg.senderUid !== user.uid && (!msg.readBy || !msg.readBy.includes(user.uid))) ? '×¦\'××˜ ××©×¤×—×ª×™ - ×™×© ×”×•×“×¢×•×ª ×©×œ× × ×§×¨××•' : '×¦\'××˜ ××©×¤×—×ª×™'}
                                    >
                                        <span aria-hidden="true">ğŸ’¬</span>
                                        {chatMessages.some(msg => msg.senderUid !== user.uid && (!msg.readBy || !msg.readBy.includes(user.uid))) && (
                                            <>
                                                <span className="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full animate-pulse" aria-hidden="true"></span>
                                                <span className="sr-only">×™×© ×”×•×“×¢×•×ª ×—×“×©×•×ª</span>
                                            </>
                                        )}
                                    </button>
                                    <button
                                        onClick={toggleDarkMode}
                                        className="w-10 h-10 rounded-xl bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-lg hover:scale-110 transition-transform touch-target"
                                        aria-label={darkMode ? '×¢×‘×•×¨ ×œ××¦×‘ ×‘×”×™×¨' : '×¢×‘×•×¨ ×œ××¦×‘ ×›×”×”'}
                                        aria-pressed={darkMode}
                                    >
                                        <span aria-hidden="true">{darkMode ? 'â˜€ï¸' : 'ğŸŒ™'}</span>
                                    </button>
                                    <button
                                        onClick={handleLogout}
                                        className="w-10 h-10 rounded-xl bg-red-100 dark:bg-red-900/50 flex items-center justify-center text-lg hover:scale-110 transition-transform text-red-600 dark:text-red-400 touch-target"
                                        title="×”×ª× ×ª×§"
                                        aria-label="×”×ª× ×ª×§ ××”×—×©×‘×•×Ÿ"
                                    >
                                        <span aria-hidden="true">ğŸšª</span>
                                    </button>
                                </div>
                            </div>

                            {/* List Selector - Wrapping Grid */}
                            <div className="flex flex-wrap gap-2 mb-4">
                                {lists.map(list => (
                                    <button
                                        key={list.id}
                                        onClick={() => setCurrentList(list)}
                                        className={`flex items-center gap-1.5 px-3 py-2 rounded-xl transition-all text-sm ${
                                            currentList?.id === list.id
                                                ? 'btn-gradient text-white shadow-lg'
                                                : 'bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200'
                                        }`}
                                    >
                                        <span>{list.icon}</span>
                                        <span className="font-medium">{list.name}</span>
                                        {list.isDefault && <span className="text-xs">â­</span>}
                                    </button>
                                ))}
                                <button
                                    onClick={() => setShowCreateList(true)}
                                    className="flex items-center gap-1.5 px-3 py-2 rounded-xl bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 hover:bg-indigo-100 dark:hover:bg-indigo-900/50 transition-all text-sm"
                                >
                                    <span>â•</span>
                                    <span className="font-medium">×—×“×©</span>
                                </button>
                            </div>

                            {/* Active Editors & Shopping Mode Indicator */}
                            {(activeEditors.length > 0 || shoppingMode) && (
                                <div className="flex items-center gap-3 mb-4 flex-wrap">
                                    {shoppingMode && (
                                        <div className="flex items-center gap-2 px-3 py-1.5 bg-green-100 dark:bg-green-900/50 text-green-700 dark:text-green-300 rounded-full text-sm font-medium">
                                            <span className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                                            ××¦×‘ ×§× ×™×•×ª ×¤×¢×™×œ
                                        </div>
                                    )}
                                    {activeEditors.length > 0 && (
                                        <div className="flex items-center gap-2 px-3 py-1.5 bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300 rounded-full text-sm">
                                            <span className="w-2 h-2 bg-blue-500 rounded-full animate-pulse"></span>
                                            {activeEditors.join(', ')} ×¢×•×¨×š/×ª ×›×¨×’×¢
                                        </div>
                                    )}
                                </div>
                            )}

                            {/* Quick Actions Bar - 4 icons in a row */}
                            <div className="grid grid-cols-4 gap-2 mb-4">
                                <button
                                    onClick={() => setShowImportWhatsApp(true)}
                                    className="flex flex-col items-center justify-center py-3 rounded-xl bg-green-50 dark:bg-green-900/30 text-green-700 dark:text-green-300 hover:bg-green-100 dark:hover:bg-green-900/50 transition-all"
                                >
                                    <span className="text-2xl mb-1">ğŸ“±</span>
                                    <span className="text-xs font-medium">×•×•×˜×¡××¤</span>
                                </button>
                                <button
                                    onClick={() => setShowSavedLists(true)}
                                    className="flex flex-col items-center justify-center py-3 rounded-xl bg-purple-50 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 hover:bg-purple-100 dark:hover:bg-purple-900/50 transition-all relative"
                                >
                                    <span className="text-2xl mb-1">ğŸ“‹</span>
                                    <span className="text-xs font-medium">×¨×©×™××•×ª</span>
                                    {savedLists.length > 0 && <span className="absolute top-1 right-1 bg-purple-500 text-white w-5 h-5 rounded-full text-xs flex items-center justify-center">{savedLists.length}</span>}
                                </button>
                                <button
                                    onClick={saveListForReuse}
                                    className="flex flex-col items-center justify-center py-3 rounded-xl bg-amber-50 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 hover:bg-amber-100 dark:hover:bg-amber-900/50 transition-all"
                                >
                                    <span className="text-2xl mb-1">ğŸ’¾</span>
                                    <span className="text-xs font-medium">×©××™×¨×”</span>
                                </button>
                                <button
                                    onClick={startPriceScanner}
                                    className="flex flex-col items-center justify-center py-3 rounded-xl bg-cyan-50 dark:bg-cyan-900/30 text-cyan-700 dark:text-cyan-300 hover:bg-cyan-100 dark:hover:bg-cyan-900/50 transition-all"
                                >
                                    <span className="text-2xl mb-1">ğŸ“¸</span>
                                    <span className="text-xs font-medium">××—×™×¨×™×</span>
                                </button>
                            </div>

                            {/* AI Assistant Button */}
                            <button
                                onClick={() => { setShowAIAssistant(true); generateAISuggestions(); }}
                                className="w-full mb-4 flex items-center justify-center gap-3 py-3 px-4 rounded-xl bg-gradient-to-r from-violet-500 to-purple-600 text-white font-bold shadow-lg hover:shadow-xl hover:scale-[1.02] transition-all"
                            >
                                <span className="text-2xl">ğŸ¤–</span>
                                <span>×¢×•×–×¨ ×§× ×™×•×ª ×—×›× - ×”×¦×¢×•×ª AI</span>
                                <span className="text-lg">âœ¨</span>
                            </button>

                            {/* Holiday Recommendations Banner */}
                            {getHolidayRecommendations().length > 0 && (
                                <div className="mb-4 p-4 bg-gradient-to-r from-amber-50 to-orange-50 dark:from-amber-900/30 dark:to-orange-900/30 rounded-2xl border border-amber-200 dark:border-amber-700">
                                    <div className="flex items-center justify-between mb-2">
                                        <div className="flex items-center gap-2">
                                            <span className="text-xl">{getHolidayRecommendations()[0].icon}</span>
                                            <span className="font-bold text-amber-800 dark:text-amber-200">{getHolidayRecommendations()[0].name} ××ª×§×¨×‘!</span>
                                        </div>
                                        <button
                                            onClick={() => setShowHolidayRecommendations(!showHolidayRecommendations)}
                                            className="text-sm text-amber-600 dark:text-amber-400 hover:underline"
                                        >
                                            {showHolidayRecommendations ? '×”×¡×ª×¨' : '×”×¦×’ ×”××œ×¦×•×ª'}
                                        </button>
                                    </div>
                                    {showHolidayRecommendations && (
                                        <div className="flex flex-wrap gap-2 mt-2">
                                            {getHolidayRecommendations()[0].products.map((product, idx) => (
                                                <button
                                                    key={idx}
                                                    onClick={() => addProduct(product)}
                                                    className="px-3 py-1.5 bg-white dark:bg-gray-800 rounded-lg text-sm font-medium text-amber-700 dark:text-amber-300 hover:bg-amber-100 dark:hover:bg-amber-900/50 transition-all border border-amber-200 dark:border-amber-700"
                                                >
                                                    + {product}
                                                </button>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            )}

                            <div className="flex items-center justify-between mb-4">
                                <div className="text-sm text-gray-500 dark:text-gray-400">
                                    {currentList?.icon} {currentList?.name}
                                </div>
                                <button
                                    onClick={() => document.getElementById('shopping-list-section')?.scrollIntoView({ behavior: 'smooth' })}
                                    className="flex items-center gap-2 px-4 py-2 bg-gradient-to-br from-indigo-50 to-purple-50 dark:from-indigo-900/30 dark:to-purple-900/30 rounded-xl hover:shadow-lg transition-all border border-indigo-200/50 dark:border-indigo-700/50">
                                    <span className="text-xs text-gray-500 dark:text-gray-400 font-medium">×¤×¨×™×˜×™×</span>
                                    <span className="text-xl font-bold text-gradient">{totalItems}</span>
                                </button>
                            </div>

                            {totalItems > 0 && (
                                <div className="bg-gradient-to-r from-indigo-500/10 to-purple-500/10 dark:from-indigo-500/20 dark:to-purple-500/20 rounded-2xl p-4 mb-4">
                                    <div className="flex justify-between mb-2 text-sm">
                                        <span className="text-gray-600 dark:text-gray-300 font-medium">×”×ª×§×“××•×ª ×§× ×™×™×”</span>
                                        <span className="font-bold text-gradient">{purchasedCount} / {totalItems}</span>
                                    </div>
                                    <div className="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5 overflow-hidden">
                                        <div className="progress-animate h-2.5 rounded-full transition-all duration-700 ease-out"
                                            style={{ width: `${totalItems > 0 ? (purchasedCount / totalItems) * 100 : 0}%` }} />
                                    </div>
                                    {purchasedCount === totalItems && totalItems > 0 && (
                                        <div className="text-center mt-2 text-sm text-green-600 dark:text-green-400 font-medium">ğŸ‰ ×›×œ ×”××•×¦×¨×™× × ×§× ×•!</div>
                                    )}
                                </div>
                            )}

                            <div className="grid grid-cols-2 gap-3">
                                <button onClick={() => purchasedCount > 0 ? setShowFinishShopping(true) : alert('××™×Ÿ ××•×¦×¨×™× ×©× ×§× ×• ×¢×“×™×™×Ÿ. ×¡××Ÿ ××•×¦×¨×™× ×©×§× ×™×ª.')}
                                    className="relative overflow-hidden bg-gradient-to-br from-emerald-50 to-green-100 dark:from-emerald-900/30 dark:to-green-900/30 p-4 rounded-2xl border border-emerald-200/50 dark:border-emerald-700/50 card-hover group">
                                    <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-700"></div>
                                    <div className="text-sm text-gray-600 dark:text-gray-400 font-medium">×¡×™×™× ×§× ×™×™×”</div>
                                    <div className="text-3xl my-1">âœ…</div>
                                    {purchasedCount > 0 ? (
                                        <div className="text-xs text-emerald-600 dark:text-emerald-400 font-semibold">{purchasedCount} ×¤×¨×™×˜×™× × ×§× ×•</div>
                                    ) : (
                                        <div className="text-xs text-gray-400 dark:text-gray-500">×¡××Ÿ ××•×¦×¨×™× ×©×§× ×™×ª</div>
                                    )}
                                </button>
                                <button onClick={() => setShowHistory(true)}
                                    className="relative overflow-hidden bg-gradient-to-br from-purple-50 to-pink-100 dark:from-purple-900/30 dark:to-pink-900/30 p-4 rounded-2xl border border-purple-200/50 dark:border-purple-700/50 card-hover group">
                                    <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-700"></div>
                                    <div className="text-sm text-gray-600 dark:text-gray-400 font-medium">×”×™×¡×˜×•×¨×™×”</div>
                                    <div className="text-3xl my-1">ğŸ“Š</div>
                                    <div className="text-xs text-purple-600 dark:text-purple-400 font-semibold">{history.length} ×§× ×™×•×ª</div>
                                </button>
                            </div>

                            <div className="mt-4 flex gap-3">
                                <button onClick={() => setShowRecipes(true)}
                                    className="flex-1 bg-gradient-to-r from-orange-500 to-amber-500 text-white px-4 py-3 rounded-lg hover:from-orange-600 hover:to-amber-600 transition-all font-semibold shadow-lg hover:shadow-xl hover:scale-105">
                                    ğŸ³ ××ª×›×•× ×™×
                                </button>
                                {items.filter(item => !item.purchased).length > 0 && (
                                    <button onClick={exportToWhatsApp}
                                        className="flex-1 bg-gradient-to-r from-green-500 to-emerald-500 text-white px-4 py-3 rounded-lg hover:from-green-600 hover:to-emerald-600 transition-all font-semibold shadow-lg hover:shadow-xl hover:scale-105">
                                        ğŸ“± WhatsApp
                                    </button>
                                )}
                            </div>

                            <div className="mt-3 flex gap-2">
                                <button onClick={() => setShowForgottenStats(true)}
                                    className="flex-1 bg-gradient-to-r from-rose-400 to-pink-500 text-white px-4 py-3 rounded-lg hover:from-rose-500 hover:to-pink-600 transition-all font-semibold shadow-lg hover:shadow-xl hover:scale-[1.02] flex items-center justify-center gap-2">
                                    <span>ğŸ§ </span>
                                    <span>××” ×©×›×—×ª×™?</span>
                                    {shoppingStreak > 0 && (
                                        <span className="bg-white/20 px-2 py-0.5 rounded-full text-xs">ğŸ”¥ {shoppingStreak}</span>
                                    )}
                                </button>
                                <button onClick={() => setShowCalendar(true)}
                                    className="w-14 bg-gradient-to-r from-violet-400 to-purple-500 text-white rounded-lg hover:from-violet-500 hover:to-purple-600 transition-all shadow-lg hover:shadow-xl hover:scale-105 flex items-center justify-center"
                                    title="×œ×•×— ×©× ×” ×•×—×’×™×">
                                    ğŸ“…
                                </button>
                            </div>

                            {/* Add Regulars Button */}
                            {regularItems.length > 0 && (
                                <div className="mt-3">
                                    <button onClick={() => setShowRegulars(true)}
                                        className="w-full bg-gradient-to-r from-amber-400 to-orange-500 text-white px-4 py-3 rounded-lg hover:from-amber-500 hover:to-orange-600 transition-all font-semibold shadow-lg hover:shadow-xl hover:scale-[1.02] flex items-center justify-center gap-2">
                                        <span>â­</span>
                                        <span>×”×•×¡×£ ××ª ×”×§×‘×•×¢×™× ×©×œ×™</span>
                                        <span className="bg-white/20 px-2 py-0.5 rounded-full text-xs">{regularItems.length}</span>
                                    </button>
                                </div>
                            )}
                        </div>

                        {searchTerm && (
                            <div className="glass rounded-2xl shadow-xl p-6 mb-6 card-hover">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-xl font-bold dark:text-white flex items-center gap-2">
                                        <span className="text-2xl">ğŸ”</span>
                                        <span className="text-gradient">×ª×•×¦××•×ª ×—×™×¤×•×©</span>
                                    </h2>
                                    <button onClick={() => setSearchTerm('')} className="btn-gradient text-white text-sm px-4 py-2 rounded-full font-medium hover:shadow-lg hover:scale-105 transition-all">× ×§×” ×—×™×¤×•×© âœ•</button>
                                </div>
                                <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                                    {Object.entries(PRODUCTS).flatMap(([category, products]) =>
                                        products
                                            .filter(product => product.includes(searchTerm))
                                            .map((product, idx) => (
                                                <button key={`${category}-${idx}`} onClick={() => { addProduct(product); setSelectedCategory(category); }}
                                                    className="group relative bg-white dark:bg-gray-800 p-4 rounded-2xl border border-gray-100 dark:border-gray-700 hover:border-indigo-300 dark:hover:border-indigo-600 hover:shadow-lg hover:shadow-indigo-100/50 dark:hover:shadow-indigo-900/30 transition-all duration-200 text-right"
                                                >
                                                    <div className="flex items-start gap-3">
                                                        <div className="w-10 h-10 rounded-xl bg-gray-50 dark:bg-gray-700 flex items-center justify-center text-xl group-hover:scale-110 transition-transform">
                                                            {CATEGORIES[category]?.icon}
                                                        </div>
                                                        <div className="flex-1 min-w-0">
                                                            <div className="font-semibold text-gray-700 dark:text-gray-200 text-sm leading-tight mb-1">{product}</div>
                                                            <div className="text-xs text-gray-400 dark:text-gray-500">{CATEGORIES[category]?.name}</div>
                                                        </div>
                                                        <div className="w-6 h-6 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center opacity-0 group-hover:opacity-100 group-hover:bg-indigo-500 transition-all duration-200">
                                                            <svg className="w-3.5 h-3.5 text-gray-400 group-hover:text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2.5}>
                                                                <path strokeLinecap="round" strokeLinejoin="round" d="M12 4v16m8-8H4" />
                                                            </svg>
                                                        </div>
                                                    </div>
                                                </button>
                                            ))
                                    )}
                                </div>
                                {Object.entries(PRODUCTS).flatMap(([_, products]) => products.filter(p => p.includes(searchTerm))).length === 0 && (
                                    <div className="text-center py-8">
                                        <div className="text-6xl mb-4">ğŸ”</div>
                                        <p className="text-gray-500 dark:text-gray-400 text-lg">×œ× × ××¦××• ××•×¦×¨×™× ×”×ª×•×××™× "<span className="font-bold">{searchTerm}</span>"</p>
                                        <p className="text-sm text-gray-400 dark:text-gray-500 mt-2">× ×¡×” ×—×™×¤×•×© ××—×¨ ××• ×‘×—×¨ ×§×˜×’×•×¨×™×”</p>
                                    </div>
                                )}
                            </div>
                        )}

                        {!selectedCategory && !searchTerm ? (
                            <div className="glass rounded-2xl shadow-xl p-6 mb-6">
                                <h2 className="text-2xl font-bold text-center mb-2 dark:text-white flex items-center justify-center gap-2">
                                    <span className="text-3xl">ğŸ·ï¸</span>
                                    <span className="text-gradient">×‘×—×¨ ×§×˜×’×•×¨×™×”</span>
                                </h2>
                                <p className="text-center text-gray-500 dark:text-gray-400 text-sm mb-6">××• ×”×©×ª××© ×‘×—×™×¤×•×© ×œ××˜×” ×œ××¦×™××” ××”×™×¨×”</p>
                                <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                                    {Object.entries(CATEGORIES).map(([key, cat]) => {
                                        const count = items.filter(item => item.category === key && !item.purchased).length;
                                        return (
                                            <button
                                                key={key}
                                                onClick={() => setSelectedCategory(key)}
                                                className="group relative bg-white dark:bg-gray-800 p-5 rounded-2xl border border-gray-100 dark:border-gray-700 hover:border-indigo-300 dark:hover:border-indigo-600 hover:shadow-xl hover:shadow-indigo-100/50 dark:hover:shadow-indigo-900/30 transition-all duration-200"
                                            >
                                                <div className="flex flex-col items-center text-center">
                                                    <div className="w-14 h-14 rounded-2xl bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-700 dark:to-gray-600 flex items-center justify-center text-3xl mb-3 group-hover:scale-110 group-hover:shadow-lg transition-all duration-200">
                                                        {cat.icon}
                                                    </div>
                                                    <div className="text-sm font-semibold text-gray-700 dark:text-gray-200">{cat.name}</div>
                                                </div>
                                                {count > 0 && (
                                                    <div className="absolute -top-1 -left-1 bg-indigo-500 text-white text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center shadow-md">
                                                        {count}
                                                    </div>
                                                )}
                                            </button>
                                        );
                                    })}
                                </div>
                            </div>
                        ) : selectedCategory && !searchTerm && (
                            <>
                                {/* Fixed Back Button at Bottom */}
                                <div className="fixed bottom-32 left-4 right-4 z-40 flex justify-center pointer-events-none">
                                    <button onClick={() => setSelectedCategory(null)}
                                        className="pointer-events-auto btn-gradient text-white px-6 py-3 rounded-full font-bold shadow-2xl hover:shadow-xl hover:scale-105 transition-all flex items-center gap-2 text-lg">
                                        <span>â†</span>
                                        <span>×—×–×•×¨ ×œ×§×˜×’×•×¨×™×•×ª</span>
                                    </button>
                                </div>

                                <div className="glass rounded-2xl shadow-xl mb-6">
                                    {/* Category Header */}
                                    <div className="p-4 border-b border-gray-200 dark:border-gray-700">
                                        <h2 className="text-xl font-bold flex items-center justify-center gap-2 dark:text-white">
                                            <span className="text-3xl">{CATEGORIES[selectedCategory].icon}</span>
                                            <span className="text-gradient">{CATEGORIES[selectedCategory].name}</span>
                                        </h2>
                                    </div>

                                    {/* Products Grid */}
                                    <div className="p-4">
                                        <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                                            {PRODUCTS[selectedCategory]?.map((product, idx) => (
                                                <button key={idx} onClick={() => addProduct(product)}
                                                    className="group relative bg-white dark:bg-gray-800 p-4 rounded-2xl border border-gray-100 dark:border-gray-700 hover:border-indigo-300 dark:hover:border-indigo-600 hover:shadow-lg hover:shadow-indigo-100/50 dark:hover:shadow-indigo-900/30 transition-all duration-200 text-right"
                                                    style={{animationDelay: `${idx * 30}ms`}}
                                                >
                                                <div className="flex items-center justify-between gap-2">
                                                    <div className="w-8 h-8 rounded-full bg-gray-50 dark:bg-gray-700 flex items-center justify-center group-hover:bg-indigo-500 group-hover:scale-110 transition-all duration-200">
                                                        <svg className="w-4 h-4 text-gray-400 group-hover:text-white transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2.5}>
                                                            <path strokeLinecap="round" strokeLinejoin="round" d="M12 4v16m8-8H4" />
                                                        </svg>
                                                    </div>
                                                    <span className="flex-1 font-semibold text-gray-700 dark:text-gray-200 text-sm leading-tight">{product}</span>
                                                </div>
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            </div>
                            </>
                        )}

                        {filteredItems.length > 0 && (
                            <div id="shopping-list-section" className="glass rounded-2xl shadow-xl p-6 mb-6">
                                <h2 className="text-2xl font-bold mb-6 dark:text-white flex items-center gap-3">
                                    <span className="text-3xl">ğŸ“</span>
                                    <span className="text-gradient">×”×¨×©×™××” ×©×œ×™</span>
                                    <span className="btn-gradient text-white text-sm px-3 py-1 rounded-full">{filteredItems.length}</span>
                                </h2>
                                {Object.entries(groupedItems).map(([category, categoryItems]) => (
                                    <div key={category} className="mb-6">
                                        <h3 className="text-lg font-bold text-indigo-700 dark:text-indigo-400 mb-3 pb-2 border-b-2 border-indigo-200/50 dark:border-indigo-700/50 flex items-center gap-2">
                                            <span className="text-2xl">{CATEGORIES[category]?.icon}</span>
                                            {CATEGORIES[category]?.name}
                                            <span className="text-xs bg-indigo-100 dark:bg-indigo-900/50 px-2 py-1 rounded-full">{categoryItems.length}</span>
                                        </h3>
                                        {categoryItems.map(item => (
                                            <SwipeableItem
                                                key={item.id}
                                                className="mb-3 fade-slide-in"
                                                purchased={item.purchased}
                                                onSwipeRight={() => !item.purchased && togglePurchasedWithAnimation(item.id, item.purchased)}
                                                onSwipeLeft={() => !item.purchased && postponeItem(item.id)}
                                            >
                                                <div className={`product-card ${animatingItems.has(item.id) ? 'success-glow' : ''} ${item.purchased ? 'purchased' : ''}`}>
                                                    <div className="flex items-center gap-3" role="group" aria-label={`×¤×¨×™×˜: ${item.name}`}>
                                                        {/* Checkbox - WCAG 4.1.2 Name, Role, Value */}
                                                        <button
                                                            onClick={(e) => togglePurchasedWithAnimation(item.id, item.purchased, e)}
                                                            aria-label={item.purchased ? `×‘×˜×œ ×¡×™××•×Ÿ × ×§× ×” ×¢×‘×•×¨ ${item.name}` : `×¡××Ÿ ${item.name} ×›× ×§× ×”`}
                                                            aria-pressed={item.purchased}
                                                            role="checkbox"
                                                            aria-checked={item.purchased}
                                                            className={`w-6 h-6 rounded-lg border-2 flex items-center justify-center flex-shrink-0 transition-all duration-150 touch-target ${
                                                                item.purchased
                                                                    ? 'bg-emerald-500 border-emerald-500'
                                                                    : 'border-gray-300 dark:border-gray-500 hover:border-emerald-400 hover:bg-emerald-50 dark:hover:bg-emerald-900/20'
                                                            }`}
                                                        >
                                                            {item.purchased && (
                                                                <svg className={`w-4 h-4 text-white ${animatingItems.has(item.id) ? 'check-animate' : ''}`} fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={3} aria-hidden="true">
                                                                    <path strokeLinecap="round" strokeLinejoin="round" d="M5 13l4 4L19 7" />
                                                                </svg>
                                                            )}
                                                        </button>

                                                        {/* Item Info */}
                                                        <div className="flex-1 min-w-0">
                                                            {editingItemId === item.id ? (
                                                                <input
                                                                    type="text"
                                                                    value={editingItemName}
                                                                    onChange={(e) => setEditingItemName(e.target.value)}
                                                                    onBlur={saveItemName}
                                                                    onKeyDown={(e) => e.key === 'Enter' && saveItemName()}
                                                                    className="inline-edit-input text-base font-medium text-gray-800 dark:text-white"
                                                                    aria-label={`×¢×¨×™×›×ª ×©× ×”××•×¦×¨ ${item.name}`}
                                                                    autoFocus
                                                                />
                                                            ) : (
                                                                <div
                                                                    onClick={() => !item.purchased && startEditingItem(item)}
                                                                    className={`text-base font-medium cursor-pointer ${
                                                                        item.purchased
                                                                            ? 'text-gray-400 dark:text-gray-500 line-through'
                                                                            : 'text-gray-800 dark:text-white'
                                                                    }`}
                                                                >
                                                                    {item.name}
                                                                </div>
                                                            )}
                                                            <div className="flex items-center gap-1.5 mt-1 flex-wrap">
                                                                {item.note && (
                                                                    <button
                                                                        onClick={() => setEditingNote(item)}
                                                                        className="text-xs bg-amber-100 dark:bg-amber-900/40 text-amber-700 dark:text-amber-300 px-2 py-0.5 rounded-md hover:bg-amber-200 dark:hover:bg-amber-900/60 transition-colors"
                                                                    >
                                                                        ğŸ“ {item.note.length > 12 ? item.note.substring(0, 12) + '...' : item.note}
                                                                    </button>
                                                                )}
                                                                {item.purchased && item.purchasedBy && (
                                                                    <span className="text-xs text-emerald-600 dark:text-emerald-400 font-medium">
                                                                        âœ“ {item.purchasedBy}
                                                                    </span>
                                                                )}
                                                                {item.postponedBy && !item.purchased && (
                                                                    <span className="text-xs text-orange-500 dark:text-orange-400">× ×“×—×”</span>
                                                                )}
                                                            </div>
                                                        </div>

                                                        {/* Quantity Stepper - WCAG compliant */}
                                                        <div className="qty-stepper flex-shrink-0" role="group" aria-label={`×›××•×ª ${item.name}`}>
                                                            <button
                                                                onClick={() => updateQuantity(item.id, (typeof item.quantity === 'number' ? item.quantity : 1) - 1)}
                                                                aria-label={`×”×¤×—×ª ×›××•×ª ×©×œ ${item.name}`}
                                                                className="qty-btn text-gray-500 dark:text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/30 touch-target"
                                                            >
                                                                <span aria-hidden="true">âˆ’</span>
                                                            </button>
                                                            <span className="qty-value text-gray-800 dark:text-white" aria-live="polite" aria-atomic="true">
                                                                {typeof item.quantity === 'string' ? item.quantity : item.quantity}
                                                            </span>
                                                            <button
                                                                onClick={() => updateQuantity(item.id, (typeof item.quantity === 'number' ? item.quantity : 1) + 1)}
                                                                aria-label={`×”×•×¡×£ ×›××•×ª ×©×œ ${item.name}`}
                                                                className="qty-btn text-gray-500 dark:text-gray-400 hover:text-emerald-500 hover:bg-emerald-50 dark:hover:bg-emerald-900/30 touch-target"
                                                            >
                                                                <span aria-hidden="true">+</span>
                                                            </button>
                                                        </div>

                                                        {/* Actions */}
                                                        <div className="flex items-center gap-1 flex-shrink-0">
                                                            {!item.note && (
                                                                <button
                                                                    onClick={() => setEditingNote(item)}
                                                                    className="w-8 h-8 rounded-lg flex items-center justify-center text-gray-400 hover:text-amber-500 hover:bg-amber-50 dark:hover:bg-amber-900/30 transition-all"
                                                                    title="×”×•×¡×£ ×”×¢×¨×”"
                                                                >
                                                                    <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
                                                                        <path strokeLinecap="round" strokeLinejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                                                    </svg>
                                                                </button>
                                                            )}
                                                            {/* WCAG 2.5.1 - Postpone button as alternative to swipe gesture */}
                                                            {!item.purchased && (
                                                                <button
                                                                    onClick={() => postponeItem(item.id)}
                                                                    aria-label={`×“×—×” ××ª ${item.name} ×œ×¡×•×£ ×”×¨×©×™××”`}
                                                                    className="w-8 h-8 rounded-lg flex items-center justify-center text-gray-400 hover:text-amber-500 hover:bg-amber-50 dark:hover:bg-amber-900/30 transition-all touch-target"
                                                                    title="×“×—×” ×œ×¡×•×£"
                                                                >
                                                                    <span className="text-sm" aria-hidden="true">â­</span>
                                                                </button>
                                                            )}
                                                            {!item.purchased && !item.outOfStock && shoppingMode && (
                                                                <button
                                                                    onClick={() => markOutOfStock(item)}
                                                                    aria-label={`×¡××Ÿ ${item.name} ×›××–×œ ××”××œ××™`}
                                                                    className="w-8 h-8 rounded-lg flex items-center justify-center text-gray-400 hover:text-orange-500 hover:bg-orange-50 dark:hover:bg-orange-900/30 transition-all touch-target"
                                                                    title="××–×œ ××”××œ××™"
                                                                >
                                                                    <span className="text-sm" aria-hidden="true">ğŸš«</span>
                                                                </button>
                                                            )}
                                                            {item.outOfStock && (
                                                                <span className="px-2 py-1 bg-orange-100 dark:bg-orange-900/50 text-orange-600 dark:text-orange-400 text-xs rounded-lg font-medium" role="status">
                                                                    ××–×œ
                                                                </span>
                                                            )}
                                                            <button
                                                                onClick={() => setShowDeleteConfirm(item.id)}
                                                                aria-label={`××—×§ ××ª ${item.name} ××”×¨×©×™××”`}
                                                                className="w-8 h-8 rounded-lg flex items-center justify-center text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/30 transition-all touch-target"
                                                                title="××—×§"
                                                            >
                                                                <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2} aria-hidden="true">
                                                                    <path strokeLinecap="round" strokeLinejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                                                </svg>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </SwipeableItem>
                                        ))}
                                    </div>
                                ))}
                            </div>
                        )}

                        {filteredItems.length === 0 && !searchTerm && (
                            <div className="glass rounded-2xl shadow-xl p-12 text-center">
                                <div className="text-7xl mb-6 float">ğŸ›’</div>
                                <p className="text-2xl text-gradient font-bold mb-2">×”×¨×©×™××” ×¨×™×§×”</p>
                                <p className="text-gray-500 dark:text-gray-400 mt-2">×”×•×¡×£ ××•×¦×¨×™× ×‘×©×•×¨×ª ×”×—×™×¤×•×© ×œ××˜×”</p>
                            </div>
                        )}

                        {/* Bottom spacing for sticky bar */}
                        <div className="h-24"></div>
                    </div>

                    {/* Sticky Add Bar */}
                    <div className="sticky-add-bar">
                        <div className="max-w-2xl mx-auto flex gap-2 items-center">
                            <div className="relative flex-1">
                                <label htmlFor="product-search" className="sr-only">×—×™×¤×•×© ×•×”×•×¡×¤×ª ××•×¦×¨</label>
                                <input
                                    id="product-search"
                                    ref={addBarInputRef}
                                    type="text"
                                    value={searchTerm}
                                    onChange={e => setSearchTerm(e.target.value)}
                                    placeholder="ğŸ” ×”×•×¡×£ ××•×¦×¨..."
                                    aria-label="×—×™×¤×•×© ×•×”×•×¡×¤×ª ××•×¦×¨ ×œ×¨×©×™××”"
                                    aria-autocomplete="list"
                                    className="w-full px-4 py-3 pr-4 pl-12 border-2 border-gray-200 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800 dark:text-white focus:border-indigo-500 dark:focus:border-indigo-400 focus:ring-2 focus:ring-indigo-100 dark:focus:ring-indigo-900/30 transition-all text-base font-medium placeholder:text-gray-400"
                                />
                                {searchTerm && (
                                    <button
                                        onClick={() => setSearchTerm('')}
                                        className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-red-500 text-xl touch-target"
                                        aria-label="× ×§×” ×©×“×” ×—×™×¤×•×©"
                                    >
                                        <span aria-hidden="true">âœ•</span>
                                    </button>
                                )}
                            </div>
                            {voiceSupported && (
                                <button
                                    onClick={isListening ? stopListening : startListening}
                                    className={`w-12 h-12 rounded-xl flex items-center justify-center text-xl transition-all touch-target ${
                                        isListening
                                            ? 'bg-red-500 text-white animate-pulse'
                                            : 'bg-indigo-100 dark:bg-indigo-900/50 text-indigo-600 dark:text-indigo-400 hover:bg-indigo-200'
                                    }`}
                                    aria-label={isListening ? '×”×¤×¡×§ ×”×§×œ×˜×” ×§×•×œ×™×ª' : '×”×ª×—×œ ×”×§×œ×˜×” ×§×•×œ×™×ª ×œ×”×•×¡×¤×ª ××•×¦×¨×™×'}
                                    aria-pressed={isListening}
                                >
                                    <span aria-hidden="true">{isListening ? 'â¹ï¸' : 'ğŸ¤'}</span>
                                </button>
                            )}
                        </div>

                        {/* Voice listening indicator - Enhanced */}
                        {isListening && (
                            <div className="max-w-2xl mx-auto mt-2 expand-in">
                                <div className="bg-gradient-to-r from-purple-100 to-indigo-100 dark:from-purple-900/50 dark:to-indigo-900/50 rounded-xl p-4 border-2 border-purple-300 dark:border-purple-700">
                                    <div className="flex items-center justify-between mb-2">
                                        <div className="flex items-center gap-2">
                                            <div className="flex items-center h-4">
                                                <span className="sound-wave"></span>
                                                <span className="sound-wave"></span>
                                                <span className="sound-wave"></span>
                                            </div>
                                            <span className="text-sm font-bold text-purple-700 dark:text-purple-300">
                                                {voiceStatus || (voiceLang === 'en-US' ? 'Listening...' : '××§×©×™×‘...')}
                                            </span>
                                        </div>
                                        <button onClick={toggleVoiceLang} className="text-xs px-3 py-1 bg-white dark:bg-gray-800 rounded-full shadow-sm font-medium">
                                            {voiceLang === 'en-US' ? 'ğŸ‡ºğŸ‡¸ English' : 'ğŸ‡®ğŸ‡± ×¢×‘×¨×™×ª'}
                                        </button>
                                    </div>
                                    {voiceTranscript && (
                                        <div className="bg-white dark:bg-gray-800 rounded-lg p-3 mt-2">
                                            <p className="text-gray-600 dark:text-gray-300 text-sm">
                                                <span className="text-purple-500">×©××¢×ª×™:</span> {voiceTranscript}
                                            </p>
                                        </div>
                                    )}
                                    <p className="text-xs text-purple-500 dark:text-purple-400 mt-2 text-center">
                                        ğŸ’¡ ×˜×™×¤: ×“×‘×¨ ×‘×¨×•×¨ ×•×××•×¨ "×”×•×¡×£ ×—×œ×‘ ×•×‘×™×¦×™×"
                                    </p>
                                </div>
                            </div>
                        )}

                        {/* Voice status message (when not listening) */}
                        {!isListening && voiceStatus && voiceStatus !== '××ª×—×™×œ...' && (
                            <div className="max-w-2xl mx-auto mt-2 text-center">
                                <p className="text-sm text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-800 rounded-lg py-2 px-4 inline-block">
                                    {voiceStatus}
                                </p>
                            </div>
                        )}

                        {/* Quick add suggestions when searching */}
                        {searchTerm && !isListening && (
                            <div className="max-w-2xl mx-auto mt-2 flex flex-wrap gap-1.5 pb-1">
                                {Object.entries(PRODUCTS)
                                    .flatMap(([cat, prods]) => prods.map(p => ({ name: p, cat })))
                                    .filter(p => p.name.includes(searchTerm))
                                    .slice(0, 6)
                                    .map((p, i) => (
                                        <button
                                            key={i}
                                            onClick={() => addProduct(p.name)}
                                            className="px-2.5 py-1.5 bg-indigo-100 dark:bg-indigo-900/50 text-indigo-700 dark:text-indigo-300 rounded-lg text-xs font-medium hover:bg-indigo-200 dark:hover:bg-indigo-800 transition-all expand-in"
                                        >
                                            {CATEGORIES[p.cat]?.icon} {p.name}
                                        </button>
                                    ))}
                                {searchTerm.length >= 2 && !Object.values(PRODUCTS).flat().some(p => p === searchTerm) && (
                                    <button
                                        onClick={() => addProduct(searchTerm)}
                                        className="px-2.5 py-1.5 bg-emerald-100 dark:bg-emerald-900/50 text-emerald-700 dark:text-emerald-300 rounded-lg text-xs font-medium hover:bg-emerald-200 dark:hover:bg-emerald-800 transition-all expand-in"
                                    >
                                        â• "{searchTerm}"
                                    </button>
                                )}
                            </div>
                        )}
                    </div>

                    {/* Accessibility Button */}
                    <button
                        onClick={() => setShowAccessibility(true)}
                        className="accessibility-btn"
                        title="×”×’×“×¨×•×ª × ×’×™×©×•×ª"
                        aria-label="×¤×ª×— ×ª×¤×¨×™×˜ × ×’×™×©×•×ª"
                    >
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="4" r="2" fill="white"/>
                            <path d="M19 13v-2c-1.54.02-3.09-.75-4.07-1.83l-1.29-1.43c-.17-.19-.38-.34-.61-.45-.01 0-.01-.01-.02-.01H13c-.35-.2-.75-.3-1.19-.26C10.76 7.11 10 8.04 10 9.09V15c0 1.1.9 2 2 2h5v5h2v-5.5c0-1.1-.9-2-2-2h-3v-3.45c1.29 1.07 3.25 1.94 5 1.95zm-6.17 5c-.41 1.16-1.52 2-2.83 2-1.66 0-3-1.34-3-3 0-1.31.84-2.41 2-2.83V12.1c-2.28.46-4 2.48-4 4.9 0 2.76 2.24 5 5 5 2.42 0 4.44-1.72 4.9-4h-2.07z" fill="white"/>
                        </svg>
                    </button>

                    {/* Help Button */}
                    <button
                        onClick={() => setShowHelp(true)}
                        className="fixed bottom-100 left-4 w-12 h-12 bg-gradient-to-r from-green-500 to-emerald-500 rounded-full flex items-center justify-center text-white text-2xl shadow-lg z-[9998] hover:scale-110 transition-transform touch-target"
                        style={{ bottom: '160px' }}
                        title="×¢×–×¨×” ×•××©×•×‘"
                        aria-label="×¤×ª×— ×ª×¤×¨×™×˜ ×¢×–×¨×” ×•××©×•×‘"
                    >
                        <span aria-hidden="true">?</span>
                    </button>

                    {/* Accessibility Modal */}
                    {showAccessibility && (
                        <div className="fixed inset-0 bg-black/50 z-[10000] flex items-start justify-center pt-10 overflow-y-auto" onClick={() => setShowAccessibility(false)}>
                            <div className="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-md mx-4 mb-10" onClick={e => e.stopPropagation()}>
                                <div className="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
                                    <button onClick={() => setShowAccessibility(false)} className="text-2xl text-gray-500 hover:text-gray-700 touch-target" aria-label="×¡×’×•×¨ ×ª×¤×¨×™×˜ × ×’×™×©×•×ª"><span aria-hidden="true">âœ•</span></button>
                                    <h2 className="text-xl font-bold text-gray-800 dark:text-white">×¡×¨×’×œ × ×’×™×©×•×ª</h2>
                                    <div className="w-8"></div>
                                </div>
                                <div className="p-4 space-y-4">
                                    {/* Skip to content */}
                                    <button onClick={() => { document.querySelector('main, [role="main"], .max-w-4xl')?.scrollIntoView(); setShowAccessibility(false); }}
                                        className="w-full py-3 bg-gray-100 dark:bg-gray-700 rounded-xl font-medium text-gray-800 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                        ×“×œ×’ ×œ×ª×•×›×Ÿ ×”×¢××•×“
                                    </button>

                                    {/* Font Size */}
                                    <div>
                                        <p className="text-sm text-gray-500 dark:text-gray-400 mb-2 text-center">×’×•×¤×Ÿ ×•×§×™×©×•×¨×™×</p>
                                        <div className="flex gap-2">
                                            <button onClick={() => updateAccessibility('fontSize', 'large')}
                                                className={`flex-1 py-2 rounded-xl font-medium transition-colors ${accessibilitySettings.fontSize === 'large' ? 'bg-blue-500 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-white'}`}>
                                                ×”×’×“×œ×ª ×˜×§×¡×˜
                                            </button>
                                            <button onClick={() => updateAccessibility('fontSize', 'small')}
                                                className={`flex-1 py-2 rounded-xl font-medium transition-colors ${accessibilitySettings.fontSize === 'small' ? 'bg-blue-500 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-white'}`}>
                                                ×”×§×˜× ×ª ×˜×§×¡×˜
                                            </button>
                                            <button onClick={() => updateAccessibility('highlightLinks', !accessibilitySettings.highlightLinks)}
                                                className={`flex-1 py-2 rounded-xl font-medium transition-colors ${accessibilitySettings.highlightLinks ? 'bg-blue-500 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-white'}`}>
                                                ×”×“×’×© ×§×™×©×•×¨×™×
                                            </button>
                                        </div>
                                    </div>

                                    {/* Contrast */}
                                    <div>
                                        <p className="text-sm text-gray-500 dark:text-gray-400 mb-2 text-center">×¦×‘×¢×™×</p>
                                        <div className="flex gap-2">
                                            <button onClick={() => updateAccessibility('contrast', 'low')}
                                                className={`flex-1 py-2 rounded-xl font-medium transition-colors ${accessibilitySettings.contrast === 'low' ? 'bg-blue-500 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-white'}`}>
                                                × ×™×’×•×“×™×•×ª ×¢×“×™× ×”
                                            </button>
                                            <button onClick={() => updateAccessibility('contrast', 'normal')}
                                                className={`flex-1 py-2 rounded-xl font-medium transition-colors ${accessibilitySettings.contrast === 'normal' ? 'bg-blue-500 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-white'}`}>
                                                × ×™×’×•×“×™×•×ª ×¨×’×™×œ×”
                                            </button>
                                            <button onClick={() => updateAccessibility('contrast', 'high')}
                                                className={`flex-1 py-2 rounded-xl font-medium transition-colors ${accessibilitySettings.contrast === 'high' ? 'bg-blue-500 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-white'}`}>
                                                × ×™×’×•×“×™×•×ª ×’×‘×•×”×”
                                            </button>
                                        </div>
                                    </div>

                                    {/* Cursor */}
                                    <div>
                                        <p className="text-sm text-gray-500 dark:text-gray-400 mb-2 text-center">×¡××Ÿ ×”×¢×›×‘×¨</p>
                                        <div className="flex gap-2">
                                            <button onClick={() => updateAccessibility('cursorSize', 'large-black')}
                                                className={`flex-1 py-2 rounded-xl font-medium transition-colors ${accessibilitySettings.cursorSize === 'large-black' ? 'bg-blue-500 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-white'}`}>
                                                ×¡××Ÿ ×’×“×•×œ ×©×—×•×¨
                                            </button>
                                            <button onClick={() => updateAccessibility('cursorSize', 'normal')}
                                                className={`flex-1 py-2 rounded-xl font-medium transition-colors ${accessibilitySettings.cursorSize === 'normal' ? 'bg-blue-500 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-white'}`}>
                                                ×¡××Ÿ ×¨×’×™×œ
                                            </button>
                                            <button onClick={() => updateAccessibility('cursorSize', 'large-white')}
                                                className={`flex-1 py-2 rounded-xl font-medium transition-colors ${accessibilitySettings.cursorSize === 'large-white' ? 'bg-blue-500 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-white'}`}>
                                                ×¡××Ÿ ×’×“×•×œ ×œ×‘×Ÿ
                                            </button>
                                        </div>
                                    </div>

                                    {/* Reset */}
                                    <button onClick={resetAccessibility}
                                        className="w-full py-3 bg-gray-200 dark:bg-gray-600 rounded-xl font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors">
                                        ××™×¤×•×¡ ×›×œ ×”×”×’×“×¨×•×ª
                                    </button>

                                    {/* Footer links */}
                                    <div className="flex justify-between pt-2 border-t border-gray-200 dark:border-gray-700">
                                        <button onClick={() => setShowFeedback(true)} className="text-blue-500 hover:underline text-sm">×¦×•×¨ ×§×©×¨</button>
                                        <button onClick={() => alert('××¤×œ×™×§×¦×™×™×ª ShopSmart ××—×•×™×‘×ª ×œ× ×’×™×©×•×ª ××œ××” ×œ×›×œ ×”××©×ª××©×™×.\n\n×”××¤×œ×™×§×¦×™×” ×ª×•×›× × ×” ×‘×”×ª×× ×œ×ª×§×Ÿ ×”×™×©×¨××œ×™ ×ª"×™ 5568 ×•×œ×”× ×—×™×•×ª WCAG 2.1 ×‘×¨××” AA.\n\n×œ×©××œ×•×ª ×‘× ×•×©× × ×’×™×©×•×ª × ×™×ª×Ÿ ×œ×¤× ×•×ª ××œ×™× ×•.')} className="text-blue-500 hover:underline text-sm">×”×¦×”×¨×ª × ×’×™×©×•×ª</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Help Modal */}
                    {showHelp && (
                        <div className="fixed inset-0 bg-black/50 z-[10000] flex items-center justify-center p-4" onClick={() => setShowHelp(false)}>
                            <div className="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto" onClick={e => e.stopPropagation()}>
                                <div className="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700 sticky top-0 bg-white dark:bg-gray-800">
                                    <button onClick={() => setShowHelp(false)} className="text-2xl text-gray-500 hover:text-gray-700 touch-target" aria-label="×¡×’×•×¨ ×—×œ×•×Ÿ ×¢×–×¨×”"><span aria-hidden="true">âœ•</span></button>
                                    <h2 className="text-xl font-bold text-gray-800 dark:text-white">×¢×–×¨×”</h2>
                                    <div className="w-8"></div>
                                </div>
                                <div className="p-4 space-y-4">
                                    <div className="bg-indigo-50 dark:bg-indigo-900/30 rounded-xl p-4">
                                        <h3 className="font-bold text-indigo-800 dark:text-indigo-200 mb-2">ğŸ›’ ××™×š ×œ×”×©×ª××© ×‘××¤×œ×™×§×¦×™×”</h3>
                                        <ul className="text-sm text-indigo-700 dark:text-indigo-300 space-y-2 list-disc list-inside">
                                            <li>×‘×—×¨ ×§×˜×’×•×¨×™×” ×•×œ×—×¥ ×¢×œ ××•×¦×¨ ×œ×”×•×¡×¤×” ×œ×¨×©×™××”</li>
                                            <li>×”×—×œ×§ ×©×××œ×” ×¢×œ ××•×¦×¨ ×œ×¡×™××•×Ÿ "× ×§× ×”"</li>
                                            <li>×”×—×œ×§ ×™××™× ×” ×œ×“×—×™×™×” ×œ×¡×•×£ ×”×¨×©×™××”</li>
                                            <li>×”×©×ª××© ×‘×—×™×¤×•×© ×œ××¦×™××ª ××•×¦×¨×™× ××”×™×¨×”</li>
                                        </ul>
                                    </div>
                                    <div className="bg-purple-50 dark:bg-purple-900/30 rounded-xl p-4">
                                        <h3 className="font-bold text-purple-800 dark:text-purple-200 mb-2">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ×©×™×ª×•×£ ×¢× ×”××©×¤×—×”</h3>
                                        <ul className="text-sm text-purple-700 dark:text-purple-300 space-y-2 list-disc list-inside">
                                            <li>×©×ª×£ ××ª ×§×•×“ ×”××©×¤×—×” ×¢× ×‘× ×™ ×”×‘×™×ª</li>
                                            <li>×›×•×œ× ×™×›×•×œ×™× ×œ×”×•×¡×™×£ ×•×œ×¢×¨×•×š ×¤×¨×™×˜×™×</li>
                                            <li>×¦'××˜ ××•×‘× ×” ×œ×ª×™××•× ×”×§× ×™×•×ª</li>
                                        </ul>
                                    </div>
                                    <div className="bg-amber-50 dark:bg-amber-900/30 rounded-xl p-4">
                                        <h3 className="font-bold text-amber-800 dark:text-amber-200 mb-2">ğŸ“· ×¡×¨×™×§×” ×—×›××”</h3>
                                        <ul className="text-sm text-amber-700 dark:text-amber-300 space-y-2 list-disc list-inside">
                                            <li>×¡×¨×•×§ ××ª×›×•×Ÿ ×œ×”×•×¡×¤×ª ×¨×›×™×‘×™× ××•×˜×•××˜×™×ª</li>
                                            <li>×¦×œ× ××•×¦×¨ ×œ×–×™×”×•×™ ×•×”×•×¡×¤×”</li>
                                        </ul>
                                    </div>
                                    <button onClick={() => { setShowHelp(false); setShowFeedback(true); }}
                                        className="w-full py-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-xl font-bold hover:opacity-90 transition-opacity">
                                        ğŸ“§ ×©×œ×— ××©×•×‘ ××• ×“×™×•×•×— ×¢×œ ×‘×¢×™×”
                                    </button>
                                    <button onClick={() => { localStorage.removeItem('hasSeenOnboarding'); setShowHelp(false); setShowOnboarding(true); setOnboardingStep(0); }}
                                        className="w-full py-3 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 rounded-xl font-medium hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                        ğŸ“ ×”×¦×’ ×”×“×¨×›×” ××—×“×©
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Feedback Modal */}
                    {showFeedback && (
                        <div className="fixed inset-0 bg-black/50 z-[10001] flex items-center justify-center p-4" onClick={() => setShowFeedback(false)}>
                            <div className="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-md" onClick={e => e.stopPropagation()}>
                                <div className="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
                                    <button onClick={() => setShowFeedback(false)} className="text-2xl text-gray-500 hover:text-gray-700">âœ•</button>
                                    <h2 className="text-xl font-bold text-gray-800 dark:text-white">×©×œ×— ××©×•×‘</h2>
                                    <div className="w-8"></div>
                                </div>
                                {feedbackSent ? (
                                    <div className="p-8 text-center">
                                        <div className="text-5xl mb-4">âœ…</div>
                                        <p className="text-lg font-medium text-gray-800 dark:text-white">×ª×•×“×” ×¢×œ ×”××©×•×‘!</p>
                                        <p className="text-gray-500 dark:text-gray-400">× ×—×–×•×¨ ××œ×™×š ×‘×”×§×“×</p>
                                    </div>
                                ) : (
                                    <div className="p-4 space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">×¡×•×’ ×”×¤× ×™×™×”</label>
                                            <div className="flex gap-2">
                                                <button onClick={() => setFeedbackType('bug')}
                                                    className={`flex-1 py-2 rounded-xl font-medium transition-colors ${feedbackType === 'bug' ? 'bg-red-500 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200'}`}>
                                                    ğŸ› ×‘××’
                                                </button>
                                                <button onClick={() => setFeedbackType('feature')}
                                                    className={`flex-1 py-2 rounded-xl font-medium transition-colors ${feedbackType === 'feature' ? 'bg-blue-500 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200'}`}>
                                                    ğŸ’¡ ×‘×§×©×”
                                                </button>
                                                <button onClick={() => setFeedbackType('other')}
                                                    className={`flex-1 py-2 rounded-xl font-medium transition-colors ${feedbackType === 'other' ? 'bg-purple-500 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200'}`}>
                                                    ğŸ’¬ ××—×¨
                                                </button>
                                            </div>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">×ª×™××•×¨</label>
                                            <textarea
                                                value={feedbackText}
                                                onChange={(e) => setFeedbackText(e.target.value)}
                                                placeholder="×¡×¤×¨ ×œ× ×• ××” ×§×¨×” ××• ××” ×ª×¨×¦×” ×œ×¨××•×ª..."
                                                className="w-full h-32 p-3 border border-gray-200 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-800 dark:text-white resize-none focus:ring-2 focus:ring-indigo-500"
                                            />
                                        </div>
                                        <button onClick={sendFeedback} disabled={!feedbackText.trim() || feedbackSending}
                                            className="w-full py-3 bg-gradient-to-r from-indigo-500 to-purple-500 text-white rounded-xl font-bold disabled:opacity-50 hover:opacity-90 transition-opacity">
                                            {feedbackSending ? 'â³ ×©×•×œ×—...' : 'ğŸ“¤ ×©×œ×—'}
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}

                    {/* Onboarding Modal */}
                    {showOnboarding && (
                        <div className="fixed inset-0 bg-black/70 z-[10002] flex items-center justify-center p-4">
                            <div className="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-md overflow-hidden">
                                {onboardingStep === 0 && (
                                    <div className="p-6 text-center">
                                        <div className="text-6xl mb-4">ğŸ›’</div>
                                        <h2 className="text-2xl font-bold text-gray-800 dark:text-white mb-2">×‘×¨×•×›×™× ×”×‘××™× ×œ-ShopSmart!</h2>
                                        <p className="text-gray-600 dark:text-gray-300 mb-6">×¨×©×™××ª ×§× ×™×•×ª ×—×›××” ×œ×›×œ ×”××©×¤×—×”</p>
                                        <button onClick={() => setOnboardingStep(1)} className="w-full py-3 bg-gradient-to-r from-indigo-500 to-purple-500 text-white rounded-xl font-bold">
                                            ×‘×•××• × ×ª×—×™×œ! â†’
                                        </button>
                                    </div>
                                )}
                                {onboardingStep === 1 && (
                                    <div className="p-6">
                                        <div className="text-4xl mb-3 text-center">ğŸ“±</div>
                                        <h3 className="text-xl font-bold text-gray-800 dark:text-white mb-2 text-center">×”×•×¡×¤×ª ××•×¦×¨×™×</h3>
                                        <div className="bg-indigo-50 dark:bg-indigo-900/30 rounded-xl p-4 mb-4">
                                            <ul className="text-sm text-gray-700 dark:text-gray-300 space-y-2">
                                                <li>ğŸ“‚ <strong>×§×˜×’×•×¨×™×•×ª:</strong> ×‘×—×¨ ×§×˜×’×•×¨×™×” ×•×œ×—×¥ ×¢×œ ××•×¦×¨</li>
                                                <li>ğŸ” <strong>×—×™×¤×•×©:</strong> ×”×§×œ×“ ×©× ××•×¦×¨ ×‘×©×•×¨×ª ×”×—×™×¤×•×©</li>
                                                <li>ğŸ¤ <strong>×§×•×œ×™:</strong> ×œ×—×¥ ×¢×œ ×”××™×§×¨×•×¤×•×Ÿ ×•×××•×¨ ××ª ×”××•×¦×¨</li>
                                            </ul>
                                        </div>
                                        <div className="flex gap-2">
                                            <button onClick={() => setOnboardingStep(0)} className="flex-1 py-2 bg-gray-100 dark:bg-gray-700 rounded-xl">â† ×”×§×•×“×</button>
                                            <button onClick={() => setOnboardingStep(2)} className="flex-1 py-2 bg-indigo-500 text-white rounded-xl">×”×‘× â†’</button>
                                        </div>
                                    </div>
                                )}
                                {onboardingStep === 2 && (
                                    <div className="p-6">
                                        <div className="text-4xl mb-3 text-center">ğŸ‘†</div>
                                        <h3 className="text-xl font-bold text-gray-800 dark:text-white mb-2 text-center">× ×™×”×•×œ ×”×¨×©×™××”</h3>
                                        <div className="bg-green-50 dark:bg-green-900/30 rounded-xl p-4 mb-4">
                                            <ul className="text-sm text-gray-700 dark:text-gray-300 space-y-2">
                                                <li>ğŸ‘ˆ <strong>×”×—×œ×§×” ×©×××œ×”:</strong> ×¡×™××•×Ÿ "× ×§× ×”" âœ“</li>
                                                <li>ğŸ‘‰ <strong>×”×—×œ×§×” ×™××™× ×”:</strong> ×“×—×™×™×” ×œ×¡×•×£ ×”×¨×©×™××”</li>
                                                <li>ğŸ”¢ <strong>×œ×—×™×¦×” ×¢×œ ×›××•×ª:</strong> ×©×™× ×•×™ ×›××•×ª</li>
                                                <li>ğŸ“ <strong>×œ×—×™×¦×” ××¨×•×›×”:</strong> ×¢×¨×™×›×ª ×”×¢×¨×”</li>
                                            </ul>
                                        </div>
                                        <div className="flex gap-2">
                                            <button onClick={() => setOnboardingStep(1)} className="flex-1 py-2 bg-gray-100 dark:bg-gray-700 rounded-xl">â† ×”×§×•×“×</button>
                                            <button onClick={() => setOnboardingStep(3)} className="flex-1 py-2 bg-indigo-500 text-white rounded-xl">×”×‘× â†’</button>
                                        </div>
                                    </div>
                                )}
                                {onboardingStep === 3 && (
                                    <div className="p-6">
                                        <div className="text-4xl mb-3 text-center">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</div>
                                        <h3 className="text-xl font-bold text-gray-800 dark:text-white mb-2 text-center">×©×™×ª×•×£ ××©×¤×—×ª×™</h3>
                                        <div className="bg-purple-50 dark:bg-purple-900/30 rounded-xl p-4 mb-4">
                                            <ul className="text-sm text-gray-700 dark:text-gray-300 space-y-2">
                                                <li>ğŸ”— <strong>×§×•×“ ××©×¤×—×”:</strong> ×©×ª×£ ×¢× ×‘× ×™ ×”×‘×™×ª ×œ×”×¦×˜×¨×¤×•×ª</li>
                                                <li>ğŸ’¬ <strong>×¦'××˜:</strong> ×ª×§×©×•×¨×ª ×‘×–××Ÿ ×××ª</li>
                                                <li>ğŸ”„ <strong>×¡× ×›×¨×•×Ÿ:</strong> ×©×™× ×•×™×™× ××•×¤×™×¢×™× ××™×“ ××¦×œ ×›×•×œ×</li>
                                            </ul>
                                        </div>
                                        <div className="flex gap-2">
                                            <button onClick={() => setOnboardingStep(2)} className="flex-1 py-2 bg-gray-100 dark:bg-gray-700 rounded-xl">â† ×”×§×•×“×</button>
                                            <button onClick={() => setOnboardingStep(4)} className="flex-1 py-2 bg-indigo-500 text-white rounded-xl">×”×‘× â†’</button>
                                        </div>
                                    </div>
                                )}
                                {onboardingStep === 4 && (
                                    <div className="p-6 text-center">
                                        <div className="text-6xl mb-4">ğŸ‰</div>
                                        <h3 className="text-xl font-bold text-gray-800 dark:text-white mb-2">××•×›× ×™× ×œ×§× ×™×•×ª!</h3>
                                        <p className="text-gray-600 dark:text-gray-300 mb-4">×ª××™×“ ××¤×©×¨ ×œ×—×–×•×¨ ×œ×”×“×¨×›×” ××›×¤×ª×•×¨ ×”×¢×–×¨×”</p>
                                        <div className="flex gap-2 text-xs text-gray-500 dark:text-gray-400 justify-center mb-4">
                                            <span>â™¿ × ×’×™×©×•×ª</span>
                                            <span>â€¢</span>
                                            <span>â“ ×¢×–×¨×”</span>
                                        </div>
                                        <button onClick={completeOnboarding} className="w-full py-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-xl font-bold">
                                            âœ¨ ×‘×•××• × ×ª×—×™×œ!
                                        </button>
                                    </div>
                                )}
                                {/* Progress dots */}
                                <div className="flex justify-center gap-2 pb-4">
                                    {[0, 1, 2, 3, 4].map(step => (
                                        <div key={step} className={`w-2 h-2 rounded-full transition-colors ${onboardingStep === step ? 'bg-indigo-500' : 'bg-gray-300 dark:bg-gray-600'}`} />
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}
                    </main>
                </div>
            );
        }

        // Main App Content (inside FamilyProvider)
        function AppContent() {
            const { family, loading: familyLoading } = useFamily();

            if (familyLoading) {
                return (
                    <div className="min-h-screen gradient-bg flex items-center justify-center">
                        <div className="text-center">
                            <div className="text-6xl mb-4 float">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</div>
                            <div className="text-xl text-white font-medium">×˜×•×¢×Ÿ ××©×¤×—×”...</div>
                            <div className="mt-4 w-32 h-1 bg-white/20 rounded-full overflow-hidden mx-auto">
                                <div className="h-full w-1/2 progress-animate rounded-full"></div>
                            </div>
                        </div>
                    </div>
                );
            }

            if (!family) {
                return <NoFamilyScreen />;
            }

            return <ShoppingList />;
        }

        // Main App Component
        function App() {
            const { user, loading } = useAuth();

            if (loading) {
                return (
                    <div className="min-h-screen gradient-bg flex items-center justify-center">
                        <div className="text-center">
                            <div className="text-6xl mb-4 float">ğŸ›’</div>
                            <div className="text-xl text-white font-medium">×˜×•×¢×Ÿ...</div>
                            <div className="mt-4 w-32 h-1 bg-white/20 rounded-full overflow-hidden mx-auto">
                                <div className="h-full w-1/2 progress-animate rounded-full"></div>
                            </div>
                        </div>
                    </div>
                );
            }

            if (!user) {
                return <AuthScreen />;
            }

            return (
                <FamilyProvider>
                    <AppContent />
                </FamilyProvider>
            );
        }

        ReactDOM.render(
            <AuthProvider>
                <App />
            </AuthProvider>,
            document.getElementById('root')
        );
    </script>
</body>
</html>
