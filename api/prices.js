// Vercel Serverless Function - Israeli Supermarket Prices API
// This API returns estimated prices for common Israeli supermarket products

// Comprehensive price database (average prices in NIS)
// Updated: February 2025
const PRICES_DATABASE = {
  // Dairy - מוצרי חלב
  'חלב 3%': 6.90, 'חלב 1%': 6.50, 'חלב דל שומן': 6.50,
  'חלב סויה': 12.90, 'חלב שקדים': 14.90, 'חלב קוקוס': 14.90,
  'חלב שיבולת שועל': 13.90, 'לבן': 5.90, 'לבן עז': 8.90,
  'קוטג׳ 5%': 8.90, 'קוטג׳ 3%': 8.50, 'קוטג׳': 8.90,
  'גבינה צהובה עמק': 32.90, 'גבינה צהובה גלבוע': 28.90,
  'גבינה צהובה 9%': 24.90, 'גבינה צהובה 22%': 28.90,
  'גבינה צהובה': 28.90, 'עמק': 32.90, 'גלבוע': 28.90,
  'גבינה בולגרית': 18.90, 'צפתית': 22.90, 'גבינת שמנת': 12.90,
  'מוצרלה': 19.90, 'פרמזן': 42.90, 'גאודה': 34.90,
  'אמנטל': 38.90, 'ברי': 32.90, 'קממבר': 28.90, 'חלומי': 36.90,
  'פילדלפיה': 16.90, 'לאבנה': 12.90, 'ריקוטה': 22.90, 'גבינת עזים': 28.90,
  'גבינה לבנה 5%': 8.90, 'גבינה לבנה 9%': 9.90, 'גבינה לבנה': 8.90,
  'ביצים': 24.90, 'ביצים L': 24.90, 'ביצים XL': 28.90,
  'ביצים אורגניות': 34.90, 'ביצים חופשיות': 32.90,
  'חמאה': 14.90, 'חמאה מלוחה': 15.90,
  'שמנת מתוקה': 9.90, 'שמנת חמוצה': 7.90, 'שמנת לקצפת': 11.90,
  'יוגורט': 5.90, 'יוגורט יווני': 8.90, 'יוגורט יווני 0%': 9.90,
  'יוגורט תנובה': 5.90, 'יוגורט אקטיביה': 7.90,
  'מרגרינה': 9.90, 'טופו': 18.90,

  // Bread & Bakery - לחם ומאפים
  'לחם': 7.90, 'לחם מלא': 9.90, 'לחם שיפון': 12.90,
  'לחם כוסמין': 14.90, 'לחם דגנים': 11.90, 'לחם פרוס': 8.90,
  'לחם ללא גלוטן': 22.90, 'חלה': 12.90, 'חלה מלאה': 14.90,
  'פיתות': 8.90, 'פיתות מלאות': 10.90, 'פיתות מיני': 7.90,
  'לחמניות': 9.90, 'לחמניות המבורגר': 12.90,
  'בגט': 6.90, 'צ\'בטה': 9.90, 'פוקצ\'ה': 14.90,
  'טורטייה': 14.90, 'לאפה': 8.90,
  'קרואסון': 7.90, 'קרואסון שוקולד': 9.90,
  'בורקס גבינה': 14.90, 'בורקס תפו״א': 12.90, 'בורקס פטריות': 14.90, 'בורקס': 12.90,
  'מאפינס': 16.90, 'עוגיות': 12.90, 'עוגיות שוקולד צ\'יפס': 14.90,
  'רוגלך': 19.90, 'שטרודל': 24.90, 'מצות': 12.90, 'קרקרים': 9.90,

  // Fruits & Vegetables - פירות וירקות
  'עגבניות': 8.90, 'עגבניות שרי': 12.90, 'עגבניות מגי': 14.90,
  'מלפפונים': 6.90, 'מלפפון בייבי': 9.90,
  'בצל': 4.90, 'בצל סגול': 6.90, 'בצל ירוק': 4.90, 'שום': 9.90,
  'פלפל אדום': 12.90, 'פלפל ירוק': 8.90, 'פלפל צהוב': 12.90, 'פלפל': 10.90,
  'חסה': 7.90, 'חסה אייסברג': 9.90, 'חסה רומית': 8.90,
  'כרוב': 5.90, 'כרוב סגול': 7.90,
  'גזר': 5.90, 'גזר בייבי': 9.90, 'סלק': 6.90,
  'תפו״א': 5.90, 'תפו״א אדום': 5.90, 'תפו״א לבן': 5.90, 'תפוחי אדמה': 5.90,
  'בטטה': 8.90, 'קישוא': 7.90, 'חציל': 8.90,
  'ברוקולי': 12.90, 'כרובית': 9.90, 'תרד': 9.90,
  'פטרוזיליה': 4.90, 'כוסברה': 4.90, 'נענע': 4.90, 'שמיר': 4.90, 'בזיליקום': 5.90,
  'רוקט': 9.90, 'סלרי': 7.90, 'שומר': 8.90,
  'פטריות': 14.90, 'פטריות שמפיניון': 14.90, 'פטריות פורטובלו': 19.90,
  'בננות': 9.90, 'תפוחים': 12.90, 'תפוחים ירוקים': 12.90, 'תפוחים אדומים': 12.90,
  'תפוזים': 8.90, 'קלמנטינות': 12.90,
  'אשכולית': 6.90, 'אשכולית אדומה': 7.90, 'פומלה': 8.90,
  'לימון': 7.90, 'ליים': 9.90, 'אבוקדו': 6.90,
  'מנגו': 14.90, 'אננס': 16.90,
  'ענבים': 24.90, 'ענבים ירוקים': 24.90, 'ענבים שחורים': 24.90,
  'אגס': 14.90, 'שזיפים': 18.90, 'אפרסקים': 16.90, 'נקטרינות': 16.90,
  'קיווי': 4.90, 'רימונים': 9.90,
  'תותים': 24.90, 'אוכמניות': 34.90, 'פטל': 29.90, 'דובדבנים': 39.90,
  'אבטיח': 3.90, 'מלון': 5.90,

  // Meat - בשר
  'עוף שלם': 32.90, 'עוף שלם טרי': 34.90, 'עוף שלם קפוא': 29.90,
  'חזה עוף': 39.90, 'חזה עוף טרי': 39.90, 'חזה עוף קפוא': 34.90,
  'כרעיים עוף': 22.90, 'כרעיים עוף טריות': 24.90, 'כרעיים עוף קפואות': 19.90,
  'שוקיים עוף': 27.90, 'שוקיים עוף טריים': 29.90,
  'כנפיים עוף': 20.90, 'כנפיים עוף טריות': 22.90,
  'עוף טחון': 32.90, 'עוף טחון טרי': 34.90, 'כבד עוף': 17.90, 'כבד עוף טרי': 19.90,
  'פרגית': 34.90, 'פרגית טרייה': 36.90,
  'חזה הודו': 42.90, 'חזה הודו טרי': 44.90, 'הודו טחון': 37.90, 'הודו טחון טרי': 39.90,
  'בשר טחון': 47.90, 'בשר טחון טרי': 49.90, 'בשר טחון קפוא': 44.90, 'בשר טחון רזה': 52.90,
  'אנטריקוט': 127.90, 'אנטריקוט טרי': 129.90,
  'סינטה': 107.90, 'סינטה טרייה': 109.90,
  'פילה בקר': 147.90, 'פילה בקר טרי': 149.90,
  'צלעות בקר': 87.90, 'צלעות בקר טריות': 89.90,
  'אסאדו': 77.90, 'אסאדו טרי': 79.90, 'גולש': 67.90, 'גולש טרי': 69.90,
  'שניצל': 40.90, 'שניצל עוף': 40.90, 'שניצל עוף טרי': 42.90, 'שניצל עוף קפוא': 36.90,
  'שניצל הודו': 44.90, 'שניצל הודו טרי': 46.90,
  'המבורגר': 42.90, 'המבורגר טרי': 44.90, 'המבורגר קפוא': 39.90,
  'קבב': 47.90, 'קבב טרי': 49.90,
  'נקניקיות': 24.90, 'נקניקיות עוף': 24.90, 'נקניקיות בקר': 29.90,
  'קציצות': 39.90, 'קציצות עוף': 34.90, 'קציצות בקר': 44.90,

  // Deli - מעדנייה
  'פסטרמה': 89.90, 'פסטרמה דבש': 89.90, 'פסטרמה הודו': 89.90,
  'סלמי': 79.90, 'סלמי הונגרי': 89.90,
  'חזה הודו מעושן': 84.90, 'הודו מעושן': 84.90, 'רוסטביף': 99.90, 'רוסט ביף': 99.90,
  'נקניק': 34.90, 'נקניק פרנקפורטר': 39.90, 'חזה עוף מעושן': 74.90,
  'שניצל מוכן': 49.90, 'קציצות מוכנות': 44.90, 'קבב מוכן': 49.90,

  // Fish - דגים
  'סלמון': 99.90, 'סלמון טרי': 109.90, 'סלמון קפוא': 89.90, 'פילה סלמון': 99.90,
  'טונה טרייה': 89.90, 'דג טונה': 89.90,
  'דניס': 59.90, 'לברק': 69.90, 'בורי': 44.90, 'אמנון': 39.90,
  'פילה דג': 64.90, 'נסיכי ים': 54.90, 'קרפיון': 34.90, 'מוסר': 79.90,
  'שרימפס': 89.90, 'קלמארי': 59.90, 'מידיות': 49.90,

  // Canned & Dry - שימורים ומוצרים יבשים
  'טונה': 12.90, 'טונה בשמן': 14.90, 'טונה במים': 12.90,
  'סרדינים': 9.90, 'תירס': 8.90, 'תירס מתוק': 9.90,
  'אפונה': 7.90, 'שעועית': 8.90, 'שעועית לבנה': 9.90, 'שעועית אדומה': 9.90,
  'חומוס משומר': 8.90, 'טחינה': 14.90, 'טחינה גולמית': 24.90,
  'זיתים': 12.90, 'זיתים ירוקים': 14.90, 'זיתים שחורים': 12.90,
  'מלפפון חמוץ': 9.90, 'רסק עגבניות': 7.90, 'עגבניות מרוסקות': 8.90, 'עגבניות חתוכות': 9.90,

  // Pasta, Rice & Grains - פסטה, אורז ודגנים
  'פסטה': 7.90, 'ספגטי': 7.90, 'פנה': 8.90, 'פוזילי': 8.90,
  'אטריות': 9.90, 'לזניה': 14.90, 'קנלוני': 12.90, 'רביולי': 19.90,
  'אורז': 12.90, 'אורז לבן': 12.90, 'אורז בסמטי': 16.90, 'אורז מלא': 14.90,
  'קוסקוס': 9.90, 'בורגול': 12.90, 'קינואה': 24.90, 'כוסמת': 14.90,
  'עדשים': 12.90, 'עדשים אדומות': 14.90, 'עדשים ירוקות': 14.90,
  'חומוס יבש': 9.90, 'שעועית יבשה': 9.90,

  // Oils & Condiments - שמנים ותבלינים
  'שמן זית': 34.90, 'שמן זית כתית': 44.90, 'שמן קנולה': 14.90,
  'שמן חמניות': 12.90, 'שמן תירס': 14.90, 'שמן שומשום': 19.90,
  'חומץ': 7.90, 'חומץ בלסמי': 19.90, 'חומץ תפוחים': 12.90,
  'סויה': 9.90, 'רוטב סויה': 9.90, 'רוטב צ\'ילי': 12.90, 'רוטב טריאקי': 14.90,
  'קטשופ': 9.90, 'חרדל': 9.90, 'מיונז': 12.90, 'טחינה': 14.90,
  'מלח': 3.90, 'פלפל שחור': 9.90, 'פפריקה': 9.90, 'כורכום': 9.90,
  'קינמון': 9.90, 'אגוז מוסקט': 12.90, 'כמון': 9.90, 'קארי': 12.90,
  'בזיליקום יבש': 9.90, 'אורגנו': 9.90, 'רוזמרין': 9.90, 'תימין': 9.90,
  'סוכר': 7.90, 'סוכר חום': 9.90, 'דבש': 29.90, 'סילאן': 19.90,
  'קמח': 7.90, 'קמח מלא': 9.90, 'קמח תופח': 12.90, 'אבקת אפייה': 4.90,

  // Drinks - משקאות
  'מים מינרליים': 4.90, 'מים מינרליים 1.5 ליטר': 5.90, 'מים מינרליים 6 בקבוקים': 19.90,
  'קולה': 8.90, 'קולה 1.5 ליטר': 9.90, 'קולה זירו': 8.90,
  'ספרייט': 8.90, 'פאנטה': 8.90, 'שוופס': 9.90,
  'מיץ תפוזים': 12.90, 'מיץ תפוחים': 11.90, 'מיץ ענבים': 14.90, 'מיץ גזר': 12.90,
  'נקטר': 9.90, 'לימונענע': 9.90,
  'בירה': 9.90, 'בירה גולדסטאר': 9.90, 'בירה מכבי': 9.90, 'בירה קורונה': 14.90,
  'יין': 34.90, 'יין אדום': 34.90, 'יין לבן': 34.90, 'יין רוזה': 34.90,
  'יין קידוש': 24.90, 'יין מתוק': 29.90,

  // Coffee & Tea - קפה ותה
  'קפה טורקי': 19.90, 'קפה נמס': 24.90, 'קפה עלית': 24.90,
  'קפסולות נספרסו': 29.90, 'קפסולות': 29.90,
  'תה': 9.90, 'תה ירוק': 12.90, 'תה צמחים': 14.90, 'תה עם נענע': 12.90,
  'קקאו': 14.90, 'אבקת קקאו': 14.90,

  // Snacks - חטיפים
  'במבה': 7.90, 'במבה גדולה': 12.90, 'ביסלי': 7.90, 'ביסלי גדול': 12.90,
  'תפוצ\'יפס': 9.90, 'דוריטוס': 12.90, 'פרינגלס': 14.90,
  'אגוזים': 24.90, 'שקדים': 34.90, 'בוטנים': 19.90, 'קשיו': 44.90, 'אגוזי מלך': 54.90,
  'חטיף שוקולד': 5.90, 'שוקולד': 9.90, 'שוקולד מריר': 12.90, 'שוקולד חלב': 9.90,
  'שוקולד פרה': 7.90, 'קינדר': 9.90, 'סניקרס': 6.90, 'מארס': 6.90,
  'עוגיות אוראו': 12.90, 'קרמבו': 14.90,
  'פופקורן': 9.90, 'גרעינים': 14.90, 'גרעיני חמניות': 14.90, 'גרעיני דלעת': 19.90,

  // Frozen - קפואים
  'גלידה': 24.90, 'גלידה בן אנד ג\'ריס': 34.90, 'גלידה שטראוס': 24.90,
  'ירקות קפואים': 14.90, 'ברוקולי קפוא': 14.90, 'שעועית ירוקה קפואה': 12.90,
  'פירות קפואים': 19.90, 'תותים קפואים': 22.90, 'פירות יער קפואים': 24.90,
  'פיצה קפואה': 24.90, 'בצק עלים': 19.90, 'בצק פילו': 14.90,
  'שניצל קפוא': 34.90, 'נאגטס': 29.90, 'פלאפל קפוא': 19.90,
  'בורקס קפוא': 24.90, 'ספרינג רול': 19.90, 'סמבוסק': 22.90,

  // Hygiene - היגיינה
  'סבון ידיים': 9.90, 'סבון גוף': 14.90, 'סבון מוצק': 4.90,
  'שמפו': 19.90, 'שמפו הד אנד שולדרס': 29.90, 'מרכך שיער': 19.90,
  'משחת שיניים': 14.90, 'משחת שיניים קולגייט': 14.90, 'מברשת שיניים': 12.90,
  'חוט דנטלי': 14.90, 'מי פה': 19.90,
  'דאודורנט': 19.90, 'דאודורנט רול און': 19.90, 'דאודורנט ספריי': 22.90,
  'קרם גוף': 24.90, 'קרם ידיים': 14.90, 'קרם פנים': 34.90,
  'קרם לחות': 29.90, 'קרם הגנה': 39.90,
  'נייר טואלט': 29.90, 'נייר טואלט 24 גלילים': 44.90, 'ממחטות': 9.90, 'ממחטות אף': 9.90,
  'גילוח': 29.90, 'סכיני גילוח': 44.90, 'קצף גילוח': 19.90,
  'תחבושות': 14.90, 'טמפונים': 24.90, 'פדים': 9.90,

  // Baby - תינוקות
  'חיתולים': 47.90, 'חיתולים מידה 1': 44.90, 'חיתולים מידה 2': 46.90,
  'חיתולים מידה 3': 49.90, 'חיתולים מידה 4': 49.90,
  'חיתולים מידה 5': 52.90, 'חיתולים מידה 6': 54.90,
  'מגבונים לתינוקות': 14.90, 'מגבונים': 14.90,
  'שמפו לתינוקות': 19.90, 'סבון לתינוקות': 14.90, 'קרם החתלה': 24.90,
  'מזון תינוקות': 12.90, 'דייסה לתינוקות': 24.90, 'פורמולה': 89.90,
  'מוצץ': 19.90, 'בקבוק תינוק': 34.90,

  // Cleaning - ניקיון
  'אקונומיקה': 9.90, 'נוזל כלים': 9.90, 'נוזל כלים פיירי': 14.90,
  'סבון כלים': 9.90, 'טבליות למדיח': 44.90, 'מלח למדיח': 14.90, 'מבריק למדיח': 19.90,
  'נוזל רצפות': 14.90, 'נוזל אוניברסלי': 12.90,
  'מסיר שומנים': 16.90, 'מסיר אבנית': 14.90, 'מנקה שירותים': 12.90,
  'מנקה אמבטיה': 14.90, 'מנקה זכוכית': 12.90, 'מנקה תנור': 19.90,
  'מרכך כביסה': 19.90, 'אבקת כביסה': 29.90, 'נוזל כביסה': 34.90,
  'קפסולות כביסה': 44.90, 'מסיר כתמים': 19.90,
  'מטליות': 9.90, 'ספוגים': 9.90, 'ספוג פלדה': 7.90,
  'שקיות אשפה': 14.90, 'מטאטא': 29.90, 'מגב': 34.90,
  'כפפות גומי': 9.90, 'כפפות חד פעמיות': 14.90,

  // Candles - נרות
  'נרות שבת': 12.90, 'נרות שבת 24': 14.90, 'נרות שבת 72': 29.90,
  'נרות חנוכה': 9.90, 'נרות חנוכה צבעוניים': 12.90,
  'שמן למאור': 14.90, 'שמן זית למאור': 24.90, 'פתילות': 7.90,
  'נר נשמה': 5.90, 'נר נשמה 24 שעות': 5.90, 'נר נשמה 48 שעות': 7.90, 'נר נשמה 7 ימים': 12.90,
  'נר הבדלה': 9.90, 'בשמים להבדלה': 14.90,
  'נרות יום הולדת': 9.90, 'נרות ריחניים': 24.90, 'נרות דקורטיביים': 29.90,
  'גפרורים': 4.90, 'מצית': 9.90, 'מציתים': 9.90,
  'חנוכייה': 29.90, 'סביבונים': 9.90,

  // Pets - חיות מחמד
  'אוכל לכלבים': 44.90, 'אוכל לכלבים יבש': 89.90,
  'אוכל לחתולים': 34.90, 'אוכל לחתולים יבש': 79.90,
  'חול לחתולים': 39.90, 'חטיפים לכלבים': 19.90, 'חטיפים לחתולים': 16.90,

  // Spreads - ממרחים
  'נוטלה': 24.90, 'ממרח שוקולד': 14.90, 'חמאת בוטנים': 22.90,
  'חמאת שקדים': 44.90, 'ריבה': 14.90, 'ריבה תות': 16.90,
  'מרמלדה': 12.90, 'דבש': 29.90, 'סילאן': 19.90,
  'חומוס': 12.90, 'טחינה': 14.90, 'ממרח זיתים': 18.90, 'פסטו': 22.90,

  // Desserts - קינוחים
  'מילקי': 5.90, 'דנונה': 5.50, 'יופלה': 5.90, 'שוקו': 4.90,
  'מעדן שוקולד': 6.90, 'קרם קרמל': 5.90, 'פודינג': 9.90, 'ג\'לי': 4.90,
  'עוגת גבינה': 34.90, 'טירמיסו': 29.90, 'סופלה שוקולד': 24.90
};

// Weight-based products (price per kg)
const WEIGHT_BASED_PRICES = {
  // Cheese
  'גבינה צהובה עמק': 119.90, 'גבינה צהובה גלבוע': 109.90, 'גבינה צהובה 9%': 99.90,
  'גבינה צהובה 22%': 109.90, 'גבינה צהובה': 109.90, 'עמק': 119.90, 'גלבוע': 109.90,
  'גאודה': 129.90, 'אמנטל': 149.90, 'גבינה בולגרית': 69.90, 'צפתית': 79.90,
  'מוצרלה': 79.90, 'פרמזן': 189.90, 'ברי': 139.90, 'קממבר': 119.90,
  'חלומי': 149.90, 'גבינת עזים': 119.90,
  // Deli
  'פסטרמה': 149.90, 'פסטרמה דבש': 149.90, 'פסטרמה הודו': 149.90,
  'סלמי': 139.90, 'סלמי הונגרי': 149.90,
  'חזה הודו מעושן': 129.90, 'הודו מעושן': 129.90, 'רוסטביף': 169.90,
  'נקניק': 89.90, 'חזה עוף מעושן': 119.90, 'קבב מוכן': 89.90,
  // Meat
  'חזה עוף': 49.90, 'שוקיים עוף': 39.90, 'כרעיים עוף': 34.90, 'כנפיים עוף': 29.90,
  'עוף טחון': 44.90, 'פרגית': 46.90, 'חזה הודו': 59.90, 'הודו טחון': 54.90,
  'בשר טחון': 69.90, 'אנטריקוט': 179.90, 'סינטה': 159.90, 'פילה בקר': 219.90,
  'צלעות בקר': 129.90, 'אסאדו': 109.90, 'גולש': 99.90, 'קבב': 69.90,
  // Fish
  'סלמון': 129.90, 'סלמון טרי': 149.90, 'דניס': 79.90, 'לברק': 89.90,
  'בורי': 59.90, 'אמנון': 49.90, 'פילה דג': 89.90
};

// API Handler
module.exports = function handler(req, res) {
  // Enable CORS
  res.setHeader('Access-Control-Allow-Origin', '*');
  res.setHeader('Access-Control-Allow-Methods', 'GET, OPTIONS');
  res.setHeader('Access-Control-Allow-Headers', 'Content-Type');
  res.setHeader('Cache-Control', 's-maxage=3600, stale-while-revalidate');

  if (req.method === 'OPTIONS') {
    return res.status(200).end();
  }

  const { product, category, all } = req.query;

  // Return all prices
  if (all === 'true' || all === '1') {
    return res.status(200).json({
      success: true,
      lastUpdated: '2025-02-07',
      totalProducts: Object.keys(PRICES_DATABASE).length,
      prices: PRICES_DATABASE,
      weightBasedPrices: WEIGHT_BASED_PRICES
    });
  }

  // Search for specific product
  if (product) {
    const searchTerm = product.toLowerCase();
    const results = {};

    for (const [name, price] of Object.entries(PRICES_DATABASE)) {
      if (name.toLowerCase().includes(searchTerm) || searchTerm.includes(name.toLowerCase())) {
        results[name] = price;
      }
    }

    const isWeightBased = WEIGHT_BASED_PRICES[product] !== undefined;

    return res.status(200).json({
      success: true,
      query: product,
      resultsCount: Object.keys(results).length,
      isWeightBased,
      pricePerKg: isWeightBased ? WEIGHT_BASED_PRICES[product] : null,
      results
    });
  }

  // Default: return API info
  return res.status(200).json({
    success: true,
    message: 'Israeli Supermarket Prices API',
    version: '1.1.0',
    lastUpdated: '2025-02-07',
    totalProducts: Object.keys(PRICES_DATABASE).length,
    endpoints: {
      getAllPrices: '/api/prices?all=true',
      searchProduct: '/api/prices?product=חלב',
    },
    disclaimer: 'המחירים משוערים בלבד ועשויים להשתנות בין רשתות ולפי מבצעים'
  });
}
